<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="theme-color" content="#2c7a7b">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <link rel="apple-touch-icon" href="https://cdn-icons-png.flaticon.com/512/822/822118.png">
    
    <title>Ù…Ø¬Ù…Ø¹ Ø§Ù„Ø´ÙØ§Ø¡ - Ø§Ù„Ù†Ø¸Ø§Ù… Ø§Ù„Ù…ØªÙƒØ§Ù…Ù„ 2026</title>
    
    <!-- PWA Manifest -->
    <link rel="manifest" href="data:application/manifest+json,{%22name%22:%22%D9%85%D8%AC%D9%85%D8%B9%20%D8%A7%D9%84%D8%B4%D9%81%D8%A7%D8%A1%22,%22short_name%22:%22%D8%A7%D9%84%D8%B4%D9%81%D8%A1%22,%22start_url%22:%22.%22,%22display%22:%22standalone%22,%22background_color%22:%22%23f8fafc%22,%22theme_color%22:%22%232c7a7b%22,%22description%22:%22%D9%86%D8%B8%D8%A7%D9%85%20%D8%A5%D8%AF%D8%A7%D8%B1%D8%A9%20%D8%A7%D9%84%D9%85%D8%B3%D8%AA%D8%B4%D9%81%D9%8A%D8%A7%D8%AA%20%D9%88%D8%A7%D9%84%D8%B9%D9%8A%D8%A7%D8%AF%D8%A7%D8%AA%20%D8%A7%D9%84%D8%B0%D9%83%D9%8A%22,%22icons%22:[{%22src%22:%22https://cdn-icons-png.flaticon.com/512/822/822118.png%22,%22sizes%22:%22512x512%22,%22type%22:%22image/png%22,%22purpose%22:%22any%22},{%22src%22:%22https://cdn-icons-png.flaticon.com/512/822/822118.png%22,%22sizes%22:%22192x192%22,%22type%22:%22image/png%22,%22purpose%22:%22maskable%22}]}">

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.rtl.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css"/>
    <style>
        /* ... Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø£Ù†Ù…Ø§Ø· Ø§Ù„Ø³Ø§Ø¨Ù‚Ø© ØªØ¨Ù‚Ù‰ ÙƒÙ…Ø§ Ù‡ÙŠ ... */
        /* ØªÙ… Ø¥Ø¶Ø§ÙØ© Ù†Ù…Ø· Ø¬Ø¯ÙŠØ¯ Ù„Ù„Ø´Ø§Ø´Ø© Ø§Ù„Ø¥Ø¯Ø§Ø±ÙŠØ© Ù„Ù„Ø¨ÙŠØ§Ù†Ø§Øª */
        .admin-login-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.8);
            z-index: 10000;
            display: flex;
            align-items: center;
            justify-content: center;
            display: none;
        }
    </style>
</head>
<body>

    <audio id="notificationSound" src="https://assets.mixkit.co/active_storage/sfx/2869/2869-preview.mp3" preload="auto"></audio>

    <!-- Ù…Ù†Ø·Ù‚Ø© Ø§Ù„Ø·Ø¨Ø§Ø¹Ø© -->
    <div id="printArea" class="hidden-section">
        <!-- ... Ø§Ù„Ù…Ø­ØªÙˆÙ‰ Ø§Ù„Ø³Ø§Ø¨Ù‚ ÙŠØ¨Ù‚Ù‰ ÙƒÙ…Ø§ Ù‡Ùˆ ... -->
    </div>

    <!-- Ø´Ø§Ø´Ø© ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ - Ø¨Ø¯ÙˆÙ† Ø¹Ø±Ø¶ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø­Ø³Ø§Ø³Ø© -->
    <div id="loginOverlay" class="no-print" style="position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: linear-gradient(rgba(44, 122, 123, 0.9), rgba(44, 122, 123, 0.8)); z-index: 9999; display: flex; align-items: center; justify-content: center;">
        <div class="card p-4 shadow-lg animate__animated animate__zoomIn" style="width: 380px; border-top: 8px solid var(--accent-gold);">
            <div class="text-center mb-4">
                <img src="https://cdn-icons-png.flaticon.com/512/822/822118.png" width="60">
                <h3 class="mt-2 fw-bold" style="color: var(--primary-color);">Ù…Ø¬Ù…Ø¹ Ø§Ù„Ø´ÙØ§Ø¡ Ø§Ù„Ø·Ø¨ÙŠ 2026</h3>
                <p class="text-muted small">Ø§Ù„Ù†Ø¸Ø§Ù… Ø§Ù„Ù…ØªÙƒØ§Ù…Ù„ Ø§Ù„Ù…Ø­Ø¯Ø« - Ø¥Ø¯Ø§Ø±Ø© Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø£Ù‚Ø³Ø§Ù…</p>
                <div class="mt-2">
                    <div class="form-check form-check-inline">
                        <input class="form-check-input" type="radio" name="loginMode" id="modeLocal" value="local" checked>
                        <label class="form-check-label" for="modeLocal">ğŸ’¾ Ø¹Ù…Ù„ Ù…Ø­Ù„ÙŠ</label>
                    </div>
                    <div class="form-check form-check-inline">
                        <input class="form-check-input" type="radio" name="loginMode" id="modeServer" value="server">
                        <label class="form-check-label" for="modeServer">â˜ï¸ Ù‚Ø§Ø¹Ø¯Ø© Ø¨ÙŠØ§Ù†Ø§Øª</label>
                    </div>
                </div>
            </div>
            <input type="text" id="username" class="form-control mb-3" placeholder="Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…">
            <input type="password" id="password" class="form-control mb-3" placeholder="ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±">
            <button class="btn btn-primary w-100 fw-bold" onclick="handleLogin()">ğŸš€ Ø¯Ø®ÙˆÙ„ Ù„Ù„Ù†Ø¸Ø§Ù…</button>
            <div class="mt-3 text-center small text-muted" id="loginStatus">Ø£Ø¯Ø®Ù„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø§Ù„Ø®Ø§ØµØ© Ø¨Ùƒ</div>
            
            <!-- Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø­Ø³Ø§Ø¨Ø§Øª Ø§Ù„Ø£Ù‚Ø³Ø§Ù… - Ù…Ø®ÙÙŠØ© -->
            <div class="mt-3 p-2 bg-light rounded" id="loginHelp" style="display: none;">
                <h6 class="text-center mb-2">ğŸ” Ù…Ø³Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¯Ø®ÙˆÙ„:</h6>
                <div class="row small text-muted">
                    <div class="col-12">
                        <div>ğŸ‘‘ Ø§Ù„Ù…Ø¯ÙŠØ±: admin</div>
                        <div>ğŸ‘¨â€âš•ï¸ Ø§Ù„Ø·Ø¨ÙŠØ¨: doctor</div>
                        <div>ğŸ“‹ Ø§Ù„Ø§Ø³ØªÙ‚Ø¨Ø§Ù„: reception</div>
                        <div>ğŸ’Š Ø§Ù„ØµÙŠØ¯Ù„ÙŠ: pharmacist</div>
                        <div>ğŸ§ª Ø§Ù„Ù…Ø¹Ù…Ù„: lab</div>
                        <div>ğŸ’‰ Ø§Ù„ØªÙ…Ø±ÙŠØ¶: nurse</div>
                    </div>
                </div>
                <p class="text-center mt-2 small">ØªÙˆØ§ØµÙ„ Ù…Ø¹ Ø§Ù„Ù…Ø¯ÙŠØ± Ù„Ø§Ø³ØªØ¹Ø§Ø¯Ø© ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±</p>
            </div>
            
            <div class="text-center mt-3">
                <button class="btn btn-sm btn-outline-secondary" onclick="toggleLoginHelp()">
                    <small>ğŸ‘ï¸ Ø¹Ø±Ø¶ Ø£Ø³Ù…Ø§Ø¡ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†</small>
                </button>
                <button class="btn btn-sm btn-outline-info ms-2" onclick="showAdminAccess()">
                    <small>ğŸ”§ ÙˆØµÙˆÙ„ Ø¥Ø¯Ø§Ø±ÙŠ</small>
                </button>
            </div>
        </div>
    </div>

    <!-- Ø´Ø§Ø´Ø© Ø§Ù„ÙˆØµÙˆÙ„ Ø§Ù„Ø¥Ø¯Ø§Ø±ÙŠ (Ù…Ø­Ù…ÙŠØ© Ø¨ÙƒÙ„Ù…Ø© Ø³Ø± Ø®Ø§ØµØ©) -->
    <div id="adminAccessOverlay" class="admin-login-overlay">
        <div class="card p-4 shadow-lg animate__animated animate__zoomIn" style="width: 380px; border-top: 8px solid var(--accent-red);">
            <div class="text-center mb-4">
                <h4 class="fw-bold text-danger">ğŸ”§ Ø§Ù„ÙˆØµÙˆÙ„ Ø§Ù„Ø¥Ø¯Ø§Ø±ÙŠ</h4>
                <p class="text-muted small">Ù„Ù„Ø¹Ø§Ù…Ù„ÙŠÙ† ÙÙŠ Ù‚Ø³Ù… Ø§Ù„Ø¯Ø¹Ù… Ø§Ù„ÙÙ†ÙŠ ÙÙ‚Ø·</p>
            </div>
            <input type="password" id="adminAccessPassword" class="form-control mb-3" placeholder="ÙƒÙ„Ù…Ø© Ù…Ø±ÙˆØ± Ø§Ù„ÙˆØµÙˆÙ„ Ø§Ù„Ø¥Ø¯Ø§Ø±ÙŠ">
            <button class="btn btn-danger w-100 fw-bold" onclick="verifyAdminAccess()">ğŸ”“ Ø¯Ø®ÙˆÙ„</button>
            <button class="btn btn-outline-secondary w-100 mt-2" onclick="hideAdminAccess()">Ø±Ø¬ÙˆØ¹</button>
        </div>
    </div>

    <!-- Ø§Ù„Ù…Ø­ØªÙˆÙ‰ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ -->
    <div id="mainContent" class="hidden-section">
        <!-- Ø¨Ø§Ù‚ÙŠ Ø§Ù„Ù…Ø­ØªÙˆÙ‰ ÙŠØ¨Ù‚Ù‰ ÙƒÙ…Ø§ Ù‡Ùˆ Ø¨Ø¯ÙˆÙ† ØªØºÙŠÙŠØ± -->
        <!-- ... -->
    </div>

    <!-- Modals -->
    <!-- ... Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù€ Modals Ø§Ù„Ø³Ø§Ø¨Ù‚Ø© ØªØ¨Ù‚Ù‰ ÙƒÙ…Ø§ Ù‡ÙŠ ... -->

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script>
        // ============================================
        // Ù†Ø¸Ø§Ù… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ù„Ù„Ø£Ù‚Ø³Ø§Ù… (Ù…Ø®ÙÙ‰ Ø¹Ù† Ø§Ù„ÙˆØ§Ø¬Ù‡Ø©)
        // ============================================

        const USERS = {
            'admin': { password: '123', role: 'admin', name: 'Ø§Ù„Ù…Ø¯ÙŠØ±' },
            'doctor': { password: 'doc123', role: 'doctor', name: 'Ø§Ù„Ø·Ø¨ÙŠØ¨' },
            'reception': { password: 'rec123', role: 'reception', name: 'Ø§Ù„Ø§Ø³ØªÙ‚Ø¨Ø§Ù„' },
            'pharmacist': { password: 'ph123', role: 'pharmacy', name: 'Ø§Ù„ØµÙŠØ¯Ù„ÙŠ' },
            'lab': { password: 'lab123', role: 'lab', name: 'Ø§Ù„Ù…Ø¹Ù…Ù„' },
            'nurse': { password: 'nur123', role: 'nursing', name: 'Ø§Ù„ØªÙ…Ø±ÙŠØ¶' }
        };

        // ÙƒÙ„Ù…Ø© Ù…Ø±ÙˆØ± Ø®Ø§ØµØ© Ù„Ù„ÙˆØµÙˆÙ„ Ø§Ù„Ø¥Ø¯Ø§Ø±ÙŠ (Ù„Ù„Ø¹Ø§Ù…Ù„ÙŠÙ† Ø§Ù„ÙÙ†ÙŠÙŠÙ† ÙÙ‚Ø·)
        const ADMIN_ACCESS_PASSWORD = 'shifa2026';

        let currentUser = null;
        let patients = JSON.parse(localStorage.getItem('shifa_pats')) || [];
        let labRequests = JSON.parse(localStorage.getItem('shifa_lab')) || [];
        let pharmOrders = JSON.parse(localStorage.getItem('shifa_rx')) || [];
        let nursingTasks = JSON.parse(localStorage.getItem('shifa_nursing_tasks')) || [];
        let financials = JSON.parse(localStorage.getItem('shifa_fin')) || { clinic: 0, lab: 0, pharSales: 0, pharProfit: 0, total: 0 };
        let staffMembers = JSON.parse(localStorage.getItem('shifa_staff')) || [];
        let medicalLibrary = JSON.parse(localStorage.getItem('shifa_library')) || [];
        let backups = JSON.parse(localStorage.getItem('shifa_backups')) || [];
        
        // Ø¨ÙŠØ§Ù†Ø§Øª Ø¬Ø¯ÙŠØ¯Ø©
        let labTests = JSON.parse(localStorage.getItem('shifa_labTests')) || [
            {name: 'CBC', price: 5000},
            {name: 'Malaria', price: 2000},
            {name: 'Glucose', price: 1000},
            {name: 'Cholesterol', price: 3000}
        ];
        
        let inventory = JSON.parse(localStorage.getItem('shifa_inventory')) || [
            {name: 'Panadol', price: 1000, qty: 100},
            {name: 'Antibiotic', price: 2500, qty: 50},
            {name: 'Vitamin C', price: 1500, qty: 75}
        ];

        // ============================================
        // Ø¯ÙˆØ§Ù„ Ø¬Ø¯ÙŠØ¯Ø© Ù„Ù„ØªØ­ÙƒÙ… ÙÙŠ Ø¹Ø±Ø¶ Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øª
        // ============================================

        function toggleLoginHelp() {
            const helpDiv = document.getElementById('loginHelp');
            const button = event.target.closest('button');
            
            if (helpDiv.style.display === 'none') {
                helpDiv.style.display = 'block';
                button.innerHTML = '<small>ğŸ‘ï¸ Ø¥Ø®ÙØ§Ø¡ Ø£Ø³Ù…Ø§Ø¡ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†</small>';
            } else {
                helpDiv.style.display = 'none';
                button.innerHTML = '<small>ğŸ‘ï¸ Ø¹Ø±Ø¶ Ø£Ø³Ù…Ø§Ø¡ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†</small>';
            }
        }

        function showAdminAccess() {
            document.getElementById('adminAccessOverlay').style.display = 'flex';
        }

        function hideAdminAccess() {
            document.getElementById('adminAccessOverlay').style.display = 'none';
            document.getElementById('adminAccessPassword').value = '';
        }

        function verifyAdminAccess() {
            const password = document.getElementById('adminAccessPassword').value;
            
            if (password === ADMIN_ACCESS_PASSWORD) {
                // Ø¹Ø±Ø¶ ÙƒÙ„Ù…Ø§Øª Ø§Ù„Ù…Ø±ÙˆØ± Ø§Ù„Ø­Ù‚ÙŠÙ‚ÙŠØ© Ù„Ù„Ø¯Ø¹Ù… Ø§Ù„ÙÙ†ÙŠ
                alert('ğŸ”§ Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø§Ù„Ø¥Ø¯Ø§Ø±ÙŠØ©:\n\n' +
                      'ğŸ‘‘ Ø§Ù„Ù…Ø¯ÙŠØ±: admin / 123\n' +
                      'ğŸ‘¨â€âš•ï¸ Ø§Ù„Ø·Ø¨ÙŠØ¨: doctor / doc123\n' +
                      'ğŸ“‹ Ø§Ù„Ø§Ø³ØªÙ‚Ø¨Ø§Ù„: reception / rec123\n' +
                      'ğŸ’Š Ø§Ù„ØµÙŠØ¯Ù„ÙŠ: pharmacist / ph123\n' +
                      'ğŸ§ª Ø§Ù„Ù…Ø¹Ù…Ù„: lab / lab123\n' +
                      'ğŸ’‰ Ø§Ù„ØªÙ…Ø±ÙŠØ¶: nurse / nur123\n\n' +
                      'âš ï¸ Ù‡Ø°Ù‡ Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø­Ø³Ø§Ø³Ø© ÙˆÙ„Ø§ ÙŠØ¬Ø¨ Ù…Ø´Ø§Ø±ÙƒØªÙ‡Ø§.');
                hideAdminAccess();
            } else {
                alert('âŒ ÙƒÙ„Ù…Ø© Ù…Ø±ÙˆØ± Ø§Ù„ÙˆØµÙˆÙ„ Ø§Ù„Ø¥Ø¯Ø§Ø±ÙŠ ØºÙŠØ± ØµØ­ÙŠØ­Ø©');
            }
        }

        // ============================================
        // Ù†Ø¸Ø§Ù… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ (Ø¨Ø§Ù‚ÙŠ ÙƒÙ…Ø§ Ù‡Ùˆ)
        // ============================================

        function handleLogin() {
            const username = document.getElementById('username').value.trim();
            const password = document.getElementById('password').value;
            
            if (!username || !password) {
                alert('âš ï¸ Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… ÙˆÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±!');
                return;
            }
            
            if (USERS[username] && USERS[username].password === password) {
                currentUser = {
                    u: username,
                    r: USERS[username].role,
                    name: USERS[username].name
                };
                
                localStorage.setItem('shifa_user', JSON.stringify(currentUser));
                
                document.getElementById('loginOverlay').classList.add('hidden-section');
                document.getElementById('mainContent').classList.remove('hidden-section');
                document.getElementById('currentUserDisplay').textContent = `ğŸ‘¤ ${currentUser.name}`;
                
                // ØªÙ‡ÙŠØ¦Ø© Ù‚Ø³Ù… Ø§Ù„Ù…Ø¯ÙŠØ± Ø¥Ø°Ø§ ÙƒØ§Ù† Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ù…Ø¯ÙŠØ±Ø§Ù‹
                if (currentUser.r === 'admin') {
                    initAdminSection();
                    switchSection('admin');
                } else {
                    switchSection(currentUser.r);
                }
                
                showNotification(`Ù…Ø±Ø­Ø¨Ø§Ù‹ ${currentUser.name}`, `ØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø¥Ù„Ù‰ Ù‚Ø³Ù… ${currentUser.name} Ø¨Ù†Ø¬Ø§Ø­!`);
            } else {
                alert('âŒ Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø£Ùˆ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± ØºÙŠØ± ØµØ­ÙŠØ­Ø©!');
            }
        }

        // ============================================
        // Ø¯ÙˆØ§Ù„ Ù‚Ø³Ù… Ø§Ù„Ø§Ø³ØªÙ‚Ø¨Ø§Ù„
        // ============================================

        function registerPatient() {
            const name = document.getElementById('pName').value.trim();
            const age = document.getElementById('pAge').value;
            const ticket = parseFloat(document.getElementById('pTicket').value) || 2000;
            
            if (!name) {
                alert("âš ï¸ Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ø³Ù… Ø§Ù„Ù…Ø±ÙŠØ¶!");
                return;
            }
            
            const patientId = Date.now();
            const newPatient = {
                id: patientId,
                name: name,
                age: age,
                gender: document.getElementById('pGender').value,
                phone: document.getElementById('pPhone').value.trim(),
                address: document.getElementById('pAddress').value,
                ticket: ticket,
                visitType: document.getElementById('pVisitType').value,
                medicalHistory: document.getElementById('pMedicalHistory').value,
                status: 'waiting_doctor',
                department: 'doctor',
                createdAt: new Date().toISOString(),
                time: new Date().toLocaleTimeString('ar-EG'),
                complaint: '',
                diagnosis: '',
                tests: [],
                meds: [],
                nursingInstructions: '',
                vitalSigns: {}
            };
            
            patients.push(newPatient);
            localStorage.setItem('shifa_pats', JSON.stringify(patients));
            
            // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª
            financials.clinic += newPatient.ticket;
            localStorage.setItem('shifa_fin', JSON.stringify(financials));
            
            // Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø§Ù„Ø­Ù‚ÙˆÙ„
            document.getElementById('pName').value = '';
            document.getElementById('pAge').value = '';
            document.getElementById('pPhone').value = '';
            document.getElementById('pAddress').value = '';
            document.getElementById('pMedicalHistory').value = '';
            
            showNotification("âœ… ØªÙ… Ø§Ù„ØªØ³Ø¬ÙŠÙ„", `ØªÙ… ØªØ³Ø¬ÙŠÙ„ ${name} ÙˆØ¥Ø±Ø³Ø§Ù„Ù‡ Ù„Ù„Ø·Ø¨ÙŠØ¨`);
            
            updateReceptionStats();
            updateBadges();
            loadReception();
        }

        // ============================================
        // Ø¨Ø§Ù‚ÙŠ Ø§Ù„Ø¯ÙˆØ§Ù„ ØªØ¨Ù‚Ù‰ ÙƒÙ…Ø§ Ù‡ÙŠ Ø¨Ø¯ÙˆÙ† ØªØºÙŠÙŠØ±
        // ============================================

        // ... (Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¯ÙˆØ§Ù„ Ø§Ù„Ø£Ø®Ø±Ù‰ ØªØ¨Ù‚Ù‰ ÙƒÙ…Ø§ Ù‡ÙŠ Ø¨Ø¯ÙˆÙ† ØªØºÙŠÙŠØ±) ...

        // ============================================
        // ØªÙ‡ÙŠØ¦Ø© Ø§Ù„Ù†Ø¸Ø§Ù…
        // ============================================

        window.onload = function() {
            updateClock();
            setInterval(updateClock, 1000);
            
            if ('Notification' in window && Notification.permission === 'default') {
                Notification.requestPermission();
            }
            
            const savedUser = localStorage.getItem('shifa_user');
            if (savedUser) {
                currentUser = JSON.parse(savedUser);
                document.getElementById('loginOverlay').classList.add('hidden-section');
                document.getElementById('mainContent').classList.remove('hidden-section');
                document.getElementById('currentUserDisplay').textContent = `ğŸ‘¤ ${currentUser.name}`;
                
                if (currentUser.r === 'admin') {
                    initAdminSection();
                    switchSection('admin');
                } else {
                    switchSection(currentUser.r);
                }
            }
            
            // ØªÙ‡ÙŠØ¦Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠØ©
            if (staffMembers.length === 0) {
                staffMembers = Object.keys(USERS).map(username => ({
                    u: username,
                    p: USERS[username].password,
                    r: USERS[username].role,
                    name: USERS[username].name,
                    status: 'active',
                    created: new Date().toISOString()
                }));
                localStorage.setItem('shifa_staff', JSON.stringify(staffMembers));
            }
            
            if (medicalLibrary.length === 0) {
                medicalLibrary = [
                    {
                        id: 1,
                        title: 'Ù…Ø±Ø¶ Ø§Ù„Ø³ÙƒØ±ÙŠ',
                        category: 'diseases',
                        content: 'Ù…Ø±Ø¶ Ù…Ø²Ù…Ù† ÙŠØ­Ø¯Ø« Ø¹Ù†Ø¯Ù…Ø§ ÙŠØ¹Ø¬Ø² Ø§Ù„Ø¨Ù†ÙƒØ±ÙŠØ§Ø³ Ø¹Ù† Ø¥Ù†ØªØ§Ø¬ Ø§Ù„Ø¥Ù†Ø³ÙˆÙ„ÙŠÙ† Ø¨ÙƒÙ…ÙŠØ© ÙƒØ§ÙÙŠØ©...',
                        addedBy: 'system',
                        addedAt: new Date().toISOString()
                    },
                    {
                        id: 2,
                        title: 'Ø¨Ø§Ø±Ø§Ø³ÙŠØªØ§Ù…ÙˆÙ„',
                        category: 'drugs',
                        content: 'Ù…Ø³ÙƒÙ† Ù„Ù„Ø£Ù„Ù… ÙˆØ®Ø§ÙØ¶ Ù„Ù„Ø­Ø±Ø§Ø±Ø©ØŒ Ø§Ù„Ø¬Ø±Ø¹Ø© Ø§Ù„Ù…Ø¹ØªØ§Ø¯Ø© 500-1000 Ù…Ø¬Ù… ÙƒÙ„ 6-8 Ø³Ø§Ø¹Ø§Øª...',
                        addedBy: 'system',
                        addedAt: new Date().toISOString()
                    }
                ];
                localStorage.setItem('shifa_library', JSON.stringify(medicalLibrary));
            }
            
            // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù€ badges
            updateBadges();
        };

        // ============================================
        // Ø¯ÙˆØ§Ù„ Ø¥Ø¶Ø§ÙÙŠØ©
        // ============================================

        function updateClock() {
            const now = new Date();
            const clockElement = document.getElementById('clockDisplay');
            if (clockElement) {
                clockElement.textContent = now.toLocaleTimeString('ar-EG');
            }
        }

        function showNotification(title, message) {
            console.log(`ğŸ”” ${title}: ${message}`);
            
            try {
                document.getElementById('notificationSound').play();
            } catch (e) {}
            
            if ('Notification' in window && Notification.permission === 'granted') {
                new Notification(title, {
                    body: message,
                    icon: 'https://cdn-icons-png.flaticon.com/512/822/822118.png'
                });
            }
        }

        function playNotify() {
            try {
                document.getElementById('notificationSound').play();
            } catch (e) {}
        }

        // ============================================
        // Ø¯Ø§Ù„Ø© ØªØºÙŠÙŠØ± ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± Ù„Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†
        // ============================================

        function changePassword() {
            const modal = new bootstrap.Modal(document.getElementById('changePasswordModal'));
            modal.show();
        }

        function confirmPasswordChange() {
            const currentPass = document.getElementById('currentPassword').value;
            const newPass = document.getElementById('newPassword').value;
            const confirmPass = document.getElementById('confirmPassword').value;
            
            if (!currentPass || !newPass || !confirmPass) {
                alert('âš ï¸ Ø§Ù„Ø±Ø¬Ø§Ø¡ Ù…Ù„Ø¡ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ„!');
                return;
            }
            
            if (newPass !== confirmPass) {
                alert('âš ï¸ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø© ØºÙŠØ± Ù…ØªØ·Ø§Ø¨Ù‚Ø©!');
                return;
            }
            
            if (newPass.length < 4) {
                alert('âš ï¸ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± ÙŠØ¬Ø¨ Ø£Ù† ØªÙƒÙˆÙ† 4 Ø£Ø­Ø±Ù Ø¹Ù„Ù‰ Ø§Ù„Ø£Ù‚Ù„!');
                return;
            }
            
            // ØªØ­Ø¯ÙŠØ« ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± Ù„Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø§Ù„Ø­Ø§Ù„ÙŠ
            USERS[currentUser.u].password = newPass;
            
            // ØªØ­Ø¯ÙŠØ« ÙÙŠ staffMembers
            const staff = staffMembers.find(s => s.u === currentUser.u);
            if (staff) {
                staff.p = newPass;
                localStorage.setItem('shifa_staff', JSON.stringify(staffMembers));
            }
            
            alert('âœ… ØªÙ… ØªØºÙŠÙŠØ± ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± Ø¨Ù†Ø¬Ø§Ø­!');
            const modal = bootstrap.Modal.getInstance(document.getElementById('changePasswordModal'));
            modal.hide();
        }

    </script>
</body>
</html>
