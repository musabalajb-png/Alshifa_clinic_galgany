<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="theme-color" content="#2c7a7b">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <link rel="apple-touch-icon" href="https://cdn-icons-png.flaticon.com/512/822/822118.png">
    
    <title>Ù…Ø¬Ù…Ø¹ Ø§Ù„Ø´ÙØ§Ø¡ - Ø§Ù„Ù†Ø³Ø®Ø© Ø§Ù„Ø°ÙƒÙŠØ© Ø§Ù„Ø´Ø§Ù…Ù„Ø© 2025</title>
    
    <!-- PWA Manifest -->
    <link rel="manifest" href="data:application/manifest+json,{%22name%22:%22%D9%85%D8%AC%D9%85%D8%B9%20%D8%A7%D9%84%D8%B4%D9%81%D8%A7%D8%A1%22,%22short_name%22:%22%D8%A7%D9%84%D8%B4%D9%81%D8%A1%22,%22start_url%22:%22.%22,%22display%22:%22standalone%22,%22background_color%22:%22%23f8fafc%22,%22theme_color%22:%22%232c7a7b%22,%22description%22:%22%D9%86%D8%B8%D8%A7%D9%85%20%D8%A5%D8%AF%D8%A7%D8%B1%D8%A9%20%D8%A7%D9%84%D9%85%D8%B3%D8%AA%D8%B4%D9%81%D9%8A%D8%A7%D8%AA%20%D9%88%D8%A7%D9%84%D8%B9%D9%8A%D8%A7%D8%AF%D8%A7%D8%AA%20%D8%A7%D9%84%D8%B0%D9%83%D9%8A%22,%22icons%22:[{%22src%22:%22https://cdn-icons-png.flaticon.com/512/822/822118.png%22,%22sizes%22:%22512x512%22,%22type%22:%22image/png%22,%22purpose%22:%22any%22},{%22src%22:%22https://cdn-icons-png.flaticon.com/512/822/822118.png%22,%22sizes%22:%22192x192%22,%22type%22:%22image/png%22,%22purpose%22:%22maskable%22}]}">

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.rtl.min.css" rel="stylesheet">
    <style>
        :root { 
            --primary-color: #2c7a7b; 
            --secondary-color: #f0fdf4; 
            --accent-blue: #0d6efd; 
            --accent-red: #dc3545; 
            --accent-green: #198754; 
            --accent-gold: #d4af37;
            --accent-warning: #ffc107;
            --accent-info: #17a2b8;
            --accent-purple: #6f42c1;
        }
        body { background-color: #f8fafc; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; -webkit-tap-highlight-color: transparent; }
        .navbar { background-color: var(--primary-color) !important; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
        .card { border-radius: 15px; border: none; box-shadow: 0 4px 12px rgba(0,0,0,0.08); margin-bottom: 15px; transition: transform 0.2s; }
        .card:hover { transform: translateY(-2px); }
        .hidden-section { display: none !important; }
        .nav-link { cursor: pointer; font-weight: bold; color: var(--primary-color); padding: 10px 20px !important; position: relative; }
        .nav-link.active { background-color: var(--accent-blue) !important; color: white !important; border-radius: 10px; }
        .badge-notify { position: absolute; top: -5px; right: -5px; background: var(--accent-red); color: white; border-radius: 50%; padding: 3px 7px; font-size: 0.7rem; }
        .stat-card { border-radius: 15px; padding: 20px; color: white; text-align: center; }
        .patient-btn { text-align: right; margin-bottom: 8px; border-right: 5px solid var(--primary-color); width: 100%; transition: 0.3s; padding: 12px 15px; background: white; border: 1px solid #dee2e6; border-radius: 10px; }
        .patient-btn.ready { border-right-color: #28a745; background-color: #f0fff4; }
        .patient-btn:hover { background-color: #f8f9fa; }
        .lab-result-item { background: #e9ecef; padding: 10px; border-radius: 8px; margin-bottom: 5px; border-left: 4px solid var(--accent-blue); }
        .section-pane { animation: fadeIn 0.3s ease-in; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        @media print { .no-print { display: none !important; } body * { visibility: hidden; } #printArea, #printArea * { visibility: visible; } #printArea { position: absolute; left: 0; top: 0; width: 100%; direction: rtl; padding: 20px; } }
        .search-box { position: relative; }
        .search-box input { padding-right: 40px; }
        .rx-item { background: #f8f9fa; padding: 8px 12px; margin: 5px 0; border-radius: 8px; border-left: 4px solid var(--accent-green); }
        .status-online { color: #28a745; font-weight: bold; }
        .status-offline { color: #dc3545; font-weight: bold; }
        .sync-status { position: fixed; bottom: 10px; left: 10px; z-index: 1000; }
        .sync-btn { position: fixed; bottom: 10px; right: 10px; z-index: 1000; }
        .medical-record { background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%); padding: 20px; border-radius: 10px; margin-bottom: 20px; }
        .nursing-schedule { border-left: 5px solid var(--accent-purple); }
        .expiry-warning { background: #fff3cd; border-left: 5px solid #ffc107; }
        .stock-critical { background: #f8d7da; border-left: 5px solid #dc3545; }
        .library-card { height: 100%; transition: all 0.3s; }
        .library-card:hover { transform: scale(1.02); box-shadow: 0 6px 20px rgba(0,0,0,0.15); }
        .form-check { padding-right: 1.5em; margin-bottom: 0.5rem; }
        .form-check-input { margin-right: -1.5em; }
        #labTestsChecklist { scrollbar-width: thin; scrollbar-color: var(--primary-color) #f1f1f1; }
        #labTestsChecklist::-webkit-scrollbar { width: 8px; }
        #labTestsChecklist::-webkit-scrollbar-track { background: #f1f1f1; border-radius: 4px; }
        #labTestsChecklist::-webkit-scrollbar-thumb { background: var(--primary-color); border-radius: 4px; }
        
        /* PWA Styles */
        .install-btn { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; border: none; border-radius: 50px; padding: 10px 20px; font-weight: bold; box-shadow: 0 4px 15px rgba(0,0,0,0.2); transition: all 0.3s; }
        .install-btn:hover { transform: translateY(-2px); box-shadow: 0 6px 20px rgba(0,0,0,0.3); }
        .pwa-status { position: fixed; top: 10px; left: 10px; z-index: 9999; }
        .pwa-notification { position: fixed; bottom: 20px; left: 50%; transform: translateX(-50%); background: white; border-radius: 15px; box-shadow: 0 10px 30px rgba(0,0,0,0.2); padding: 20px; z-index: 10000; max-width: 400px; direction: rtl; }
        .offline-banner { position: fixed; top: 0; left: 0; right: 0; background: #dc3545; color: white; text-align: center; padding: 10px; z-index: 9998; }
        .online-banner { position: fixed; top: 0; left: 0; right: 0; background: #28a745; color: white; text-align: center; padding: 10px; z-index: 9998; }
        #appVersion { font-size: 0.8em; color: #6c757d; }
        
        /* Advanced Permissions Styles */
        .permission-badge { font-size: 0.7em; padding: 2px 6px; margin-right: 3px; }
        .permission-row { border-bottom: 1px solid #eee; padding: 8px 0; }
        .permission-header { background: linear-gradient(135deg, #6a11cb 0%, #2575fc 100%); color: white; padding: 10px; border-radius: 8px; }
        .permission-toggle { transform: scale(0.9); }
        .user-status-online { color: #28a745; animation: pulse 2s infinite; }
        .user-status-offline { color: #dc3545; }
        @keyframes pulse { 0% { opacity: 1; } 50% { opacity: 0.7; } 100% { opacity: 1; } }
        .role-badge { font-size: 0.75em; padding: 3px 8px; }
        .permission-modal { max-height: 80vh; overflow-y: auto; }
        .password-strength { height: 5px; border-radius: 2px; margin-top: 5px; transition: all 0.3s; }
    </style>
</head>
<body>

    <audio id="notificationSound" src="https://assets.mixkit.co/active_storage/sfx/2869/2869-preview.mp3"></audio>

    <!-- Ù…Ù†Ø·Ù‚Ø© Ø§Ù„Ø·Ø¨Ø§Ø¹Ø© -->
    <div id="printArea" class="hidden-section">
        <div class="text-center border-bottom pb-3 mb-3">
            <h2 style="color: var(--primary-color);">ğŸ¥ Ù…Ø¬Ù…Ø¹ Ø§Ù„Ø´ÙØ§Ø¡ Ø§Ù„Ø·Ø¨ÙŠ</h2>
            <p>Ø§Ù„Ø³ÙˆØ¯Ø§Ù† - Ø¬Ù„Ù‚Ù†ÙŠ</p>
            <h5 id="printTitle">Ø±ÙˆØ´ØªØ© Ø·Ø¨ÙŠØ© / ÙØ§ØªÙˆØ±Ø©</h5>
            <small id="printDate"></small>
        </div>
        <div id="printContent" class="fs-5"></div>
        <div class="mt-5 pt-3 border-top text-center"><p>Ù†ØªÙ…Ù†Ù‰ Ù„ÙƒÙ… Ø¹Ø§Ø¬Ù„ Ø§Ù„Ø´ÙØ§Ø¡</p></div>
    </div>

    <!-- Ø´Ø§Ø´Ø© ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ -->
    <div id="loginOverlay" class="no-print" style="position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: #f0fdf4; z-index: 9999; display: flex; align-items: center; justify-content: center;">
        <div class="card p-4 shadow-lg" style="width: 380px; border-top: 8px solid var(--primary-color);">
            <div class="text-center mb-4">
                <img src="https://cdn-icons-png.flaticon.com/512/822/822118.png" width="60">
                <h3 class="mt-2 fw-bold" style="color: var(--primary-color);">Ù…Ø¬Ù…Ø¹ Ø§Ù„Ø´ÙØ§Ø¡ Ø§Ù„Ø·Ø¨ÙŠ</h3>
                <p class="text-muted small">Ø§Ù„Ù†Ø¸Ø§Ù… Ø§Ù„Ø°ÙƒÙŠ Ø§Ù„Ø´Ø§Ù…Ù„ - Ø¥Ø¯Ø§Ø±Ø© Ù…ØªÙƒØ§Ù…Ù„Ø©</p>
                <div class="mt-2">
                    <div class="form-check form-check-inline">
                        <input class="form-check-input" type="radio" name="loginMode" id="modeLocal" value="local" checked>
                        <label class="form-check-label" for="modeLocal">ğŸ’¾ Ø¹Ù…Ù„ Ù…Ø­Ù„ÙŠ</label>
                    </div>
                    <div class="form-check form-check-inline">
                        <input class="form-check-input" type="radio" name="loginMode" id="modeServer" value="server">
                        <label class="form-check-label" for="modeServer">â˜ï¸ Ù‚Ø§Ø¹Ø¯Ø© Ø¨ÙŠØ§Ù†Ø§Øª</label>
                    </div>
                </div>
            </div>
            <input type="text" id="username" class="form-control mb-3" placeholder="Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…" value="admin">
            <input type="password" id="password" class="form-control mb-3" placeholder="ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±" value="123">
            <button class="btn btn-primary w-100 fw-bold" onclick="handleLogin()">ğŸš€ Ø¯Ø®ÙˆÙ„ Ù„Ù„Ù†Ø¸Ø§Ù…</button>
            <div class="mt-3 text-center small text-muted" id="loginStatus">Ø¬Ø§Ù‡Ø² Ù„Ù„ØªØ´ØºÙŠÙ„</div>
            
            <!-- PWA Install Button -->
            <button id="installButton" class="install-btn hidden-section w-100 mt-3">
                ğŸ“² ØªØ«Ø¨ÙŠØª Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ Ø¹Ù„Ù‰ Ø§Ù„Ø¬Ù‡Ø§Ø²
            </button>
            
            <div id="appVersion" class="mt-2">Ø§Ù„Ø¥ØµØ¯Ø§Ø± 2.6.0 - Ù†Ø¸Ø§Ù… Ø§Ù„ØµÙ„Ø§Ø­ÙŠØ§Øª Ø§Ù„Ù…ØªÙ‚Ø¯Ù…</div>
        </div>
    </div>

    <!-- Ø§Ù„Ù…Ø­ØªÙˆÙ‰ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ -->
    <div id="mainContent" class="hidden-section">
        <!-- PWA Status -->
        <div class="pwa-status no-print">
            <div id="pwaStatus" class="badge bg-info">PWA: Ù†Ø´Ø·</div>
        </div>
        
        <!-- Ø´Ø±ÙŠØ· Ø§Ù„ØªÙ†Ù‚Ù„ -->
        <nav class="navbar navbar-dark mb-4 no-print">
            <div class="container d-flex justify-content-between text-white align-items-center">
                <span class="navbar-brand fw-bold">ğŸ¥ Ù…Ø¬Ù…Ø¹ Ø§Ù„Ø´ÙØ§Ø¡ - Ø§Ù„Ù†Ø¸Ø§Ù… Ø§Ù„Ø°ÙƒÙŠ</span>
                <div>
                    <span id="currentUserDisplay" class="badge bg-light text-dark mx-2"></span>
                    <span id="clockDisplay" class="badge bg-info text-dark"></span>
                    <span id="connectionStatus" class="badge bg-success mx-2">Ù…ØªØµÙ„ Ù…Ø­Ù„ÙŠØ§Ù‹</span>
                    <button class="btn btn-sm btn-outline-light ms-2" onclick="openUserMenu()">ğŸ‘¤</button>
                </div>
                <button class="btn btn-sm btn-outline-light" onclick="logout()">Ø®Ø±ÙˆØ¬</button>
            </div>
        </nav>

        <!-- ØªØ¨ÙˆÙŠØ¨Ø§Øª Ø§Ù„ØªÙ†Ù‚Ù„ -->
        <div class="container">
            <ul class="nav nav-pills mb-4 shadow-sm p-2 bg-white rounded justify-content-center no-print" id="mainTabs">
                <li class="nav-item" id="tab-reception-li"><button class="nav-link" id="btn-reception" onclick="switchSection('reception')">ğŸ“‹ Ø§Ù„Ø§Ø³ØªÙ‚Ø¨Ø§Ù„</button></li>
                <li class="nav-item" id="tab-doctor-li"><button class="nav-link" id="btn-doctor" onclick="switchSection('doctor')">ğŸ‘¨â€âš•ï¸ Ø§Ù„Ø¹ÙŠØ§Ø¯Ø© <span id="doctorBadge" class="badge-notify hidden-section">0</span></button></li>
                <li class="nav-item" id="tab-lab-li"><button class="nav-link" id="btn-lab" onclick="switchSection('lab')">ğŸ§ª Ø§Ù„Ù…Ø¹Ù…Ù„ <span id="labBadge" class="badge-notify hidden-section">0</span></button></li>
                <li class="nav-item" id="tab-pharmacy-li"><button class="nav-link" id="btn-pharmacy" onclick="switchSection('pharmacy')">ğŸ’Š Ø§Ù„ØµÙŠØ¯Ù„ÙŠØ© <span id="pharBadge" class="badge-notify hidden-section">0</span></button></li>
                <li class="nav-item" id="tab-nursing-li"><button class="nav-link" id="btn-nursing" onclick="switchSection('nursing')">ğŸ’‰ Ø§Ù„ØªÙ…Ø±ÙŠØ¶ <span id="nurseBadge" class="badge-notify hidden-section">0</span></button></li>
                <li class="nav-item" id="tab-admin-li"><button class="nav-link" id="btn-admin" onclick="switchSection('admin')">ğŸ‘‘ Ø§Ù„Ù…Ø¯ÙŠØ±</button></li>
            </ul>

            <!-- Ø£Ø²Ø±Ø§Ø± Ø§Ù„Ù…Ø²Ø§Ù…Ù†Ø© -->
            <div class="sync-status no-print">
                <div id="syncStatusText" class="badge bg-secondary">Ø¬Ø§Ù‡Ø²</div>
            </div>
            <div class="sync-btn no-print">
                <button class="btn btn-sm btn-outline-primary" onclick="manualSync()" title="Ù…Ø²Ø§Ù…Ù†Ø© ÙŠØ¯ÙˆÙŠØ©">
                    ğŸ”„ Ù…Ø²Ø§Ù…Ù†Ø©
                </button>
            </div>

            <!-- Ù…Ø­ØªÙˆÙ‰ Ø§Ù„Ø£Ù‚Ø³Ø§Ù… -->
            <div class="tab-content">
                <!-- Ù‚Ø³Ù… Ø§Ù„Ø§Ø³ØªÙ‚Ø¨Ø§Ù„ (Ù…Ø­Ø¯Ø«) -->
                <div id="reception-sec" class="section-pane hidden-section">
                    <div class="row">
                        <div class="col-md-8">
                            <div class="card p-4 border-primary border-top border-4 shadow">
                                <h5 class="fw-bold text-primary mb-3">ğŸ“‹ ØªØ³Ø¬ÙŠÙ„ Ù…Ø±ÙŠØ¶ Ø¬Ø¯ÙŠØ¯ - Ø§Ù„Ø³Ø¬Ù„ Ø§Ù„Ø´Ø§Ù…Ù„</h5>
                                <div class="row g-3">
                                    <div class="col-md-4">
                                        <input type="text" id="pName" class="form-control" placeholder="Ø§Ù„Ø§Ø³Ù… Ø±Ø¨Ø§Ø¹ÙŠ *" required>
                                    </div>
                                    <div class="col-md-2">
                                        <input type="number" id="pAge" class="form-control" placeholder="Ø§Ù„Ø¹Ù…Ø± *" required>
                                    </div>
                                    <div class="col-md-2">
                                        <select id="pGender" class="form-select">
                                            <option value="">Ø§Ù„Ø¬Ù†Ø³</option>
                                            <option value="Ø°ÙƒØ±">Ø°ÙƒØ±</option>
                                            <option value="Ø£Ù†Ø«Ù‰">Ø£Ù†Ø«Ù‰</option>
                                        </select>
                                    </div>
                                    <div class="col-md-4">
                                        <input type="text" id="pPhone" class="form-control" placeholder="Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ">
                                    </div>
                                    <div class="col-md-6">
                                        <input type="text" id="pAddress" class="form-control" placeholder="Ø§Ù„Ø¹Ù†ÙˆØ§Ù† Ø§Ù„ÙƒØ§Ù…Ù„">
                                    </div>
                                    <div class="col-md-3">
                                        <input type="number" id="pTicket" class="form-control" placeholder="Ø§Ù„Ø±Ø³ÙˆÙ…" value="5000">
                                    </div>
                                    <div class="col-md-3">
                                        <select id="pVisitType" class="form-select">
                                            <option value="Ø²ÙŠØ§Ø±Ø© Ø¬Ø¯ÙŠØ¯Ø©">Ø²ÙŠØ§Ø±Ø© Ø¬Ø¯ÙŠØ¯Ø©</option>
                                            <option value="Ù…Ø±Ø§Ø¬Ø¹Ø©">Ù…Ø±Ø§Ø¬Ø¹Ø©</option>
                                            <option value="Ù…ØªØ§Ø¨Ø¹Ø©">Ù…ØªØ§Ø¨Ø¹Ø©</option>
                                        </select>
                                    </div>
                                    <div class="col-md-12">
                                        <textarea id="pMedicalHistory" class="form-control" rows="3" placeholder="ØªØ§Ø±ÙŠØ® Ù…Ø±Ø¶ÙŠ Ø³Ø§Ø¨Ù‚ (Ø­Ø³Ø§Ø³ÙŠØ§ØªØŒ Ø£Ù…Ø±Ø§Ø¶ Ù…Ø²Ù…Ù†Ø©ØŒ Ø£Ø¯ÙˆÙŠØ© Ù…Ù†ØªØ¸Ù…Ø©...)"></textarea>
                                    </div>
                                    <div class="col-md-12">
                                        <button class="btn btn-primary w-100 fw-bold" onclick="registerPatient()">
                                            ğŸ’¾ Ø­ÙØ¸ ÙˆØ¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø³Ø¬Ù„ Ø§Ù„Ø·Ø¨ÙŠ
                                        </button>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Ø³Ø¬Ù„ Ø§Ù„Ù…Ø±Ø¶Ù‰ -->
                            <div class="card p-3 mt-3 border-info shadow">
                                <h6 class="fw-bold text-info">ğŸ“ Ø³Ø¬Ù„ Ø§Ù„Ù…Ø±Ø¶Ù‰ Ø§Ù„Ø³Ø§Ø¨Ù‚ÙŠÙ†</h6>
                                <input type="text" class="form-control mb-2" placeholder="Ø¨Ø­Ø« Ø¨Ø§Ù„Ø§Ø³Ù… Ø£Ùˆ Ø§Ù„Ù‡Ø§ØªÙ..." onkeyup="searchPatientRecords(this.value)">
                                <div id="patientRecordsList" style="max-height: 300px; overflow-y: auto;"></div>
                            </div>
                        </div>
                        
                        <div class="col-md-4">
                            <div class="card p-3 bg-light shadow">
                                <h6 class="fw-bold">ğŸ“Š Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„Ø§Ø³ØªÙ‚Ø¨Ø§Ù„</h6>
                                <div class="row text-center">
                                    <div class="col-6 mb-3">
                                        <div class="bg-primary text-white p-3 rounded">
                                            <h4 id="todayPatients">0</h4>
                                            <small>Ù…Ø±Ø¶Ù‰ Ø§Ù„ÙŠÙˆÙ…</small>
                                        </div>
                                    </div>
                                    <div class="col-6 mb-3">
                                        <div class="bg-success text-white p-3 rounded">
                                            <h4 id="totalPatients">0</h4>
                                            <small>Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…Ø±Ø¶Ù‰</small>
                                        </div>
                                    </div>
                                    <div class="col-6">
                                        <div class="bg-warning text-white p-3 rounded">
                                            <h4 id="newPatients">0</h4>
                                            <small>Ø¬Ø¯Ø¯</small>
                                        </div>
                                    </div>
                                    <div class="col-6">
                                        <div class="bg-info text-white p-3 rounded">
                                            <h4 id="returnPatients">0</h4>
                                            <small>Ù…Ø±Ø§Ø¬Ø¹ÙŠÙ†</small>
                                        </div>
                                    </div>
                                </div>
                                <div class="mt-3">
                                    <h6 class="fw-bold">â° Ø£ÙˆÙ‚Ø§Øª Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø±</h6>
                                    <div class="progress mb-2">
                                        <div class="progress-bar bg-success" style="width: 30%">0-15 Ø¯</div>
                                        <div class="progress-bar bg-warning" style="width: 40%">15-30 Ø¯</div>
                                        <div class="progress-bar bg-danger" style="width: 30%">+30 Ø¯</div>
                                    </div>
                                    <small class="text-muted">Ù…ØªÙˆØ³Ø· ÙˆÙ‚Øª Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø±: <span id="avgWaitTime">0</span> Ø¯Ù‚ÙŠÙ‚Ø©</small>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Ù‚Ø³Ù… Ø§Ù„Ø¹ÙŠØ§Ø¯Ø© (Ù…Ø­Ø¯Ø«) -->
                <div id="doctor-sec" class="section-pane hidden-section">
                    <div class="row">
                        <div class="col-md-4">
                            <div class="card p-3 shadow-sm">
                                <h6 class="fw-bold text-primary border-bottom pb-2">ğŸ‘¥ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø±</h6>
                                <div class="search-box mb-3">
                                    <input type="text" id="searchPatient" class="form-control" placeholder="Ø¨Ø­Ø« Ø¹Ù† Ù…Ø±ÙŠØ¶..." onkeyup="searchPatients(this.value)">
                                </div>
                                <div id="doctorPatientList" class="mt-2" style="max-height: 400px; overflow-y: auto;"></div>
                            </div>
                            
                            <!-- Ù…ÙƒØªØ¨Ø© Ø·Ø¨ÙŠØ© Ø±Ù‚Ù…ÙŠØ© -->
                            <div class="card p-3 mt-3 border-warning shadow">
                                <h6 class="fw-bold text-warning">ğŸ“š Ø§Ù„Ù…ÙƒØªØ¨Ø© Ø§Ù„Ø·Ø¨ÙŠØ©</h6>
                                <div class="input-group mb-2">
                                    <input type="text" id="librarySearch" class="form-control" placeholder="Ø¨Ø­Ø« Ø¹Ù† Ù…Ø±Ø¶ Ø£Ùˆ Ø¯ÙˆØ§Ø¡..." onkeyup="searchLibrary(this.value)">
                                    <button class="btn btn-warning" onclick="openLibrary()">ğŸ”</button>
                                </div>
                                <div id="quickLibraryResults" style="max-height: 200px; overflow-y: auto;"></div>
                            </div>
                        </div>
                        
                        <div class="col-md-8">
                            <!-- Ù…Ù†Ø·Ù‚Ø© Ø§Ù„Ø¹Ù„Ø§Ø¬ -->
                            <div id="treatmentArea" class="card p-4 shadow hidden-section">
                                <div class="d-flex justify-content-between align-items-start border-bottom pb-2 mb-3">
                                    <div>
                                        <h4 class="text-primary fw-bold mb-0" id="selectedPatientTitle"></h4>
                                        <small class="text-muted" id="selectedPatientInfo"></small>
                                    </div>
                                    <div>
                                        <span class="badge bg-warning text-dark" id="caseStatus">ØªØ­Øª Ø§Ù„Ù…Ø¹Ø§ÙŠÙ†Ø©</span>
                                        <button class="btn btn-sm btn-outline-info ms-2" onclick="viewFullMedicalRecord()">ğŸ“„ Ø§Ù„Ø³Ø¬Ù„ Ø§Ù„ÙƒØ§Ù…Ù„</button>
                                    </div>
                                </div>
                                
                                <!-- Ø¹Ù„Ø§Ù…Ø§Øª Ø­ÙŠÙˆÙŠØ© -->
                                <div class="row g-2 mb-3">
                                    <div class="col-md-3">
                                        <input type="text" class="form-control" placeholder="Ø§Ù„Ø¶ØºØ·" id="vitalBP">
                                    </div>
                                    <div class="col-md-2">
                                        <input type="text" class="form-control" placeholder="Ø§Ù„Ù†Ø¨Ø¶" id="vitalPulse">
                                    </div>
                                    <div class="col-md-2">
                                        <input type="text" class="form-control" placeholder="Ø§Ù„Ø­Ø±Ø§Ø±Ø©" id="vitalTemp">
                                    </div>
                                    <div class="col-md-2">
                                        <input type="text" class="form-control" placeholder="Ø§Ù„ØªÙ†ÙØ³" id="vitalResp">
                                    </div>
                                    <div class="col-md-3">
                                        <input type="text" class="form-control" placeholder="Ø§Ù„Ø³ÙƒØ±" id="vitalSugar">
                                    </div>
                                </div>
                                
                                <!-- Ø§Ù„Ø³Ø¬Ù„ Ø§Ù„Ø·Ø¨ÙŠ Ù„Ù„Ù…Ø±ÙŠØ¶ -->
                                <div class="medical-record mb-3">
                                    <h6 class="fw-bold">ğŸ“‹ Ø§Ù„Ø³Ø¬Ù„ Ø§Ù„Ø·Ø¨ÙŠ Ù„Ù„Ù…Ø±ÙŠØ¶</h6>
                                    <div class="row">
                                        <div class="col-md-6">
                                            <p><strong>Ø§Ù„ØªØ§Ø±ÙŠØ® Ø§Ù„Ù…Ø±Ø¶ÙŠ:</strong> <span id="patientMedicalHistory">Ù„Ø§ ÙŠÙˆØ¬Ø¯</span></p>
                                            <p><strong>Ø§Ù„Ø£Ø¯ÙˆÙŠØ© Ø§Ù„Ù…Ù†ØªØ¸Ù…Ø©:</strong> <span id="patientRegularMeds">Ù„Ø§ ÙŠÙˆØ¬Ø¯</span></p>
                                        </div>
                                        <div class="col-md-6">
                                            <p><strong>Ø§Ù„Ø­Ø³Ø§Ø³ÙŠØ§Øª:</strong> <span id="patientAllergies">Ù„Ø§ ÙŠÙˆØ¬Ø¯</span></p>
                                            <p><strong>Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª Ø§Ù„Ø³Ø§Ø¨Ù‚Ø©:</strong> <span id="patientSurgeries">Ù„Ø§ ÙŠÙˆØ¬Ø¯</span></p>
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="mb-3">
                                    <label class="fw-bold mb-1">Ø´ÙƒÙˆÙ‰ Ø§Ù„Ù…Ø±ÙŠØ¶ ÙˆØ§Ù„ØªØ´Ø®ÙŠØµ:</label>
                                    <textarea id="pComplaint" class="form-control" rows="3" placeholder="Ø§ÙƒØªØ¨ Ø´ÙƒÙˆÙ‰ Ø§Ù„Ù…Ø±ÙŠØ¶ ÙˆØ§Ù„ØªØ´Ø®ÙŠØµ Ù‡Ù†Ø§..."></textarea>
                                </div>
                                
                                <ul class="nav nav-tabs mb-3">
                                    <li class="nav-item"><button class="nav-link active" onclick="showDocSubSection('rx')">ğŸ’Š Ø§Ù„Ø±ÙˆØ´ØªØ©</button></li>
                                    <li class="nav-item"><button class="nav-link" onclick="showDocSubSection('lab')">ğŸ§ª Ø·Ù„Ø¨ ÙØ­Øµ</button></li>
                                    <li class="nav-item"><button class="nav-link" onclick="showDocSubSection('results')">ğŸ“Š Ø§Ù„Ù†ØªØ§Ø¦Ø¬</button></li>
                                    <li class="nav-item"><button class="nav-link" onclick="showDocSubSection('nursing')">ğŸ’‰ Ø§Ù„ØªÙ…Ø±ÙŠØ¶</button></li>
                                </ul>
                                
                                <div id="doc-sub-rx">
                                    <div class="p-3 bg-light border rounded mb-3">
                                        <h6 class="text-muted small mb-2">Ø¥Ø¶Ø§ÙØ© Ø£Ø¯ÙˆÙŠØ© Ù„Ù„Ø±ÙˆØ´ØªØ©:</h6>
                                        <div class="row g-2 mb-2">
                                            <div class="col-md-5">
                                                <input list="stockMeds" id="medSearch" class="form-control" placeholder="Ø§Ø³Ù… Ø§Ù„Ø¯ÙˆØ§Ø¡..." onkeyup="filterStock(this.value)">
                                                <datalist id="stockMeds"></datalist>
                                            </div>
                                            <div class="col-md-3">
                                                <input type="text" id="medDose" class="form-control" placeholder="Ø§Ù„Ø¬Ø±Ø¹Ø©">
                                            </div>
                                            <div class="col-md-2">
                                                <input type="number" id="medDays" class="form-control" placeholder="Ø§Ù„Ø£ÙŠØ§Ù…" value="7">
                                            </div>
                                            <div class="col-md-2">
                                                <button class="btn btn-outline-primary w-100" onclick="addMedToRx()">â•</button>
                                            </div>
                                        </div>
                                        <div class="form-check">
                                            <input class="form-check-input" type="checkbox" id="checkInteractions">
                                            <label class="form-check-label small" for="checkInteractions">ÙØ­Øµ ØªÙØ§Ø¹Ù„Ø§Øª Ø§Ù„Ø£Ø¯ÙˆÙŠØ©</label>
                                        </div>
                                    </div>
                                    <div id="rxItemsContainer" class="mb-3"></div>
                                    <div id="drugInteractionsAlert" class="alert alert-danger hidden-section"></div>
                                    <textarea id="finalRx" class="form-control mb-3 bg-white" rows="4" readonly placeholder="Ù…Ø­ØªÙˆÙ‰ Ø§Ù„Ø±ÙˆØ´ØªØ©..."></textarea>
                                    <div class="d-flex gap-2">
                                        <button class="btn btn-success w-50 fw-bold" onclick="sendRxToPharmacy()">ğŸ’Š Ø¥Ø±Ø³Ø§Ù„ Ù„Ù„ØµÙŠØ¯Ù„ÙŠØ©</button>
                                        <button class="btn btn-warning w-25" onclick="addNursingOrders()">ğŸ’‰ Ø¥Ø¶Ø§ÙØ© ØªÙ…Ø±ÙŠØ¶</button>
                                        <button class="btn btn-dark w-25" onclick="printRx()">ğŸ–¨ï¸ Ø·Ø¨Ø§Ø¹Ø©</button>
                                    </div>
                                </div>
                                
                                <div id="doc-sub-lab" class="hidden-section">
                                    <div class="mb-3">
                                        <h6 class="fw-bold text-success mb-2">Ø§Ø®ØªØ± Ø§Ù„ÙØ­ÙˆØµØ§Øª Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©:</h6>
                                        <div id="labTestsChecklist" style="max-height: 200px; overflow-y: auto; border: 1px solid #dee2e6; border-radius: 8px; padding: 10px; background: #f8f9fa;">
                                            <!-- Ø³ÙŠØªÙ… Ù…Ù„Ø¤Ù‡Ø§ Ø¨ÙˆØ§Ø³Ø·Ø© JavaScript -->
                                        </div>
                                    </div>
                                    <div class="mb-3">
                                        <button class="btn btn-danger w-100" onclick="sendSelectedTestsToLab()">ğŸ§ª Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„ÙØ­ÙˆØµØ§Øª Ø§Ù„Ù…Ø®ØªØ§Ø±Ø© Ù„Ù„Ù…Ø¹Ù…Ù„</button>
                                        <button class="btn btn-outline-secondary w-100 mt-2" onclick="selectAllLabTests()">âœ… ØªØ­Ø¯ÙŠØ¯ Ø§Ù„ÙƒÙ„</button>
                                    </div>
                                    <h6 class="fw-bold text-success mt-3">ğŸ“‹ Ø·Ù„Ø¨Ø§Øª Ø§Ù„ÙØ­ÙˆØµØ§Øª Ø§Ù„Ù…Ø±Ø³Ù„Ø©:</h6>
                                    <div id="doctorLabRequests"></div>
                                </div>
                                
                                <div id="doc-sub-results" class="hidden-section">
                                    <h6 class="fw-bold text-success">âœ… Ù†ØªØ§Ø¦Ø¬ Ø§Ù„ÙØ­ÙˆØµØ§Øª Ø§Ù„ÙˆØ§Ø±Ø¯Ø©:</h6>
                                    <div id="patientSpecificLabResults" class="mt-2" style="max-height: 300px; overflow-y: auto;"></div>
                                </div>
                                
                                <div id="doc-sub-nursing" class="hidden-section">
                                    <h6 class="fw-bold text-purple">ğŸ’‰ Ø£ÙˆØ§Ù…Ø± Ø§Ù„ØªÙ…Ø±ÙŠØ¶</h6>
                                    <div class="row g-2 mb-3">
                                        <div class="col-md-6">
                                            <select id="nursingProcedure" class="form-select">
                                                <option value="">Ø§Ø®ØªØ± Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡</option>
                                                <option value="Ø­Ù‚Ù† Ø¹Ø¶Ù„ÙŠ">Ø­Ù‚Ù† Ø¹Ø¶Ù„ÙŠ</option>
                                                <option value="Ø­Ù‚Ù† ÙˆØ±ÙŠØ¯ÙŠ">Ø­Ù‚Ù† ÙˆØ±ÙŠØ¯ÙŠ</option>
                                                <option value="ØªØºÙŠÙŠØ± Ø¶Ù…Ø§Ø¯Ø©">ØªØºÙŠÙŠØ± Ø¶Ù…Ø§Ø¯Ø©</option>
                                                <option value="Ù‚ÙŠØ§Ø³ Ø¹Ù„Ø§Ù…Ø§Øª Ø­ÙŠÙˆÙŠØ©">Ù‚ÙŠØ§Ø³ Ø¹Ù„Ø§Ù…Ø§Øª Ø­ÙŠÙˆÙŠØ©</option>
                                                <option value="Ø¹Ù†Ø§ÙŠØ© Ø¨Ø§Ù„Ø¬Ø±Ø­">Ø¹Ù†Ø§ÙŠØ© Ø¨Ø§Ù„Ø¬Ø±Ø­</option>
                                                <option value="Ø¥Ø¹Ø·Ø§Ø¡ Ø£ÙƒØ³Ø¬ÙŠÙ†">Ø¥Ø¹Ø·Ø§Ø¡ Ø£ÙƒØ³Ø¬ÙŠÙ†</option>
                                            </select>
                                        </div>
                                        <div class="col-md-4">
                                            <input type="text" id="nursingFrequency" class="form-control" placeholder="Ø§Ù„ØªÙƒØ±Ø§Ø±">
                                        </div>
                                        <div class="col-md-2">
                                            <button class="btn btn-purple w-100 text-white" onclick="addNursingOrder()">â•</button>
                                        </div>
                                    </div>
                                    <div id="nursingOrdersList" class="mb-3"></div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Ù‚Ø³Ù… Ø§Ù„Ù…Ø¹Ù…Ù„ -->
                <div id="lab-sec" class="section-pane hidden-section">
                    <div class="card p-3 border-danger border-top border-4 shadow">
                        <h5 class="fw-bold text-danger mb-3">ğŸ§ª Ø·Ù„Ø¨Ø§Øª Ø§Ù„ÙØ­ÙˆØµØ§Øª ÙˆØ³Ø­Ø¨ Ø§Ù„Ø¹ÙŠÙ†Ø§Øª</h5>
                        <div class="table-responsive">
                            <table class="table table-hover align-middle">
                                <thead class="table-danger">
                                    <tr>
                                        <th>Ø§Ù„Ù…Ø±ÙŠØ¶</th>
                                        <th>Ø§Ù„ÙØ­Øµ</th>
                                        <th>Ø§Ù„Ø³Ø¹Ø±</th>
                                        <th>Ø§Ù„ÙˆÙ‚Øª</th>
                                        <th>Ø§Ù„Ù†ØªÙŠØ¬Ø©</th>
                                        <th>Ø¥Ø¬Ø±Ø§Ø¡</th>
                                    </tr>
                                </thead>
                                <tbody id="labWorkTable"></tbody>
                            </table>
                        </div>
                    </div>
                </div>

                <!-- Ù‚Ø³Ù… Ø§Ù„ØµÙŠØ¯Ù„ÙŠØ© (Ù…Ø­Ø¯Ø« Ø¨Ø§Ù„Ù…Ø®Ø²ÙˆÙ† Ø§Ù„Ø§Ø³ØªØ±Ø§ØªÙŠØ¬ÙŠ) -->
                <div id="pharmacy-sec" class="section-pane hidden-section">
                    <div class="row">
                        <div class="col-md-7">
                            <div class="card p-3 border-success border-top border-4 shadow">
                                <h5 class="fw-bold text-success mb-3">ğŸ’Š Ø§Ù„Ø±ÙˆØ´ØªØ§Øª Ø§Ù„ÙˆØ§Ø±Ø¯Ø©</h5>
                                <div id="pharmacyQueue"></div>
                            </div>
                            
                            <!-- Ø§Ù„Ù…Ø®Ø²ÙˆÙ† Ø§Ù„Ø§Ø³ØªØ±Ø§ØªÙŠØ¬ÙŠ -->
                            <div class="card p-3 mt-3 border-warning shadow">
                                <h5 class="fw-bold text-warning mb-3">ğŸ“¦ Ø§Ù„Ù…Ø®Ø²ÙˆÙ† Ø§Ù„Ø§Ø³ØªØ±Ø§ØªÙŠØ¬ÙŠ</h5>
                                <div class="row mb-3">
                                    <div class="col-md-4">
                                        <div class="card bg-light p-2 text-center">
                                            <h6 class="text-danger">ğŸ”„ Ø¯ÙˆØ±ØªÙ‡</h6>
                                            <h4 id="stockTurnover">0</h4>
                                        </div>
                                    </div>
                                    <div class="col-md-4">
                                        <div class="card bg-light p-2 text-center">
                                            <h6 class="text-warning">â° Ø£ÙŠØ§Ù… Ø§Ù„Ù…Ø®Ø²ÙˆÙ†</h6>
                                            <h4 id="stockDays">0</h4>
                                        </div>
                                    </div>
                                    <div class="col-md-4">
                                        <div class="card bg-light p-2 text-center">
                                            <h6 class="text-success">ğŸ“Š ÙƒÙØ§Ø¡Ø©</h6>
                                            <h4 id="stockEfficiency">0%</h4>
                                        </div>
                                    </div>
                                </div>
                                <div id="strategicStockAlerts"></div>
                            </div>
                        </div>
                        
                        <div class="col-md-5">
                            <div class="card p-3 bg-light shadow">
                                <h5 class="fw-bold">ğŸ“¦ Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø®Ø²ÙˆÙ† Ø§Ù„Ù…ØªÙ‚Ø¯Ù…Ø©</h5>
                                <ul class="nav nav-tabs mb-3">
                                    <li class="nav-item"><button class="nav-link active" onclick="showPharmacyTab('inventory')">Ø§Ù„Ù…Ø®Ø²ÙˆÙ†</button></li>
                                    <li class="nav-item"><button class="nav-link" onclick="showPharmacyTab('orders')">Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ø´Ø±Ø§Ø¡</button></li>
                                    <li class="nav-item"><button class="nav-link" onclick="showPharmacyTab('expiry')">Ø§Ù„ØµÙ„Ø§Ø­ÙŠØ©</button></li>
                                </ul>
                                
                                <div id="pharmacy-inventory">
                                    <div class="input-group mb-2">
                                        <input type="text" id="iName" class="form-control" placeholder="Ø§Ù„ØµÙ†Ù">
                                        <input type="number" id="iCost" class="form-control" placeholder="Ø³Ø¹Ø± Ø§Ù„Ø´Ø±Ø§Ø¡">
                                        <input type="number" id="iQty" class="form-control" placeholder="Ø§Ù„ÙƒÙ…ÙŠØ©">
                                        <button class="btn btn-primary" onclick="addInventory()">â• Ø¥Ø¶Ø§ÙØ©</button>
                                    </div>
                                    <div style="max-height: 300px; overflow-y: auto;">
                                        <table class="table table-sm table-striped bg-white">
                                            <thead>
                                                <tr>
                                                    <th>Ø§Ù„ØµÙ†Ù</th>
                                                    <th>Ø³Ø¹Ø± Ø§Ù„Ø¨ÙŠØ¹</th>
                                                    <th>Ø§Ù„Ù…Ø®Ø²ÙˆÙ†</th>
                                                    <th>Ø¥Ø¬Ø±Ø§Ø¡</th>
                                                </tr>
                                            </thead>
                                            <tbody id="invTable"></tbody>
                                        </table>
                                    </div>
                                </div>
                                
                                <div id="pharmacy-orders" class="hidden-section">
                                    <button class="btn btn-warning w-100 mb-2" onclick="generatePurchaseOrders()">ğŸ“‹ ØªÙˆÙ„ÙŠØ¯ Ø·Ù„Ø¨Ø§Øª Ø´Ø±Ø§Ø¡</button>
                                    <div id="purchaseOrdersList" style="max-height: 250px; overflow-y: auto;"></div>
                                </div>
                                
                                <div id="pharmacy-expiry" class="hidden-section">
                                    <h6 class="fw-bold text-danger">âš ï¸ ØªÙ†Ø¨ÙŠÙ‡Ø§Øª Ø§Ù†ØªÙ‡Ø§Ø¡ Ø§Ù„ØµÙ„Ø§Ø­ÙŠØ©</h6>
                                    <div id="expiryAlerts" style="max-height: 250px; overflow-y: auto;"></div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Ù‚Ø³Ù… Ø§Ù„ØªÙ…Ø±ÙŠØ¶ (Ø¬Ø¯ÙŠØ¯) -->
                <div id="nursing-sec" class="section-pane hidden-section">
                    <div class="row">
                        <div class="col-md-8">
                            <div class="card p-4 border-purple border-top border-4 shadow">
                                <h5 class="fw-bold text-purple mb-3">ğŸ’‰ Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ù…Ù…Ø±Ø¶ÙŠÙ† - ØªÙ†ÙÙŠØ° Ø§Ù„Ø¬Ø±Ø¹Ø§Øª</h5>
                                
                                <ul class="nav nav-tabs mb-3">
                                    <li class="nav-item"><button class="nav-link active" onclick="showNursingTab('schedule')">Ø§Ù„Ø¬Ø¯ÙˆÙ„ Ø§Ù„ÙŠÙˆÙ…ÙŠ</button></li>
                                    <li class="nav-item"><button class="nav-link" onclick="showNursingTab('patients')">Ø§Ù„Ù…Ø±Ø¶Ù‰ Ø§Ù„Ù†Ø´Ø·ÙŠÙ†</button></li>
                                    <li class="nav-item"><button class="nav-link" onclick="showNursingTab('medications')">Ø§Ù„Ø£Ø¯ÙˆÙŠØ© Ø§Ù„Ù…Ù‚Ø±Ø±Ø©</button></li>
                                </ul>
                                
                                <div id="nursing-schedule">
                                    <div class="row mb-3">
                                        <div class="col-md-3">
                                            <input type="date" id="nursingDate" class="form-control" value="" onchange="loadNursingSchedule()">
                                        </div>
                                        <div class="col-md-3">
                                            <select id="nursingShift" class="form-select" onchange="loadNursingSchedule()">
                                                <option value="all">Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ù†Ø§ÙˆØ¨Ø§Øª</option>
                                                <option value="ØµØ¨Ø§Ø­">ØµØ¨Ø§Ø­ (7Øµ-3Ù…)</option>
                                                <option value="Ù…Ø³Ø§Ø¡">Ù…Ø³Ø§Ø¡ (3Ù…-11Ù…)</option>
                                                <option value="Ù„ÙŠÙ„">Ù„ÙŠÙ„ (11Ù…-7Øµ)</option>
                                            </select>
                                        </div>
                                        <div class="col-md-6">
                                            <button class="btn btn-purple w-100 text-white" onclick="addNewNursingTask()">â• Ø¥Ø¶Ø§ÙØ© Ù…Ù‡Ù…Ø© Ø¬Ø¯ÙŠØ¯Ø©</button>
                                        </div>
                                    </div>
                                    <div id="nursingScheduleTable" style="max-height: 400px; overflow-y: auto;"></div>
                                </div>
                                
                                <div id="nursing-patients" class="hidden-section">
                                    <div class="row">
                                        <div class="col-md-12">
                                            <div class="input-group mb-3">
                                                <input type="text" class="form-control" placeholder="Ø¨Ø­Ø« Ø¹Ù† Ù…Ø±ÙŠØ¶..." id="searchNursingPatient">
                                                <button class="btn btn-outline-purple" onclick="searchNursingPatients()">Ø¨Ø­Ø«</button>
                                            </div>
                                            <div id="nursingPatientsList" style="max-height: 400px; overflow-y: auto;"></div>
                                        </div>
                                    </div>
                                </div>
                                
                                <div id="nursing-medications" class="hidden-section">
                                    <div class="alert alert-info">
                                        <h6>ğŸ’Š Ø£Ø¯ÙˆÙŠØ© ØªØ­ØªØ§Ø¬ ØªÙ†ÙÙŠØ°</h6>
                                        <p id="pendingMedicationsCount">0 Ø¯ÙˆØ§Ø¡ ÙŠØ­ØªØ§Ø¬ Ø¥Ø¹Ø·Ø§Ø¡</p>
                                    </div>
                                    <div id="nursingMedicationsList" style="max-height: 400px; overflow-y: auto;"></div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="col-md-4">
                            <div class="card p-3 bg-light shadow">
                                <h6 class="fw-bold">ğŸ‘©â€âš•ï¸ Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ù…Ø±Ø¶ÙŠÙ†</h6>
                                <div class="mb-3">
                                    <input type="text" class="form-control mb-2" placeholder="Ø§Ø³Ù… Ø§Ù„Ù…Ù…Ø±Ø¶/Ø©">
                                    <select class="form-select mb-2">
                                        <option>Ù…Ù†Ø§ÙˆØ¨Ø© ØµØ¨Ø§Ø­</option>
                                        <option>Ù…Ù†Ø§ÙˆØ¨Ø© Ù…Ø³Ø§Ø¡</option>
                                        <option>Ù…Ù†Ø§ÙˆØ¨Ø© Ù„ÙŠÙ„</option>
                                    </select>
                                    <button class="btn btn-sm btn-purple text-white w-100">â• Ø¥Ø¶Ø§ÙØ© Ù…Ù…Ø±Ø¶</button>
                                </div>
                                <div id="nursesList" style="max-height: 200px; overflow-y: auto;"></div>
                            </div>
                            
                            <div class="card p-3 mt-3 border-info shadow">
                                <h6 class="fw-bold">ğŸ“Š Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„ØªÙ…Ø±ÙŠØ¶</h6>
                                <div class="row text-center">
                                    <div class="col-6 mb-2">
                                        <div class="bg-info text-white p-2 rounded">
                                            <h5 id="nursingTasksToday">0</h5>
                                            <small>Ù…Ù‡Ø§Ù… Ø§Ù„ÙŠÙˆÙ…</small>
                                        </div>
                                    </div>
                                    <div class="col-6 mb-2">
                                        <div class="bg-success text-white p-2 rounded">
                                            <h5 id="nursingTasksDone">0</h5>
                                            <small>Ù…ÙƒØªÙ…Ù„Ø©</small>
                                        </div>
                                    </div>
                                    <div class="col-6">
                                        <div class="bg-warning text-white p-2 rounded">
                                            <h5 id="nursingTasksPending">0</h5>
                                            <small>Ù…Ø¹Ù„Ù‚Ø©</small>
                                        </div>
                                    </div>
                                    <div class="col-6">
                                        <div class="bg-danger text-white p-2 rounded">
                                            <h5 id="nursingTasksLate">0</h5>
                                            <small>Ù…ØªØ£Ø®Ø±Ø©</small>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="card p-3 mt-3 border-warning shadow">
                                <h6 class="fw-bold">â° ØªÙ†Ø¨ÙŠÙ‡Ø§Øª Ù…Ù‡Ù…Ø©</h6>
                                <div id="nursingAlerts" style="max-height: 200px; overflow-y: auto;"></div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Ù‚Ø³Ù… Ø§Ù„Ù…Ø¯ÙŠØ± Ù…Ø¹ Ù†Ø¸Ø§Ù… Ø§Ù„ØµÙ„Ø§Ø­ÙŠØ§Øª Ø§Ù„Ù…ØªÙ‚Ø¯Ù… -->
                <div id="admin-sec" class="section-pane hidden-section">
                    <div class="row g-3 mb-4 text-white no-print">
                        <div class="col-md-3">
                            <div class="stat-card bg-primary shadow">ğŸ¦ Ø§Ù„Ø¹ÙŠØ§Ø¯Ø©<h2 id="finClinic">0</h2>Ø¬Ù†ÙŠØ©</div>
                        </div>
                        <div class="col-md-3">
                            <div class="stat-card bg-danger shadow">ğŸ§ª Ø§Ù„Ù…Ø¹Ù…Ù„<h2 id="finLab">0</h2>Ø¬Ù†ÙŠØ©</div>
                        </div>
                        <div class="col-md-3">
                            <div class="stat-card bg-success shadow">ğŸ’Š Ù…Ø¨ÙŠØ¹Ø§Øª Ø§Ù„ØµÙŠØ¯Ù„ÙŠØ©<h2 id="finPhar">0</h2>Ø¬Ù†ÙŠØ©</div>
                        </div>
                        <div class="col-md-3">
                            <div class="stat-card bg-dark shadow">ğŸ’° Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø£Ø±Ø¨Ø§Ø­<h2 id="totalProfit">0</h2>Ø¬Ù†ÙŠØ©</div>
                        </div>
                    </div>

                    <div class="row no-print">
                        <!-- Ø§Ù„Ù…ÙƒØªØ¨Ø© Ø§Ù„Ø·Ø¨ÙŠØ© Ø§Ù„Ø±Ù‚Ù…ÙŠØ© -->
                        <div class="col-md-4">
                            <div class="card p-4 border-top border-3 border-warning shadow library-card">
                                <h5 class="fw-bold text-warning mb-3">ğŸ“š Ø§Ù„Ù…ÙƒØªØ¨Ø© Ø§Ù„Ø·Ø¨ÙŠØ© Ø§Ù„Ø±Ù‚Ù…ÙŠØ©</h5>
                                <div class="input-group mb-3">
                                    <input type="text" id="searchMedicalLibrary" class="form-control" placeholder="Ø¨Ø­Ø« Ø¹Ù† Ù…Ø±Ø¶ØŒ Ø¯ÙˆØ§Ø¡ØŒ Ø¥Ø¬Ø±Ø§Ø¡...">
                                    <button class="btn btn-warning" onclick="searchMedicalLibrary()">ğŸ”</button>
                                </div>
                                <div class="mb-3">
                                    <select class="form-select" onchange="filterLibrary(this.value)">
                                        <option value="all">Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø£Ù‚Ø³Ø§Ù…</option>
                                        <option value="diseases">Ø§Ù„Ø£Ù…Ø±Ø§Ø¶</option>
                                        <option value="drugs">Ø§Ù„Ø£Ø¯ÙˆÙŠØ©</option>
                                        <option value="procedures">Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª</option>
                                        <option value="tests">Ø§Ù„ÙØ­ÙˆØµØ§Øª</option>
                                    </select>
                                </div>
                                <div id="medicalLibraryContent" style="max-height: 300px; overflow-y: auto;"></div>
                                <button class="btn btn-outline-warning w-100 mt-3" onclick="addToLibrary()">â• Ø¥Ø¶Ø§ÙØ© Ù…Ø§Ø¯Ø© Ø¹Ù„Ù…ÙŠØ©</button>
                            </div>
                        </div>

                        <!-- ØªÙ‚Ø§Ø±ÙŠØ± Ù…ØªÙ‚Ø¯Ù…Ø© -->
                        <div class="col-md-8">
                            <div class="card p-4 border-top border-3 border-info shadow">
                                <h5 class="fw-bold mb-3">ğŸ“Š Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ… Ø§Ù„Ø´Ø§Ù…Ù„Ø©</h5>
                                
                                <ul class="nav nav-tabs mb-3">
                                    <li class="nav-item"><button class="nav-link active" onclick="showAdminTab('reports')">Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ±</button></li>
                                    <li class="nav-item"><button class="nav-link" onclick="showAdminTab('patients')">Ø§Ù„Ù…Ø±Ø¶Ù‰</button></li>
                                    <li class="nav-item"><button class="nav-link" onclick="showAdminTab('inventory')">Ø§Ù„Ù…Ø®Ø²ÙˆÙ†</button></li>
                                    <li class="nav-item"><button class="nav-link" onclick="showAdminTab('staff')">Ø§Ù„Ù…ÙˆØ¸ÙÙŠÙ†</button></li>
                                    <li class="nav-item"><button class="nav-link" onclick="showAdminTab('permissions')">ğŸ” Ø§Ù„ØµÙ„Ø§Ø­ÙŠØ§Øª</button></li>
                                </ul>
                                
                                <div id="admin-reports">
                                    <div class="row g-3">
                                        <div class="col-md-6">
                                            <div class="card p-3 bg-light">
                                                <h6>ğŸ“ˆ Ø§Ù„Ø¥ÙŠØ±Ø§Ø¯Ø§Øª Ø§Ù„Ø´Ù‡Ø±ÙŠØ©</h6>
                                                <canvas id="revenueChart" height="150"></canvas>
                                            </div>
                                        </div>
                                        <div class="col-md-6">
                                            <div class="card p-3 bg-light">
                                                <h6>ğŸ‘¥ ØªÙˆØ²ÙŠØ¹ Ø§Ù„Ù…Ø±Ø¶Ù‰</h6>
                                                <canvas id="patientsChart" height="150"></canvas>
                                            </div>
                                        </div>
                                        <div class="col-md-12">
                                            <div class="card p-3 bg-light">
                                                <h6>ğŸ“‹ ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ø£Ø¯Ø§Ø¡ Ø§Ù„ÙŠÙˆÙ…ÙŠ</h6>
                                                <div class="row">
                                                    <div class="col-md-3">
                                                        <p class="mb-1">Ù…ØªÙˆØ³Ø· ÙˆÙ‚Øª Ø§Ù„ÙƒØ´Ù: <strong id="avgConsultationTime">0</strong> Ø¯</p>
                                                    </div>
                                                    <div class="col-md-3">
                                                        <p class="mb-1">Ø¹Ø¯Ø¯ Ø§Ù„Ù…Ø±Ø¶Ù‰/Ø·Ø¨ÙŠØ¨: <strong id="patientsPerDoctor">0</strong></p>
                                                    </div>
                                                    <div class="col-md-3">
                                                        <p class="mb-1">Ù…Ø¹Ø¯Ù„ Ø§Ù„Ø¥Ø´ØºØ§Ù„: <strong id="occupancyRate">0%</strong></p>
                                                    </div>
                                                    <div class="col-md-3">
                                                        <p class="mb-1">Ø±Ø¶Ø§ Ø§Ù„Ù…Ø±Ø¶Ù‰: <strong id="patientSatisfaction">0%</strong></p>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                
                                <div id="admin-patients" class="hidden-section">
                                    <h6 class="fw-bold">ğŸ‘¥ Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø³Ø¬Ù„Ø§Øª Ø§Ù„Ø·Ø¨ÙŠØ©</h6>
                                    <div class="row mb-3">
                                        <div class="col-md-6">
                                            <input type="text" class="form-control" placeholder="Ø¨Ø­Ø« ÙÙŠ Ø³Ø¬Ù„Ø§Øª Ø§Ù„Ù…Ø±Ø¶Ù‰..." id="adminPatientSearch">
                                        </div>
                                        <div class="col-md-3">
                                            <button class="btn btn-info w-100" onclick="exportMedicalRecords()">ğŸ“¥ ØªØµØ¯ÙŠØ± Ø§Ù„Ø³Ø¬Ù„Ø§Øª</button>
                                        </div>
                                        <div class="col-md-3">
                                            <button class="btn btn-danger w-100" onclick="backupAllData()">ğŸ’¾ Ù†Ø³Ø® Ø§Ø­ØªÙŠØ§Ø·ÙŠ ÙƒØ§Ù…Ù„</button>
                                        </div>
                                    </div>
                                    <div id="adminPatientsTable" style="max-height: 300px; overflow-y: auto;"></div>
                                </div>
                                
                                <div id="admin-inventory" class="hidden-section">
                                    <h6 class="fw-bold">ğŸ“¦ Ø§Ù„ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ø§Ø³ØªØ±Ø§ØªÙŠØ¬ÙŠ Ù„Ù„Ù…Ø®Ø²ÙˆÙ†</h6>
                                    <div class="row mb-3">
                                        <div class="col-md-4">
                                            <div class="card bg-light p-2 text-center">
                                                <h6>ğŸ’° Ù‚ÙŠÙ…Ø© Ø§Ù„Ù…Ø®Ø²ÙˆÙ†</h6>
                                                <h4 id="inventoryValue">0</h4>
                                            </div>
                                        </div>
                                        <div class="col-md-4">
                                            <div class="card bg-light p-2 text-center">
                                                <h6>ğŸ“Š Ù…Ø¹Ø¯Ù„ Ø§Ù„Ø¯ÙˆØ±Ø§Ù†</h6>
                                                <h4 id="inventoryTurnover">0</h4>
                                            </div>
                                        </div>
                                        <div class="col-md-4">
                                            <div class="card bg-light p-2 text-center">
                                                <h6>âš ï¸ Ù…ÙˆØ§Ø¯ Ù…Ù†ØªÙ‡ÙŠØ©</h6>
                                                <h4 id="expiredItems">0</h4>
                                            </div>
                                        </div>
                                    </div>
                                    <div id="inventoryAnalysis"></div>
                                </div>
                                
                                <div id="admin-staff" class="hidden-section">
                                    <h6 class="fw-bold">ğŸ‘¥ Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…ÙˆØ¸ÙÙŠÙ† ÙˆØ§Ù„Ø£Ø¯Ø§Ø¡</h6>
                                    <div class="row g-2 mb-3">
                                        <div class="col-4">
                                            <input type="text" id="newStaffUser" class="form-control form-control-sm" placeholder="Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…">
                                        </div>
                                        <div class="col-4">
                                            <input type="text" id="newStaffPass" class="form-control form-control-sm" placeholder="ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±">
                                        </div>
                                        <div class="col-4">
                                            <select id="newStaffRole" class="form-select form-select-sm">
                                                <option value="admin">Ù…Ø¯ÙŠØ± Ù†Ø¸Ø§Ù…</option>
                                                <option value="super_admin">Ù…Ø¯ÙŠØ± Ø¹Ø§Ù…</option>
                                                <option value="head_doctor">Ø±Ø¦ÙŠØ³ Ø£Ø·Ø¨Ø§Ø¡</option>
                                                <option value="doctor">Ø·Ø¨ÙŠØ¨</option>
                                                <option value="lab_manager">Ù…Ø¯ÙŠØ± Ù…Ø¹Ù…Ù„</option>
                                                <option value="lab_tech">ÙÙ†ÙŠ Ù…Ø¹Ù…Ù„</option>
                                                <option value="pharmacy_manager">Ù…Ø¯ÙŠØ± ØµÙŠØ¯Ù„ÙŠØ©</option>
                                                <option value="pharmacist">ØµÙŠØ¯Ù„ÙŠ</option>
                                                <option value="head_nurse">Ø±Ø¦ÙŠØ³ ØªÙ…Ø±ÙŠØ¶</option>
                                                <option value="nurse">Ù…Ù…Ø±Ø¶</option>
                                                <option value="reception_supervisor">Ù…Ø´Ø±Ù Ø§Ø³ØªÙ‚Ø¨Ø§Ù„</option>
                                                <option value="reception">Ù…ÙˆØ¸Ù Ø§Ø³ØªÙ‚Ø¨Ø§Ù„</option>
                                                <option value="accountant">Ù…Ø­Ø§Ø³Ø¨</option>
                                                <option value="auditor">Ù…Ø±Ø§Ø¬Ø¹</option>
                                            </select>
                                        </div>
                                        <button class="btn btn-dark btn-sm w-100" onclick="addNewStaff()">â• Ø¥Ø¶Ø§ÙØ© Ù…ÙˆØ¸Ù</button>
                                    </div>
                                    <div class="row g-2 mb-2">
                                        <div class="col-6">
                                            <button class="btn btn-outline-info btn-sm w-100" onclick="resetUserPassword()">ğŸ”„ Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±</button>
                                        </div>
                                        <div class="col-6">
                                            <button class="btn btn-outline-warning btn-sm w-100" onclick="exportUserActivity()">ğŸ“Š ØªØµØ¯ÙŠØ± Ù†Ø´Ø§Ø· Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†</button>
                                        </div>
                                    </div>
                                    <table class="table table-bordered text-center table-sm table-hover">
                                        <thead class="table-light">
                                            <tr>
                                                <th>Ø§Ù„Ø§Ø³Ù…</th>
                                                <th>Ø§Ù„ØµÙ„Ø§Ø­ÙŠØ©</th>
                                                <th>Ø§Ù„Ù†Ø´Ø§Ø·</th>
                                                <th>Ø§Ù„Ø­Ø§Ù„Ø©</th>
                                                <th>Ø¥Ø¬Ø±Ø§Ø¡</th>
                                            </tr>
                                        </thead>
                                        <tbody id="staffTableBody"></tbody>
                                    </table>
                                </div>
                                
                                <!-- Ù†Ø¸Ø§Ù… Ø§Ù„ØµÙ„Ø§Ø­ÙŠØ§Øª Ø§Ù„Ù…ØªÙ‚Ø¯Ù… -->
                                <div id="admin-permissions" class="hidden-section">
                                    <h6 class="fw-bold">ğŸ” Ù†Ø¸Ø§Ù… Ø§Ù„ØµÙ„Ø§Ø­ÙŠØ§Øª Ø§Ù„Ù…ØªÙ‚Ø¯Ù…</h6>
                                    
                                    <!-- Ù†Ø¸Ø±Ø© Ø¹Ø§Ù…Ø© Ø¹Ù„Ù‰ Ø§Ù„ØµÙ„Ø§Ø­ÙŠØ§Øª -->
                                    <div class="card mb-3">
                                        <div class="card-header bg-primary text-white">
                                            <h6 class="mb-0">ğŸ‘¥ Ø£Ø¯ÙˆØ§Ø± Ø§Ù„Ù†Ø¸Ø§Ù…</h6>
                                        </div>
                                        <div class="card-body">
                                            <div class="row g-2" id="rolesOverview">
                                                <!-- Ø³ÙŠØªÙ… Ù…Ù„Ø¤Ù‡Ø§ Ø¬Ø§ÙØ§Ø³ÙƒØ±ÙŠØ¨Øª -->
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <!-- Ø¥Ø¯Ø§Ø±Ø© ØµÙ„Ø§Ø­ÙŠØ§Øª Ø§Ù„Ø¯ÙˆØ± -->
                                    <div class="card">
                                        <div class="card-header bg-info text-white">
                                            <h6 class="mb-0">âš™ï¸ Ø¥Ø¯Ø§Ø±Ø© ØµÙ„Ø§Ø­ÙŠØ§Øª Ø§Ù„Ø¯ÙˆØ±</h6>
                                        </div>
                                        <div class="card-body">
                                            <div class="row mb-3">
                                                <div class="col-md-6">
                                                    <select class="form-select" id="roleSelector" onchange="loadRolePermissions()">
                                                        <option value="">Ø§Ø®ØªØ± Ø¯ÙˆØ±Ø§Ù‹</option>
                                                    </select>
                                                </div>
                                                <div class="col-md-6">
                                                    <button class="btn btn-success w-100" onclick="saveRolePermissions()">ğŸ’¾ Ø­ÙØ¸ Ø§Ù„ØµÙ„Ø§Ø­ÙŠØ§Øª</button>
                                                </div>
                                            </div>
                                            
                                            <div id="permissionsContainer">
                                                <!-- Ø³ÙŠØªÙ… Ù…Ù„Ø¤Ù‡Ø§ Ø¬Ø§ÙØ§Ø³ÙƒØ±ÙŠØ¨Øª -->
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <!-- Ø³Ø¬Ù„ Ø§Ù„ØµÙ„Ø§Ø­ÙŠØ§Øª -->
                                    <div class="card mt-3">
                                        <div class="card-header bg-warning">
                                            <h6 class="mb-0">ğŸ“‹ Ø³Ø¬Ù„ ØªØ¹Ø¯ÙŠÙ„Ø§Øª Ø§Ù„ØµÙ„Ø§Ø­ÙŠØ§Øª</h6>
                                        </div>
                                        <div class="card-body">
                                            <div id="permissionsLog" style="max-height: 200px; overflow-y: auto;"></div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="card mt-3 p-3 bg-light">
                                <h6 class="fw-bold">ğŸ”„ ØªØ­ÙƒÙ… Ø³Ø±ÙŠØ¹</h6>
                                <div class="d-flex gap-2 flex-wrap">
                                    <button class="btn btn-outline-danger btn-sm" onclick="resetSection('pats')">ØªØµÙÙŠØ± Ø§Ù„Ø§Ø³ØªÙ‚Ø¨Ø§Ù„</button>
                                    <button class="btn btn-outline-danger btn-sm" onclick="resetSection('lab')">ØªØµÙÙŠØ± Ø§Ù„Ù…Ø¹Ù…Ù„</button>
                                    <button class="btn btn-outline-danger btn-sm" onclick="resetSection('rx')">ØªØµÙÙŠØ± Ø§Ù„ØµÙŠØ¯Ù„ÙŠØ©</button>
                                    <button class="btn btn-outline-danger btn-sm" onclick="resetSection('nursing')">ØªØµÙÙŠØ± Ø§Ù„ØªÙ…Ø±ÙŠØ¶</button>
                                    <button class="btn btn-danger btn-sm" onclick="resetAllDay()">ğŸ”„ Ø¥ØºÙ„Ø§Ù‚ Ø§Ù„ÙŠÙˆÙ…</button>
                                    <button class="btn btn-success btn-sm" onclick="generateDailyReport()">ğŸ“Š ØªÙ‚Ø±ÙŠØ± ÙŠÙˆÙ…ÙŠ</button>
                                    <button class="btn btn-info btn-sm" onclick="showSystemLogs()">ğŸ“‹ Ø³Ø¬Ù„Ø§Øª Ø§Ù„Ù†Ø¸Ø§Ù…</button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal Ù„ØªØºÙŠÙŠØ± ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± -->
    <div id="changePasswordModal" class="modal fade" tabindex="-1">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header bg-primary text-white">
                    <h5 class="modal-title">ğŸ” ØªØºÙŠÙŠØ± ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±</h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <div class="mb-3">
                        <label class="form-label">ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± Ø§Ù„Ø­Ø§Ù„ÙŠØ©</label>
                        <input type="password" id="currentPassword" class="form-control">
                    </div>
                    <div class="mb-3">
                        <label class="form-label">ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©</label>
                        <input type="password" id="newPassword" class="form-control" onkeyup="checkPasswordStrength()">
                        <div class="password-strength" id="passwordStrength"></div>
                        <small class="text-muted">ÙŠØ¬Ø¨ Ø£Ù† ØªØ­ØªÙˆÙŠ Ø¹Ù„Ù‰ 8 Ø£Ø­Ø±Ù Ø¹Ù„Ù‰ Ø§Ù„Ø£Ù‚Ù„ØŒ Ø­Ø±ÙˆÙ ÙƒØ¨ÙŠØ±Ø© ÙˆØµØºÙŠØ±Ø©ØŒ ÙˆØ£Ø±Ù‚Ø§Ù…</small>
                    </div>
                    <div class="mb-3">
                        <label class="form-label">ØªØ£ÙƒÙŠØ¯ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©</label>
                        <input type="password" id="confirmPassword" class="form-control">
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Ø¥Ù„ØºØ§Ø¡</button>
                    <button type="button" class="btn btn-primary" onclick="confirmPasswordChange()">ØªØºÙŠÙŠØ±</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal Ù„Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… -->
    <div id="userMenuModal" class="modal fade" tabindex="-1">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header bg-info text-white">
                    <h5 class="modal-title">ğŸ‘¤ Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø­Ø³Ø§Ø¨</h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <div class="text-center mb-3">
                        <div class="bg-light rounded-circle d-inline-flex align-items-center justify-content-center" style="width: 80px; height: 80px;">
                            <span class="fs-3">ğŸ‘¤</span>
                        </div>
                        <h5 class="mt-2" id="userNameDisplay"></h5>
                        <span class="badge bg-primary" id="userRoleDisplay"></span>
                    </div>
                    <div class="list-group">
                        <button class="list-group-item list-group-item-action" onclick="changePasswordModal()">
                            ğŸ” ØªØºÙŠÙŠØ± ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±
                        </button>
                        <button class="list-group-item list-group-item-action" onclick="viewMyActivity()">
                            ğŸ“‹ Ø³Ø¬Ù„ Ù†Ø´Ø§Ø·ÙŠ
                        </button>
                        <button class="list-group-item list-group-item-action" onclick="showMyPermissions()">
                            âš™ï¸ ØµÙ„Ø§Ø­ÙŠØ§ØªÙŠ
                        </button>
                        <button class="list-group-item list-group-item-action" onclick="toggleDarkMode()">
                            ğŸŒ™ Ø§Ù„ÙˆØ¶Ø¹ Ø§Ù„Ù„ÙŠÙ„ÙŠ
                        </button>
                    </div>
                </div>
                <div class="modal-footer">
                    <small class="text-muted" id="lastLoginDisplay"></small>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal Ù„Ø¹Ø±Ø¶ Ø§Ù„ØµÙ„Ø§Ø­ÙŠØ§Øª -->
    <div id="permissionsModal" class="modal fade" tabindex="-1">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header bg-warning">
                    <h5 class="modal-title">âš™ï¸ ØªÙØ§ØµÙŠÙ„ Ø§Ù„ØµÙ„Ø§Ø­ÙŠØ§Øª</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body permission-modal">
                    <div id="permissionsDetails"></div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // ============================================
        // Ù†Ø¸Ø§Ù… Ø§Ù„ØµÙ„Ø§Ø­ÙŠØ§Øª Ø§Ù„Ù…ØªÙ‚Ø¯Ù…
        // ============================================

        // ØªØ¹Ø±ÙŠÙ Ø§Ù„Ø£Ø¯ÙˆØ§Ø± ÙˆØ§Ù„ØµÙ„Ø§Ø­ÙŠØ§Øª
        const ROLES = {
            SUPER_ADMIN: 'super_admin',
            ADMIN: 'admin',
            HEAD_DOCTOR: 'head_doctor',
            DOCTOR: 'doctor',
            LAB_MANAGER: 'lab_manager',
            LAB_TECH: 'lab_tech',
            PHARMACY_MANAGER: 'pharmacy_manager',
            PHARMACIST: 'pharmacist',
            HEAD_NURSE: 'head_nurse',
            NURSE: 'nurse',
            RECEPTION_SUPERVISOR: 'reception_supervisor',
            RECEPTION: 'reception',
            ACCOUNTANT: 'accountant',
            AUDITOR: 'auditor'
        };

        // ØªØ¹Ø±ÙŠÙ Ø¬Ù…ÙŠØ¹ Ø§Ù„ØµÙ„Ø§Ø­ÙŠØ§Øª Ø§Ù„Ù…ØªØ§Ø­Ø©
        const ALL_PERMISSIONS = {
            // Ù‚Ø³Ù… Ø§Ù„Ø§Ø³ØªÙ‚Ø¨Ø§Ù„
            RECEPTION_VIEW: 'reception_view',
            RECEPTION_ADD: 'reception_add',
            RECEPTION_EDIT: 'reception_edit',
            RECEPTION_DELETE: 'reception_delete',
            RECEPTION_PRINT: 'reception_print',
            
            // Ù‚Ø³Ù… Ø§Ù„Ø¹ÙŠØ§Ø¯Ø©
            DOCTOR_VIEW: 'doctor_view',
            DOCTOR_ADD: 'doctor_add',
            DOCTOR_EDIT: 'doctor_edit',
            DOCTOR_DELETE: 'doctor_delete',
            DOCTOR_PRINT_RX: 'doctor_print_rx',
            DOCTOR_REQUEST_LAB: 'doctor_request_lab',
            DOCTOR_VIEW_RESULTS: 'doctor_view_results',
            DOCTOR_ADD_NURSING: 'doctor_add_nursing',
            
            // Ù‚Ø³Ù… Ø§Ù„Ù…Ø¹Ù…Ù„
            LAB_VIEW: 'lab_view',
            LAB_ADD: 'lab_add',
            LAB_EDIT: 'lab_edit',
            LAB_DELETE: 'lab_delete',
            LAB_PRINT: 'lab_print',
            LAB_ENTER_RESULTS: 'lab_enter_results',
            LAB_VIEW_ALL: 'lab_view_all',
            
            // Ù‚Ø³Ù… Ø§Ù„ØµÙŠØ¯Ù„ÙŠØ©
            PHARMACY_VIEW: 'pharmacy_view',
            PHARMACY_DISPENSE: 'pharmacy_dispense',
            PHARMACY_INVENTORY: 'pharmacy_inventory',
            PHARMACY_ADD_ITEM: 'pharmacy_add_item',
            PHARMACY_EDIT_ITEM: 'pharmacy_edit_item',
            PHARMACY_DELETE_ITEM: 'pharmacy_delete_item',
            PHARMACY_REPORTS: 'pharmacy_reports',
            
            // Ù‚Ø³Ù… Ø§Ù„ØªÙ…Ø±ÙŠØ¶
            NURSING_VIEW: 'nursing_view',
            NURSING_ADD: 'nursing_add',
            NURSING_EDIT: 'nursing_edit',
            NURSING_DELETE: 'nursing_delete',
            NURSING_COMPLETE: 'nursing_complete',
            NURSING_SCHEDULE: 'nursing_schedule',
            
            // Ù‚Ø³Ù… Ø§Ù„Ù…Ø¯ÙŠØ±
            ADMIN_VIEW: 'admin_view',
            ADMIN_REPORTS: 'admin_reports',
            ADMIN_STAFF: 'admin_staff',
            ADMIN_PERMISSIONS: 'admin_permissions',
            ADMIN_FINANCIAL: 'admin_financial',
            ADMIN_SETTINGS: 'admin_settings',
            
            // ØµÙ„Ø§Ø­ÙŠØ§Øª Ø¹Ø§Ù…Ø©
            EXPORT_DATA: 'export_data',
            IMPORT_DATA: 'import_data',
            BACKUP_DATA: 'backup_data',
            VIEW_LOGS: 'view_logs',
            SYSTEM_SETTINGS: 'system_settings'
        };

        // ØªØ¹Ø±ÙŠÙ ØµÙ„Ø§Ø­ÙŠØ§Øª ÙƒÙ„ Ø¯ÙˆØ± (Ø§Ù„Ù‚ÙŠÙ… Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠØ©)
        const DEFAULT_ROLE_PERMISSIONS = {
            [ROLES.SUPER_ADMIN]: Object.values(ALL_PERMISSIONS),
            [ROLES.ADMIN]: [
                ALL_PERMISSIONS.RECEPTION_VIEW, ALL_PERMISSIONS.RECEPTION_ADD, ALL_PERMISSIONS.RECEPTION_EDIT,
                ALL_PERMISSIONS.DOCTOR_VIEW, ALL_PERMISSIONS.DOCTOR_ADD, ALL_PERMISSIONS.DOCTOR_EDIT,
                ALL_PERMISSIONS.LAB_VIEW, ALL_PERMISSIONS.LAB_ADD, ALL_PERMISSIONS.LAB_EDIT,
                ALL_PERMISSIONS.PHARMACY_VIEW, ALL_PERMISSIONS.PHARMACY_DISPENSE, ALL_PERMISSIONS.PHARMACY_INVENTORY,
                ALL_PERMISSIONS.NURSING_VIEW, ALL_PERMISSIONS.NURSING_ADD, ALL_PERMISSIONS.NURSING_EDIT,
                ALL_PERMISSIONS.ADMIN_VIEW, ALL_PERMISSIONS.ADMIN_REPORTS, ALL_PERMISSIONS.ADMIN_STAFF,
                ALL_PERMISSIONS.EXPORT_DATA, ALL_PERMISSIONS.BACKUP_DATA, ALL_PERMISSIONS.VIEW_LOGS
            ],
            [ROLES.HEAD_DOCTOR]: [
                ALL_PERMISSIONS.DOCTOR_VIEW, ALL_PERMISSIONS.DOCTOR_ADD, ALL_PERMISSIONS.DOCTOR_EDIT,
                ALL_PERMISSIONS.DOCTOR_PRINT_RX, ALL_PERMISSIONS.DOCTOR_REQUEST_LAB, ALL_PERMISSIONS.DOCTOR_VIEW_RESULTS,
                ALL_PERMISSIONS.DOCTOR_ADD_NURSING, ALL_PERMISSIONS.RECEPTION_VIEW, ALL_PERMISSIONS.LAB_VIEW,
                ALL_PERMISSIONS.NURSING_VIEW, ALL_PERMISSIONS.EXPORT_DATA
            ],
            [ROLES.DOCTOR]: [
                ALL_PERMISSIONS.DOCTOR_VIEW, ALL_PERMISSIONS.DOCTOR_ADD, ALL_PERMISSIONS.DOCTOR_EDIT,
                ALL_PERMISSIONS.DOCTOR_PRINT_RX, ALL_PERMISSIONS.DOCTOR_REQUEST_LAB, ALL_PERMISSIONS.DOCTOR_VIEW_RESULTS,
                ALL_PERMISSIONS.DOCTOR_ADD_NURSING
            ],
            [ROLES.LAB_MANAGER]: [
                ALL_PERMISSIONS.LAB_VIEW, ALL_PERMISSIONS.LAB_ADD, ALL_PERMISSIONS.LAB_EDIT,
                ALL_PERMISSIONS.LAB_DELETE, ALL_PERMISSIONS.LAB_PRINT, ALL_PERMISSIONS.LAB_ENTER_RESULTS,
                ALL_PERMISSIONS.LAB_VIEW_ALL, ALL_PERMISSIONS.EXPORT_DATA
            ],
            [ROLES.LAB_TECH]: [
                ALL_PERMISSIONS.LAB_VIEW, ALL_PERMISSIONS.LAB_ENTER_RESULTS, ALL_PERMISSIONS.LAB_PRINT
            ],
            [ROLES.PHARMACY_MANAGER]: [
                ALL_PERMISSIONS.PHARMACY_VIEW, ALL_PERMISSIONS.PHARMACY_DISPENSE, ALL_PERMISSIONS.PHARMACY_INVENTORY,
                ALL_PERMISSIONS.PHARMACY_ADD_ITEM, ALL_PERMISSIONS.PHARMACY_EDIT_ITEM, ALL_PERMISSIONS.PHARMACY_REPORTS,
                ALL_PERMISSIONS.EXPORT_DATA
            ],
            [ROLES.PHARMACIST]: [
                ALL_PERMISSIONS.PHARMACY_VIEW, ALL_PERMISSIONS.PHARMACY_DISPENSE, ALL_PERMISSIONS.PHARMACY_INVENTORY
            ],
            [ROLES.HEAD_NURSE]: [
                ALL_PERMISSIONS.NURSING_VIEW, ALL_PERMISSIONS.NURSING_ADD, ALL_PERMISSIONS.NURSING_EDIT,
                ALL_PERMISSIONS.NURSING_DELETE, ALL_PERMISSIONS.NURSING_COMPLETE, ALL_PERMISSIONS.NURSING_SCHEDULE,
                ALL_PERMISSIONS.DOCTOR_VIEW_RESULTS, ALL_PERMISSIONS.EXPORT_DATA
            ],
            [ROLES.NURSE]: [
                ALL_PERMISSIONS.NURSING_VIEW, ALL_PERMISSIONS.NURSING_COMPLETE
            ],
            [ROLES.RECEPTION_SUPERVISOR]: [
                ALL_PERMISSIONS.RECEPTION_VIEW, ALL_PERMISSIONS.RECEPTION_ADD, ALL_PERMISSIONS.RECEPTION_EDIT,
                ALL_PERMISSIONS.RECEPTION_DELETE, ALL_PERMISSIONS.RECEPTION_PRINT, ALL_PERMISSIONS.EXPORT_DATA
            ],
            [ROLES.RECEPTION]: [
                ALL_PERMISSIONS.RECEPTION_VIEW, ALL_PERMISSIONS.RECEPTION_ADD, ALL_PERMISSIONS.RECEPTION_EDIT
            ],
            [ROLES.ACCOUNTANT]: [
                ALL_PERMISSIONS.ADMIN_VIEW, ALL_PERMISSIONS.ADMIN_FINANCIAL, ALL_PERMISSIONS.EXPORT_DATA
            ],
            [ROLES.AUDITOR]: [
                ALL_PERMISSIONS.VIEW_LOGS, ALL_PERMISSIONS.EXPORT_DATA, ALL_PERMISSIONS.RECEPTION_VIEW,
                ALL_PERMISSIONS.DOCTOR_VIEW, ALL_PERMISSIONS.LAB_VIEW, ALL_PERMISSIONS.PHARMACY_VIEW,
                ALL_PERMISSIONS.NURSING_VIEW, ALL_PERMISSIONS.ADMIN_REPORTS
            ]
        };

        // ÙˆØµÙ Ø§Ù„ØµÙ„Ø§Ø­ÙŠØ§Øª Ø¨Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©
        const PERMISSION_DESCRIPTIONS = {
            [ALL_PERMISSIONS.RECEPTION_VIEW]: 'Ø¹Ø±Ø¶ Ù‚Ø³Ù… Ø§Ù„Ø§Ø³ØªÙ‚Ø¨Ø§Ù„',
            [ALL_PERMISSIONS.RECEPTION_ADD]: 'Ø¥Ø¶Ø§ÙØ© Ù…Ø±Ø¶Ù‰ Ø¬Ø¯Ø¯',
            [ALL_PERMISSIONS.RECEPTION_EDIT]: 'ØªØ¹Ø¯ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø±Ø¶Ù‰',
            [ALL_PERMISSIONS.RECEPTION_DELETE]: 'Ø­Ø°Ù Ø§Ù„Ù…Ø±Ø¶Ù‰',
            [ALL_PERMISSIONS.RECEPTION_PRINT]: 'Ø·Ø¨Ø§Ø¹Ø© Ù…Ù† Ø§Ù„Ø§Ø³ØªÙ‚Ø¨Ø§Ù„',
            
            [ALL_PERMISSIONS.DOCTOR_VIEW]: 'Ø¹Ø±Ø¶ Ù‚Ø³Ù… Ø§Ù„Ø¹ÙŠØ§Ø¯Ø©',
            [ALL_PERMISSIONS.DOCTOR_ADD]: 'Ø¥Ø¶Ø§ÙØ© ØªØ´Ø®ÙŠØµ Ø¬Ø¯ÙŠØ¯',
            [ALL_PERMISSIONS.DOCTOR_EDIT]: 'ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„ØªØ´Ø®ÙŠØµ',
            [ALL_PERMISSIONS.DOCTOR_DELETE]: 'Ø­Ø°Ù Ø§Ù„ØªØ´Ø®ÙŠØµ',
            [ALL_PERMISSIONS.DOCTOR_PRINT_RX]: 'Ø·Ø¨Ø§Ø¹Ø© Ø§Ù„Ø±ÙˆØ´ØªØ©',
            [ALL_PERMISSIONS.DOCTOR_REQUEST_LAB]: 'Ø·Ù„Ø¨ ÙØ­ÙˆØµØ§Øª Ù…Ø¹Ù…Ù„ÙŠØ©',
            [ALL_PERMISSIONS.DOCTOR_VIEW_RESULTS]: 'Ø¹Ø±Ø¶ Ù†ØªØ§Ø¦Ø¬ Ø§Ù„ÙØ­ÙˆØµØ§Øª',
            [ALL_PERMISSIONS.DOCTOR_ADD_NURSING]: 'Ø¥Ø¶Ø§ÙØ© Ø£ÙˆØ§Ù…Ø± ØªÙ…Ø±ÙŠØ¶',
            
            [ALL_PERMISSIONS.LAB_VIEW]: 'Ø¹Ø±Ø¶ Ù‚Ø³Ù… Ø§Ù„Ù…Ø¹Ù…Ù„',
            [ALL_PERMISSIONS.LAB_ADD]: 'Ø¥Ø¶Ø§ÙØ© ÙØ­ÙˆØµØ§Øª Ø¬Ø¯ÙŠØ¯Ø©',
            [ALL_PERMISSIONS.LAB_EDIT]: 'ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„ÙØ­ÙˆØµØ§Øª',
            [ALL_PERMISSIONS.LAB_DELETE]: 'Ø­Ø°Ù Ø§Ù„ÙØ­ÙˆØµØ§Øª',
            [ALL_PERMISSIONS.LAB_PRINT]: 'Ø·Ø¨Ø§Ø¹Ø© Ù†ØªØ§Ø¦Ø¬ Ø§Ù„Ù…Ø¹Ù…Ù„',
            [ALL_PERMISSIONS.LAB_ENTER_RESULTS]: 'Ø¥Ø¯Ø®Ø§Ù„ Ù†ØªØ§Ø¦Ø¬ Ø§Ù„ÙØ­ÙˆØµØ§Øª',
            [ALL_PERMISSIONS.LAB_VIEW_ALL]: 'Ø¹Ø±Ø¶ Ø¬Ù…ÙŠØ¹ ÙØ­ÙˆØµØ§Øª Ø§Ù„Ù…Ø¹Ù…Ù„',
            
            [ALL_PERMISSIONS.PHARMACY_VIEW]: 'Ø¹Ø±Ø¶ Ù‚Ø³Ù… Ø§Ù„ØµÙŠØ¯Ù„ÙŠØ©',
            [ALL_PERMISSIONS.PHARMACY_DISPENSE]: 'ØµØ±Ù Ø§Ù„Ø£Ø¯ÙˆÙŠØ©',
            [ALL_PERMISSIONS.PHARMACY_INVENTORY]: 'Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø®Ø²ÙˆÙ†',
            [ALL_PERMISSIONS.PHARMACY_ADD_ITEM]: 'Ø¥Ø¶Ø§ÙØ© Ø£Ø¯ÙˆÙŠØ© Ø¬Ø¯ÙŠØ¯Ø©',
            [ALL_PERMISSIONS.PHARMACY_EDIT_ITEM]: 'ØªØ¹Ø¯ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø£Ø¯ÙˆÙŠØ©',
            [ALL_PERMISSIONS.PHARMACY_DELETE_ITEM]: 'Ø­Ø°Ù Ø§Ù„Ø£Ø¯ÙˆÙŠØ©',
            [ALL_PERMISSIONS.PHARMACY_REPORTS]: 'Ø¹Ø±Ø¶ ØªÙ‚Ø§Ø±ÙŠØ± Ø§Ù„ØµÙŠØ¯Ù„ÙŠØ©',
            
            [ALL_PERMISSIONS.NURSING_VIEW]: 'Ø¹Ø±Ø¶ Ù‚Ø³Ù… Ø§Ù„ØªÙ…Ø±ÙŠØ¶',
            [ALL_PERMISSIONS.NURSING_ADD]: 'Ø¥Ø¶Ø§ÙØ© Ù…Ù‡Ø§Ù… ØªÙ…Ø±ÙŠØ¶',
            [ALL_PERMISSIONS.NURSING_EDIT]: 'ØªØ¹Ø¯ÙŠÙ„ Ù…Ù‡Ø§Ù… Ø§Ù„ØªÙ…Ø±ÙŠØ¶',
            [ALL_PERMISSIONS.NURSING_DELETE]: 'Ø­Ø°Ù Ù…Ù‡Ø§Ù… Ø§Ù„ØªÙ…Ø±ÙŠØ¶',
            [ALL_PERMISSIONS.NURSING_COMPLETE]: 'Ø¥ÙƒÙ…Ø§Ù„ Ù…Ù‡Ø§Ù… Ø§Ù„ØªÙ…Ø±ÙŠØ¶',
            [ALL_PERMISSIONS.NURSING_SCHEDULE]: 'Ø¥Ø¯Ø§Ø±Ø© Ø¬Ø¯ÙˆÙ„ Ø§Ù„ØªÙ…Ø±ÙŠØ¶',
            
            [ALL_PERMISSIONS.ADMIN_VIEW]: 'Ø¹Ø±Ø¶ Ù‚Ø³Ù… Ø§Ù„Ù…Ø¯ÙŠØ±',
            [ALL_PERMISSIONS.ADMIN_REPORTS]: 'Ø¹Ø±Ø¶ Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ±',
            [ALL_PERMISSIONS.ADMIN_STAFF]: 'Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…ÙˆØ¸ÙÙŠÙ†',
            [ALL_PERMISSIONS.ADMIN_PERMISSIONS]: 'Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„ØµÙ„Ø§Ø­ÙŠØ§Øª',
            [ALL_PERMISSIONS.ADMIN_FINANCIAL]: 'Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø§Ù„ÙŠØ©',
            [ALL_PERMISSIONS.ADMIN_SETTINGS]: 'Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ù†Ø¸Ø§Ù…',
            
            [ALL_PERMISSIONS.EXPORT_DATA]: 'ØªØµØ¯ÙŠØ± Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª',
            [ALL_PERMISSIONS.IMPORT_DATA]: 'Ø§Ø³ØªÙŠØ±Ø§Ø¯ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª',
            [ALL_PERMISSIONS.BACKUP_DATA]: 'Ù†Ø³Ø® Ø§Ø­ØªÙŠØ§Ø·ÙŠ',
            [ALL_PERMISSIONS.VIEW_LOGS]: 'Ø¹Ø±Ø¶ Ø³Ø¬Ù„Ø§Øª Ø§Ù„Ù†Ø¸Ø§Ù…',
            [ALL_PERMISSIONS.SYSTEM_SETTINGS]: 'ØªØ¹Ø¯ÙŠÙ„ Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ù†Ø¸Ø§Ù…'
        };

        // ÙˆØµÙ Ø§Ù„Ø£Ø¯ÙˆØ§Ø± Ø¨Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©
        const ROLE_DESCRIPTIONS = {
            [ROLES.SUPER_ADMIN]: 'Ù…Ø¯ÙŠØ± Ù†Ø¸Ø§Ù… Ø¹Ø§Ù… - ØµÙ„Ø§Ø­ÙŠØ§Øª ÙƒØ§Ù…Ù„Ø©',
            [ROLES.ADMIN]: 'Ù…Ø¯ÙŠØ± Ø§Ù„Ù†Ø¸Ø§Ù… - ØµÙ„Ø§Ø­ÙŠØ§Øª Ø¥Ø¯Ø§Ø±ÙŠØ©',
            [ROLES.HEAD_DOCTOR]: 'Ø±Ø¦ÙŠØ³ Ø§Ù„Ø£Ø·Ø¨Ø§Ø¡ - Ø¥Ø´Ø±Ø§Ù Ø·Ø¨ÙŠ',
            [ROLES.DOCTOR]: 'Ø·Ø¨ÙŠØ¨ - ØªØ´Ø®ÙŠØµ ÙˆØ¹Ù„Ø§Ø¬',
            [ROLES.LAB_MANAGER]: 'Ù…Ø¯ÙŠØ± Ø§Ù„Ù…Ø¹Ù…Ù„ - Ø¥Ø´Ø±Ø§Ù Ù…Ø®ØªØ¨Ø±ÙŠ',
            [ROLES.LAB_TECH]: 'ÙÙ†ÙŠ Ù…Ø¹Ù…Ù„ - Ø¥Ø¬Ø±Ø§Ø¡ Ø§Ù„ÙØ­ÙˆØµØ§Øª',
            [ROLES.PHARMACY_MANAGER]: 'Ù…Ø¯ÙŠØ± Ø§Ù„ØµÙŠØ¯Ù„ÙŠØ© - Ø¥Ø´Ø±Ø§Ù ØµÙŠØ¯Ù„Ø§Ù†ÙŠ',
            [ROLES.PHARMACIST]: 'ØµÙŠØ¯Ù„ÙŠ - ØµØ±Ù Ø§Ù„Ø£Ø¯ÙˆÙŠØ©',
            [ROLES.HEAD_NURSE]: 'Ø±Ø¦ÙŠØ³ Ø§Ù„ØªÙ…Ø±ÙŠØ¶ - Ø¥Ø´Ø±Ø§Ù ØªÙ…Ø±ÙŠØ¶ÙŠ',
            [ROLES.NURSE]: 'Ù…Ù…Ø±Ø¶ - ØªÙ†ÙÙŠØ° Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª',
            [ROLES.RECEPTION_SUPERVISOR]: 'Ù…Ø´Ø±Ù Ø§Ø³ØªÙ‚Ø¨Ø§Ù„ - Ø¥Ø´Ø±Ø§Ù Ø§Ø³ØªÙ‚Ø¨Ø§Ù„',
            [ROLES.RECEPTION]: 'Ù…ÙˆØ¸Ù Ø§Ø³ØªÙ‚Ø¨Ø§Ù„ - ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ù…Ø±Ø¶Ù‰',
            [ROLES.ACCOUNTANT]: 'Ù…Ø­Ø§Ø³Ø¨ - Ø¥Ø¯Ø§Ø±Ø© Ù…Ø§Ù„ÙŠØ©',
            [ROLES.AUDITOR]: 'Ù…Ø±Ø§Ø¬Ø¹ - Ù…Ø±Ø§Ø¬Ø¹Ø© Ø§Ù„Ø³Ø¬Ù„Ø§Øª'
        };

        // ============================================
        // Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ù†Ø¸Ø§Ù… Ø§Ù„Ù…ØªÙ‚Ø¯Ù…Ø©
        // ============================================

        // ØªØ¹Ø±ÙŠÙ Ù…ØªØºÙŠØ±Ø§Øª Ø§Ù„Ù†Ø¸Ø§Ù…
        const SERVER_URL = "http://alshifaclinic.somee.com/api.aspx";
        let OPERATION_MODE = "local";
        let IS_ONLINE = navigator.onLine;
        let PENDING_SYNC = [];
        let SYNC_INTERVAL = null;
        let SESSION_TIMEOUT = null;

        // Ù‚ÙˆØ§Ø¹Ø¯ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø­Ù„ÙŠØ©
        let patients = JSON.parse(localStorage.getItem('shifa_pats')) || [];
        let labRequests = JSON.parse(localStorage.getItem('shifa_lab')) || [];
        let pharmOrders = JSON.parse(localStorage.getItem('shifa_rx')) || [];
        let nursingOrders = JSON.parse(localStorage.getItem('shifa_nursing')) || [];
        let nursingTasks = JSON.parse(localStorage.getItem('shifa_nursing_tasks')) || [];
        
        // Ù…Ø®Ø²ÙˆÙ† Ù…ÙˆØ³Ø¹
        let inventory = JSON.parse(localStorage.getItem('shifa_inv')) || [
            {id: 1, name: "Amoxicillin", cost: 300, sale: 500, qty: 50, minLevel: 20, maxLevel: 100, expiryDate: "2025-12-31", category: "Ù…Ø¶Ø§Ø¯Ø§Øª Ø­ÙŠÙˆÙŠØ©"},
            {id: 2, name: "Paracetamol", cost: 100, sale: 200, qty: 100, minLevel: 50, maxLevel: 200, expiryDate: "2026-06-30", category: "Ù…Ø³ÙƒÙ†Ø§Øª"},
            {id: 3, name: "Vitamin C", cost: 150, sale: 300, qty: 80, minLevel: 30, maxLevel: 150, expiryDate: "2025-09-30", category: "ÙÙŠØªØ§Ù…ÙŠÙ†Ø§Øª"},
            {id: 4, name: "Ibuprofen", cost: 200, sale: 400, qty: 60, minLevel: 25, maxLevel: 100, expiryDate: "2025-11-30", category: "Ù…Ø³ÙƒÙ†Ø§Øª"},
            {id: 5, name: "Insulin", cost: 800, sale: 1200, qty: 15, minLevel: 10, maxLevel: 40, expiryDate: "2025-08-31", category: "Ù‡Ø±Ù…ÙˆÙ†Ø§Øª"},
            {id: 6, name: "Syringe 5ml", cost: 50, sale: 100, qty: 200, minLevel: 100, maxLevel: 500, expiryDate: "2027-12-31", category: "Ø£Ø¯ÙˆØ§Øª Ø·Ø¨ÙŠØ©"}
        ];
        
        let financials = JSON.parse(localStorage.getItem('shifa_fin')) || { clinic: 0, lab: 0, pharSales: 0, pharProfit: 0 };
        
        // Ø§Ù„Ù…ÙˆØ¸ÙÙˆÙ† Ù…Ø¹ Ø§Ù„ØµÙ„Ø§Ø­ÙŠØ§Øª
        let staffMembers = JSON.parse(localStorage.getItem('shifa_staff')) || [
            {u: "admin", p: "123", r: ROLES.ADMIN, name: "Ø§Ù„Ù…Ø¯ÙŠØ± Ø§Ù„Ø¹Ø§Ù…", permissions: DEFAULT_ROLE_PERMISSIONS[ROLES.ADMIN], lastLogin: null, status: 'active'},
            {u: "doctor", p: "doc123", r: ROLES.DOCTOR, name: "Ø¯. Ø£Ø­Ù…Ø¯", permissions: DEFAULT_ROLE_PERMISSIONS[ROLES.DOCTOR], lastLogin: null, status: 'active'},
            {u: "lab", p: "lab123", r: ROLES.LAB_TECH, name: "ÙÙ†ÙŠ Ø§Ù„Ù…Ø¹Ù…Ù„", permissions: DEFAULT_ROLE_PERMISSIONS[ROLES.LAB_TECH], lastLogin: null, status: 'active'},
            {u: "pharmacy", p: "ph123", r: ROLES.PHARMACIST, name: "Ø§Ù„ØµÙŠØ¯Ù„ÙŠ Ù…Ø­Ù…Ø¯", permissions: DEFAULT_ROLE_PERMISSIONS[ROLES.PHARMACIST], lastLogin: null, status: 'active'},
            {u: "reception", p: "rec123", r: ROLES.RECEPTION, name: "Ù…ÙˆØ¸Ù Ø§Ù„Ø§Ø³ØªÙ‚Ø¨Ø§Ù„", permissions: DEFAULT_ROLE_PERMISSIONS[ROLES.RECEPTION], lastLogin: null, status: 'active'},
            {u: "nursing", p: "nurse123", r: ROLES.NURSE, name: "Ø§Ù„Ù…Ù…Ø±Ø¶Ø© Ø³Ø§Ø±Ø©", permissions: DEFAULT_ROLE_PERMISSIONS[ROLES.NURSE], lastLogin: null, status: 'active'},
            {u: "superadmin", p: "super123", r: ROLES.SUPER_ADMIN, name: "Ø§Ù„Ù…Ø¯ÙŠØ± Ø§Ù„Ø¹Ø§Ù…", permissions: DEFAULT_ROLE_PERMISSIONS[ROLES.SUPER_ADMIN], lastLogin: null, status: 'active'}
        ];
        
        let labTests = JSON.parse(localStorage.getItem('shifa_tests')) || [
            {name: "BFFM", price: 3000}, {name: "Widal for entrica", price: 4000}, {name: "Brucella test", price: 4000},
            {name: "H. pylori Ag", price: 4000}, {name: "ASO", price: 5000}, {name: "U. G", price: 3000},
            {name: "S.G", price: 3000}, {name: "RFT(U&C)", price: 10000}, {name: "S.uric acid", price: 5000},
            {name: "ESR", price: 4000}, {name: "RF(rheumatoid factor)", price: 5000}, {name: "TWBCS", price: 3000}
        ];

        // Ø§Ù„Ù…ÙƒØªØ¨Ø© Ø§Ù„Ø·Ø¨ÙŠØ©
        let medicalLibrary = JSON.parse(localStorage.getItem('shifa_library')) || [
            {id: 1, title: "Ø§Ù„Ø£Ù†ÙÙ„ÙˆÙ†Ø²Ø§ Ø§Ù„Ù…ÙˆØ³Ù…ÙŠØ©", category: "diseases", content: "Ù…Ø±Ø¶ ÙÙŠØ±ÙˆØ³ÙŠ ÙŠØµÙŠØ¨ Ø§Ù„Ø¬Ù‡Ø§Ø² Ø§Ù„ØªÙ†ÙØ³ÙŠØŒ Ø§Ù„Ø£Ø¹Ø±Ø§Ø¶: Ø­Ù…Ù‰ØŒ Ø³Ø¹Ø§Ù„ØŒ Ø¢Ù„Ø§Ù… Ø¬Ø³Ù…..."},
            {id: 2, title: "Amoxicillin", category: "drugs", content: "Ù…Ø¶Ø§Ø¯ Ø­ÙŠÙˆÙŠ ÙˆØ§Ø³Ø¹ Ø§Ù„Ù…Ø¬Ø§Ù„ØŒ Ø§Ù„Ø¬Ø±Ø¹Ø©: 500mg ÙƒÙ„ 8 Ø³Ø§Ø¹Ø§ØªØŒ Ù…ÙˆØ§Ù†Ø¹ Ø§Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù…: Ø­Ø³Ø§Ø³ÙŠØ© Ø§Ù„Ø¨Ù†Ø³Ù„ÙŠÙ†"},
            {id: 3, title: "Ø­Ù‚Ù† Ø¹Ø¶Ù„ÙŠ", category: "procedures", content: "ÙŠØªÙ… Ø§Ù„Ø­Ù‚Ù† ÙÙŠ Ø§Ù„Ø¹Ø¶Ù„Ø© Ø§Ù„Ø£Ù„ÙˆÙŠØ© Ø£Ùˆ Ø§Ù„Ø¯Ø§Ù„ÙŠØ©ØŒ Ø²Ø§ÙˆÙŠØ© 90 Ø¯Ø±Ø¬Ø©..."},
            {id: 4, title: "ÙØ­Øµ CBC", category: "tests", content: "ØªØ­Ù„ÙŠÙ„ ØµÙˆØ±Ø© Ø§Ù„Ø¯Ù… Ø§Ù„ÙƒØ§Ù…Ù„Ø©ØŒ ÙŠØ´Ù…Ù„: Ø§Ù„Ù‡ÙŠÙ…ÙˆØ¬Ù„ÙˆØ¨ÙŠÙ†ØŒ ÙƒØ±Ø§Øª Ø§Ù„Ø¯Ù… Ø§Ù„Ø¨ÙŠØ¶Ø§Ø¡ ÙˆØ§Ù„Ø­Ù…Ø±Ø§Ø¡..."},
            {id: 5, title: "Ø¶ØºØ· Ø§Ù„Ø¯Ù… Ø§Ù„Ù…Ø±ØªÙØ¹", category: "diseases", content: "Ø§Ø±ØªÙØ§Ø¹ Ø¶ØºØ· Ø§Ù„Ø¯Ù… Ø¹Ù† 140/90ØŒ Ø§Ù„Ø¹Ù„Ø§Ø¬: Ù…Ø¯Ø±Ø§Øª Ø¨ÙˆÙ„ØŒ Ø­Ø§ØµØ±Ø§Øª Ø¨ÙŠØªØ§..."},
            {id: 6, title: "Ø§Ù„Ø§Ù†Ø³ÙˆÙ„ÙŠÙ†", category: "drugs", content: "Ù‡Ø±Ù…ÙˆÙ† Ù„Ø¹Ù„Ø§Ø¬ Ø§Ù„Ø³ÙƒØ±ÙŠØŒ Ø£Ù†ÙˆØ§Ø¹: Ù‚ØµÙŠØ±ØŒ Ù…ØªÙˆØ³Ø·ØŒ Ø·ÙˆÙŠÙ„ Ø§Ù„Ù…ÙØ¹ÙˆÙ„ØŒ Ø§Ù„ØªØ®Ø²ÙŠÙ†: Ø«Ù„Ø§Ø¬Ø© 2-8 Ù…"}
        ];

        // Ø§Ù„Ù…Ù…Ø±Ø¶ÙˆÙ†
        let nurses = JSON.parse(localStorage.getItem('shifa_nurses')) || [
            {id: 1, name: "Ø³Ø§Ø±Ø© Ø£Ø­Ù…Ø¯", shift: "ØµØ¨Ø§Ø­", phone: "0912345678"},
            {id: 2, name: "Ù…Ø±ÙŠÙ… Ø®Ø§Ù„Ø¯", shift: "Ù…Ø³Ø§Ø¡", phone: "0912345679"},
            {id: 3, name: "Ø­Ø³Ù† Ø¹Ù…Ø±", shift: "Ù„ÙŠÙ„", phone: "0912345680"}
        ];

        // Ø³Ø¬Ù„Ø§Øª Ø§Ù„Ù†Ø¸Ø§Ù…
        let systemLogs = JSON.parse(localStorage.getItem('shifa_logs')) || [];
        let permissionLogs = JSON.parse(localStorage.getItem('shifa_permission_logs')) || [];
        let userActivityLogs = JSON.parse(localStorage.getItem('shifa_activity_logs')) || [];

        // Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø§Ù„Ø­Ø§Ù„ÙŠ
        let currentUser = localStorage.getItem('shifa_user') ? JSON.parse(localStorage.getItem('shifa_user')) : null;
        let selectedPatientId = null;
        let currentRxItems = [];
        let currentNursingOrders = [];

        // ============================================
        // Ø¯ÙˆØ§Ù„ Ù†Ø¸Ø§Ù… Ø§Ù„ØµÙ„Ø§Ø­ÙŠØ§Øª Ø§Ù„Ù…ØªÙ‚Ø¯Ù…
        // ============================================

        // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„ØµÙ„Ø§Ø­ÙŠØ©
        function hasPermission(permission) {
            if (!currentUser) return false;
            if (currentUser.r === ROLES.SUPER_ADMIN) return true;
            if (!currentUser.permissions) {
                currentUser.permissions = DEFAULT_ROLE_PERMISSIONS[currentUser.r] || [];
                localStorage.setItem('shifa_user', JSON.stringify(currentUser));
            }
            return currentUser.permissions.includes(permission);
        }

        // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ØµÙ„Ø§Ø­ÙŠØ© Ø§Ù„Ù‚Ø³Ù…
        function hasSectionPermission(section) {
            const sectionPermissions = {
                'reception': [ALL_PERMISSIONS.RECEPTION_VIEW],
                'doctor': [ALL_PERMISSIONS.DOCTOR_VIEW],
                'lab': [ALL_PERMISSIONS.LAB_VIEW],
                'pharmacy': [ALL_PERMISSIONS.PHARMACY_VIEW],
                'nursing': [ALL_PERMISSIONS.NURSING_VIEW],
                'admin': [ALL_PERMISSIONS.ADMIN_VIEW]
            };
            
            if (!sectionPermissions[section]) return false;
            return sectionPermissions[section].some(permission => hasPermission(permission));
        }

        // ØªØ³Ø¬ÙŠÙ„ Ù†Ø´Ø§Ø· Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…
        function logUserActivity(action, details = {}) {
            if (!currentUser) return;
            
            const activity = {
                userId: currentUser.u,
                userName: currentUser.name,
                role: currentUser.r,
                action: action,
                details: details,
                timestamp: new Date().toISOString(),
                ip: 'local'
            };
            
            userActivityLogs.push(activity);
            if (userActivityLogs.length > 1000) userActivityLogs = userActivityLogs.slice(-1000);
            localStorage.setItem('shifa_activity_logs', JSON.stringify(userActivityLogs));
        }

        // ØªØ³Ø¬ÙŠÙ„ ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„ØµÙ„Ø§Ø­ÙŠØ§Øª
        function logPermissionChange(changedBy, role, changes) {
            const log = {
                changedBy: changedBy,
                role: role,
                changes: changes,
                timestamp: new Date().toISOString()
            };
            
            permissionLogs.push(log);
            if (permissionLogs.length > 500) permissionLogs = permissionLogs.slice(-500);
            localStorage.setItem('shifa_permission_logs', JSON.stringify(permissionLogs));
        }

        // ØªØ³Ø¬ÙŠÙ„ Ø³Ø¬Ù„ Ø§Ù„Ù†Ø¸Ø§Ù…
        function logSystemEvent(event, level = 'info', details = {}) {
            const log = {
                event: event,
                level: level,
                details: details,
                timestamp: new Date().toISOString(),
                user: currentUser ? currentUser.u : 'system'
            };
            
            systemLogs.push(log);
            if (systemLogs.length > 2000) systemLogs = systemLogs.slice(-2000);
            localStorage.setItem('shifa_logs', JSON.stringify(systemLogs));
        }

        // ØªØ­Ù…ÙŠÙ„ Ù†Ø¸Ø±Ø© Ø¹Ø§Ù…Ø© Ø¹Ù„Ù‰ Ø§Ù„Ø£Ø¯ÙˆØ§Ø±
        function loadRolesOverview() {
            const container = document.getElementById('rolesOverview');
            let html = '';
            
            Object.entries(ROLE_DESCRIPTIONS).forEach(([role, description]) => {
                const roleData = staffMembers.filter(s => s.r === role);
                const count = roleData.length;
                
                html += `
                    <div class="col-6 col-md-4 col-lg-3 mb-2">
                        <div class="card h-100">
                            <div class="card-body p-2 text-center">
                                <h6 class="mb-1">${description.split(' - ')[0]}</h6>
                                <small class="text-muted">${description.split(' - ')[1] || ''}</small>
                                <div class="mt-2">
                                    <span class="badge bg-primary">${count} Ù…Ø³ØªØ®Ø¯Ù…</span>
                                </div>
                                <button class="btn btn-sm btn-outline-info mt-2" onclick="editRolePermissions('${role}')">
                                    âš™ï¸ Ø¥Ø¯Ø§Ø±Ø©
                                </button>
                            </div>
                        </div>
                    </div>
                `;
            });
            
            container.innerHTML = html;
            
            // ØªØ­Ø¯ÙŠØ« Ù‚Ø§Ø¦Ù…Ø© Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ø£Ø¯ÙˆØ§Ø±
            const roleSelector = document.getElementById('roleSelector');
            roleSelector.innerHTML = '<option value="">Ø§Ø®ØªØ± Ø¯ÙˆØ±Ø§Ù‹</option>' + 
                Object.entries(ROLE_DESCRIPTIONS).map(([role, desc]) => 
                    `<option value="${role}">${desc}</option>`
                ).join('');
        }

        // ØªØ­Ù…ÙŠÙ„ ØµÙ„Ø§Ø­ÙŠØ§Øª Ø§Ù„Ø¯ÙˆØ±
        function loadRolePermissions(role = null) {
            if (!role) {
                role = document.getElementById('roleSelector').value;
                if (!role) return;
            }
            
            document.getElementById('roleSelector').value = role;
            
            const container = document.getElementById('permissionsContainer');
            const permissions = DEFAULT_ROLE_PERMISSIONS[role] || [];
            
            // ØªØ¬Ù…ÙŠØ¹ Ø§Ù„ØµÙ„Ø§Ø­ÙŠØ§Øª Ø­Ø³Ø¨ Ø§Ù„ÙØ¦Ø©
            const categorizedPermissions = {};
            Object.entries(PERMISSION_DESCRIPTIONS).forEach(([perm, desc]) => {
                const category = desc.split(' - ')[0] || 'Ø¹Ø§Ù…';
                if (!categorizedPermissions[category]) {
                    categorizedPermissions[category] = [];
                }
                categorizedPermissions[category].push({perm, desc});
            });
            
            let html = '<div class="permission-header mb-3"><h6 class="mb-0">ØµÙ„Ø§Ø­ÙŠØ§Øª: ' + ROLE_DESCRIPTIONS[role] + '</h6></div>';
            
            Object.entries(categorizedPermissions).forEach(([category, perms]) => {
                html += `
                    <div class="card mb-3">
                        <div class="card-header bg-light">
                            <h6 class="mb-0">${category}</h6>
                        </div>
                        <div class="card-body">
                            ${perms.map(({perm, desc}) => `
                                <div class="permission-row d-flex justify-content-between align-items-center">
                                    <div>
                                        <span class="form-check-label">${desc}</span>
                                        <small class="text-muted d-block">${perm}</small>
                                    </div>
                                    <div class="form-check form-switch">
                                        <input class="form-check-input permission-toggle" type="checkbox" 
                                               id="perm_${perm}" ${permissions.includes(perm) ? 'checked' : ''}>
                                    </div>
                                </div>
                            `).join('')}
                        </div>
                    </div>
                `;
            });
            
            container.innerHTML = html;
        }

        // Ø­ÙØ¸ ØµÙ„Ø§Ø­ÙŠØ§Øª Ø§Ù„Ø¯ÙˆØ±
        function saveRolePermissions() {
            const role = document.getElementById('roleSelector').value;
            if (!role) {
                alert('Ø§Ø®ØªØ± Ø¯ÙˆØ±Ø§Ù‹ Ø£ÙˆÙ„Ø§Ù‹!');
                return;
            }
            
            const checkboxes = document.querySelectorAll('#permissionsContainer .permission-toggle');
            const newPermissions = [];
            
            checkboxes.forEach(cb => {
                if (cb.checked) {
                    const perm = cb.id.replace('perm_', '');
                    newPermissions.push(perm);
                }
            });
            
            // ØªØ­Ø¯ÙŠØ« ØµÙ„Ø§Ø­ÙŠØ§Øª Ø§Ù„Ø¯ÙˆØ± Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠØ©
            DEFAULT_ROLE_PERMISSIONS[role] = newPermissions;
            
            // ØªØ­Ø¯ÙŠØ« ØµÙ„Ø§Ø­ÙŠØ§Øª Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ† Ø¨Ù‡Ø°Ø§ Ø§Ù„Ø¯ÙˆØ±
            staffMembers.forEach(user => {
                if (user.r === role) {
                    user.permissions = newPermissions;
                }
            });
            
            // Ø­ÙØ¸ Ø§Ù„ØªØºÙŠÙŠØ±Ø§Øª
            localStorage.setItem('shifa_staff', JSON.stringify(staffMembers));
            
            // ØªØ³Ø¬ÙŠÙ„ Ø§Ù„ØªØºÙŠÙŠØ±
            logPermissionChange(currentUser.u, role, {
                added: newPermissions.filter(p => !(DEFAULT_ROLE_PERMISSIONS[role] || []).includes(p)),
                removed: (DEFAULT_ROLE_PERMISSIONS[role] || []).filter(p => !newPermissions.includes(p))
            });
            
            // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø§Ù„Ø­Ø§Ù„ÙŠ Ø¥Ø°Ø§ ÙƒØ§Ù† ÙŠÙ†Ø·Ø¨Ù‚ Ø¹Ù„ÙŠÙ‡
            if (currentUser.r === role) {
                currentUser.permissions = newPermissions;
                localStorage.setItem('shifa_user', JSON.stringify(currentUser));
            }
            
            // ØªØ­Ø¯ÙŠØ« Ø³Ø¬Ù„ Ø§Ù„ØµÙ„Ø§Ø­ÙŠØ§Øª
            updatePermissionsLog();
            
            alert('âœ… ØªÙ… Ø­ÙØ¸ ØµÙ„Ø§Ø­ÙŠØ§Øª Ø§Ù„Ø¯ÙˆØ± Ø¨Ù†Ø¬Ø§Ø­!');
            logSystemEvent('ØªØ­Ø¯ÙŠØ« ØµÙ„Ø§Ø­ÙŠØ§Øª Ø§Ù„Ø¯ÙˆØ±', 'info', {role, permissions: newPermissions});
        }

        // ØªØ­Ø¯ÙŠØ« Ø³Ø¬Ù„ Ø§Ù„ØµÙ„Ø§Ø­ÙŠØ§Øª
        function updatePermissionsLog() {
            const container = document.getElementById('permissionsLog');
            const recentLogs = permissionLogs.slice(-10).reverse();
            
            container.innerHTML = recentLogs.map(log => `
                <div class="border-bottom pb-2 mb-2">
                    <small class="text-muted">${new Date(log.timestamp).toLocaleString('ar-EG')}</small><br>
                    <strong>${log.changedBy}</strong> Ù‚Ø§Ù… Ø¨ØªØ¹Ø¯ÙŠÙ„ ØµÙ„Ø§Ø­ÙŠØ§Øª Ø¯ÙˆØ± 
                    <span class="badge bg-info">${ROLE_DESCRIPTIONS[log.role]?.split(' - ')[0] || log.role}</span>
                </div>
            `).join('');
        }

        // ÙØªØ­ Ù†Ø§ÙØ°Ø© Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø¯ÙˆØ±
        function editRolePermissions(role) {
            document.getElementById('roleSelector').value = role;
            loadRolePermissions(role);
            showAdminTab('permissions');
        }

        // Ø¹Ø±Ø¶ ØµÙ„Ø§Ø­ÙŠØ§ØªÙŠ
        function showMyPermissions() {
            if (!currentUser) return;
            
            const modal = new bootstrap.Modal(document.getElementById('permissionsModal'));
            const container = document.getElementById('permissionsDetails');
            
            const permissions = currentUser.permissions || DEFAULT_ROLE_PERMISSIONS[currentUser.r] || [];
            const categorized = {};
            
            permissions.forEach(perm => {
                const desc = PERMISSION_DESCRIPTIONS[perm];
                if (desc) {
                    const category = desc.split(' - ')[0] || 'Ø¹Ø§Ù…';
                    if (!categorized[category]) {
                        categorized[category] = [];
                    }
                    categorized[category].push(desc);
                }
            });
            
            let html = `
                <div class="text-center mb-4">
                    <h5>ğŸ‘¤ ${currentUser.name}</h5>
                    <span class="badge bg-primary">${ROLE_DESCRIPTIONS[currentUser.r]}</span>
                </div>
            `;
            
            Object.entries(categorized).forEach(([category, perms]) => {
                html += `
                    <div class="card mb-3">
                        <div class="card-header bg-light">
                            <h6 class="mb-0">${category}</h6>
                        </div>
                        <div class="card-body">
                            ${perms.map(desc => `
                                <div class="d-flex align-items-center mb-2">
                                    <span class="badge bg-success me-2">âœ“</span>
                                    <span>${desc}</span>
                                </div>
                            `).join('')}
                        </div>
                    </div>
                `;
            });
            
            container.innerHTML = html;
            modal.show();
        }

        // ============================================
        // Ø¯ÙˆØ§Ù„ Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ† Ø§Ù„Ù…ØªÙ‚Ø¯Ù…Ø©
        // ============================================

        // Ø¥Ø¶Ø§ÙØ© Ù…ÙˆØ¸Ù Ø¬Ø¯ÙŠØ¯
        function addNewStaff() {
            const u = document.getElementById('newStaffUser').value.trim();
            const p = document.getElementById('newStaffPass').value;
            const r = document.getElementById('newStaffRole').value;
            
            if(!u || !p) {
                alert("Ø£Ø¯Ø®Ù„ Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… ÙˆÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±!");
                return;
            }
            
            const exists = staffMembers.find(s => s.u === u);
            if (exists) {
                alert("Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ù…ÙˆØ¬ÙˆØ¯ Ù…Ø³Ø¨Ù‚Ø§Ù‹!");
                return;
            }
            
            // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ù‚ÙˆØ© ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±
            if (p.length < 6) {
                alert("ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± ÙŠØ¬Ø¨ Ø£Ù† ØªÙƒÙˆÙ† 6 Ø£Ø­Ø±Ù Ø¹Ù„Ù‰ Ø§Ù„Ø£Ù‚Ù„!");
                return;
            }
            
            const newStaff = {
                u, 
                p, 
                r, 
                name: u,
                permissions: DEFAULT_ROLE_PERMISSIONS[r] || [],
                lastLogin: null,
                status: 'active',
                created: new Date().toISOString(),
                createdBy: currentUser ? currentUser.u : 'system'
            };
            
            staffMembers.push(newStaff);
            localStorage.setItem('shifa_staff', JSON.stringify(staffMembers));
            
            document.getElementById('newStaffUser').value = '';
            document.getElementById('newStaffPass').value = '';
            
            refreshStaffTable();
            logUserActivity('Ø¥Ø¶Ø§ÙØ© Ù…ÙˆØ¸Ù Ø¬Ø¯ÙŠØ¯', {username: u, role: r});
            logSystemEvent('Ø¥Ø¶Ø§ÙØ© Ù…Ø³ØªØ®Ø¯Ù… Ø¬Ø¯ÙŠØ¯', 'info', {username: u, role: r});
            
            alert(`âœ… ØªÙ… Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… ${u} Ø¨Ù†Ø¬Ø§Ø­!`);
        }

        // ØªØ­Ø¯ÙŠØ« Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ù…ÙˆØ¸ÙÙŠÙ†
        function refreshStaffTable() {
            const tableBody = document.getElementById('staffTableBody');
            tableBody.innerHTML = staffMembers.map((s, i) => `
                <tr>
                    <td>
                        <div>
                            <strong>${s.name}</strong><br>
                            <small class="text-muted">${s.u}</small>
                        </div>
                    </td>
                    <td>
                        <span class="badge bg-info role-badge">${ROLE_DESCRIPTIONS[s.r]?.split(' - ')[0] || s.r}</span>
                    </td>
                    <td>
                        <span class="${s.lastLogin ? 'user-status-online' : 'user-status-offline'}">
                            ${s.lastLogin ? 'Ù†Ø´Ø· ' + new Date(s.lastLogin).toLocaleTimeString('ar-EG') : 'Ù„Ù… ÙŠØ³Ø¬Ù„ Ø¯Ø®ÙˆÙ„'}
                        </span>
                    </td>
                    <td>
                        ${s.status === 'active' ? 
                            '<span class="badge bg-success">Ù†Ø´Ø·</span>' : 
                            '<span class="badge bg-danger">Ù…Ø¹Ø·Ù„</span>'
                        }
                    </td>
                    <td>
                        <button class="btn btn-sm btn-outline-warning me-1" onclick="editStaff(${i})" title="ØªØ¹Ø¯ÙŠÙ„">
                            âœï¸
                        </button>
                        <button class="btn btn-sm btn-outline-danger" onclick="deleteStaff(${i})" title="Ø­Ø°Ù">
                            âœ•
                        </button>
                    </td>
                </tr>
            `).join('');
        }

        // Ø­Ø°Ù Ù…ÙˆØ¸Ù
        function deleteStaff(index) {
            const staff = staffMembers[index];
            if (!confirm(`Ù‡Ù„ ØªØ±ÙŠØ¯ Ø­Ø°Ù Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… ${staff.name}ØŸ`)) return;
            
            if (staff.u === currentUser.u) {
                alert("Ù„Ø§ ÙŠÙ…ÙƒÙ†Ùƒ Ø­Ø°Ù Ø­Ø³Ø§Ø¨Ùƒ Ø§Ù„Ø®Ø§Øµ!");
                return;
            }
            
            staffMembers.splice(index, 1);
            localStorage.setItem('shifa_staff', JSON.stringify(staffMembers));
            refreshStaffTable();
            
            logUserActivity('Ø­Ø°Ù Ù…ÙˆØ¸Ù', {username: staff.u, name: staff.name});
            logSystemEvent('Ø­Ø°Ù Ù…Ø³ØªØ®Ø¯Ù…', 'warning', {username: staff.u});
            
            alert("âœ… ØªÙ… Ø­Ø°Ù Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…!");
        }

        // ØªØ¹Ø¯ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ù…ÙˆØ¸Ù
        function editStaff(index) {
            const staff = staffMembers[index];
            const newName = prompt("Ø§Ù„Ø§Ø³Ù… Ø§Ù„Ø¬Ø¯ÙŠØ¯:", staff.name);
            if (newName && newName !== staff.name) {
                staff.name = newName;
                localStorage.setItem('shifa_staff', JSON.stringify(staffMembers));
                refreshStaffTable();
                
                logUserActivity('ØªØ¹Ø¯ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ù…ÙˆØ¸Ù', {username: staff.u, oldName: staff.name, newName});
                alert("âœ… ØªÙ… ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ø§Ø³Ù…!");
            }
        }

        // Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±
        function resetUserPassword() {
            const username = prompt("Ø£Ø¯Ø®Ù„ Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…:");
            if (!username) return;
            
            const user = staffMembers.find(s => s.u === username);
            if (!user) {
                alert("Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯!");
                return;
            }
            
            const newPassword = prompt("Ø£Ø¯Ø®Ù„ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©:");
            if (!newPassword || newPassword.length < 6) {
                alert("ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± ÙŠØ¬Ø¨ Ø£Ù† ØªÙƒÙˆÙ† 6 Ø£Ø­Ø±Ù Ø¹Ù„Ù‰ Ø§Ù„Ø£Ù‚Ù„!");
                return;
            }
            
            const confirmPassword = prompt("Ø£Ø¹Ø¯ Ø¥Ø¯Ø®Ø§Ù„ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±:");
            if (newPassword !== confirmPassword) {
                alert("ÙƒÙ„Ù…Ø§Øª Ø§Ù„Ù…Ø±ÙˆØ± ØºÙŠØ± Ù…ØªØ·Ø§Ø¨Ù‚Ø©!");
                return;
            }
            
            user.p = newPassword;
            localStorage.setItem('shifa_staff', JSON.stringify(staffMembers));
            
            logUserActivity('Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† ÙƒÙ„Ù…Ø© Ù…Ø±ÙˆØ±', {username: user.u});
            logSystemEvent('Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† ÙƒÙ„Ù…Ø© Ù…Ø±ÙˆØ±', 'warning', {username: user.u});
            
            alert("âœ… ØªÙ… Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± Ø¨Ù†Ø¬Ø§Ø­!");
        }

        // ØªØµØ¯ÙŠØ± Ù†Ø´Ø§Ø· Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†
        function exportUserActivity() {
            const data = {
                users: staffMembers.map(u => ({
                    username: u.u,
                    name: u.name,
                    role: u.r,
                    lastLogin: u.lastLogin,
                    status: u.status
                })),
                activities: userActivityLogs.slice(-100),
                exportDate: new Date().toISOString()
            };
            
            const blob = new Blob([JSON.stringify(data, null, 2)], {type: 'application/json'});
            const a = document.createElement('a');
            a.href = URL.createObjectURL(blob);
            a.download = `User_Activity_${new Date().toLocaleDateString('ar-EG')}.json`;
            a.click();
            
            alert("âœ… ØªÙ… ØªØµØ¯ÙŠØ± Ù†Ø´Ø§Ø· Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†!");
        }

        // ============================================
        // Ø¯ÙˆØ§Ù„ Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø¬Ù„Ø³Ø§Øª ÙˆØ§Ù„Ø£Ù…Ø§Ù†
        // ============================================

        // Ø¨Ø¯Ø¡ Ø¬Ù„Ø³Ø© Ø¬Ø¯ÙŠØ¯Ø©
        function startSession() {
            if (!currentUser) return;
            
            currentUser.lastLogin = new Date().toISOString();
            localStorage.setItem('shifa_user', JSON.stringify(currentUser));
            
            // ØªØ­Ø¯ÙŠØ« Ø¢Ø®Ø± Ø¯Ø®ÙˆÙ„ ÙÙŠ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…ÙˆØ¸ÙÙŠÙ†
            const userIndex = staffMembers.findIndex(s => s.u === currentUser.u);
            if (userIndex !== -1) {
                staffMembers[userIndex].lastLogin = currentUser.lastLogin;
                localStorage.setItem('shifa_staff', JSON.stringify(staffMembers));
            }
            
            // ØªØ¹ÙŠÙŠÙ† Ù…Ù‡Ù„Ø© Ø§Ù„Ø¬Ù„Ø³Ø© (8 Ø³Ø§Ø¹Ø§Øª)
            SESSION_TIMEOUT = setTimeout(() => {
                if (confirm("Ø§Ù†ØªÙ‡Øª Ù…Ù‡Ù„Ø© Ø§Ù„Ø¬Ù„Ø³Ø©. Ù‡Ù„ ØªØ±ÙŠØ¯ ØªØ¬Ø¯ÙŠØ¯Ù‡Ø§ØŸ")) {
                    startSession();
                } else {
                    logout();
                }
            }, 8 * 60 * 60 * 1000);
            
            logUserActivity('ØªØ³Ø¬ÙŠÙ„ Ø¯Ø®ÙˆÙ„');
            logSystemEvent('ØªØ³Ø¬ÙŠÙ„ Ø¯Ø®ÙˆÙ„', 'info', {username: currentUser.u, role: currentUser.r});
        }

        // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø¬Ù„Ø³Ø©
        function checkSession() {
            const session = JSON.parse(localStorage.getItem('shifa_session'));
            if (!session || !session.user) return false;
            
            const now = new Date();
            const expiresAt = new Date(session.expiresAt);
            
            if (now > expiresAt) {
                localStorage.removeItem('shifa_session');
                localStorage.removeItem('shifa_user');
                return false;
            }
            
            currentUser = session.user;
            return true;
        }

        // ÙØªØ­ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…
        function openUserMenu() {
            if (!currentUser) return;
            
            document.getElementById('userNameDisplay').textContent = currentUser.name;
            document.getElementById('userRoleDisplay').textContent = ROLE_DESCRIPTIONS[currentUser.r]?.split(' - ')[0] || currentUser.r;
            document.getElementById('lastLoginDisplay').textContent = currentUser.lastLogin ? 
                `Ø¢Ø®Ø± Ø¯Ø®ÙˆÙ„: ${new Date(currentUser.lastLogin).toLocaleString('ar-EG')}` : 
                'Ù„Ù… ÙŠØ³Ø¬Ù„ Ø¯Ø®ÙˆÙ„ Ù…Ù† Ù‚Ø¨Ù„';
            
            const modal = new bootstrap.Modal(document.getElementById('userMenuModal'));
            modal.show();
        }

        // ØªØºÙŠÙŠØ± ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±
        function changePasswordModal() {
            const modal = new bootstrap.Modal(document.getElementById('changePasswordModal'));
            modal.show();
        }

        // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ù‚ÙˆØ© ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±
        function checkPasswordStrength() {
            const password = document.getElementById('newPassword').value;
            const strengthBar = document.getElementById('passwordStrength');
            
            let strength = 0;
            let color = '#dc3545';
            
            if (password.length >= 8) strength++;
            if (/[A-Z]/.test(password)) strength++;
            if (/[a-z]/.test(password)) strength++;
            if (/[0-9]/.test(password)) strength++;
            if (/[^A-Za-z0-9]/.test(password)) strength++;
            
            if (strength === 5) {
                color = '#198754';
            } else if (strength >= 3) {
                color = '#ffc107';
            }
            
            strengthBar.style.width = (strength * 20) + '%';
            strengthBar.style.backgroundColor = color;
        }

        // ØªØ£ÙƒÙŠØ¯ ØªØºÙŠÙŠØ± ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±
        function confirmPasswordChange() {
            const currentPass = document.getElementById('currentPassword').value;
            const newPass = document.getElementById('newPassword').value;
            const confirmPass = document.getElementById('confirmPassword').value;
            
            if (!currentPass || !newPass || !confirmPass) {
                alert("Ø§Ù…Ù„Ø£ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ„!");
                return;
            }
            
            if (currentPass !== currentUser.p) {
                alert("ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± Ø§Ù„Ø­Ø§Ù„ÙŠØ© ØºÙŠØ± ØµØ­ÙŠØ­Ø©!");
                return;
            }
            
            if (newPass !== confirmPass) {
                alert("ÙƒÙ„Ù…Ø§Øª Ø§Ù„Ù…Ø±ÙˆØ± ØºÙŠØ± Ù…ØªØ·Ø§Ø¨Ù‚Ø©!");
                return;
            }
            
            if (newPass.length < 6) {
                alert("ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± ÙŠØ¬Ø¨ Ø£Ù† ØªÙƒÙˆÙ† 6 Ø£Ø­Ø±Ù Ø¹Ù„Ù‰ Ø§Ù„Ø£Ù‚Ù„!");
                return;
            }
            
            // ØªØ­Ø¯ÙŠØ« ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±
            const userIndex = staffMembers.findIndex(s => s.u === currentUser.u);
            if (userIndex !== -1) {
                staffMembers[userIndex].p = newPass;
                currentUser.p = newPass;
                
                localStorage.setItem('shifa_staff', JSON.stringify(staffMembers));
                localStorage.setItem('shifa_user', JSON.stringify(currentUser));
                
                logUserActivity('ØªØºÙŠÙŠØ± ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±');
                logSystemEvent('ØªØºÙŠÙŠØ± ÙƒÙ„Ù…Ø© Ù…Ø±ÙˆØ±', 'info', {username: currentUser.u});
                
                alert("âœ… ØªÙ… ØªØºÙŠÙŠØ± ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± Ø¨Ù†Ø¬Ø§Ø­!");
                bootstrap.Modal.getInstance(document.getElementById('changePasswordModal')).hide();
            }
        }

        // Ø¹Ø±Ø¶ Ù†Ø´Ø§Ø·ÙŠ
        function viewMyActivity() {
            if (!currentUser) return;
            
            const myActivities = userActivityLogs
                .filter(log => log.userId === currentUser.u)
                .slice(-20)
                .reverse();
            
            let html = `
                <div class="card">
                    <div class="card-header bg-info text-white">
                        <h5 class="mb-0">ğŸ“‹ Ø³Ø¬Ù„ Ù†Ø´Ø§Ø·ÙŠ</h5>
                    </div>
                    <div class="card-body">
                        ${myActivities.length === 0 ? 
                            '<p class="text-muted">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø£Ù†Ø´Ø·Ø© Ù…Ø³Ø¬Ù„Ø©</p>' :
                            myActivities.map(act => `
                                <div class="border-bottom pb-2 mb-2">
                                    <div class="d-flex justify-content-between">
                                        <strong>${act.action}</strong>
                                        <small class="text-muted">${new Date(act.timestamp).toLocaleString('ar-EG')}</small>
                                    </div>
                                    ${act.details ? `<small class="text-muted">${JSON.stringify(act.details)}</small>` : ''}
                                </div>
                            `).join('')
                        }
                    </div>
                </div>
            `;
            
            document.getElementById('permissionsDetails').innerHTML = html;
            const modal = new bootstrap.Modal(document.getElementById('permissionsModal'));
            modal.show();
        }

        // ============================================
        // Ø¯ÙˆØ§Ù„ PWA (Ø§Ù„Ù…Ø­ÙÙˆØ¸Ø© Ù…Ù† Ø§Ù„ÙƒÙˆØ¯ Ø§Ù„Ø³Ø§Ø¨Ù‚)
        // ============================================

        // PWA Service Worker Registration
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('service-worker.js')
                    .then(registration => {
                        console.log('âœ… Service Worker registered:', registration.scope);
                        document.getElementById('pwaStatus').textContent = 'PWA: Ù†Ø´Ø·';
                        document.getElementById('pwaStatus').className = 'badge bg-success';
                        
                        registration.addEventListener('updatefound', () => {
                            const newWorker = registration.installing;
                            console.log('ğŸ”„ Service Worker update found');
                            document.getElementById('pwaStatus').textContent = 'PWA: Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ø¯ÙŠØ«';
                            document.getElementById('pwaStatus').className = 'badge bg-warning';
                        });
                    })
                    .catch(error => {
                        console.error('âŒ Service Worker registration failed:', error);
                        document.getElementById('pwaStatus').textContent = 'PWA: ØºÙŠØ± Ù†Ø´Ø·';
                        document.getElementById('pwaStatus').className = 'badge bg-danger';
                    });
                
                navigator.serviceWorker.addEventListener('message', event => {
                    if (event.data && event.data.type === 'CACHE_UPDATED') {
                        console.log('ğŸ”„ Cache updated, new content available');
                        showUpdateNotification();
                    }
                });
            });
        }

        // PWA Installation
        let deferredPrompt;
        const installButton = document.getElementById('installButton');

        window.addEventListener('beforeinstallprompt', (e) => {
            e.preventDefault();
            deferredPrompt = e;
            installButton.classList.remove('hidden-section');
            
            installButton.addEventListener('click', () => {
                installButton.classList.add('hidden-section');
                deferredPrompt.prompt();
                
                deferredPrompt.userChoice.then((choiceResult) => {
                    if (choiceResult.outcome === 'accepted') {
                        console.log('âœ… User accepted install');
                        showNotification('ØªÙ… ØªØ«Ø¨ÙŠØª Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ Ø¨Ù†Ø¬Ø§Ø­!', 'success');
                    } else {
                        console.log('âŒ User declined install');
                    }
                    deferredPrompt = null;
                });
            });
        });

        window.addEventListener('appinstalled', () => {
            console.log('ğŸ“± PWA installed successfully');
            installButton.classList.add('hidden-section');
            deferredPrompt = null;
            localStorage.setItem('appInstalled', 'true');
            localStorage.setItem('installDate', new Date().toISOString());
        });

        // PWA Notifications
        function requestNotificationPermission() {
            if ('Notification' in window && Notification.permission === 'default') {
                Notification.requestPermission().then(permission => {
                    if (permission === 'granted') {
                        console.log('âœ… Notification permission granted');
                        localStorage.setItem('notificationsEnabled', 'true');
                    }
                });
            }
        }

        function showNotification(title, body, icon = null) {
            if ('Notification' in window && Notification.permission === 'granted') {
                const options = {
                    body: body,
                    icon: icon || 'https://cdn-icons-png.flaticon.com/512/822/822118.png',
                    badge: 'https://cdn-icons-png.flaticon.com/512/822/822118.png',
                    tag: 'shifa-notification',
                    requireInteraction: true
                };
                
                const notification = new Notification(title, options);
                
                notification.onclick = function() {
                    window.focus();
                    notification.close();
                };
                
                setTimeout(notification.close.bind(notification), 5000);
            }
        }

        function showUpdateNotification() {
            const notification = document.createElement('div');
            notification.className = 'pwa-notification';
            notification.innerHTML = `
                <div class="text-center">
                    <h5>ğŸ”„ ØªØ­Ø¯ÙŠØ« Ø¬Ø¯ÙŠØ¯ Ù…ØªØ§Ø­!</h5>
                    <p>ØªÙ… ØªØ­Ø¯ÙŠØ« Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ Ø¨Ù…Ø­ØªÙˆÙ‰ Ø¬Ø¯ÙŠØ¯. Ø§Ø¶ØºØ· Ø¹Ù„Ù‰ Ø²Ø± Ø§Ù„ØªØ­Ø¯ÙŠØ« Ù„ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¥ØµØ¯Ø§Ø± Ø§Ù„Ø¬Ø¯ÙŠØ¯.</p>
                    <button class="btn btn-primary w-100" onclick="window.location.reload()">ğŸ”„ ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¢Ù†</button>
                </div>
            `;
            
            document.body.appendChild(notification);
            
            setTimeout(() => {
                if (notification.parentNode) {
                    notification.parentNode.removeChild(notification);
                }
            }, 10000);
        }

        // ============================================
        // Ø¯ÙˆØ§Ù„ Ø§Ù„Ù†Ø¸Ø§Ù… Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ© (Ø§Ù„Ù…Ø­ÙÙˆØ¸Ø©)
        // ============================================

        // ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„
        async function handleLogin() {
            const username = document.getElementById('username').value.trim().toLowerCase();
            const password = document.getElementById('password').value.trim();
            const loginMode = document.querySelector('input[name="loginMode"]:checked').value;
            const loginStatus = document.getElementById('loginStatus');
            
            OPERATION_MODE = loginMode;
            
            loginStatus.textContent = "ğŸ”„ Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù‚Ù‚...";
            loginStatus.className = "status-info";
            
            if (loginMode === "server") {
                try {
                    const result = await apiCall('login', { u: username, p: password });
                    
                    if (result.success) {
                        currentUser = result.user;
                        localStorage.setItem('shifa_user', JSON.stringify(currentUser));
                        await syncFromServer();
                        completeLogin();
                    } else {
                        loginStatus.textContent = "âŒ Ø¨ÙŠØ§Ù†Ø§Øª Ø®Ø§Ø·Ø¦Ø© ÙÙŠ Ø§Ù„Ø³ÙŠØ±ÙØ±";
                        loginStatus.className = "status-offline";
                        alert("Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¯Ø®ÙˆÙ„ ØºÙŠØ± ØµØ­ÙŠØ­Ø© ÙÙŠ Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª!");
                    }
                } catch (error) {
                    loginStatus.textContent = "âŒ ÙØ´Ù„ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø³ÙŠØ±ÙØ±";
                    loginStatus.className = "status-offline";
                    alert("ÙØ´Ù„ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø³ÙŠØ±ÙØ±! Ø³ÙŠØªÙ… Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø­Ù„ÙŠØ©.");
                    OPERATION_MODE = "local";
                    handleLocalLogin(username, password);
                }
            } else {
                handleLocalLogin(username, password);
            }
        }

        function handleLocalLogin(username, password) {
            const user = staffMembers.find(s => s.u === username && s.p === password && s.status === 'active');
            
            if (user) {
                currentUser = user;
                localStorage.setItem('shifa_user', JSON.stringify(user));
                completeLogin();
            } else {
                document.getElementById('loginStatus').textContent = "âŒ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¯Ø®ÙˆÙ„ ØºÙŠØ± ØµØ­ÙŠØ­Ø© Ø£Ùˆ Ø§Ù„Ø­Ø³Ø§Ø¨ Ù…Ø¹Ø·Ù„!";
                alert("Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¯Ø®ÙˆÙ„ ØºÙŠØ± ØµØ­ÙŠØ­Ø© ÙÙŠ Ø§Ù„Ù†Ø¸Ø§Ù… Ø§Ù„Ù…Ø­Ù„ÙŠ Ø£Ùˆ Ø§Ù„Ø­Ø³Ø§Ø¨ Ù…Ø¹Ø·Ù„!");
            }
        }

        function completeLogin() {
            document.getElementById('loginOverlay').classList.add('hidden-section');
            document.getElementById('mainContent').classList.remove('hidden-section');
            document.getElementById('currentUserDisplay').innerText = `ğŸ‘¤ ${currentUser.u}`;
            
            setupPermissions(currentUser.r);
            startSession();
            updateConnectionStatus(navigator.onLine);
            updateSyncStatus();
            
            if (OPERATION_MODE === "server" && IS_ONLINE) {
                SYNC_INTERVAL = setInterval(processPendingSync, 30000);
            }
            
            showNotification('Ù…Ø±Ø­Ø¨Ø§Ù‹ Ø¨Ùƒ', `ØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø¯Ø®ÙˆÙ„Ùƒ ÙƒÙ€ ${ROLE_DESCRIPTIONS[currentUser.r]?.split(' - ')[0] || currentUser.r}`);
        }

        // Ø¥Ø¹Ø¯Ø§Ø¯ Ø§Ù„ØµÙ„Ø§Ø­ÙŠØ§Øª
        function setupPermissions(role) {
            // Ø¥Ø®ÙØ§Ø¡ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø£Ù‚Ø³Ø§Ù… Ø£ÙˆÙ„Ø§Ù‹
            document.querySelectorAll('.nav-item').forEach(li => li.classList.add('hidden-section'));
            
            // Ø¥Ø¸Ù‡Ø§Ø± Ø§Ù„Ø£Ù‚Ø³Ø§Ù… Ø§Ù„Ù…Ø³Ù…ÙˆØ­ Ø¨Ù‡Ø§
            const allowedSections = getSectionsForRole(role);
            allowedSections.forEach(section => {
                const tab = document.getElementById(`tab-${section}-li`);
                if (tab) tab.classList.remove('hidden-section');
            });
            
            // Ø¥Ø°Ø§ ÙƒØ§Ù† Ø§Ù„Ù…Ø¯ÙŠØ±ØŒ Ø¥Ø¸Ù‡Ø§Ø± ÙƒÙ„ Ø´ÙŠØ¡
            if (role === ROLES.ADMIN || role === ROLES.SUPER_ADMIN) {
                document.querySelectorAll('.nav-item').forEach(li => li.classList.remove('hidden-section'));
                switchSection('admin');
            } else {
                // Ø§Ù„ØªÙˆØ¬Ù‡ Ù„Ù„Ù‚Ø³Ù… Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ
                const mainSection = getMainSectionForRole(role);
                switchSection(mainSection);
            }
            
            refreshAll();
        }

        function getSectionsForRole(role) {
            const sectionMap = {
                [ROLES.SUPER_ADMIN]: ['reception', 'doctor', 'lab', 'pharmacy', 'nursing', 'admin'],
                [ROLES.ADMIN]: ['reception', 'doctor', 'lab', 'pharmacy', 'nursing', 'admin'],
                [ROLES.HEAD_DOCTOR]: ['reception', 'doctor', 'lab', 'nursing'],
                [ROLES.DOCTOR]: ['doctor'],
                [ROLES.LAB_MANAGER]: ['lab'],
                [ROLES.LAB_TECH]: ['lab'],
                [ROLES.PHARMACY_MANAGER]: ['pharmacy'],
                [ROLES.PHARMACIST]: ['pharmacy'],
                [ROLES.HEAD_NURSE]: ['nursing', 'doctor'],
                [ROLES.NURSE]: ['nursing'],
                [ROLES.RECEPTION_SUPERVISOR]: ['reception'],
                [ROLES.RECEPTION]: ['reception'],
                [ROLES.ACCOUNTANT]: ['admin'],
                [ROLES.AUDITOR]: ['admin']
            };
            
            return sectionMap[role] || [];
        }

        function getMainSectionForRole(role) {
            const mainSectionMap = {
                [ROLES.HEAD_DOCTOR]: 'doctor',
                [ROLES.DOCTOR]: 'doctor',
                [ROLES.LAB_MANAGER]: 'lab',
                [ROLES.LAB_TECH]: 'lab',
                [ROLES.PHARMACY_MANAGER]: 'pharmacy',
                [ROLES.PHARMACIST]: 'pharmacy',
                [ROLES.HEAD_NURSE]: 'nursing',
                [ROLES.NURSE]: 'nursing',
                [ROLES.RECEPTION_SUPERVISOR]: 'reception',
                [ROLES.RECEPTION]: 'reception',
                [ROLES.ACCOUNTANT]: 'admin',
                [ROLES.AUDITOR]: 'admin'
            };
            
            return mainSectionMap[role] || 'reception';
        }

        // ============================================
        // Ø¯ÙˆØ§Ù„ Ø§Ù„ØªÙ‡ÙŠØ¦Ø© ÙˆØ§Ù„Ø¥Ø¹Ø¯Ø§Ø¯
        // ============================================

        window.onload = function() {
            // Show PWA splash screen
            showSplashScreen();
            
            // ØªÙ‡ÙŠØ¦Ø© Service Worker
            if ('serviceWorker' in navigator) {
                navigator.serviceWorker.register('service-worker.js').catch(err => console.log('Service Worker failed', err));
            }
            
            // Request notification permission
            requestNotificationPermission();
            
            // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø³Ø§Ø¹Ø©
            updateClock();
            setInterval(updateClock, 1000);
            
            // ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø¹Ù„Ù‚Ø© Ù„Ù„Ù…Ø²Ø§Ù…Ù†Ø©
            PENDING_SYNC = JSON.parse(localStorage.getItem('shifa_pending_sync')) || [];
            updateSyncStatus();
            
            // ØªØ­Ù…ÙŠÙ„ ÙˆØ¶Ø¹ Ø§Ù„ØªØ´ØºÙŠÙ„ Ø§Ù„Ø³Ø§Ø¨Ù‚
            OPERATION_MODE = localStorage.getItem('shifa_mode') || "local";
            
            // ØªØ­Ø¯ÙŠØ« Ø­Ø§Ù„Ø© Ø§Ù„Ø§ØªØµØ§Ù„
            updateConnectionStatus(navigator.onLine);
            
            // ØªØ­Ù…ÙŠÙ„ Ø³Ø¬Ù„Ø§Øª Ø§Ù„ØµÙ„Ø§Ø­ÙŠØ§Øª
            updatePermissionsLog();
            
            // Ù…Ø³ØªÙ…Ø¹ÙŠ Ø£Ø­Ø¯Ø§Ø« Ø§Ù„Ø´Ø¨ÙƒØ©
            window.addEventListener('online', () => updateConnectionStatus(true));
            window.addEventListener('offline', () => updateConnectionStatus(false));
            
            // Ø¥Ø°Ø§ ÙƒØ§Ù† Ù‡Ù†Ø§Ùƒ Ù…Ø³ØªØ®Ø¯Ù… Ù…Ø³Ø¬Ù„ Ù…Ø³Ø¨Ù‚Ø§Ù‹
            if(currentUser) {
                document.getElementById('loginOverlay').classList.add('hidden-section');
                document.getElementById('mainContent').classList.remove('hidden-section');
                document.getElementById('currentUserDisplay').innerText = `ğŸ‘¤ ${currentUser.u}`;
                setupPermissions(currentUser.r);
                refreshAll();
                
                // ØªØ­Ø¯ÙŠØ¯ ÙˆØ¶Ø¹ Ø§Ù„Ø¯Ø®ÙˆÙ„ ÙÙŠ Ø§Ù„Ø´Ø§Ø´Ø©
                const modeRadio = document.querySelector(`input[name="loginMode"][value="${OPERATION_MODE}"]`);
                if (modeRadio) modeRadio.checked = true;
            } else {
                // ØªØ¹ÙŠÙŠÙ† ÙˆØ¶Ø¹ Ø§Ù„ØªØ´ØºÙŠÙ„ ÙÙŠ Ø´Ø§Ø´Ø© Ø§Ù„Ø¯Ø®ÙˆÙ„
                const modeRadio = document.querySelector(`input[name="loginMode"][value="${OPERATION_MODE}"]`);
                if (modeRadio) modeRadio.checked = true;
            }
            
            // ØªØ¹ÙŠÙŠÙ† ØªØ§Ø±ÙŠØ® Ø§Ù„ÙŠÙˆÙ… Ù„Ø­Ù‚Ù„ Ø§Ù„ØªÙ…Ø±ÙŠØ¶
            document.getElementById('nursingDate').value = new Date().toISOString().split('T')[0];
            
            // ØªØ­Ù…ÙŠÙ„ Ù†Ø¸Ø±Ø© Ø¹Ø§Ù…Ø© Ø¹Ù„Ù‰ Ø§Ù„Ø£Ø¯ÙˆØ§Ø±
            loadRolesOverview();
            refreshStaffTable();
            
            // Show welcome notification if first time
            if (!localStorage.getItem('welcomeShown')) {
                setTimeout(() => {
                    showNotification('Ù…Ø±Ø­Ø¨Ø§Ù‹ ÙÙŠ Ù…Ø¬Ù…Ø¹ Ø§Ù„Ø´ÙØ§Ø¡', 'Ø§Ù„Ù†Ø¸Ø§Ù… Ø§Ù„Ø°ÙƒÙŠ Ø§Ù„Ø´Ø§Ù…Ù„ Ø¨Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„ØµÙ„Ø§Ø­ÙŠØ§Øª Ø§Ù„Ù…ØªÙ‚Ø¯Ù…Ø©');
                    localStorage.setItem('welcomeShown', 'true');
                }, 3000);
            }
        };

        // ============================================
        // Ø¯ÙˆØ§Ù„ Ø§Ù„Ù†Ø¸Ø§Ù… Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ© Ø§Ù„Ù…ØªØ¨Ù‚ÙŠØ© (Ù…Ø­ÙÙˆØ¸Ø© ÙƒÙ…Ø§ Ù‡ÙŠ)
        // ============================================

        // Ø¯ÙˆØ§Ù„ PWA Ø§Ù„Ù…Ø­ÙÙˆØ¸Ø©
        function showSplashScreen() {
            const splash = document.createElement('div');
            splash.id = 'splashScreen';
            splash.style.cssText = `
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: linear-gradient(135deg, #2c7a7b 0%, #1a535c 100%);
                display: flex;
                flex-direction: column;
                justify-content: center;
                align-items: center;
                z-index: 99999;
                color: white;
                text-align: center;
            `;
            
            splash.innerHTML = `
                <img src="https://cdn-icons-png.flaticon.com/512/822/822118.png" width="100" style="margin-bottom: 20px;">
                <h2>Ù…Ø¬Ù…Ø¹ Ø§Ù„Ø´ÙØ§Ø¡ Ø§Ù„Ø·Ø¨ÙŠ</h2>
                <p>Ø§Ù„Ø¥ØµØ¯Ø§Ø± 2.6.0 - Ù†Ø¸Ø§Ù… Ø§Ù„ØµÙ„Ø§Ø­ÙŠØ§Øª Ø§Ù„Ù…ØªÙ‚Ø¯Ù…</p>
                <div class="spinner-border" role="status"></div>
            `;
            
            document.body.appendChild(splash);
            
            setTimeout(() => {
                const splash = document.getElementById('splashScreen');
                if (splash) {
                    splash.style.opacity = '0';
                    splash.style.transition = 'opacity 0.5s';
                    setTimeout(() => {
                        if (splash.parentNode) {
                            splash.parentNode.removeChild(splash);
                        }
                    }, 500);
                }
            }, 2000);
        }

        // Ø¯ÙˆØ§Ù„ Ø§Ù„Ù†Ø¸Ø§Ù… Ø§Ù„Ù…Ø­ÙÙˆØ¸Ø© ÙƒÙ…Ø§ Ù‡ÙŠ
        function updateClock() { 
            document.getElementById('clockDisplay').innerText = new Date().toLocaleTimeString('ar-EG'); 
        }

        function switchSection(id) {
            // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„ØµÙ„Ø§Ø­ÙŠØ©
            if (!hasSectionPermission(id)) {
                alert("â›” Ù„ÙŠØ³ Ù„Ø¯ÙŠÙƒ ØµÙ„Ø§Ø­ÙŠØ© Ù„Ù„ÙˆØµÙˆÙ„ Ù„Ù‡Ø°Ø§ Ø§Ù„Ù‚Ø³Ù…!");
                return;
            }
            
            document.querySelectorAll('.section-pane').forEach(s => s.classList.add('hidden-section'));
            document.getElementById(`${id}-sec`).classList.remove('hidden-section');
            document.querySelectorAll('.nav-link').forEach(n => n.classList.remove('active'));
            document.getElementById(`btn-${id}`)?.classList.add('active');
            
            updateBadges();
            refreshAll();
            
            // ØªØ­Ù…ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ø®Ø§ØµØ© Ø¨ÙƒÙ„ Ù‚Ø³Ù…
            if (id === 'reception') {
                loadReceptionStats();
                loadPatientRecords();
            } else if (id === 'nursing') {
                loadNursingSchedule();
                loadNursingStats();
            } else if (id === 'admin') {
                loadAdminReports();
                loadMedicalLibrary();
                loadRolesOverview();
                refreshStaffTable();
                updatePermissionsLog();
            }
            
            logUserActivity(`Ø§Ù„Ø§Ù†ØªÙ‚Ø§Ù„ Ø¥Ù„Ù‰ Ù‚Ø³Ù… ${id}`);
        }

        function showAdminTab(tab) {
            ['reports', 'patients', 'inventory', 'staff', 'permissions'].forEach(t => {
                document.getElementById(`admin-${t}`).classList.add('hidden-section');
            });
            document.getElementById(`admin-${tab}`).classList.remove('hidden-section');
            
            if (tab === 'permissions') {
                loadRolesOverview();
                updatePermissionsLog();
            }
        }

        // Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¯ÙˆØ§Ù„ Ø§Ù„Ø£Ø®Ø±Ù‰ Ø§Ù„Ù…Ø­ÙÙˆØ¸Ø© ÙƒÙ…Ø§ Ù‡ÙŠ
        // ... (Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¯ÙˆØ§Ù„ Ø§Ù„Ø£Ø®Ø±Ù‰ ØªØ¨Ù‚Ù‰ ÙƒÙ…Ø§ Ù‡ÙŠ Ø¨Ø¯ÙˆÙ† ØªØºÙŠÙŠØ±)

        // ============================================
        // Ø¯Ø§Ù„Ø© Ø§Ù„Ø®Ø±ÙˆØ¬
        // ============================================

        function logout() { 
            logUserActivity('ØªØ³Ø¬ÙŠÙ„ Ø®Ø±ÙˆØ¬');
            logSystemEvent('ØªØ³Ø¬ÙŠÙ„ Ø®Ø±ÙˆØ¬', 'info', {username: currentUser.u});
            
            if (SYNC_INTERVAL) clearInterval(SYNC_INTERVAL);
            if (SESSION_TIMEOUT) clearTimeout(SESSION_TIMEOUT);
            
            localStorage.removeItem('shifa_user'); 
            localStorage.removeItem('shifa_session');
            location.reload(); 
        }

        // ============================================
        // Ø¯ÙˆØ§Ù„ Ø¥Ø¶Ø§ÙÙŠØ© Ù„Ù„Ø¹Ø±Ø¶
        // ============================================

        function showSystemLogs() {
            const recentLogs = systemLogs.slice(-20).reverse();
            let html = `
                <div class="card">
                    <div class="card-header bg-dark text-white">
                        <h5 class="mb-0">ğŸ“‹ Ø³Ø¬Ù„Ø§Øª Ø§Ù„Ù†Ø¸Ø§Ù…</h5>
                    </div>
                    <div class="card-body">
                        ${recentLogs.map(log => `
                            <div class="border-bottom pb-2 mb-2">
                                <div class="d-flex justify-content-between">
                                    <span class="badge ${log.level === 'error' ? 'bg-danger' : log.level === 'warning' ? 'bg-warning' : 'bg-info'}">
                                        ${log.level}
                                    </span>
                                    <small class="text-muted">${new Date(log.timestamp).toLocaleString('ar-EG')}</small>
                                </div>
                                <div class="mt-1">
                                    <strong>${log.event}</strong><br>
                                    <small class="text-muted">Ø¨ÙˆØ§Ø³Ø·Ø©: ${log.user}</small>
                                </div>
                            </div>
                        `).join('')}
                    </div>
                </div>
            `;
            
            document.getElementById('permissionsDetails').innerHTML = html;
            const modal = new bootstrap.Modal(document.getElementById('permissionsModal'));
            modal.show();
        }

        function toggleDarkMode() {
            document.body.classList.toggle('dark-mode');
            localStorage.setItem('darkMode', document.body.classList.contains('dark-mode'));
            alert(document.body.classList.contains('dark-mode') ? 'ØªÙ… ØªÙØ¹ÙŠÙ„ Ø§Ù„ÙˆØ¶Ø¹ Ø§Ù„Ù„ÙŠÙ„ÙŠ' : 'ØªÙ… ØªØ¹Ø·ÙŠÙ„ Ø§Ù„ÙˆØ¶Ø¹ Ø§Ù„Ù„ÙŠÙ„ÙŠ');
        }

        // ============================================
        // Ø¨Ø§Ù‚ÙŠ Ø¯ÙˆØ§Ù„ Ø§Ù„Ù†Ø¸Ø§Ù… (Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¯ÙˆØ§Ù„ Ø§Ù„Ø£Ø®Ø±Ù‰ ØªØ¨Ù‚Ù‰ ÙƒÙ…Ø§ Ù‡ÙŠ)
        // ============================================

        // ... (Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¯ÙˆØ§Ù„ Ø§Ù„Ø£Ø®Ø±Ù‰ ØªØ¨Ù‚Ù‰ ÙƒÙ…Ø§ Ù‡ÙŠ Ù…Ù† Ø§Ù„ÙƒÙˆØ¯ Ø§Ù„Ø³Ø§Ø¨Ù‚ Ø¨Ø¯ÙˆÙ† ØªØºÙŠÙŠØ±)

    </script>
    
    <!-- Service Worker Script -->
    <script>
        if ('serviceWorker' in navigator) {
            const swCode = `
                const CACHE_NAME = 'shifa-medical-v2.6.0';
                const urlsToCache = [
                    '.',
                    'https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.rtl.min.css',
                    'https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js',
                    'https://cdn-icons-png.flaticon.com/512/822/822118.png',
                    'https://assets.mixkit.co/active_storage/sfx/2869/2869-preview.mp3'
                ];

                self.addEventListener('install', event => {
                    event.waitUntil(
                        caches.open(CACHE_NAME)
                            .then(cache => {
                                return cache.addAll(urlsToCache);
                            })
                            .then(() => {
                                return self.skipWaiting();
                            })
                    );
                });

                self.addEventListener('activate', event => {
                    event.waitUntil(
                        caches.keys().then(cacheNames => {
                            return Promise.all(
                                cacheNames.map(cacheName => {
                                    if (cacheName !== CACHE_NAME) {
                                        return caches.delete(cacheName);
                                    }
                                })
                            );
                        }).then(() => {
                            return self.clients.claim();
                        })
                    );
                });

                self.addEventListener('fetch', event => {
                    event.respondWith(
                        caches.match(event.request)
                            .then(response => {
                                if (response) {
                                    return response;
                                }
                                
                                return fetch(event.request).then(response => {
                                    if (!response || response.status !== 200 || response.type !== 'basic') {
                                        return response;
                                    }
                                    
                                    const responseToCache = response.clone();
                                    
                                    caches.open(CACHE_NAME)
                                        .then(cache => {
                                            cache.put(event.request, responseToCache);
                                        });
                                    
                                    return response;
                                });
                            })
                    );
                });

                self.addEventListener('sync', event => {
                    if (event.tag === 'sync-data') {
                        event.waitUntil(syncData());
                    }
                });

                self.addEventListener('push', event => {
                    const options = {
                        body: event.data ? event.data.text() : 'Ø¥Ø´Ø¹Ø§Ø± Ù…Ù† Ù…Ø¬Ù…Ø¹ Ø§Ù„Ø´ÙØ§Ø¡',
                        icon: 'https://cdn-icons-png.flaticon.com/512/822/822118.png',
                        badge: 'https://cdn-icons-png.flaticon.com/512/822/822118.png',
                        tag: 'shifa-push',
                        requireInteraction: true
                    };
                    
                    event.waitUntil(
                        self.registration.showNotification('Ù…Ø¬Ù…Ø¹ Ø§Ù„Ø´ÙØ§Ø¡', options)
                    );
                });

                self.addEventListener('notificationclick', event => {
                    event.notification.close();
                    
                    event.waitUntil(
                        clients.matchAll({type: 'window'})
                            .then(clientList => {
                                for (const client of clientList) {
                                    if (client.url === '/' && 'focus' in client) {
                                        return client.focus();
                                    }
                                }
                                if (clients.openWindow) {
                                    return clients.openWindow('/');
                                }
                            })
                    );
                });

                async function syncData() {
                    const cache = await caches.open(CACHE_NAME);
                    return Promise.resolve('Data synced');
                }
            `;
            
            const blob = new Blob([swCode], {type: 'application/javascript'});
            const swURL = URL.createObjectURL(blob);
            
            navigator.serviceWorker.register(swURL)
                .then(registration => {
                    console.log('âœ… Service Worker registered with scope:', registration.scope);
                })
                .catch(error => {
                    console.error('âŒ Service Worker registration failed:', error);
                });
        }
    </script>
</body>
</html>
