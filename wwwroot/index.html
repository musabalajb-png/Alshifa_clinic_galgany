<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="theme-color" content="#2c7a7b">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <link rel="apple-touch-icon" href="https://cdn-icons-png.flaticon.com/512/822/822118.png">
    
    <title>Ù…Ø¬Ù…Ø¹ Ø§Ù„Ø´ÙØ§Ø¡ - Ø§Ù„Ù†Ø¸Ø§Ù… Ø§Ù„Ù…ØªÙƒØ§Ù…Ù„ 2026</title>
    
    <!-- PWA Manifest -->
    <link rel="manifest" href="data:application/manifest+json,{%22name%22:%22%D9%85%D8%AC%D9%85%D8%B9%20%D8%A7%D9%84%D8%B4%D9%81%D8%A1%22,%22short_name%22:%22%D8%A7%D9%84%D8%B4%D9%81%D8%A1%22,%22start_url%22:%22.%22,%22display%22:%22standalone%22,%22background_color%22:%22%23f8fafc%22,%22theme_color%22:%22%232c7a7b%22,%22description%22:%22%D9%86%D8%B8%D8%A7%D9%85%20%D8%A5%D8%AF%D8%A7%D8%B1%D8%A9%20%D8%A7%D9%84%D9%85%D8%B3%D8%AA%D8%B4%D9%81%D9%8A%D8%A7%D8%AA%20%D9%88%D8%A7%D9%84%D8%B9%D9%8A%D8%A7%D8%AF%D8%A7%D8%AA%20%D8%A7%D9%84%D8%B0%D9%83%D9%8A%22,%22icons%22:[{%22src%22:%22https://cdn-icons-png.flaticon.com/512/822/822118.png%22,%22sizes%22:%22512x512%22,%22type%22:%22image/png%22,%22purpose%22:%22any%22},{%22src%22:%22https://cdn-icons-png.flaticon.com/512/822/822118.png%22,%22sizes%22:%22192x192%22,%22type%22:%22image/png%22,%22purpose%22:%22maskable%22}]}">

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.rtl.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css"/>
    <style>
        :root { 
            --primary-color: #2c7a7b; 
            --secondary-color: #f0fdf4; 
            --accent-blue: #0d6efd; 
            --accent-red: #dc3545; 
            --accent-green: #198754; 
            --accent-gold: #d4af37;
            --accent-warning: #ffc107;
            --accent-info: #17a2b8;
            --accent-purple: #6f42c1;
        }
        body { background-color: #f8fafc; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; -webkit-tap-highlight-color: transparent; }
        .navbar { background: linear-gradient(135deg, var(--primary-color), #1f5a5a) !important; box-shadow: 0 2px 15px rgba(0,0,0,0.2); }
        .card { border-radius: 15px; border: none; box-shadow: 0 4px 12px rgba(0,0,0,0.08); margin-bottom: 15px; transition: transform 0.2s; }
        .card:hover { transform: translateY(-2px); }
        .hidden-section { display: none !important; }
        .nav-link { cursor: pointer; font-weight: bold; color: var(--primary-color); padding: 10px 20px !important; position: relative; }
        .nav-link.active { background-color: var(--accent-blue) !important; color: white !important; border-radius: 10px; }
        .badge-notify { position: absolute; top: -5px; right: -5px; background: var(--accent-red); color: white; border-radius: 50%; padding: 3px 7px; font-size: 0.7rem; }
        .stat-card { border-radius: 15px; padding: 20px; color: white; text-align: center; }
        .patient-btn { text-align: right; margin-bottom: 8px; border-right: 5px solid var(--primary-color); width: 100%; transition: 0.3s; padding: 12px 15px; background: white; border: 1px solid #dee2e6; border-radius: 10px; }
        .patient-btn.ready { border-right-color: #28a745; background-color: #f0fff4; }
        .patient-btn:hover { background-color: #f8f9fa; }
        .lab-result-item { background: #e9ecef; padding: 10px; border-radius: 8px; margin-bottom: 5px; border-left: 4px solid var(--accent-blue); }
        .section-pane { animation: fadeIn 0.3s ease-in; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        @media print { .no-print { display: none !important; } body * { visibility: hidden; } #printArea, #printArea * { visibility: visible; } #printArea { position: absolute; left: 0; top: 0; width: 100%; direction: rtl; padding: 20px; } }
        .search-box { position: relative; }
        .search-box input { padding-right: 40px; }
        .rx-item { background: #f8f9fa; padding: 8px 12px; margin: 5px 0; border-radius: 8px; border-left: 4px solid var(--accent-green); }
        .status-online { color: #28a745; font-weight: bold; }
        .status-offline { color: #dc3545; font-weight: bold; }
        .sync-status { position: fixed; bottom: 10px; left: 10px; z-index: 1000; }
        .sync-btn { position: fixed; bottom: 10px; right: 10px; z-index: 1000; }
        .medical-record { background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%); padding: 20px; border-radius: 10px; margin-bottom: 20px; }
        .nursing-schedule { border-left: 5px solid var(--accent-purple); }
        .expiry-warning { background: #fff3cd; border-left: 5px solid #ffc107; }
        .stock-critical { background: #f8d7da; border-left: 5px solid #dc3545; }
        .library-card { height: 100%; transition: all 0.3s; }
        .library-card:hover { transform: scale(1.02); box-shadow: 0 6px 20px rgba(0,0,0,0.15); }
        .form-check { padding-right: 1.5em; margin-bottom: 0.5rem; }
        .form-check-input { margin-right: -1.5em; }
        #labTestsChecklist { scrollbar-width: thin; scrollbar-color: var(--primary-color) #f1f1f1; }
        #labTestsChecklist::-webkit-scrollbar { width: 8px; }
        #labTestsChecklist::-webkit-scrollbar-track { background: #f1f1f1; border-radius: 4px; }
        #labTestsChecklist::-webkit-scrollbar-thumb { background: var(--primary-color); border-radius: 4px; }
        
        /* PWA Styles */
        .install-btn { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; border: none; border-radius: 50px; padding: 10px 20px; font-weight: bold; box-shadow: 0 4px 15px rgba(0,0,0,0.2); transition: all 0.3s; }
        .install-btn:hover { transform: translateY(-2px); box-shadow: 0 6px 20px rgba(0,0,0,0.3); }
        .pwa-status { position: fixed; top: 10px; left: 10px; z-index: 9999; }
        .pwa-notification { position: fixed; bottom: 20px; left: 50%; transform: translateX(-50%); background: white; border-radius: 15px; box-shadow: 0 10px 30px rgba(0,0,0,0.2); padding: 20px; z-index: 10000; max-width: 400px; direction: rtl; }
        .offline-banner { position: fixed; top: 0; left: 0; right: 0; background: #dc3545; color: white; text-align: center; padding: 10px; z-index: 9998; }
        .online-banner { position: fixed; top: 0; left: 0; right: 0; background: #28a745; color: white; text-align: center; padding: 10px; z-index: 9998; }
        #appVersion { font-size: 0.8em; color: #6c757d; }
        
        /* Advanced Permissions Styles */
        .permission-badge { font-size: 0.7em; padding: 2px 6px; margin-right: 3px; }
        .permission-row { border-bottom: 1px solid #eee; padding: 8px 0; }
        .permission-header { background: linear-gradient(135deg, #6a11cb 0%, #2575fc 100%); color: white; padding: 10px; border-radius: 8px; }
        .permission-toggle { transform: scale(0.9); }
        .user-status-online { color: #28a745; animation: pulse 2s infinite; }
        .user-status-offline { color: #dc3545; }
        @keyframes pulse { 0% { opacity: 1; } 50% { opacity: 0.7; } 100% { opacity: 1; } }
        .role-badge { font-size: 0.75em; padding: 3px 8px; }
        .permission-modal { max-height: 80vh; overflow-y: auto; }
        .password-strength { height: 5px; border-radius: 2px; margin-top: 5px; transition: all 0.3s; }
        
        /* New Styles for Workflow */
        .workflow-step { border-left: 4px solid; padding: 10px; margin: 5px 0; border-radius: 8px; }
        .step-reception { border-color: #0d6efd; background: #e7f1ff; }
        .step-doctor { border-color: #198754; background: #e8f5e8; }
        .step-lab { border-color: #dc3545; background: #fde8e8; }
        .step-pharmacy { border-color: #ffc107; background: #fff8e1; }
        .step-nursing { border-color: #6f42c1; background: #f0e8ff; }
        .step-completed { background: #d4edda !important; }
        .patient-flow { display: flex; justify-content: space-between; margin: 10px 0; }
        .flow-arrow { color: #6c757d; margin: 0 10px; }
        
        /* Admin Dashboard Styles */
        .admin-stat-card { border-radius: 12px; padding: 15px; color: white; text-align: center; min-height: 100px; display: flex; flex-direction: column; justify-content: center; }
        .admin-chart-container { height: 300px; position: relative; }
        .quick-action-btn { width: 100%; margin: 5px 0; }
        .system-health { font-size: 0.9em; }
        .health-good { color: #28a745; }
        .health-warning { color: #ffc107; }
        .health-critical { color: #dc3545; }
        .transaction-item { border-left: 4px solid; padding: 8px; margin: 5px 0; border-radius: 6px; }
        .transaction-income { border-color: #28a745; background: #d4edda; }
        .transaction-expense { border-color: #dc3545; background: #f8d7da; }
        .staff-avatar { width: 40px; height: 40px; border-radius: 50%; background: #6c757d; color: white; display: flex; align-items: center; justify-content: center; font-weight: bold; }
        
        /* New Styles from Version 2 */
        .bg-medical { background: #eef2f3; border-right: 5px solid var(--primary-color); }
        .border-purple { border-color: var(--accent-purple) !important; }
        .btn-outline-purple { color: var(--accent-purple); border-color: var(--accent-purple); }
        .btn-outline-purple:hover { background-color: var(--accent-purple); color: white; }
        
        /* Ø¥Ø¶Ø§ÙØ© Ø£Ù†Ù…Ø§Ø· Ø¬Ø¯ÙŠØ¯Ø© Ù„Ù„ØªØ­ÙƒÙ… ÙÙŠ Ø¹Ø±Ø¶ Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øª */
        .admin-login-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.8);
            z-index: 10000;
            display: flex;
            align-items: center;
            justify-content: center;
            display: none;
        }
        
        .security-warning {
            border-left: 5px solid #dc3545;
            background: #f8d7da;
            padding: 10px;
            border-radius: 8px;
            margin: 10px 0;
            font-size: 0.9em;
        }
        
        .access-log {
            font-size: 0.8em;
            color: #6c757d;
            border-top: 1px solid #dee2e6;
            padding-top: 5px;
            margin-top: 10px;
        }
        
        /* Ø£Ù†Ù…Ø§Ø· Ø¬Ø¯ÙŠØ¯Ø© Ù„Ù„Ø±ÙˆØ´ØªØ© Ø§Ù„Ø·Ø¨ÙŠØ© */
        .prescription-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            border-radius: 10px 10px 0 0;
        }
        
        .medicine-entry {
            background: #f8f9fa;
            padding: 10px;
            border-radius: 8px;
            margin-bottom: 10px;
            border-left: 4px solid var(--accent-green);
        }
        
        .add-medicine-btn {
            border: 2px dashed #0d6efd;
            color: #0d6efd;
            background: transparent;
            padding: 10px;
            border-radius: 8px;
            width: 100%;
            margin: 10px 0;
            transition: all 0.3s;
        }
        
        .add-medicine-btn:hover {
            background: #e7f1ff;
            border-color: #0a58ca;
        }
        
        .pharmacy-daily-stats {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            color: white;
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 20px;
        }
        
        .prescription-list-item {
            border-left: 4px solid #ffc107;
            background: #fff8e1;
            padding: 10px;
            border-radius: 8px;
            margin-bottom: 10px;
        }
        
        .lab-results-panel {
            background: #e8f4fd;
            border-radius: 10px;
            padding: 15px;
            margin-top: 15px;
            border-left: 5px solid #0d6efd;
        }
        
        .lab-result-badge {
            background: #0d6efd;
            color: white;
            padding: 3px 10px;
            border-radius: 15px;
            font-size: 0.8em;
        }
        
        /* Ø£Ù†Ù…Ø§Ø· Ø¬Ø¯ÙŠØ¯Ø© Ù„Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…ÙˆØ¸ÙÙŠÙ† */
        .admin-tabs {
            background: white;
            border-radius: 10px;
            padding: 10px;
            margin-bottom: 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        .admin-tab-btn {
            margin: 0 5px;
            padding: 8px 20px;
            border: none;
            background: transparent;
            border-radius: 8px;
            font-weight: bold;
            transition: all 0.3s;
        }
        
        .admin-tab-btn.active {
            background: var(--primary-color);
            color: white;
        }
        
        .admin-tab-btn:hover {
            background: #e7f1ff;
        }
        
        .staff-card {
            border-left: 5px solid var(--accent-blue);
            margin-bottom: 10px;
            transition: all 0.3s;
        }
        
        .staff-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }
        
        .staff-role-badge {
            font-size: 0.7em;
            padding: 3px 8px;
            border-radius: 10px;
        }
        
        .staff-admin { background: #dc3545; color: white; }
        .staff-doctor { background: #198754; color: white; }
        .staff-reception { background: #0d6efd; color: white; }
        .staff-pharmacy { background: #ffc107; color: #000; }
        .staff-lab { background: #6f42c1; color: white; }
        .staff-nursing { background: #17a2b8; color: white; }
        
        .reset-system-card {
            border: 2px dashed var(--accent-red);
            background: #fff5f5;
            text-align: center;
            padding: 30px;
            border-radius: 15px;
        }
        
        .reset-system-card h5 {
            color: var(--accent-red);
        }
        
        .system-backup {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 15px;
        }
        
        /* Ø£Ù†Ù…Ø§Ø· Ø¥Ø¶Ø§ÙÙŠØ© Ù„Ù†Ø¸Ø§Ù… Ø§Ù„Ø£Ù…Ø§Ù† */
        .security-log-item {
            border-left: 4px solid;
            padding: 8px 12px;
            margin-bottom: 5px;
            border-radius: 6px;
            font-size: 0.85em;
        }
        
        .security-critical {
            border-color: #dc3545;
            background-color: #f8d7da;
        }
        
        .security-warning {
            border-color: #ffc107;
            background-color: #fff3cd;
        }
        
        .security-info {
            border-color: #0dcaf0;
            background-color: #d1ecf1;
        }
        
        .password-strength-meter {
            height: 5px;
            border-radius: 2px;
            margin-top: 5px;
            background-color: #e9ecef;
            overflow: hidden;
        }
        
        .password-strength-fill {
            height: 100%;
            transition: all 0.3s ease;
        }
        
        .session-timeout-warning {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: #fff3cd;
            border: 2px solid #ffc107;
            border-radius: 10px;
            padding: 15px;
            z-index: 9999;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
            animation: pulseWarning 2s infinite;
        }
        
        @keyframes pulseWarning {
            0% { box-shadow: 0 0 0 0 rgba(255, 193, 7, 0.7); }
            70% { box-shadow: 0 0 0 10px rgba(255, 193, 7, 0); }
            100% { box-shadow: 0 0 0 0 rgba(255, 193, 7, 0); }
        }
        
        .audit-log-table {
            font-size: 0.8em;
        }
        
        .audit-log-table th {
            background-color: #f8f9fa;
            position: sticky;
            top: 0;
        }
        
        .security-badge {
            font-size: 0.7em;
            padding: 2px 6px;
            border-radius: 10px;
        }
        
        /* Ø£Ù†Ù…Ø§Ø· Ù„Ù„ÙˆØ­Ø© Ø³Ø¬Ù„Ø§Øª Ø§Ù„Ø£Ù…Ø§Ù† */
        .security-filter-card {
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 20px;
        }
        
        .security-stats-card {
            background: linear-gradient(135deg, #6a11cb 0%, #2575fc 100%);
            color: white;
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 15px;
        }
        
        .security-log-container {
            max-height: 500px;
            overflow-y: auto;
            scrollbar-width: thin;
            scrollbar-color: var(--primary-color) #f1f1f1;
        }
        
        .security-log-container::-webkit-scrollbar {
            width: 8px;
        }
        
        .security-log-container::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 4px;
        }
        
        .security-log-container::-webkit-scrollbar-thumb {
            background: var(--primary-color);
            border-radius: 4px;
        }
        
        /* Ø£Ù†Ù…Ø§Ø· Ù„Ù†Ø§ÙØ°Ø© ØªØºÙŠÙŠØ± ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± */
        .password-requirements {
            background: #f8f9fa;
            border-radius: 8px;
            padding: 10px;
            border-left: 4px solid var(--accent-info);
        }
        
        .requirement-met {
            color: #198754;
        }
        
        .requirement-not-met {
            color: #dc3545;
        }
        
        .password-match {
            font-weight: bold;
            padding: 2px 5px;
            border-radius: 4px;
        }
        
        /* Ø£Ù†Ù…Ø§Ø· Ù„Ø´Ø§Ø´Ø© Ø§Ù„Ù‚ÙÙ„ Ø¨Ø¹Ø¯ Ù…Ø­Ø§ÙˆÙ„Ø§Øª ÙØ§Ø´Ù„Ø© */
        .account-lock-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.9);
            z-index: 10000;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            text-align: center;
            padding: 20px;
        }
        
        .lock-timer {
            font-size: 3em;
            font-weight: bold;
            color: #ffc107;
            margin: 20px 0;
        }
        
        /* Ø£Ù†Ù…Ø§Ø· Ù„Ù„ØªØ­Ø°ÙŠØ±Ø§Øª Ø§Ù„Ø£Ù…Ù†ÙŠØ© */
        .security-alert {
            border: 2px solid #dc3545;
            background: #f8d7da;
            color: #721c24;
            padding: 15px;
            border-radius: 10px;
            margin: 10px 0;
            animation: shake 0.5s ease-in-out;
        }
        
        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-5px); }
            75% { transform: translateX(5px); }
        }
        
        /* Ø£Ù†Ù…Ø§Ø· Ù„Ø´Ø§Ø´Ø© ØªØ¯Ù‚ÙŠÙ‚ Ø§Ù„Ø£Ù…Ø§Ù† */
        .audit-screen {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            min-height: 100vh;
            padding: 20px;
        }
    </style>
</head>
<body>

    <audio id="notificationSound" src="https://assets.mixkit.co/active_storage/sfx/2869/2869-preview.mp3" preload="auto"></audio>

    <!-- Ù…Ù†Ø·Ù‚Ø© Ø§Ù„Ø·Ø¨Ø§Ø¹Ø© -->
    <div id="printArea" class="hidden-section">
        <div class="text-center border-bottom pb-3 mb-3">
            <h2 style="color: var(--primary-color);">ğŸ¥ Ù…Ø¬Ù…Ø¹ Ø§Ù„Ø´ÙØ§Ø¡ Ø§Ù„Ø·Ø¨ÙŠ</h2>
            <p>Ø§Ù„Ø³ÙˆØ¯Ø§Ù† - Ø¬Ù„Ù‚Ù†ÙŠ</p>
            <h5 id="printTitle">Ø±ÙˆØ´ØªØ© Ø·Ø¨ÙŠØ©</h5>
            <small id="printDate"></small>
        </div>
        <div id="printContent" class="fs-5"></div>
        <div class="mt-5 pt-3 border-top text-center">
            <p>Ø§Ø³Ù… ÙˆØªÙˆÙ‚ÙŠØ¹ Ø§Ù„Ø·Ø¨ÙŠØ¨: <strong id="printDoctorName"></strong></p>
            <p>Ù†ØªÙ…Ù†Ù‰ Ù„ÙƒÙ… Ø¹Ø§Ø¬Ù„ Ø§Ù„Ø´ÙØ§Ø¡</p>
        </div>
    </div>

    <!-- Ø´Ø§Ø´Ø© ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ -->
    <div id="loginOverlay" class="no-print" style="position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: linear-gradient(rgba(44, 122, 123, 0.9), rgba(44, 122, 123, 0.8)); z-index: 9999; display: flex; align-items: center; justify-content: center;">
        <div class="card p-4 shadow-lg animate__animated animate__zoomIn" style="width: 420px; border-top: 8px solid var(--accent-gold);">
            <div class="text-center mb-4">
                <img src="https://cdn-icons-png.flaticon.com/512/822/822118.png" width="70">
                <h3 class="mt-2 fw-bold" style="color: var(--primary-color);">Ù…Ø¬Ù…Ø¹ Ø§Ù„Ø´ÙØ§Ø¡ Ø§Ù„Ø·Ø¨ÙŠ</h3>
                <p class="text-muted small">Ø§Ù„Ù†Ø¸Ø§Ù… Ø§Ù„Ù…ØªÙƒØ§Ù…Ù„ Ù„Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø£Ù‚Ø³Ø§Ù… Ø§Ù„Ø·Ø¨ÙŠØ©</p>
                <div class="alert alert-info mt-2">
                    <small>ğŸ”’ ÙŠØ±Ø¬Ù‰ Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø§Ù„Ù…Ø®ØµØµØ© Ù„Ùƒ ÙÙ‚Ø·</small>
                </div>
            </div>
            
            <div class="mb-3">
                <label class="form-label fw-bold">ğŸ‘¤ Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…</label>
                <input type="text" id="username" class="form-control" placeholder="Ø£Ø¯Ø®Ù„ Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…" autocomplete="username">
            </div>
            
            <div class="mb-3">
                <label class="form-label fw-bold">ğŸ” ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±</label>
                <input type="password" id="password" class="form-control" placeholder="Ø£Ø¯Ø®Ù„ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±" autocomplete="current-password">
            </div>
            
            <div class="mb-3">
                <select id="loginDept" class="form-select" onchange="updateLoginPlaceholder()">
                    <option value="">Ø§Ø®ØªØ± Ù‚Ø³Ù… Ø§Ù„Ø¯Ø®ÙˆÙ„</option>
                    <option value="admin">ğŸ‘‘ Ø§Ù„Ù…Ø¯ÙŠØ± Ø§Ù„Ø¹Ø§Ù…</option>
                    <option value="reception">ğŸ“‹ Ø§Ù„Ø§Ø³ØªÙ‚Ø¨Ø§Ù„</option>
                    <option value="doctor">ğŸ‘¨â€âš•ï¸ Ø§Ù„Ø·Ø¨ÙŠØ¨</option>
                    <option value="lab">ğŸ§ª Ø§Ù„Ù…Ø¹Ù…Ù„</option>
                    <option value="pharmacy">ğŸ’Š Ø§Ù„ØµÙŠØ¯Ù„ÙŠØ©</option>
                    <option value="nursing">ğŸ’‰ Ø§Ù„ØªÙ…Ø±ÙŠØ¶</option>
                </select>
            </div>
            
            <button class="btn btn-primary w-100 fw-bold py-2 mb-3" onclick="handleLogin()">
                ğŸš€ Ø¯Ø®ÙˆÙ„ Ù„Ù„Ù†Ø¸Ø§Ù…
            </button>
            
            <div class="security-warning">
                <strong>âš ï¸ ØªÙ†Ø¨ÙŠÙ‡ Ø£Ù…Ø§Ù†:</strong>
                <small class="d-block mt-1">Ù‡Ø°Ø§ Ø§Ù„Ù†Ø¸Ø§Ù… Ø­ØµØ±ÙŠ Ù„Ù„Ø¹Ø§Ù…Ù„ÙŠÙ† Ø¨Ø§Ù„Ù…Ø¤Ø³Ø³Ø©. Ø¹Ø¯Ù… Ù…Ø´Ø§Ø±ÙƒØ© Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¯Ø®ÙˆÙ„.</small>
            </div>
            
            <div class="text-center mt-3">
                <button class="btn btn-sm btn-outline-secondary" onclick="showRecoveryOptions()">
                    <small>â“ Ù†Ø³ÙŠØª Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¯Ø®ÙˆÙ„ØŸ</small>
                </button>
                <button class="btn btn-sm btn-outline-info ms-2" onclick="showEmergencyAccess()" id="emergencyBtn" style="display: none;">
                    <small>ğŸš¨ ÙˆØµÙˆÙ„ Ø·Ø§Ø±Ø¦</small>
                </button>
            </div>
            
            <div class="access-log text-center mt-2">
                <small>Ø¢Ø®Ø± Ø¯Ø®ÙˆÙ„: <span id="lastLoginTime">--</span></small>
            </div>
        </div>
    </div>

    <!-- Ø§Ù„Ù…Ø­ØªÙˆÙ‰ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ -->
    <div id="mainContent" class="hidden-section">
        <!-- PWA Status -->
        <div class="pwa-status no-print">
            <div id="pwaStatus" class="badge bg-info">PWA: Ù†Ø´Ø·</div>
        </div>
        
        <!-- Ø´Ø±ÙŠØ· Ø§Ù„ØªÙ†Ù‚Ù„ -->
        <nav class="navbar navbar-dark mb-4 no-print py-2">
            <div class="container d-flex justify-content-between text-white align-items-center">
                <span class="navbar-brand fw-bold">ğŸ¥ Ù…Ø¬Ù…Ø¹ Ø§Ù„Ø´ÙØ§Ø¡ - Ø§Ù„Ù†Ø¸Ø§Ù… Ø§Ù„Ù…ØªÙƒØ§Ù…Ù„ 2026</span>
                <div class="d-flex align-items-center">
                    <span id="currentUserDisplay" class="badge bg-white text-dark p-2 mx-2"></span>
                    <span id="clockDisplay" class="badge bg-info text-dark mx-2"></span>
                    <span id="connectionStatus" class="badge bg-success mx-2">Ù…ØªØµÙ„ Ù…Ø­Ù„ÙŠØ§Ù‹</span>
                    <button class="btn btn-sm btn-outline-light ms-2" onclick="openUserMenu()">ğŸ‘¤</button>
                    <button class="btn btn-sm btn-outline-light" onclick="logout()">Ø®Ø±ÙˆØ¬</button>
                </div>
            </div>
        </nav>

        <!-- ØªØ¨ÙˆÙŠØ¨Ø§Øª Ø§Ù„ØªÙ†Ù‚Ù„ -->
        <div class="container">
            <ul class="nav nav-pills mb-4 shadow-sm p-2 bg-white rounded-4 justify-content-center no-print" id="mainTabs">
                <li class="nav-item" id="tab-reception-li"><button class="nav-link" id="btn-reception" onclick="switchSection('reception')">ğŸ“‹ Ø§Ù„Ø§Ø³ØªÙ‚Ø¨Ø§Ù„</button></li>
                <li class="nav-item" id="tab-doctor-li"><button class="nav-link" id="btn-doctor" onclick="switchSection('doctor')">ğŸ‘¨â€âš•ï¸ Ø§Ù„Ø¹ÙŠØ§Ø¯Ø© <span id="doctorBadge" class="badge bg-danger ms-1 hidden-section">0</span></button></li>
                <li class="nav-item" id="tab-lab-li"><button class="nav-link" id="btn-lab" onclick="switchSection('lab')">ğŸ§ª Ø§Ù„Ù…Ø¹Ù…Ù„ <span id="labBadge" class="badge bg-danger ms-1 hidden-section">0</span></button></li>
                <li class="nav-item" id="tab-pharmacy-li"><button class="nav-link" id="btn-pharmacy" onclick="switchSection('pharmacy')">ğŸ’Š Ø§Ù„ØµÙŠØ¯Ù„ÙŠØ© <span id="pharBadge" class="badge bg-danger ms-1 hidden-section">0</span></button></li>
                <li class="nav-item" id="tab-nursing-li"><button class="nav-link" id="btn-nursing" onclick="switchSection('nursing')">ğŸ’‰ Ø§Ù„ØªÙ…Ø±ÙŠØ¶ <span id="nurseBadge" class="badge bg-danger ms-1 hidden-section">0</span></button></li>
                <li class="nav-item" id="tab-admin-li"><button class="nav-link" id="btn-admin" onclick="switchSection('admin')">ğŸ‘‘ Ø§Ù„Ù…Ø¯ÙŠØ±</button></li>
            </ul>

            <!-- Ù…Ø­ØªÙˆÙ‰ Ø§Ù„Ø£Ù‚Ø³Ø§Ù… -->
            <div class="tab-content">
                <!-- Ù‚Ø³Ù… Ø§Ù„Ø§Ø³ØªÙ‚Ø¨Ø§Ù„ -->
                <div id="reception-sec" class="section-pane hidden-section">
                    <div class="row">
                        <div class="col-md-5">
                            <div class="card p-4 border-top border-primary border-4">
                                <h5 class="fw-bold mb-3">ØªØ³Ø¬ÙŠÙ„ Ù…Ø±ÙŠØ¶ Ø¬Ø¯ÙŠØ¯</h5>
                                <input type="text" id="pName" class="form-control mb-2" placeholder="Ø§Ø³Ù… Ø§Ù„Ù…Ø±ÙŠØ¶ Ø§Ù„Ø±Ø¨Ø§Ø¹ÙŠ">
                                <div class="row g-2 mb-2">
                                    <div class="col-4"><input type="number" id="pAge" class="form-control" placeholder="Ø§Ù„Ø¹Ù…Ø±"></div>
                                    <div class="col-8"><input type="text" id="pAddress" class="form-control" placeholder="Ø§Ù„Ø³ÙƒÙ† / Ø§Ù„Ø¹Ù†ÙˆØ§Ù†"></div>
                                </div>
                                <div class="bg-light p-2 rounded mb-3">
                                    <label class="small fw-bold">Ø±Ø³ÙˆÙ… ØªØ°ÙƒØ±Ø© Ø§Ù„Ø·Ø¨ÙŠØ¨:</label>
                                    <input type="number" id="pTicket" class="form-control" value="2000">
                                </div>
                                <button class="btn btn-primary w-100 fw-bold" onclick="registerPatient()">âœ… Ø­ÙØ¸ ÙˆØ¥Ø±Ø³Ø§Ù„ Ù„Ù„Ø·Ø¨ÙŠØ¨</button>
                            </div>
                        </div>
                        <div class="col-md-7">
                            <div class="card p-4">
                                <h5 class="fw-bold mb-3">Ø³Ø¬Ù„ Ø§Ù„Ù…Ø±Ø¶Ù‰ Ø§Ù„ÙŠÙˆÙ…</h5>
                                <div id="receptionList"></div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Ù‚Ø³Ù… Ø§Ù„Ø¹ÙŠØ§Ø¯Ø© -->
                <div id="doctor-sec" class="section-pane hidden-section">
                    <div class="row">
                        <div class="col-md-4">
                            <div class="card p-3">
                                <h6>Ø¨Ø§Ù†ØªØ¸Ø§Ø± Ø§Ù„ÙƒØ´Ù</h6>
                                <div id="doctorQueue"></div>
                            </div>
                        </div>
                        <div class="col-md-8">
                            <div id="doctorWorkArea" class="card p-4 hidden-section border-top border-success border-5">
                                <h4 id="currentPatientName" class="text-success fw-bold"></h4>
                                <hr>
                                
                                <!-- Ù‚Ø³Ù… Ø§Ù„Ø´ÙƒÙˆÙ‰ ÙˆØ§Ù„ØªØ´Ø®ÙŠØµ -->
                                <label class="fw-bold">Ø´ÙƒÙˆÙ‰ Ø§Ù„Ù…Ø±ÙŠØ¶:</label>
                                <textarea id="complaint" class="form-control mb-3" rows="2"></textarea>
                                
                                <label class="fw-bold">Ø§Ù„ØªØ´Ø®ÙŠØµ:</label>
                                <textarea id="diagnosis" class="form-control mb-3" rows="2" placeholder="ØªØ´Ø®ÙŠØµ Ø§Ù„Ø­Ø§Ù„Ø©..."></textarea>
                                
                                <!-- Ù‚Ø³Ù… Ø·Ù„Ø¨ Ø§Ù„ÙØ­ÙˆØµØ§Øª -->
                                <div class="row mb-3">
                                    <div class="col-md-6">
                                        <label class="fw-bold small">Ø·Ù„Ø¨ ÙØ­ÙˆØµØ§Øª:</label>
                                        <select id="labSelect" class="form-select mb-2" multiple style="height: 100px;"></select>
                                        <button class="btn btn-sm btn-outline-danger w-100" onclick="orderLab()">ğŸ§ª Ø¥Ø±Ø³Ø§Ù„ Ù„Ù„Ù…Ø¹Ù…Ù„</button>
                                    </div>
                                    
                                    <!-- Ù‚Ø³Ù… ÙƒØªØ§Ø¨Ø© Ø§Ù„Ø±ÙˆØ´ØªØ© Ø§Ù„Ø·Ø¨ÙŠØ© -->
                                    <div class="col-md-6">
                                        <label class="fw-bold small">Ø§Ù„Ø±ÙˆØ´ØªØ© Ø§Ù„Ø·Ø¨ÙŠØ©:</label>
                                        <button class="btn btn-sm btn-primary w-100 mb-2" onclick="addMedicineItem()">â• Ø¥Ø¶Ø§ÙØ© Ø¯ÙˆØ§Ø¡</button>
                                        <div id="prescriptionItems" class="mb-2">
                                            <!-- Ø³ÙŠØªÙ… Ø¥Ø¶Ø§ÙØ© Ø¹Ù†Ø§ØµØ± Ø§Ù„Ø£Ø¯ÙˆÙŠØ© Ù‡Ù†Ø§ Ø¯ÙŠÙ†Ø§Ù…ÙŠÙƒÙŠØ§Ù‹ -->
                                        </div>
                                        <button class="btn btn-sm btn-success w-100 mb-2" onclick="generatePrescription()">ğŸ“ Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø±ÙˆØ´ØªØ©</button>
                                        <button class="btn btn-sm btn-warning w-100" onclick="orderPharmacy()">ğŸ’Š Ø¥Ø±Ø³Ø§Ù„ Ù„Ù„ØµÙŠØ¯Ù„ÙŠØ©</button>
                                    </div>
                                </div>
                                
                                <!-- Ø¹Ø±Ø¶ Ù†ØªØ§Ø¦Ø¬ Ø§Ù„ÙØ­ÙˆØµØ§Øª Ø¥Ø°Ø§ ÙƒØ§Ù†Øª Ù…ÙˆØ¬ÙˆØ¯Ø© -->
                                <div id="labResultsPanel" class="lab-results-panel hidden-section">
                                    <h6>ğŸ“‹ Ù†ØªØ§Ø¦Ø¬ Ø§Ù„ÙØ­ÙˆØµØ§Øª:</h6>
                                    <div id="labResultsDisplay"></div>
                                </div>
                                
                                <div class="mb-3 p-2 bg-light rounded">
                                    <label class="fw-bold small">Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª ØªÙ…Ø±ÙŠØ¶ÙŠØ© (Ø­Ù‚Ù†/Ø¯Ø±ÙŠØ¨Ø§Øª):</label>
                                    <input type="text" id="nurseNotes" class="form-control mb-2" placeholder="Ø§ÙƒØªØ¨ Ø§Ù„ØªØ¹Ù„ÙŠÙ…Ø§Øª...">
                                    <button class="btn btn-sm btn-outline-purple w-100" onclick="orderNurse()">ğŸ’‰ Ø¥Ø±Ø³Ø§Ù„ Ù„Ù„ØªÙ…Ø±ÙŠØ¶</button>
                                </div>
                                <button class="btn btn-success w-100 fw-bold" onclick="completeVisit()">ğŸ Ø¥Ù†Ù‡Ø§Ø¡ Ø§Ù„Ø²ÙŠØ§Ø±Ø© Ø¨Ø§Ù„ÙƒØ§Ù…Ù„</button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Ù‚Ø³Ù… Ø§Ù„Ù…Ø¹Ù…Ù„ -->
                <div id="lab-sec" class="section-pane hidden-section">
                    <div class="card p-4 border-top border-danger border-5">
                        <h5 class="fw-bold">ğŸ§ª Ø·Ù„Ø¨Ø§Øª Ø§Ù„ÙØ­Øµ Ø§Ù„ÙˆØ§Ø±Ø¯Ø©</h5>
                        <div id="labList" class="row g-3"></div>
                    </div>
                </div>

                <!-- Ù‚Ø³Ù… Ø§Ù„ØµÙŠØ¯Ù„ÙŠØ© -->
                <div id="pharmacy-sec" class="section-pane hidden-section">
                    <!-- Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª Ø§Ù„ÙŠÙˆÙ…ÙŠØ© -->
                    <div class="pharmacy-daily-stats">
                        <div class="row">
                            <div class="col-md-8">
                                <h5>ğŸ’Š Ø§Ù„ØµÙŠØ¯Ù„ÙŠØ© Ø§Ù„Ù…Ø±ÙƒØ²ÙŠØ©</h5>
                                <h3>Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª Ø§Ù„ÙŠÙˆÙ…: <span id="dailySalesTotal">0</span> Ø¬.Ø³</h3>
                            </div>
                            <div class="col-md-4 text-end">
                                <button class="btn btn-light mt-2" onclick="resetDailySales()">ğŸ”„ ØªØµÙÙŠØ± Ø§Ù„Ø¹Ø¯Ø§Ø¯ Ø§Ù„ÙŠÙˆÙ…ÙŠ</button>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø±ÙˆØ´ØªØ§Øª Ø§Ù„ÙŠÙˆÙ…ÙŠØ© -->
                    <div class="card p-3 mb-3">
                        <h6>ğŸ“‹ Ø±ÙˆØ´ØªØ§Øª Ø§Ù„ÙŠÙˆÙ… Ø§Ù„Ù…Ø¨Ø§Ø¹Ø©</h6>
                        <div id="dailyPrescriptionsList"></div>
                    </div>
                    
                    <!-- Ø·Ù„Ø¨Ø§Øª Ø§Ù„ØµÙŠØ¯Ù„ÙŠØ© -->
                    <div class="card p-4 border-top border-warning border-5">
                        <h5 class="fw-bold">ğŸ“‹ Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ø£Ø¯ÙˆÙŠØ© Ø§Ù„ÙˆØ§Ø±Ø¯Ø©</h5>
                        <div id="pharmacyList" class="row g-3"></div>
                    </div>
                </div>

                <!-- Ù‚Ø³Ù… Ø§Ù„ØªÙ…Ø±ÙŠØ¶ -->
                <div id="nursing-sec" class="section-pane hidden-section">
                    <div class="card p-4 border-top border-purple border-5">
                        <h5 class="fw-bold">ğŸ’‰ ÙˆØ­Ø¯Ø© Ø§Ù„ØªÙ…Ø±ÙŠØ¶</h5>
                        <div id="nurseList" class="row g-3"></div>
                    </div>
                </div>

                <!-- Ù‚Ø³Ù… Ø§Ù„Ù…Ø¯ÙŠØ± -->
                <div id="admin-sec" class="section-pane hidden-section">
                    <!-- ØªØ¨ÙˆÙŠØ¨Ø§Øª Ù‚Ø³Ù… Ø§Ù„Ù…Ø¯ÙŠØ± -->
                    <div class="admin-tabs mb-4">
                        <button class="admin-tab-btn active" onclick="switchAdminTab('dashboard')">ğŸ“Š Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…</button>
                        <button class="admin-tab-btn" onclick="switchAdminTab('staff')">ğŸ‘¥ Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…ÙˆØ¸ÙÙŠÙ†</button>
                        <button class="admin-tab-btn" onclick="switchAdminTab('inventory')">ğŸ“¦ Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„ÙØ­ÙˆØµØ§Øª ÙˆØ§Ù„Ù…Ø®Ø²ÙˆÙ†</button>
                        <button class="admin-tab-btn" onclick="switchAdminTab('reset')">ğŸ”„ ØªØµÙÙŠØ± Ø§Ù„Ù†Ø¸Ø§Ù…</button>
                        <button class="admin-tab-btn" id="tab-security" onclick="switchAdminTab('security')">ğŸ›¡ï¸ Ø³Ø¬Ù„Ø§Øª Ø§Ù„Ø£Ù…Ø§Ù†</button>
                    </div>
                    
                    <!-- Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ… -->
                    <div id="admin-dashboard" class="admin-tab-content">
                        <div class="row g-3 mb-4">
                            <div class="col-md-3"><div class="stat-card bg-primary"><h6>Ø¥ÙŠØ±Ø§Ø¯ Ø§Ù„Ø¹ÙŠØ§Ø¯Ø©</h6><h3 id="admIncClinic">0</h3></div></div>
                            <div class="col-md-3"><div class="stat-card bg-danger"><h6>Ø¥ÙŠØ±Ø§Ø¯ Ø§Ù„Ù…Ø¹Ù…Ù„</h6><h3 id="admIncLab">0</h3></div></div>
                            <div class="col-md-3"><div class="stat-card bg-warning"><h6>Ø¥ÙŠØ±Ø§Ø¯ Ø§Ù„ØµÙŠØ¯Ù„ÙŠØ©</h6><h3 id="admIncPhar">0</h3></div></div>
                            <div class="col-md-3"><div class="stat-card bg-success"><h6>Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„ÙƒÙ„ÙŠ</h6><h3 id="admIncTotal">0</h3></div></div>
                        </div>

                        <div class="row">
                            <div class="col-md-4">
                                <div class="card p-3">
                                    <h6>â• Ø¥Ø¶Ø§ÙØ© / ØªØ¹Ø¯ÙŠÙ„ ÙØ­Øµ</h6>
                                    <input type="text" id="admLabName" class="form-control mb-2" placeholder="Ø§Ø³Ù… Ø§Ù„ÙØ­Øµ">
                                    <input type="number" id="admLabPrice" class="form-control mb-2" placeholder="Ø§Ù„Ø³Ø¹Ø±">
                                    <button class="btn btn-danger btn-sm w-100" onclick="adminAddLab()">Ø­ÙØ¸ Ø§Ù„ÙØ­Øµ</button>
                                </div>
                                <div class="card p-3 mt-3">
                                    <h6>â• Ø¥Ø¶Ø§ÙØ© Ø¯ÙˆØ§Ø¡ Ù„Ù„Ù…Ø®Ø²ÙˆÙ†</h6>
                                    <input type="text" id="admMedName" class="form-control mb-2" placeholder="Ø§Ø³Ù… Ø§Ù„Ø¯ÙˆØ§Ø¡">
                                    <input type="number" id="admMedPrice" class="form-control mb-2" placeholder="Ø§Ù„Ø³Ø¹Ø±">
                                    <input type="number" id="admMedQty" class="form-control mb-2" placeholder="Ø§Ù„ÙƒÙ…ÙŠØ©">
                                    <button class="btn btn-warning btn-sm w-100" onclick="adminAddMed()">Ø­ÙØ¸ Ø§Ù„Ø¯ÙˆØ§Ø¡</button>
                                </div>
                            </div>
                            <div class="col-md-8">
                                <div class="card p-3">
                                    <h6>ğŸ“Š ØªÙ‚Ø§Ø±ÙŠØ± Ø§Ù„Ø£Ø¯Ø§Ø¡</h6>
                                    <div class="btn-group w-100 mb-3">
                                        <button class="btn btn-outline-dark btn-sm" onclick="renderReport('day')">ØªÙ‚Ø±ÙŠØ± ÙŠÙˆÙ…ÙŠ</button>
                                        <button class="btn btn-outline-dark btn-sm" onclick="renderReport('week')">Ø£Ø³Ø¨ÙˆØ¹ÙŠ</button>
                                        <button class="btn btn-outline-dark btn-sm" onclick="renderReport('month')">Ø´Ù‡Ø±ÙŠ</button>
                                    </div>
                                    <div id="reportArea" class="bg-light p-3 rounded">Ø§Ø®ØªØ± Ù†ÙˆØ¹ Ø§Ù„ØªÙ‚Ø±ÙŠØ± Ù„Ù„Ø¹Ø±Ø¶...</div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…ÙˆØ¸ÙÙŠÙ† -->
                    <div id="admin-staff" class="admin-tab-content hidden-section">
                        <div class="row">
                            <div class="col-md-4">
                                <div class="card p-4">
                                    <h5 class="fw-bold mb-3">â• Ø¥Ø¶Ø§ÙØ© Ù…ÙˆØ¸Ù Ø¬Ø¯ÙŠØ¯</h5>
                                    <input type="text" id="newStaffUsername" class="form-control mb-2" placeholder="Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…">
                                    <input type="password" id="newStaffPassword" class="form-control mb-2" placeholder="ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±">
                                    <input type="text" id="newStaffName" class="form-control mb-2" placeholder="Ø§Ù„Ø§Ø³Ù… Ø§Ù„ÙƒØ§Ù…Ù„">
                                    <select id="newStaffRole" class="form-select mb-3">
                                        <option value="">Ø§Ø®ØªØ± Ø§Ù„Ø¯ÙˆØ±</option>
                                        <option value="admin">ğŸ‘‘ Ø§Ù„Ù…Ø¯ÙŠØ± Ø§Ù„Ø¹Ø§Ù…</option>
                                        <option value="reception">ğŸ“‹ Ø§Ù„Ø§Ø³ØªÙ‚Ø¨Ø§Ù„</option>
                                        <option value="doctor">ğŸ‘¨â€âš•ï¸ Ø§Ù„Ø·Ø¨ÙŠØ¨</option>
                                        <option value="lab">ğŸ§ª Ø§Ù„Ù…Ø¹Ù…Ù„</option>
                                        <option value="pharmacy">ğŸ’Š Ø§Ù„ØµÙŠØ¯Ù„ÙŠØ©</option>
                                        <option value="nursing">ğŸ’‰ Ø§Ù„ØªÙ…Ø±ÙŠØ¶</option>
                                    </select>
                                    <button class="btn btn-primary w-100" onclick="addNewStaff()">â• Ø¥Ø¶Ø§ÙØ© Ù…ÙˆØ¸Ù</button>
                                </div>
                            </div>
                            <div class="col-md-8">
                                <div class="card p-4">
                                    <h5 class="fw-bold mb-3">ğŸ‘¥ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…ÙˆØ¸ÙÙŠÙ†</h5>
                                    <div id="staffList" class="row g-3">
                                        <!-- Ø³ÙŠØªÙ… Ø¹Ø±Ø¶ Ø§Ù„Ù…ÙˆØ¸ÙÙŠÙ† Ù‡Ù†Ø§ -->
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Ù‚Ø³Ù… Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„ÙØ­ÙˆØµØ§Øª ÙˆØ§Ù„Ù…Ø®Ø²ÙˆÙ† -->
                    <div id="admin-inventory" class="admin-tab-content hidden-section">
                        <div class="row">
                            <!-- Ø¬Ø¯ÙˆÙ„ Ø§Ù„ÙØ­ÙˆØµØ§Øª Ø§Ù„Ù…ØªØ§Ø­Ø© -->
                            <div class="col-md-6">
                                <div class="card p-4 border-top border-danger border-5">
                                    <h5 class="fw-bold mb-3">ğŸ§ª Ø§Ù„ÙØ­ÙˆØµØ§Øª Ø§Ù„Ù…ØªØ§Ø­Ø© ÙˆØ£Ø³Ø¹Ø§Ø±Ù‡Ø§</h5>
                                    <div class="table-responsive">
                                        <table class="table table-striped table-hover table-sm">
                                            <thead class="table-dark">
                                                <tr>
                                                    <th>#</th>
                                                    <th>Ø§Ø³Ù… Ø§Ù„ÙØ­Øµ</th>
                                                    <th>Ø§Ù„Ø³Ø¹Ø± (Ø¬.Ø³)</th>
                                                    <th>Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª</th>
                                                </tr>
                                            </thead>
                                            <tbody id="labTestsTable">
                                                <!-- Ø³ÙŠØªÙ… Ù…Ù„Ø¤Ù‡Ø§ ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹ -->
                                            </tbody>
                                        </table>
                                    </div>
                                    <div class="row mt-3">
                                        <div class="col-md-8">
                                            <input type="text" id="newTestName" class="form-control mb-2" placeholder="Ø§Ø³Ù… Ø§Ù„ÙØ­Øµ Ø§Ù„Ø¬Ø¯ÙŠØ¯">
                                        </div>
                                        <div class="col-md-4">
                                            <input type="number" id="newTestPrice" class="form-control mb-2" placeholder="Ø§Ù„Ø³Ø¹Ø±">
                                        </div>
                                    </div>
                                    <button class="btn btn-danger w-100" onclick="addNewLabTest()">â• Ø¥Ø¶Ø§ÙØ© ÙØ­Øµ Ø¬Ø¯ÙŠØ¯</button>
                                </div>
                            </div>
                            
                            <!-- Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ù…Ø®Ø²ÙˆÙ† Ø§Ù„Ø¯ÙˆØ§Ø¦ÙŠ -->
                            <div class="col-md-6">
                                <div class="card p-4 border-top border-warning border-5">
                                    <h5 class="fw-bold mb-3">ğŸ’Š Ø§Ù„Ù…Ø®Ø²ÙˆÙ† Ø§Ù„Ø¯ÙˆØ§Ø¦ÙŠ Ø§Ù„Ù…ØªÙˆÙØ±</h5>
                                    <div class="alert alert-info mb-3">
                                        <small>Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…Ø®Ø²ÙˆÙ†: <span id="totalStockValue">0</span> Ø¬.Ø³</small>
                                        <small class="d-block">Ø§Ù„Ø£Ø¯ÙˆÙŠØ© Ø§Ù„Ù…Ù†Ø®ÙØ¶Ø©: <span id="lowStockCount" class="badge bg-warning">0</span></small>
                                    </div>
                                    <div class="table-responsive">
                                        <table class="table table-striped table-hover table-sm">
                                            <thead class="table-dark">
                                                <tr>
                                                    <th>#</th>
                                                    <th>Ø§Ø³Ù… Ø§Ù„Ø¯ÙˆØ§Ø¡</th>
                                                    <th>Ø§Ù„Ø³Ø¹Ø± (Ø¬.Ø³)</th>
                                                    <th>Ø§Ù„ÙƒÙ…ÙŠØ©</th>
                                                    <th>Ø§Ù„Ù‚ÙŠÙ…Ø©</th>
                                                    <th>Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª</th>
                                                </tr>
                                            </thead>
                                            <tbody id="inventoryTable">
                                                <!-- Ø³ÙŠØªÙ… Ù…Ù„Ø¤Ù‡Ø§ ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹ -->
                                            </tbody>
                                        </table>
                                    </div>
                                    <div class="row mt-3">
                                        <div class="col-md-4">
                                            <input type="text" id="newMedName" class="form-control mb-2" placeholder="Ø§Ø³Ù… Ø§Ù„Ø¯ÙˆØ§Ø¡">
                                        </div>
                                        <div class="col-md-3">
                                            <input type="number" id="newMedPrice" class="form-control mb-2" placeholder="Ø§Ù„Ø³Ø¹Ø±">
                                        </div>
                                        <div class="col-md-3">
                                            <input type="number" id="newMedQty" class="form-control mb-2" placeholder="Ø§Ù„ÙƒÙ…ÙŠØ©">
                                        </div>
                                        <div class="col-md-2">
                                            <button class="btn btn-warning w-100" onclick="addNewMedicine()">â• Ø¥Ø¶Ø§ÙØ©</button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ù…Ø®Ø²ÙˆÙ† -->
                        <div class="row mt-4">
                            <div class="col-md-12">
                                <div class="card p-4">
                                    <h5 class="fw-bold mb-3">ğŸ“Š ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ù…Ø®Ø²ÙˆÙ† ÙˆØ§Ù„ÙØ­ÙˆØµØ§Øª</h5>
                                    <div class="row">
                                        <div class="col-md-4">
                                            <div class="card bg-primary text-white p-3">
                                                <h6>Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„ÙØ­ÙˆØµØ§Øª</h6>
                                                <h3 id="totalTestsCount">0</h3>
                                            </div>
                                        </div>
                                        <div class="col-md-4">
                                            <div class="card bg-success text-white p-3">
                                                <h6>Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø£Ø¯ÙˆÙŠØ©</h6>
                                                <h3 id="totalMedsCount">0</h3>
                                            </div>
                                        </div>
                                        <div class="col-md-4">
                                            <div class="card bg-info text-white p-3">
                                                <h6>Ø§Ù„Ù‚ÙŠÙ…Ø© Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠØ©</h6>
                                                <h3 id="totalInventoryValue">0 Ø¬.Ø³</h3>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="mt-3">
                                        <button class="btn btn-outline-primary" onclick="exportInventoryReport()">ğŸ“¥ ØªØµØ¯ÙŠØ± ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ù…Ø®Ø²ÙˆÙ†</button>
                                        <button class="btn btn-outline-danger ms-2" onclick="alertLowStock()">ğŸ”” ØªÙ†Ø¨ÙŠÙ‡ Ø§Ù„Ù…Ø®Ø²ÙˆÙ† Ø§Ù„Ù…Ù†Ø®ÙØ¶</button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- ØªØµÙÙŠØ± Ø§Ù„Ù†Ø¸Ø§Ù… -->
                    <div id="admin-reset" class="admin-tab-content hidden-section">
                        <div class="row">
                            <div class="col-md-6">
                                <div class="reset-system-card">
                                    <h5>ğŸ”„ ØªØµÙÙŠØ± Ø§Ù„Ù†Ø¸Ø§Ù… Ø§Ù„ÙŠÙˆÙ…ÙŠ</h5>
                                    <p class="text-muted">Ù‡Ø°Ø§ Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡ Ø³ÙŠØµÙÙŠØ± Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„ÙŠÙˆÙ…ÙŠØ© Ø§Ø³ØªØ¹Ø¯Ø§Ø¯Ø§Ù‹ Ù„ÙŠÙˆÙ… Ø¬Ø¯ÙŠØ¯.</p>
                                    <p><strong>âš ï¸ ØªØ­Ø°ÙŠØ±:</strong> Ø³ÙŠØªÙ… Ø­Ø°Ù Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ÙŠÙˆÙ…ÙŠØ© ØºÙŠØ± Ø§Ù„Ù…Ø­ÙÙˆØ¸Ø©.</p>
                                    
                                    <div class="mt-4">
                                        <button class="btn btn-danger btn-lg w-100 mb-3" onclick="resetDailySystem()">
                                            ğŸ”„ ØªØµÙÙŠØ± Ø§Ù„Ù†Ø¸Ø§Ù… Ø§Ù„ÙŠÙˆÙ…ÙŠ
                                        </button>
                                        <small class="text-muted">Ø¢Ø®Ø± ØªØµÙÙŠØ±: <span id="lastResetTime">Ù„Ù… ÙŠØªÙ… ØªØµÙÙŠØ± Ø§Ù„Ù†Ø¸Ø§Ù… Ø¨Ø¹Ø¯</span></small>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="system-backup">
                                    <h5>ğŸ’¾ Ù†Ø³Ø®Ø© Ø§Ø­ØªÙŠØ§Ø·ÙŠØ©</h5>
                                    <p>Ø§Ø­ÙØ¸ Ù†Ø³Ø®Ø© Ø§Ø­ØªÙŠØ§Ø·ÙŠØ© Ù…Ù† Ø§Ù„Ù†Ø¸Ø§Ù… Ù‚Ø¨Ù„ Ø§Ù„ØªØµÙÙŠØ±</p>
                                    <button class="btn btn-light mt-2" onclick="createSystemBackup()">ğŸ’¾ Ø¥Ù†Ø´Ø§Ø¡ Ù†Ø³Ø®Ø© Ø§Ø­ØªÙŠØ§Ø·ÙŠØ©</button>
                                </div>
                                
                                <div class="card p-3 mt-3">
                                    <h6>ğŸ“‹ Ù…Ø§ Ø³ÙŠØªÙ… ØªØµÙÙŠØªÙ‡:</h6>
                                    <ul class="list-group list-group-flush">
                                        <li class="list-group-item">âœ… Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ø±Ø¶Ù‰ Ø§Ù„ÙŠÙˆÙ…ÙŠØ©</li>
                                        <li class="list-group-item">âœ… Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ù…Ø¹Ù…Ù„ Ø§Ù„Ù…Ø¹Ù„Ù‚Ø©</li>
                                        <li class="list-group-item">âœ… Ø·Ù„Ø¨Ø§Øª Ø§Ù„ØµÙŠØ¯Ù„ÙŠØ© Ø§Ù„Ù…Ø¹Ù„Ù‚Ø©</li>
                                        <li class="list-group-item">âœ… Ù…Ù‡Ø§Ù… Ø§Ù„ØªÙ…Ø±ÙŠØ¶ Ø§Ù„Ù…Ø¹Ù„Ù‚Ø©</li>
                                        <li class="list-group-item">âœ… Ù…Ø¨ÙŠØ¹Ø§Øª Ø§Ù„ØµÙŠØ¯Ù„ÙŠØ© Ø§Ù„ÙŠÙˆÙ…ÙŠØ©</li>
                                        <li class="list-group-item">âœ… Ø§Ù„Ø¹Ø¯Ø§Ø¯Ø§Øª ÙˆØ§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª</li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Ø³Ø¬Ù„Ø§Øª Ø§Ù„Ø£Ù…Ø§Ù† -->
                    <div id="admin-security" class="admin-tab-content hidden-section">
                        <div class="card p-4">
                            <h5 class="fw-bold mb-3">ğŸ›¡ï¸ Ø³Ø¬Ù„Ø§Øª Ø§Ù„Ø£Ù…Ø§Ù† ÙˆØ§Ù„Ù…Ø±Ø§Ù‚Ø¨Ø©</h5>
                            
                            <div class="row mb-4">
                                <div class="col-md-4">
                                    <div class="security-stats-card">
                                        <h6>ğŸ“Š Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„Ø£Ù…Ø§Ù†</h6>
                                        <p>Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø£Ø­Ø¯Ø§Ø«: <span id="securityTotalEvents">0</span></p>
                                        <p>Ø§Ù„Ø£Ø­Ø¯Ø§Ø« Ø§Ù„Ø­Ø±Ø¬Ø©: <span id="securityCriticalEvents">0</span></p>
                                        <p>Ø¢Ø®Ø± Ø­Ø¯Ø«: <span id="securityLastEvent">--</span></p>
                                    </div>
                                </div>
                                <div class="col-md-8">
                                    <div class="security-filter-card">
                                        <h6>ğŸ” ØªØµÙÙŠØ© Ø§Ù„Ø³Ø¬Ù„Ø§Øª</h6>
                                        <div class="row g-2 mb-3">
                                            <div class="col-md-4">
                                                <select class="form-select" id="securitySeverityFilter">
                                                    <option value="">Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ø³ØªÙˆÙŠØ§Øª</option>
                                                    <option value="critical">Ø­Ø±Ø¬Ø©</option>
                                                    <option value="warning">ØªØ­Ø°ÙŠØ±</option>
                                                    <option value="info">Ù…Ø¹Ù„ÙˆÙ…Ø§Øª</option>
                                                </select>
                                            </div>
                                            <div class="col-md-4">
                                                <input type="date" class="form-control" id="securityDateFilter">
                                            </div>
                                            <div class="col-md-4">
                                                <button class="btn btn-primary w-100" onclick="loadSecurityLogs()">ğŸ” ØªØµÙÙŠØ©</button>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="card p-3">
                                <h6>ğŸ“‹ Ø³Ø¬Ù„Ø§Øª Ø§Ù„Ø£Ù…Ø§Ù† Ø§Ù„Ø£Ø®ÙŠØ±Ø©</h6>
                                <div id="securityLogsContainer" class="security-log-container">
                                    <!-- Ø³ÙŠØªÙ… Ø¹Ø±Ø¶ Ø§Ù„Ø³Ø¬Ù„Ø§Øª Ù‡Ù†Ø§ -->
                                </div>
                                <div class="text-center mt-3">
                                    <button class="btn btn-sm btn-outline-secondary" onclick="exportSecurityLogs()">
                                        ğŸ“¥ ØªØµØ¯ÙŠØ± Ø§Ù„Ø³Ø¬Ù„Ø§Øª
                                    </button>
                                    <button class="btn btn-sm btn-outline-danger ms-2" onclick="clearOldLogs()">
                                        ğŸ—‘ï¸ Ø­Ø°Ù Ø§Ù„Ø³Ø¬Ù„Ø§Øª Ø§Ù„Ù‚Ø¯ÙŠÙ…Ø©
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <!-- Modal Ø§Ù„Ø±ÙˆØ´ØªØ© Ø§Ù„Ø·Ø¨ÙŠØ© -->
<div id="prescriptionModal" class="modal fade" tabindex="-1">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header bg-primary text-white">
                <h5 class="modal-title">ğŸ“ Ø§Ù„Ø±ÙˆØ´ØªØ© Ø§Ù„Ø·Ø¨ÙŠØ©</h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <div id="prescriptionContent">
                    <!-- Ø³ÙŠØªÙ… ØªØ¹Ø¨Ø¦Ø© Ù…Ø­ØªÙˆÙ‰ Ø§Ù„Ø±ÙˆØ´ØªØ© Ù‡Ù†Ø§ -->
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Ø¥ØºÙ„Ø§Ù‚</button>
                <button type="button" class="btn btn-primary" onclick="printPrescription()">ğŸ–¨ï¸ Ø·Ø¨Ø§Ø¹Ø© Ø§Ù„Ø±ÙˆØ´ØªØ©</button>
            </div>
        </div>
    </div>
</div>

<!-- Modal ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ù…ÙˆØ¸Ù -->
<div id="editStaffModal" class="modal fade" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header bg-warning text-white">
                <h5 class="modal-title">âœï¸ ØªØ¹Ø¯ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…ÙˆØ¸Ù</h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <input type="hidden" id="editStaffId">
                <div class="mb-3">
                    <label class="form-label">Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…</label>
                    <input type="text" id="editStaffUsername" class="form-control">
                </div>
                <div class="mb-3">
                    <label class="form-label">Ø§Ù„Ø§Ø³Ù… Ø§Ù„ÙƒØ§Ù…Ù„</label>
                    <input type="text" id="editStaffName" class="form-control">
                </div>
                <div class="mb-3">
                    <label class="form-label">Ø§Ù„Ø¯ÙˆØ±</label>
                    <select id="editStaffRole" class="form-select">
                        <option value="admin">ğŸ‘‘ Ø§Ù„Ù…Ø¯ÙŠØ± Ø§Ù„Ø¹Ø§Ù…</option>
                        <option value="reception">ğŸ“‹ Ø§Ù„Ø§Ø³ØªÙ‚Ø¨Ø§Ù„</option>
                        <option value="doctor">ğŸ‘¨â€âš•ï¸ Ø§Ù„Ø·Ø¨ÙŠØ¨</option>
                        <option value="lab">ğŸ§ª Ø§Ù„Ù…Ø¹Ù…Ù„</option>
                        <option value="pharmacy">ğŸ’Š Ø§Ù„ØµÙŠØ¯Ù„ÙŠØ©</option>
                        <option value="nursing">ğŸ’‰ Ø§Ù„ØªÙ…Ø±ÙŠØ¶</option>
                    </select>
                </div>
                <div class="mb-3">
                    <label class="form-label">ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø© (Ø§ØªØ±ÙƒÙ‡Ø§ ÙØ§Ø±ØºØ© Ø¥Ø°Ø§ Ù„Ù… ØªØ±Ø¯ Ø§Ù„ØªØºÙŠÙŠØ±)</label>
                    <input type="password" id="editStaffPassword" class="form-control" placeholder="ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©">
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Ø¥Ù„ØºØ§Ø¡</button>
                <button type="button" class="btn btn-warning" onclick="saveStaffChanges()">ğŸ’¾ Ø­ÙØ¸ Ø§Ù„ØªØºÙŠÙŠØ±Ø§Øª</button>
            </div>
        </div>
    </div>
</div>

<!-- Modal ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø­Ø°Ù -->
<div id="confirmDeleteModal" class="modal fade" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header bg-danger text-white">
                <h5 class="modal-title">âš ï¸ ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø­Ø°Ù</h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <p>Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ù‡Ø°Ø§ Ø§Ù„Ù…ÙˆØ¸ÙØŸ</p>
                <p><strong>âš ï¸ ØªØ­Ø°ÙŠØ±:</strong> Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø§Ù„ØªØ±Ø§Ø¬Ø¹ Ø¹Ù† Ù‡Ø°Ø§ Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡!</p>
                <input type="hidden" id="deleteStaffId">
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Ø¥Ù„ØºØ§Ø¡</button>
                <button type="button" class="btn btn-danger" onclick="deleteStaffConfirmed()">ğŸ—‘ï¸ ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø­Ø°Ù</button>
            </div>
        </div>
    </div>
</div>

<!-- Modal ØªØºÙŠÙŠØ± ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± -->
<div class="modal fade" id="passwordChangeModal" tabindex="-1" aria-labelledby="passwordChangeModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header bg-warning text-white">
                <h5 class="modal-title">ğŸ” ØªØºÙŠÙŠØ± ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±</h5>
            </div>
            <div class="modal-body">
                <div class="alert alert-info">
                    <small>ÙŠØ¬Ø¨ ØªØºÙŠÙŠØ± ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± Ù„Ø£Ø³Ø¨Ø§Ø¨ Ø£Ù…Ù†ÙŠØ©. ÙŠØ±Ø¬Ù‰ Ø§Ø®ØªÙŠØ§Ø± ÙƒÙ„Ù…Ø© Ù…Ø±ÙˆØ± Ù‚ÙˆÙŠØ©.</small>
                </div>
                
                <div class="mb-3">
                    <label class="form-label">ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©</label>
                    <input type="password" id="newPassword" class="form-control" placeholder="Ø£Ø¯Ø®Ù„ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©">
                    <div class="password-strength-meter mt-1">
                        <div class="password-strength-fill" id="passwordStrengthBar"></div>
                    </div>
                    <small class="text-muted" id="passwordStrengthText">Ù‚ÙˆØ© ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±</small>
                </div>
                
                <div class="mb-3">
                    <label class="form-label">ØªØ£ÙƒÙŠØ¯ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±</label>
                    <input type="password" id="confirmPassword" class="form-control" placeholder="Ø£Ø¹Ø¯ Ø¥Ø¯Ø®Ø§Ù„ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±">
                    <div class="form-text" id="passwordMatch"></div>
                </div>
                
                <div class="password-requirements">
                    <h6>Ù…ØªØ·Ù„Ø¨Ø§Øª ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±:</h6>
                    <ul class="mb-0">
                        <li id="reqLength" class="requirement-not-met">8 Ø£Ø­Ø±Ù Ø¹Ù„Ù‰ Ø§Ù„Ø£Ù‚Ù„</li>
                        <li id="reqUpper" class="requirement-not-met">Ø­Ø±Ù ÙƒØ¨ÙŠØ± ÙˆØ§Ø­Ø¯ Ø¹Ù„Ù‰ Ø§Ù„Ø£Ù‚Ù„</li>
                        <li id="reqLower" class="requirement-not-met">Ø­Ø±Ù ØµØºÙŠØ± ÙˆØ§Ø­Ø¯ Ø¹Ù„Ù‰ Ø§Ù„Ø£Ù‚Ù„</li>
                        <li id="reqNumber" class="requirement-not-met">Ø±Ù‚Ù… ÙˆØ§Ø­Ø¯ Ø¹Ù„Ù‰ Ø§Ù„Ø£Ù‚Ù„</li>
                        <li id="reqSpecial" class="requirement-not-met">Ø±Ù…Ø² Ø®Ø§Øµ ÙˆØ§Ø­Ø¯ Ø¹Ù„Ù‰ Ø§Ù„Ø£Ù‚Ù„ (!@#$%^&*)</li>
                    </ul>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-primary" onclick="updatePassword()">ğŸ’¾ Ø­ÙØ¸ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©</button>
            </div>
        </div>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
    // ============================================
    // Ø§Ù„Ù…ØªØºÙŠØ±Ø§Øª Ø§Ù„Ø¹Ø§Ù…Ø© Ù„Ù„Ù†Ø¸Ø§Ù…
    // ============================================

    // Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ† Ù…Ø¹ Ø§Ù„ØªØ´ÙÙŠØ± - ØªÙ… ØªØ­Ø¯ÙŠØ« ÙƒÙ„Ù…Ø§Øª Ø§Ù„Ù…Ø±ÙˆØ±
    const HASHED_USERS = {
        'admin': { 
            password: 'ef9bbe945d4a775e5af554f623b163c7293427f0886c138d6008a63163ec8a83', // Musab@219736
            role: 'admin', 
            name: 'Ø§Ù„Ù…Ø¯ÙŠØ± Ø§Ù„Ø¹Ø§Ù…',
            mustChangePassword: true,
            lastPasswordChange: new Date().toISOString()
        },
        'doctor': { 
            password: 'f6a0cb0c9c8c0c8b0c9c8c0c8b0c9c8c0c8b0c9c8c0c8b0c9c8c0c8b0c9c8c0c8', // Doc@2024
            role: 'doctor', 
            name: 'Ø¯. ',
            mustChangePassword: true,
            lastPasswordChange: new Date('2024-01-01').toISOString()
        },
        'reception': { 
            password: 'f6a0cb0c9c8c0c8b0c9c8c0c8b0c9c8c0c8b0c9c8c0c8b0c9c8c0c8b0c9c8c0c8', // Rec@2024
            role: 'reception', 
            name: ' - Ø§Ù„Ø§Ø³ØªÙ‚Ø¨Ø§Ù„',
            mustChangePassword: true,
            lastPasswordChange: new Date('2024-01-01').toISOString()
        },
        'pharmacist': { 
            password: 'f6a0cb0c9c8c0c8b0c9c8c0c8b0c9c8c0c8b0c9c8c0c8b0c9c8c0c8b0c9c8c0c8', // Phar@2024
            role: 'pharmacy', 
            name: ' - Ø§Ù„ØµÙŠØ¯Ù„ÙŠ',
            mustChangePassword: true,
            lastPasswordChange: new Date('2024-01-01').toISOString()
        },
        'lab': { 
            password: 'f6a0cb0c9c8c0c8b0c9c8c0c8b0c9c8c0c8b0c9c8c0c8b0c9c8c0c8b0c9c8c0c8', // Lab@2024
            role: 'lab', 
            name: ' - Ø§Ù„Ù…Ø¹Ù…Ù„',
            mustChangePassword: true,
            lastPasswordChange: new Date('2024-01-01').toISOString()
        },
        'nurse': { 
            password: 'f6a0cb0c9c8c0c8b0c9c8c0c8b0c9c8c0c8b0c9c8c0c8b0c9c8c0c8b0c9c8c0c8', // Nurse@2024
            role: 'nursing', 
            name: '  Ø§Ù„ØªÙ…Ø±ÙŠØ¶',
            mustChangePassword: true,
            lastPasswordChange: new Date('2024-01-01').toISOString()
        }
    };

    // Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø£Ù…Ø§Ù† Ø§Ù„Ù†Ø¸Ø§Ù…
    const SECURITY_SETTINGS = {
        emergencyCode: 'SHIFA2026EMERG',
        maxLoginAttempts: 5,
        lockoutTime: 15, // Ø¯Ù‚Ø§Ø¦Ù‚
        sessionTimeout: 30, // Ø¯Ù‚Ø§Ø¦Ù‚
        enableAuditLog: true
    };

    let currentUser = null;
    let patients = [];
    let labRequests = [];
    let pharmOrders = [];
    let nursingTasks = [];
    let financials = { clinic: 0, lab: 0, pharSales: 0, pharProfit: 0, total: 0 };
    let staffMembers = [];
    let medicalLibrary = [];
    let backups = [];
    let securityLog = [];
    
    // Ø¨ÙŠØ§Ù†Ø§Øª Ø¬Ø¯ÙŠØ¯Ø©
    let labTests = [];
    let inventory = [];
    
    // Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª Ø§Ù„ÙŠÙˆÙ…ÙŠØ©
    let dailySales = {
        total: 0,
        prescriptions: []
    };

    // Ù…ØªØºÙŠØ±Ø§Øª Ø§Ù„Ø£Ù…Ø§Ù†
    let loginAttempts = {};
    let lastActivityTime = Date.now();
    let activePatient = null;
    let prescriptionItems = [];
    
    // Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ù†Ø¸Ø§Ù…
    let systemSettings = {
        lastReset: null,
        dailyResetAuto: false,
        backupCount: 0
    };

    // ============================================
    // Ù†Ø¸Ø§Ù… Ø§Ù„ØªØ´ÙÙŠØ± ÙˆØ§Ù„Ø£Ù…Ø§Ù† Ø§Ù„Ù…ØªÙ‚Ø¯Ù…
    // ============================================

    // Ø¯Ø§Ù„Ø© ØªØ´ÙÙŠØ± ÙƒÙ„Ù…Ø§Øª Ø§Ù„Ù…Ø±ÙˆØ± Ø¨Ø§Ø³ØªØ®Ø¯Ø§Ù… SHA-256
    async function hashPassword(password) {
        // Ø¥Ø°Ø§ ÙƒØ§Ù† Ø§Ù„Ù…ØªØµÙØ­ ÙŠØ¯Ø¹Ù… Web Crypto API
        if (window.crypto && window.crypto.subtle) {
            const encoder = new TextEncoder();
            const data = encoder.encode(password);
            const hashBuffer = await crypto.subtle.digest('SHA-256', data);
            const hashArray = Array.from(new Uint8Array(hashBuffer));
            const hashHex = hashArray.map(b => b.toString(16).padStart(2, '0')).join('');
            return hashHex;
        } else {
            // Fallback Ø¨Ø³ÙŠØ· Ù„Ù„Ù…ØªØµÙØ­Ø§Øª Ø§Ù„Ù‚Ø¯ÙŠÙ…Ø©
            return 'hashed_' + btoa(password).split('').reverse().join('');
        }
    }

    // Ø¯Ø§Ù„Ø© Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ù‚ÙˆØ© ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±
    function validatePasswordStrength(password) {
        const minLength = 8;
        const hasUpperCase = /[A-Z]/.test(password);
        const hasLowerCase = /[a-z]/.test(password);
        const hasNumbers = /\d/.test(password);
        const hasSpecialChar = /[!@#$%^&*(),.?":{}|<>]/.test(password);
        
        let score = 0;
        if (password.length >= minLength) score++;
        if (hasUpperCase) score++;
        if (hasLowerCase) score++;
        if (hasNumbers) score++;
        if (hasSpecialChar) score++;
        
        return {
            score: score,
            strength: score >= 4 ? 'strong' : score >= 3 ? 'medium' : 'weak',
            meetsRequirements: password.length >= minLength && hasUpperCase && hasLowerCase && hasNumbers && hasSpecialChar,
            requirements: {
                length: password.length >= minLength,
                upperCase: hasUpperCase,
                lowerCase: hasLowerCase,
                numbers: hasNumbers,
                specialChar: hasSpecialChar
            }
        };
    }

    // Ù†Ø¸Ø§Ù… Ø§Ù„ØªØ®Ø²ÙŠÙ† Ø§Ù„Ù…Ø´ÙØ±
    class SecureStorage {
        constructor(secretKey = 'shifa_medical_secure_2026') {
            this.secretKey = secretKey;
        }
        
        encrypt(data) {
            try {
                // ØªØ´ÙÙŠØ± Ø¨Ø³ÙŠØ· Ù„Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø­Ø³Ø§Ø³Ø©
                const encrypted = btoa(JSON.stringify(data)).split('').reverse().join('');
                return `enc_${this.secretKey}_${encrypted}`;
            } catch (e) {
                console.error('Encryption error:', e);
                return data;
            }
        }
        
        decrypt(encryptedData) {
            try {
                if (!encryptedData.startsWith('enc_')) return encryptedData;
                
                const parts = encryptedData.split('_');
                if (parts.length < 3) return encryptedData;
                
                const encrypted = parts.slice(2).join('_').split('').reverse().join('');
                return JSON.parse(atob(encrypted));
            } catch (e) {
                console.error('Decryption error:', e);
                return encryptedData;
            }
        }
    }

    // Ù†Ø¸Ø§Ù… Ø³Ø¬Ù„ Ø§Ù„Ø£Ù…Ø§Ù†
    class SecurityLogger {
        constructor() {
            this.logs = JSON.parse(localStorage.getItem('shifa_security_logs')) || [];
        }
        
        log(event, details, severity = 'info') {
            const logEntry = {
                timestamp: new Date().toISOString(),
                event: event,
                details: details,
                severity: severity,
                user: currentUser?.username || 'system',
                ip: this.getClientIP() || 'unknown'
            };
            
            this.logs.push(logEntry);
            
            // Ø§Ù„Ø§Ø­ØªÙØ§Ø¸ Ø¨Ù€ 1000 Ø³Ø¬Ù„ ÙÙ‚Ø·
            if (this.logs.length > 1000) {
                this.logs = this.logs.slice(-1000);
            }
            
            localStorage.setItem('shifa_security_logs', JSON.stringify(this.logs));
            
            // Ø¥Ø´Ø¹Ø§Ø± ÙÙŠ Ø­Ø§Ù„Ø© Ø§Ù„Ø£Ø­Ø¯Ø§Ø« Ø§Ù„Ù…Ù‡Ù…Ø©
            if (severity === 'critical' || severity === 'warning') {
                this.sendAlert(logEntry);
            }
            
            return logEntry;
        }
        
        getClientIP() {
            // Ù‡Ø°Ù‡ Ø¯Ø§Ù„Ø© Ø§ÙØªØ±Ø§Ø¶ÙŠØ©ØŒ ÙÙŠ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„Ø­Ù‚ÙŠÙ‚ÙŠ ÙŠØ¬Ø¨ Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ IP Ù…Ù† Ø§Ù„Ø®Ø§Ø¯Ù…
            return 'local_' + Math.random().toString(36).substr(2, 9);
        }
        
        sendAlert(logEntry) {
            console.log(`ğŸ”’ Security Alert: ${logEntry.event} - ${logEntry.details}`);
        }
        
        getRecentLogs(count = 50) {
            return this.logs.slice(-count).reverse();
        }
    }

    // Ù†Ø¸Ø§Ù… Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø¬Ù„Ø³Ø§Øª
    class SessionManager {
        constructor() {
            this.sessionTimeout = 30 * 60 * 1000; // 30 Ø¯Ù‚ÙŠÙ‚Ø©
            this.setupActivityListeners();
        }
        
        setupActivityListeners() {
            // ØªØªØ¨Ø¹ Ø§Ù„Ù†Ø´Ø§Ø· Ù„Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø§Ù„Ù…Ù‡Ù„Ø©
            ['click', 'keypress', 'mousemove', 'scroll'].forEach(event => {
                document.addEventListener(event, () => this.resetSessionTimer());
            });
        }
        
        startSession(userData) {
            const sessionData = {
                user: userData,
                startTime: Date.now(),
                lastActivity: Date.now(),
                sessionId: 'sess_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9)
            };
            
            localStorage.setItem('shifa_session', JSON.stringify(sessionData));
            this.checkSession();
            return sessionData;
        }
        
        resetSessionTimer() {
            const session = JSON.parse(localStorage.getItem('shifa_session'));
            if (session) {
                session.lastActivity = Date.now();
                localStorage.setItem('shifa_session', JSON.stringify(session));
            }
        }
        
        checkSession() {
            const session = JSON.parse(localStorage.getItem('shifa_session'));
            if (!session) return false;
            
            const inactiveTime = Date.now() - session.lastActivity;
            
            if (inactiveTime > this.sessionTimeout) {
                this.endSession();
                alert('â° Ø§Ù†ØªÙ‡Øª Ø¬Ù„Ø³Ø© Ø§Ù„Ø¹Ù…Ù„ Ø¨Ø³Ø¨Ø¨ Ø¹Ø¯Ù… Ø§Ù„Ù†Ø´Ø§Ø·. ÙŠØ±Ø¬Ù‰ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ù…Ø±Ø© Ø£Ø®Ø±Ù‰.');
                window.location.reload();
                return false;
            }
            
            return true;
        }
        
        endSession() {
            localStorage.removeItem('shifa_session');
        }
        
        getSessionInfo() {
            return JSON.parse(localStorage.getItem('shifa_session')) || null;
        }
    }

    // Ù†Ø¸Ø§Ù… Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„ØµÙ„Ø§Ø­ÙŠØ§Øª Ø§Ù„Ù…ØªÙ‚Ø¯Ù…
    class PermissionManager {
        constructor() {
            this.permissions = {
                admin: {
                    canViewAll: true,
                    canEditAll: true,
                    canDelete: true,
                    canManageUsers: true,
                    canViewReports: true,
                    canResetSystem: true,
                    canExportData: true,
                    canAuditLogs: true
                },
                doctor: {
                    canViewAll: false,
                    canEditPatients: true,
                    canPrescribe: true,
                    canRequestLabs: true,
                    canViewPatientHistory: true,
                    canExportPrescriptions: true,
                    canDelete: false,
                    canManageUsers: false
                },
                reception: {
                    canViewAll: false,
                    canRegisterPatients: true,
                    canViewQueue: true,
                    canEditPatientInfo: true,
                    canExportBasic: true,
                    canDelete: false,
                    canManageUsers: false
                },
                pharmacy: {
                    canViewAll: false,
                    canDispense: true,
                    canViewInventory: true,
                    canUpdateStock: true,
                    canViewPrescriptions: true,
                    canExportSales: true,
                    canDelete: false,
                    canManageUsers: false
                },
                lab: {
                    canViewAll: false,
                    canProcessTests: true,
                    canUpdateResults: true,
                    canViewLabHistory: true,
                    canExportResults: true,
                    canDelete: false,
                    canManageUsers: false
                },
                nursing: {
                    canViewAll: false,
                    canProcessTasks: true,
                    canUpdatePatientStatus: true,
                    canViewNursingHistory: true,
                    canExportTasks: true,
                    canDelete: false,
                    canManageUsers: false
                }
            };
        }
        
        hasPermission(userRole, permission) {
            const rolePerms = this.permissions[userRole];
            return rolePerms ? rolePerms[permission] || false : false;
        }
        
        checkAccess(userRole, requiredPermission) {
            if (!currentUser) return false;
            
            // Ø§Ù„Ù…Ø¯ÙŠØ± Ø§Ù„Ø¹Ø§Ù… Ù„Ø¯ÙŠÙ‡ Ø¬Ù…ÙŠØ¹ Ø§Ù„ØµÙ„Ø§Ø­ÙŠØ§Øª
            if (userRole === 'admin') return true;
            
            return this.hasPermission(userRole, requiredPermission);
        }
    }

    // ØªÙ‡ÙŠØ¦Ø© Ø£Ù†Ø¸Ù…Ø© Ø§Ù„Ø£Ù…Ø§Ù†
    const secureStorage = new SecureStorage();
    const securityLogger = new SecurityLogger();
    const sessionManager = new SessionManager();
    const permissionManager = new PermissionManager();

    // ============================================
    // Ø¯ÙˆØ§Ù„ Ø§Ù„ØªØ®Ø²ÙŠÙ† ÙˆØ§Ù„ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ø´ÙØ±Ø©
    // ============================================

    // Ø¯Ø§Ù„Ø© Ù…Ø­Ø³Ù†Ø© Ù„Ø­ÙØ¸ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ø¹ Ø§Ù„ØªØ´ÙÙŠØ±
    function saveSecureData(key, data) {
        try {
            localStorage.setItem(key, secureStorage.encrypt(data));
            return true;
        } catch (e) {
            console.error('Error saving secure data:', e);
            securityLogger.log('save_error', `Failed to save data for key: ${key}`, 'error');
            return false;
        }
    }

    // Ø¯Ø§Ù„Ø© Ù…Ø­Ø³Ù†Ø© Ù„Ù‚Ø±Ø§Ø¡Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø´ÙØ±Ø©
    function loadSecureData(key, defaultValue = []) {
        try {
            const encryptedData = localStorage.getItem(key);
            if (!encryptedData) return defaultValue;
            
            const data = secureStorage.decrypt(encryptedData);
            return data || defaultValue;
        } catch (e) {
            console.error('Error loading secure data:', e);
            securityLogger.log('load_error', `Failed to load data for key: ${key}`, 'error');
            return defaultValue;
        }
    }

    // ØªØ­Ù…ÙŠÙ„ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
    function loadAllData() {
        patients = loadSecureData('shifa_pats', []);
        inventory = loadSecureData('shifa_inventory', [
            {name: 'Panadol', price: 1000, qty: 100},
            {name: 'Antibiotic', price: 2500, qty: 50},
            {name: 'Vitamin C', price: 1500, qty: 75}
        ]);
        labTests = loadSecureData('shifa_labTests', [
            {name: 'CBC', price: 5000},
            {name: 'Malaria', price: 2000},
            {name: 'Glucose', price: 1000},
            {name: 'Cholesterol', price: 3000}
        ]);
        dailySales = loadSecureData('shifa_daily_sales', { total: 0, prescriptions: [] });
        staffMembers = loadSecureData('shifa_staff', []);
        labRequests = loadSecureData('shifa_lab', []);
        pharmOrders = loadSecureData('shifa_rx', []);
        nursingTasks = loadSecureData('shifa_nursing_tasks', []);
        
        // ØªØ­Ù…ÙŠÙ„ Ø³Ø¬Ù„Ø§Øª Ø§Ù„Ø£Ù…Ø§Ù†
        const logs = JSON.parse(localStorage.getItem('shifa_security_logs') || '[]');
        securityLogger.logs = logs;
        
        // ØªØ­Ù…ÙŠÙ„ Ù…Ø­Ø§ÙˆÙ„Ø§Øª Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø§Ù„ÙØ§Ø´Ù„Ø©
        loginAttempts = JSON.parse(localStorage.getItem('shifa_login_attempts') || '{}');
        
        // ØªØ­Ù…ÙŠÙ„ Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ù†Ø¸Ø§Ù…
        const settings = localStorage.getItem('shifa_settings');
        if (settings) {
            systemSettings = JSON.parse(settings);
        }
    }

    // Ø¯Ø§Ù„Ø© Ø¹Ø§Ù…Ø© Ù„Ø­ÙØ¸ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
    function saveData() {
        saveSecureData('shifa_pats', patients);
        saveSecureData('shifa_inventory', inventory);
        saveSecureData('shifa_labTests', labTests);
        saveSecureData('shifa_daily_sales', dailySales);
        saveSecureData('shifa_staff', staffMembers);
        saveSecureData('shifa_lab', labRequests);
        saveSecureData('shifa_rx', pharmOrders);
        saveSecureData('shifa_nursing_tasks', nursingTasks);
        
        // Ø­ÙØ¸ Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ù†Ø¸Ø§Ù…
        localStorage.setItem('shifa_settings', JSON.stringify(systemSettings));
        
        updateBadges();
    }

    // ============================================
    // Ø¯ÙˆØ§Ù„ Ù†Ø¸Ø§Ù… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø§Ù„Ù…Ø­Ø³Ù†Ø©
    // ============================================

    function updateLoginPlaceholder() {
        const dept = document.getElementById('loginDept').value;
        const usernameInput = document.getElementById('username');
        
        if (dept) {
            switch(dept) {
                case 'admin': usernameInput.placeholder = 'Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…: admin'; break;
                case 'doctor': usernameInput.placeholder = 'Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…: doctor'; break;
                case 'reception': usernameInput.placeholder = 'Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…: reception'; break;
                case 'pharmacy': usernameInput.placeholder = 'Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…: pharmacist'; break;
                case 'lab': usernameInput.placeholder = 'Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…: lab'; break;
                case 'nursing': usernameInput.placeholder = 'Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…: nurse'; break;
            }
        } else {
            usernameInput.placeholder = 'Ø£Ø¯Ø®Ù„ Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…';
        }
    }

    async function handleLogin() {
        const username = document.getElementById('username').value.trim();
        const password = document.getElementById('password').value;
        const department = document.getElementById('loginDept').value;
        
        if (!username || !password) {
            alert('âš ï¸ Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… ÙˆÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±!');
            securityLogger.log('login_attempt', 'Missing credentials', 'warning');
            return;
        }
        
        // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø¹Ø¯Ø¯ Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø§Øª Ø§Ù„ÙØ§Ø´Ù„Ø©
        const userAttempts = loginAttempts[username] || { count: 0, lastAttempt: null };
        
        // Ø¥Ø°Ø§ ØªØ¬Ø§ÙˆØ² 5 Ù…Ø­Ø§ÙˆÙ„Ø§Øª Ø®Ù„Ø§Ù„ 15 Ø¯Ù‚ÙŠÙ‚Ø©
        if (userAttempts.count >= 5) {
            const lastAttemptTime = new Date(userAttempts.lastAttempt);
            const timeDiff = (Date.now() - lastAttemptTime.getTime()) / (1000 * 60); // Ø¯Ù‚Ø§Ø¦Ù‚
            
            if (timeDiff < 15) {
                alert('â›” ØªÙ… ØªØ¬Ø§ÙˆØ² Ø¹Ø¯Ø¯ Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø§Øª Ø§Ù„Ù…Ø³Ù…ÙˆØ­Ø©. ÙŠØ±Ø¬Ù‰ Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø© Ø¨Ø¹Ø¯ 15 Ø¯Ù‚ÙŠÙ‚Ø©.');
                securityLogger.log('account_locked', `Account ${username} locked due to too many attempts`, 'critical');
                return;
            } else {
                // Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø§Ù„Ø¹Ø¯ Ø¨Ø¹Ø¯ 15 Ø¯Ù‚ÙŠÙ‚Ø©
                userAttempts.count = 0;
            }
        }
        
        // ØªØ´ÙÙŠØ± ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± Ø§Ù„Ù…Ø¯Ø®Ù„Ø© ÙˆÙ…Ù‚Ø§Ø±Ù†ØªÙ‡Ø§
        const hashedInput = await hashPassword(password);
        
        if (HASHED_USERS[username] && HASHED_USERS[username].password === hashedInput) {
            // Ù†Ø¬Ø§Ø­ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„
            currentUser = {
                username: username,
                role: HASHED_USERS[username].role,
                name: HASHED_USERS[username].name,
                loginTime: new Date().toISOString(),
                mustChangePassword: HASHED_USERS[username].mustChangePassword || false
            };
            
            // Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ù…Ø­Ø§ÙˆÙ„Ø§Øª Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø§Ù„ÙØ§Ø´Ù„Ø©
            delete loginAttempts[username];
            localStorage.setItem('shifa_login_attempts', JSON.stringify(loginAttempts));
            
            // Ø­ÙØ¸ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¬Ù„Ø³Ø©
            localStorage.setItem('shifa_user', JSON.stringify(currentUser));
            localStorage.setItem('shifa_last_login', new Date().toISOString());
            
            // Ø¨Ø¯Ø¡ Ø¬Ù„Ø³Ø© Ø¬Ø¯ÙŠØ¯Ø©
            sessionManager.startSession(currentUser);
            
            // ØªØ³Ø¬ÙŠÙ„ Ø­Ø¯Ø« Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø§Ù„Ù†Ø§Ø¬Ø­
            securityLogger.log('login_success', `User ${username} logged in successfully`, 'info');
            
            // Ø¥Ø¸Ù‡Ø§Ø± Ø§Ù„Ù…Ø­ØªÙˆÙ‰ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ
            document.getElementById('loginOverlay').classList.add('hidden-section');
            document.getElementById('mainContent').classList.remove('hidden-section');
            document.getElementById('currentUserDisplay').innerHTML = `ğŸ‘¤ <b>${currentUser.name}</b>`;
            
            // ØªØ­Ø¯ÙŠØ« ÙˆÙ‚Øª Ø¢Ø®Ø± Ø¯Ø®ÙˆÙ„
            document.getElementById('lastLoginTime').textContent = new Date().toLocaleString('ar-EG');
            
            // Ø§Ù„ØªØ­Ù‚Ù‚ Ø¥Ø°Ø§ ÙƒØ§Ù† ÙŠØ¬Ø¨ ØªØºÙŠÙŠØ± ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±
            if (currentUser.mustChangePassword) {
                setTimeout(() => {
                    showPasswordChangeModal();
                }, 1000);
            }
            
            // ØªØ¨Ø¯ÙŠÙ„ Ø§Ù„Ù‚Ø³Ù… Ø§Ù„Ù…Ù†Ø§Ø³Ø¨
            switchSection(currentUser.role === 'admin' ? 'admin' : currentUser.role);
            
            // Ø¥Ø´Ø¹Ø§Ø± Ø§Ù„Ù†Ø¬Ø§Ø­
            showNotification(`Ù…Ø±Ø­Ø¨Ø§Ù‹ ${currentUser.name}`, `ØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø¥Ù„Ù‰ Ù‚Ø³Ù… ${currentUser.name} Ø¨Ù†Ø¬Ø§Ø­!`);
            
        } else {
            // Ø²ÙŠØ§Ø¯Ø© Ø¹Ø¯Ø¯ Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø§Øª Ø§Ù„ÙØ§Ø´Ù„Ø©
            userAttempts.count++;
            userAttempts.lastAttempt = new Date().toISOString();
            loginAttempts[username] = userAttempts;
            localStorage.setItem('shifa_login_attempts', JSON.stringify(loginAttempts));
            
            // ØªØ³Ø¬ÙŠÙ„ Ø­Ø¯Ø« Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø§Ù„ÙØ§Ø´Ù„
            securityLogger.log('login_failed', `Failed login attempt for user ${username}`, 'warning');
            
            alert('âŒ Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø£Ùˆ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± ØºÙŠØ± ØµØ­ÙŠØ­Ø©!');
        }
    }

    // ============================================
    // Ø¯ÙˆØ§Ù„ Ù†Ø¸Ø§Ù… Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…ÙˆØ¸ÙÙŠÙ† Ø§Ù„Ù…Ø­Ø³Ù†Ø©
    // ============================================

    function initStaffMembers() {
        if (staffMembers.length === 0) {
            staffMembers = Object.keys(HASHED_USERS).map(username => ({
                id: Date.now() + Math.random(),
                username: username,
                password: HASHED_USERS[username].password,
                name: HASHED_USERS[username].name,
                role: HASHED_USERS[username].role,
                status: 'active',
                created: new Date().toISOString(),
                lastLogin: null,
                mustChangePassword: HASHED_USERS[username].mustChangePassword || false,
                passwordHistory: [HASHED_USERS[username].password],
                failedAttempts: 0
            }));
            saveSecureData('shifa_staff', staffMembers);
        }
    }

    function getRoleName(role) {
        const roles = {
            'admin': 'ğŸ‘‘ Ù…Ø¯ÙŠØ±',
            'doctor': 'ğŸ‘¨â€âš•ï¸ Ø·Ø¨ÙŠØ¨',
            'reception': 'ğŸ“‹ Ø§Ø³ØªÙ‚Ø¨Ø§Ù„',
            'pharmacy': 'ğŸ’Š ØµÙŠØ¯Ù„ÙŠ',
            'lab': 'ğŸ§ª Ù…Ø¹Ù…Ù„',
            'nursing': 'ğŸ’‰ ØªÙ…Ø±ÙŠØ¶'
        };
        return roles[role] || role;
    }

    function loadStaffList() {
        const container = document.getElementById('staffList');
        if (!container) return;
        
        container.innerHTML = staffMembers.map(staff => `
            <div class="col-md-6">
                <div class="card p-3 staff-card">
                    <div class="d-flex justify-content-between align-items-start">
                        <div>
                            <h6 class="mb-1">${staff.name}</h6>
                            <small class="text-muted">@${staff.username}</small>
                            <div class="mt-2">
                                <span class="staff-role-badge staff-${staff.role}">
                                    ${getRoleName(staff.role)}
                                </span>
                                <span class="badge ${staff.status === 'active' ? 'bg-success' : 'bg-secondary'}">
                                    ${staff.status === 'active' ? 'Ù†Ø´Ø·' : 'ØºÙŠØ± Ù†Ø´Ø·'}
                                </span>
                            </div>
                        </div>
                        <div class="btn-group">
                            <button class="btn btn-sm btn-outline-warning" onclick="editStaff('${staff.id}')">âœï¸</button>
                            <button class="btn btn-sm btn-outline-danger" onclick="confirmDeleteStaff('${staff.id}')">ğŸ—‘ï¸</button>
                        </div>
                    </div>
                    <div class="mt-2 small text-muted">
                        <div>ØªØ§Ø±ÙŠØ® Ø§Ù„Ø¥Ù†Ø´Ø§Ø¡: ${new Date(staff.created).toLocaleDateString('ar-EG')}</div>
                        ${staff.lastLogin ? `<div>Ø¢Ø®Ø± Ø¯Ø®ÙˆÙ„: ${new Date(staff.lastLogin).toLocaleDateString('ar-EG')}</div>` : ''}
                    </div>
                </div>
            </div>
        `).join('');
    }

    async function addNewStaff() {
        const username = document.getElementById('newStaffUsername').value.trim();
        const password = document.getElementById('newStaffPassword').value;
        const name = document.getElementById('newStaffName').value.trim();
        const role = document.getElementById('newStaffRole').value;
        
        if (!username || !password || !name || !role) {
            alert('âš ï¸ ÙŠØ±Ø¬Ù‰ Ù…Ù„Ø¡ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ„!');
            return;
        }
        
        // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ù‚ÙˆØ© ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±
        const passwordStrength = validatePasswordStrength(password);
        if (!passwordStrength.meetsRequirements) {
            alert('âš ï¸ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± ÙŠØ¬Ø¨ Ø£Ù† ØªØ­ØªÙˆÙŠ Ø¹Ù„Ù‰:\n- 8 Ø£Ø­Ø±Ù Ø¹Ù„Ù‰ Ø§Ù„Ø£Ù‚Ù„\n- Ø­Ø±Ù ÙƒØ¨ÙŠØ±\n- Ø­Ø±Ù ØµØºÙŠØ±\n- Ø±Ù‚Ù…\n- Ø±Ù…Ø² Ø®Ø§Øµ (!@#$%...)');
            return;
        }
        
        // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø¹Ø¯Ù… ØªÙƒØ±Ø§Ø± Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…
        if (staffMembers.some(staff => staff.username === username) || HASHED_USERS[username]) {
            alert('âš ï¸ Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ù…ÙˆØ¬ÙˆØ¯ Ø¨Ø§Ù„ÙØ¹Ù„!');
            return;
        }
        
        // ØªØ´ÙÙŠØ± ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± Ù‚Ø¨Ù„ Ø§Ù„Ø­ÙØ¸
        const hashedPassword = await hashPassword(password);
        
        const newStaff = {
            id: Date.now() + Math.random(),
            username: username,
            password: hashedPassword,
            name: name,
            role: role,
            status: 'active',
            created: new Date().toISOString(),
            lastLogin: null,
            mustChangePassword: true,
            passwordHistory: [hashedPassword],
            failedAttempts: 0
        };
        
        staffMembers.push(newStaff);
        
        // ØªØ­Ø¯ÙŠØ« Ø§Ù„ØªØ®Ø²ÙŠÙ† Ø§Ù„Ù…Ø­Ù„ÙŠ Ù…Ø¹ Ø§Ù„ØªØ´ÙÙŠØ±
        saveSecureData('shifa_staff', staffMembers);
        
        // ØªØ­Ø¯ÙŠØ« Ù‚Ø§Ø¹Ø¯Ø© Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†
        HASHED_USERS[username] = {
            password: hashedPassword,
            role: role,
            name: name,
            mustChangePassword: true
        };
        
        // ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø­Ø¯Ø«
        securityLogger.log('staff_added', `New staff member ${username} added by ${currentUser.username}`, 'info');
        
        // Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø§Ù„Ø­Ù‚ÙˆÙ„
        document.getElementById('newStaffUsername').value = '';
        document.getElementById('newStaffPassword').value = '';
        document.getElementById('newStaffName').value = '';
        document.getElementById('newStaffRole').value = '';
        
        loadStaffList();
        alert('âœ… ØªÙ… Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…ÙˆØ¸Ù Ø¨Ù†Ø¬Ø§Ø­!');
    }

    function editStaff(staffId) {
        const staff = staffMembers.find(s => s.id === staffId);
        if (!staff) return;
        
        document.getElementById('editStaffId').value = staffId;
        document.getElementById('editStaffUsername').value = staff.username;
        document.getElementById('editStaffName').value = staff.name;
        document.getElementById('editStaffRole').value = staff.role;
        document.getElementById('editStaffPassword').value = '';
        
        const modal = new bootstrap.Modal(document.getElementById('editStaffModal'));
        modal.show();
    }

    async function saveStaffChanges() {
        const staffId = document.getElementById('editStaffId').value;
        const staffIndex = staffMembers.findIndex(s => s.id === staffId);
        
        if (staffIndex === -1) return;
        
        const username = document.getElementById('editStaffUsername').value.trim();
        const name = document.getElementById('editStaffName').value.trim();
        const role = document.getElementById('editStaffRole').value;
        const password = document.getElementById('editStaffPassword').value;
        
        if (!username || !name || !role) {
            alert('âš ï¸ ÙŠØ±Ø¬Ù‰ Ù…Ù„Ø¡ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ„ Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©!');
            return;
        }
        
        // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø¹Ø¯Ù… ØªÙƒØ±Ø§Ø± Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…
        const duplicate = staffMembers.find((s, index) => 
            s.username === username && index !== staffIndex
        );
        if (duplicate) {
            alert('âš ï¸ Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ù…ÙˆØ¬ÙˆØ¯ Ø¨Ø§Ù„ÙØ¹Ù„!');
            return;
        }
        
        // Ø­ÙØ¸ Ø§Ù„ØªØºÙŠÙŠØ±Ø§Øª
        staffMembers[staffIndex].username = username;
        staffMembers[staffIndex].name = name;
        staffMembers[staffIndex].role = role;
        
        if (password) {
            // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ù‚ÙˆØ© ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±
            const passwordStrength = validatePasswordStrength(password);
            if (!passwordStrength.meetsRequirements) {
                alert('âš ï¸ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø© ÙŠØ¬Ø¨ Ø£Ù† ØªØ­ØªÙˆÙŠ Ø¹Ù„Ù‰:\n- 8 Ø£Ø­Ø±Ù Ø¹Ù„Ù‰ Ø§Ù„Ø£Ù‚Ù„\n- Ø­Ø±Ù ÙƒØ¨ÙŠØ±\n- Ø­Ø±Ù ØµØºÙŠØ±\n- Ø±Ù‚Ù…\n- Ø±Ù…Ø² Ø®Ø§Øµ');
                return;
            }
            
            // ØªØ´ÙÙŠØ± ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©
            const hashedPassword = await hashPassword(password);
            
            // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø¹Ø¯Ù… Ø§Ø³ØªØ®Ø¯Ø§Ù… ÙƒÙ„Ù…Ø© Ù…Ø±ÙˆØ± Ø³Ø§Ø¨Ù‚Ø©
            if (staffMembers[staffIndex].passwordHistory.includes(hashedPassword)) {
                alert('âš ï¸ Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø§Ø³ØªØ®Ø¯Ø§Ù… ÙƒÙ„Ù…Ø© Ù…Ø±ÙˆØ± Ø³Ø¨Ù‚ Ø§Ø³ØªØ®Ø¯Ø§Ù…Ù‡Ø§!');
                return;
            }
            
            staffMembers[staffIndex].password = hashedPassword;
            staffMembers[staffIndex].mustChangePassword = false;
            staffMembers[staffIndex].passwordHistory.push(hashedPassword);
            
            // Ø§Ù„Ø§Ø­ØªÙØ§Ø¸ Ø¨Ù€ 5 ÙƒÙ„Ù…Ø§Øª Ù…Ø±ÙˆØ± Ø³Ø§Ø¨Ù‚Ø© ÙÙ‚Ø·
            if (staffMembers[staffIndex].passwordHistory.length > 5) {
                staffMembers[staffIndex].passwordHistory.shift();
            }
        }
        
        saveSecureData('shifa_staff', staffMembers);
        
        // ØªØ­Ø¯ÙŠØ« USERS
        HASHED_USERS[username] = {
            password: staffMembers[staffIndex].password,
            role: role,
            name: name
        };
        
        const modal = bootstrap.Modal.getInstance(document.getElementById('editStaffModal'));
        modal.hide();
        
        loadStaffList();
        alert('âœ… ØªÙ… ØªØ­Ø¯ÙŠØ« Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…ÙˆØ¸Ù Ø¨Ù†Ø¬Ø§Ø­!');
    }

    function confirmDeleteStaff(staffId) {
        const staff = staffMembers.find(s => s.id === staffId);
        if (!staff) return;
        
        // Ù…Ù†Ø¹ Ø­Ø°Ù Ø§Ù„Ù…Ø¯ÙŠØ± Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ
        if (staff.username === 'admin') {
            alert('âš ï¸ Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø­Ø°Ù Ø­Ø³Ø§Ø¨ Ø§Ù„Ù…Ø¯ÙŠØ± Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ!');
            return;
        }
        
        // Ù…Ù†Ø¹ Ø­Ø°Ù Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø§Ù„Ø­Ø§Ù„ÙŠ
        if (currentUser && staff.username === currentUser.username) {
            alert('âš ï¸ Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø­Ø°Ù Ø­Ø³Ø§Ø¨Ùƒ Ø£Ø«Ù†Ø§Ø¡ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„!');
            return;
        }
        
        document.getElementById('deleteStaffId').value = staffId;
        const modal = new bootstrap.Modal(document.getElementById('confirmDeleteModal'));
        modal.show();
    }

    function deleteStaffConfirmed() {
        const staffId = document.getElementById('deleteStaffId').value;
        const staffIndex = staffMembers.findIndex(s => s.id === staffId);
        
        if (staffIndex === -1) return;
        
        const username = staffMembers[staffIndex].username;
        
        // Ø­Ø°Ù Ù…Ù† staffMembers
        staffMembers.splice(staffIndex, 1);
        saveSecureData('shifa_staff', staffMembers);
        
        // Ø­Ø°Ù Ù…Ù† HASHED_USERS
        delete HASHED_USERS[username];
        
        const modal = bootstrap.Modal.getInstance(document.getElementById('confirmDeleteModal'));
        modal.hide();
        
        loadStaffList();
        alert('âœ… ØªÙ… Ø­Ø°Ù Ø§Ù„Ù…ÙˆØ¸Ù Ø¨Ù†Ø¬Ø§Ø­!');
    }

    // ============================================
    // Ø¯ÙˆØ§Ù„ Ø§Ù„Ø±ÙˆØ´ØªØ© Ø§Ù„Ø·Ø¨ÙŠØ©
    // ============================================

    function addMedicineItem() {
        const container = document.getElementById('prescriptionItems');
        const itemId = Date.now();
        
        const itemHTML = `
            <div class="medicine-entry" id="medItem-${itemId}">
                <div class="row g-2 mb-2">
                    <div class="col-md-5">
                        <select class="form-select medicine-select" onchange="updateMedicineDetails(${itemId})">
                            <option value="">Ø§Ø®ØªØ± Ø§Ù„Ø¯ÙˆØ§Ø¡</option>
                            ${inventory.map(med => `<option value="${med.name}" data-price="${med.price}">${med.name} - ${med.price} Ø¬.Ø³</option>`).join('')}
                        </select>
                    </div>
                    <div class="col-md-2">
                        <input type="number" class="form-control qty-input" value="1" min="1" placeholder="Ø§Ù„ÙƒÙ…ÙŠØ©" onchange="updateMedicineDetails(${itemId})">
                    </div>
                    <div class="col-md-3">
                        <input type="text" class="form-control dosage-input" placeholder="Ø§Ù„Ø¬Ø±Ø¹Ø© (Ù…Ø«Ø§Ù„: 3 Ù…Ø±Ø§Øª ÙŠÙˆÙ…ÙŠØ§Ù‹)">
                    </div>
                    <div class="col-md-2">
                        <button class="btn btn-danger btn-sm w-100" onclick="removeMedicineItem(${itemId})">âœ•</button>
                    </div>
                </div>
                <div class="row">
                    <div class="col-md-8">
                        <input type="text" class="form-control notes-input" placeholder="Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ø¥Ø¶Ø§ÙÙŠØ©">
                    </div>
                    <div class="col-md-4">
                        <span class="badge bg-info price-display" id="price-${itemId}">0 Ø¬.Ø³</span>
                    </div>
                </div>
            </div>
        `;
        
        container.insertAdjacentHTML('beforeend', itemHTML);
        prescriptionItems.push({
            id: itemId,
            name: '',
            price: 0,
            qty: 1,
            dosage: '',
            notes: '',
            total: 0
        });
    }

    function removeMedicineItem(itemId) {
        const element = document.getElementById(`medItem-${itemId}`);
        if (element) {
            element.remove();
            prescriptionItems = prescriptionItems.filter(item => item.id !== itemId);
        }
    }

    function updateMedicineDetails(itemId) {
        const element = document.getElementById(`medItem-${itemId}`);
        if (!element) return;
        
        const select = element.querySelector('.medicine-select');
        const qtyInput = element.querySelector('.qty-input');
        const dosageInput = element.querySelector('.dosage-input');
        const notesInput = element.querySelector('.notes-input');
        const priceDisplay = element.querySelector('.price-display');
        
        const selectedMedicine = inventory.find(med => med.name === select.value);
        const qty = parseInt(qtyInput.value) || 1;
        
        const itemIndex = prescriptionItems.findIndex(item => item.id === itemId);
        if (itemIndex !== -1 && selectedMedicine) {
            prescriptionItems[itemIndex] = {
                id: itemId,
                name: selectedMedicine.name,
                price: selectedMedicine.price,
                qty: qty,
                dosage: dosageInput.value,
                notes: notesInput.value,
                total: selectedMedicine.price * qty
            };
            
            priceDisplay.textContent = `${prescriptionItems[itemIndex].total.toLocaleString()} Ø¬.Ø³`;
        }
    }

    function generatePrescription() {
        if (!activePatient) {
            alert('âš ï¸ ÙŠØ±Ø¬Ù‰ Ø§Ø®ØªÙŠØ§Ø± Ù…Ø±ÙŠØ¶ Ø£ÙˆÙ„Ø§Ù‹');
            return;
        }
        
        if (prescriptionItems.length === 0) {
            alert('âš ï¸ ÙŠØ±Ø¬Ù‰ Ø¥Ø¶Ø§ÙØ© Ø£Ø¯ÙˆÙŠØ© Ù„Ù„Ø±ÙˆØ´ØªØ©');
            return;
        }
        
        const totalAmount = prescriptionItems.reduce((sum, item) => sum + item.total, 0);
        
        const prescriptionHTML = `
            <div class="prescription-header text-center mb-4">
                <h4>ğŸ¥ Ù…Ø¬Ù…Ø¹ Ø§Ù„Ø´ÙØ§Ø¡ Ø§Ù„Ø·Ø¨ÙŠ</h4>
                <p>Ø§Ù„Ø³ÙˆØ¯Ø§Ù† - Ø¬Ù„Ù‚Ù†ÙŠ</p>
            </div>
            
            <div class="row mb-4">
                <div class="col-md-6">
                    <h5>Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ù…Ø±ÙŠØ¶</h5>
                    <p><strong>Ø§Ù„Ø§Ø³Ù…:</strong> ${activePatient.name}</p>
                    <p><strong>Ø§Ù„Ø¹Ù…Ø±:</strong> ${activePatient.age || '--'}</p>
                    <p><strong>Ø§Ù„ØªØ§Ø±ÙŠØ®:</strong> ${new Date().toLocaleDateString('ar-EG')}</p>
                </div>
                <div class="col-md-6">
                    <h5>Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø·Ø¨ÙŠØ¨</h5>
                    <p><strong>Ø§Ù„Ø·Ø¨ÙŠØ¨:</strong> Ø¯. ${currentUser?.name || 'Ø·Ø¨ÙŠØ¨'}</p>
                    <p><strong>Ø§Ù„ØªÙˆÙ‚ÙŠØ¹:</strong> ________________</p>
                </div>
            </div>
            
            <div class="mb-4">
                <h5>Ø§Ù„ØªØ´Ø®ÙŠØµ:</h5>
                <p class="p-3 bg-light rounded">${document.getElementById('diagnosis').value || 'Ù„Ø§ ÙŠÙˆØ¬Ø¯ ØªØ´Ø®ÙŠØµ Ù…Ø­Ø¯Ø¯'}</p>
            </div>
            
            <div class="mb-4">
                <h5>Ø§Ù„Ø£Ø¯ÙˆÙŠØ© Ø§Ù„Ù…ÙˆØµÙˆÙØ©:</h5>
                <table class="table table-bordered">
                    <thead class="table-primary">
                        <tr>
                            <th>#</th>
                            <th>Ø§Ø³Ù… Ø§Ù„Ø¯ÙˆØ§Ø¡</th>
                            <th>Ø§Ù„ÙƒÙ…ÙŠØ©</th>
                            <th>Ø§Ù„Ø¬Ø±Ø¹Ø©</th>
                            <th>Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø§Øª</th>
                            <th>Ø§Ù„Ø³Ø¹Ø±</th>
                        </tr>
                    </thead>
                    <tbody>
                        ${prescriptionItems.map((item, index) => `
                            <tr>
                                <td>${index + 1}</td>
                                <td>${item.name}</td>
                                <td>${item.qty}</td>
                                <td>${item.dosage || '--'}</td>
                                <td>${item.notes || '--'}</td>
                                <td>${item.total.toLocaleString()} Ø¬.Ø³</td>
                            </tr>
                        `).join('')}
                    </tbody>
                    <tfoot class="table-success">
                        <tr>
                            <td colspan="5" class="text-end"><strong>Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ:</strong></td>
                            <td><strong>${totalAmount.toLocaleString()} Ø¬.Ø³</strong></td>
                        </tr>
                    </tfoot>
                </table>
            </div>
            
            <div class="alert alert-info">
                <h6>ğŸ“‹ ØªØ¹Ù„ÙŠÙ…Ø§Øª Ø¹Ø§Ù…Ø©:</h6>
                <ul>
                    <li>ÙŠØ¬Ø¨ ØªÙ†Ø§ÙˆÙ„ Ø§Ù„Ø£Ø¯ÙˆÙŠØ© Ø­Ø³Ø¨ Ø§Ù„ØªØ¹Ù„ÙŠÙ…Ø§Øª</li>
                    <li>Ù…Ø±Ø§Ø¬Ø¹Ø© Ø§Ù„Ø·Ø¨ÙŠØ¨ ÙÙŠ Ø­Ø§Ù„Ø© Ø¸Ù‡ÙˆØ± Ø£ÙŠ Ø£Ø¹Ø±Ø§Ø¶ Ø¬Ø§Ù†Ø¨ÙŠØ©</li>
                    <li>Ø§Ù„Ø­ÙØ§Ø¸ Ø¹Ù„Ù‰ Ù…ÙˆØ§Ø¹ÙŠØ¯ Ø§Ù„Ø¬Ø±Ø¹Ø§Øª Ø¨Ø¯Ù‚Ø©</li>
                </ul>
            </div>
            
            <div class="text-center mt-4">
                <p>_________________________________</p>
                <p><strong>ØªÙˆÙ‚ÙŠØ¹ Ø§Ù„Ø·Ø¨ÙŠØ¨</strong></p>
                <p>Ø¯. ${currentUser?.name || 'Ø·Ø¨ÙŠØ¨'}</p>
            </div>
        `;
        
        document.getElementById('prescriptionContent').innerHTML = prescriptionHTML;
        
        // Ø­ÙØ¸ Ø§Ù„Ø±ÙˆØ´ØªØ© ÙÙŠ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø±ÙŠØ¶
        activePatient.prescription = {
            date: new Date().toISOString(),
            doctor: currentUser?.name || 'Ø·Ø¨ÙŠØ¨',
            diagnosis: document.getElementById('diagnosis').value,
            medicines: prescriptionItems,
            totalAmount: totalAmount
        };
        
        saveData();
        
        const modal = new bootstrap.Modal(document.getElementById('prescriptionModal'));
        modal.show();
    }

    function printPrescription() {
        const printContent = document.getElementById('prescriptionContent').innerHTML;
        
        document.getElementById('printTitle').textContent = 'Ø±ÙˆØ´ØªØ© Ø·Ø¨ÙŠØ©';
        document.getElementById('printDate').textContent = new Date().toLocaleDateString('ar-EG');
        document.getElementById('printDoctorName').textContent = currentUser?.name || 'Ø·Ø¨ÙŠØ¨';
        document.getElementById('printContent').innerHTML = printContent;
        
        // Ø·Ø¨Ø§Ø¹Ø© Ø§Ù„Ø±ÙˆØ´ØªØ©
        setTimeout(() => {
            window.print();
        }, 500);
    }

    // ============================================
    // Ø¯ÙˆØ§Ù„ Ù‚Ø³Ù… Ø§Ù„ØµÙŠØ¯Ù„ÙŠØ© - Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª Ø§Ù„ÙŠÙˆÙ…ÙŠØ©
    // ============================================

    function loadDailySales() {
        document.getElementById('dailySalesTotal').textContent = dailySales.total.toLocaleString();
        
        const container = document.getElementById('dailyPrescriptionsList');
        container.innerHTML = dailySales.prescriptions.map((pres, index) => `
            <div class="prescription-list-item">
                <div class="d-flex justify-content-between">
                    <div>
                        <strong>${index + 1}. ${pres.patientName}</strong>
                        <small class="d-block">${pres.date}</small>
                    </div>
                    <div class="text-end">
                        <span class="badge bg-success">${pres.totalAmount.toLocaleString()} Ø¬.Ø³</span>
                    </div>
                </div>
                <div class="mt-2">
                    <small><strong>Ø§Ù„Ø£Ø¯ÙˆÙŠØ©:</strong> ${pres.medicines.map(m => `${m.name} (${m.qty})`).join('ØŒ ')}</small>
                </div>
            </div>
        `).join('');
    }

    function resetDailySales() {
        if (confirm('Ù‡Ù„ ØªØ±ÙŠØ¯ ØªØµÙÙŠØ± Ø¹Ø¯Ø§Ø¯ Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª Ø§Ù„ÙŠÙˆÙ…ÙŠØ©ØŸ Ø³ÙŠØªÙ… Ø­Ø°Ù Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø±ÙˆØ´ØªØ§Øª Ø§Ù„Ù…Ø³Ø¬Ù„Ø© Ø§Ù„ÙŠÙˆÙ….')) {
            dailySales = {
                total: 0,
                prescriptions: []
            };
            saveSecureData('shifa_daily_sales', dailySales);
            loadDailySales();
            alert('âœ… ØªÙ… ØªØµÙÙŠØ± Ø¹Ø¯Ø§Ø¯ Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª Ø§Ù„ÙŠÙˆÙ…ÙŠØ©');
        }
    }

    // ============================================
    // Ø¯ÙˆØ§Ù„ Ù‚Ø³Ù… Ø§Ù„Ù…Ø¹Ù…Ù„ - Ù†ØªØ§Ø¦Ø¬ Ø§Ù„ÙØ­ÙˆØµØ§Øª
    // ============================================

    function loadLab() {
        const list = document.getElementById('labList');
        const waiting = patients.filter(p => p.status === 'waiting_lab');
        
        list.innerHTML = waiting.map(p => {
            const total = p.tests?.reduce((s, t) => s + t.price, 0) || 0;
            return `
            <div class="col-md-6">
                <div class="card p-3 border-start border-danger border-5">
                    <h6>${p.name} <span class="badge bg-dark float-end">${total} Ø¬.Ø³</span></h6>
                    ${(p.tests || []).map((t, i) => `
                        <div class="mb-2">
                            <label>${t.name}:</label>
                            <div class="input-group">
                                <input type="text" class="form-control form-control-sm" 
                                       id="labResult-${p.id}-${i}"
                                       placeholder="Ø£Ø¯Ø®Ù„ Ù†ØªÙŠØ¬Ø© ${t.name}"
                                       value="${t.result || ''}"
                                       onchange="updateLabResult(${p.id}, ${i}, this.value)">
                                <span class="input-group-text">${t.price} Ø¬.Ø³</span>
                            </div>
                        </div>
                    `).join('')}
                    <button class="btn btn-danger btn-sm w-100 mt-2" onclick="finishLab(${p.id})">âœ… Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ù†ØªØ§Ø¦Ø¬ Ù„Ù„Ø·Ø¨ÙŠØ¨</button>
                </div>
            </div>`;
        }).join('');
    }

    function updateLabResult(patientId, testIndex, result) {
        const patient = patients.find(p => p.id === patientId);
        if (patient && patient.tests && patient.tests[testIndex]) {
            patient.tests[testIndex].result = result;
            saveData();
        }
    }

    function finishLab(id) { 
        const patient = patients.find(x => x.id === id);
        if (patient) {
            patient.status = 'waiting_doctor';
            
            // Ø¥Ø¶Ø§ÙØ© Ù†ØªØ§Ø¦Ø¬ Ø§Ù„ÙØ­ÙˆØµØ§Øª Ø¥Ù„Ù‰ Ø³Ø¬Ù„ Ø§Ù„Ù…Ø±ÙŠØ¶
            if (!patient.labResults) patient.labResults = [];
            patient.labResults.push({
                date: new Date().toISOString(),
                tests: patient.tests || [],
                technician: currentUser?.name || 'ÙÙ†ÙŠ Ù…Ø¹Ù…Ù„'
            });
            
            saveData(); 
            loadLab(); 
            playNotify();
            alert('âœ… ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ù†ØªØ§Ø¦Ø¬ Ø§Ù„ÙØ­ÙˆØµØ§Øª Ù„Ù„Ø·Ø¨ÙŠØ¨');
        }
    }

    // ============================================
    // Ø¯ÙˆØ§Ù„ Ù‚Ø³Ù… Ø§Ù„Ø¹ÙŠØ§Ø¯Ø© - Ø¹Ø±Ø¶ Ù†ØªØ§Ø¦Ø¬ Ø§Ù„ÙØ­ÙˆØµØ§Øª
    // ============================================

    function displayLabResults() {
        if (!activePatient || !activePatient.labResults || activePatient.labResults.length === 0) {
            document.getElementById('labResultsPanel').classList.add('hidden-section');
            return;
        }
        
        const latestResults = activePatient.labResults[activePatient.labResults.length - 1];
        const display = document.getElementById('labResultsDisplay');
        
        let resultsHTML = `
            <div class="mb-2">
                <strong>ğŸ“… ØªØ§Ø±ÙŠØ® Ø§Ù„ÙØ­Øµ:</strong> ${new Date(latestResults.date).toLocaleDateString('ar-EG')}
                <span class="lab-result-badge ms-2">${latestResults.technician}</span>
            </div>
            <div class="table-responsive">
                <table class="table table-sm table-bordered">
                    <thead class="table-info">
                        <tr>
                            <th>Ø§Ø³Ù… Ø§Ù„ÙØ­Øµ</th>
                            <th>Ø§Ù„Ù†ØªÙŠØ¬Ø©</th>
                            <th>Ø§Ù„Ø³Ø¹Ø±</th>
                        </tr>
                    </thead>
                    <tbody>
                        ${(latestResults.tests || []).map(test => `
                            <tr>
                                <td>${test.name}</td>
                                <td><strong>${test.result || 'Ù„Ù… ÙŠØªÙ… Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„Ù†ØªÙŠØ¬Ø©'}</strong></td>
                                <td>${test.price} Ø¬.Ø³</td>
                            </tr>
                        `).join('')}
                    </tbody>
                </table>
            </div>
        `;
        
        display.innerHTML = resultsHTML;
        document.getElementById('labResultsPanel').classList.remove('hidden-section');
    }

    // ============================================
    // Ø§Ù„Ø¯ÙˆØ§Ù„ Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ© Ø§Ù„Ø£Ø®Ø±Ù‰
    // ============================================

    function showNotification(title, message) {
        if ('Notification' in window && Notification.permission === 'granted') {
            new Notification(title, { body: message, icon: 'https://cdn-icons-png.flaticon.com/512/822/822118.png' });
        }
        playNotify();
    }

    function playNotify() {
        const audio = document.getElementById('notificationSound');
        if (audio) {
            audio.currentTime = 0;
            audio.play().catch(e => console.log('Audio play failed:', e));
        }
    }

    function logout() {
        if (confirm('Ù‡Ù„ ØªØ±ÙŠØ¯ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬ØŸ')) {
            localStorage.removeItem('shifa_user');
            currentUser = null;
            location.reload();
        }
    }

    function switchSection(section) {
        // Ø¥Ø®ÙØ§Ø¡ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø£Ù‚Ø³Ø§Ù…
        document.querySelectorAll('.section-pane').forEach(el => el.classList.add('hidden-section'));
        document.querySelectorAll('.nav-link').forEach(el => el.classList.remove('active'));
        
        // Ø¥Ø¸Ù‡Ø§Ø± Ø§Ù„Ù‚Ø³Ù… Ø§Ù„Ù…Ø·Ù„ÙˆØ¨
        document.getElementById(`${section}-sec`).classList.remove('hidden-section');
        document.getElementById(`btn-${section}`).classList.add('active');
        
        // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù…Ø­ØªÙˆÙ‰ Ø­Ø³Ø¨ Ø§Ù„Ù‚Ø³Ù…
        switch(section) {
            case 'reception':
                loadReception();
                break;
            case 'doctor':
                loadDoctor();
                break;
            case 'lab':
                loadLab();
                break;
            case 'pharmacy':
                loadPharmacy();
                loadDailySales();
                break;
            case 'nursing':
                loadNursing();
                break;
            case 'admin':
                loadAdminDashboard();
                break;
        }
    }

    function loadReception() {
        const list = document.getElementById('receptionList');
        const today = new Date().toDateString();
        const todayPatients = patients.filter(p => new Date(p.date).toDateString() === today);
        
        list.innerHTML = todayPatients.map(p => `
            <div class="patient-btn ${p.status === 'completed' ? 'ready' : ''}">
                <div class="d-flex justify-content-between">
                    <div>
                        <strong>${p.name}</strong>
                        <small class="d-block">Ø§Ù„Ø¹Ù…Ø±: ${p.age} | Ø§Ù„Ø¹Ù†ÙˆØ§Ù†: ${p.address}</small>
                    </div>
                    <div>
                        <span class="badge ${getStatusBadge(p.status)}">${getStatusText(p.status)}</span>
                        <small class="d-block text-muted">${new Date(p.date).toLocaleTimeString('ar-EG')}</small>
                    </div>
                </div>
            </div>
        `).join('');
    }

    function getStatusBadge(status) {
        switch(status) {
            case 'waiting_doctor': return 'bg-warning';
            case 'waiting_lab': return 'bg-danger';
            case 'waiting_pharmacy': return 'bg-info';
            case 'waiting_nursing': return 'bg-purple';
            case 'completed': return 'bg-success';
            default: return 'bg-secondary';
        }
    }

    function getStatusText(status) {
        switch(status) {
            case 'waiting_doctor': return 'Ø¨Ø§Ù†ØªØ¸Ø§Ø± Ø§Ù„Ø·Ø¨ÙŠØ¨';
            case 'waiting_lab': return 'Ø¨Ø§Ù†ØªØ¸Ø§Ø± Ø§Ù„Ù…Ø¹Ù…Ù„';
            case 'waiting_pharmacy': return 'Ø¨Ø§Ù†ØªØ¸Ø§Ø± Ø§Ù„ØµÙŠØ¯Ù„ÙŠØ©';
            case 'waiting_nursing': return 'Ø¨Ø§Ù†ØªØ¸Ø§Ø± Ø§Ù„ØªÙ…Ø±ÙŠØ¶';
            case 'completed': return 'Ù…ÙƒØªÙ…Ù„';
            default: return 'Ø¬Ø¯ÙŠØ¯';
        }
    }

    function registerPatient() {
        const name = document.getElementById('pName').value.trim();
        const age = document.getElementById('pAge').value;
        const address = document.getElementById('pAddress').value.trim();
        const ticket = document.getElementById('pTicket').value;
        
        if (!name) {
            alert('âš ï¸ ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ø³Ù… Ø§Ù„Ù…Ø±ÙŠØ¶');
            return;
        }
        
        const newPatient = {
            id: Date.now(),
            name: name,
            age: age,
            address: address,
            ticket: parseInt(ticket) || 2000,
            status: 'waiting_doctor',
            date: new Date().toISOString(),
            tests: [],
            prescription: null,
            labResults: []
        };
        
        patients.push(newPatient);
        saveData();
        
        // Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø§Ù„Ø­Ù‚ÙˆÙ„
        document.getElementById('pName').value = '';
        document.getElementById('pAge').value = '';
        document.getElementById('pAddress').value = '';
        
        loadReception();
        alert('âœ… ØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ù…Ø±ÙŠØ¶ Ø¨Ù†Ø¬Ø§Ø­ ÙˆØ¥Ø±Ø³Ø§Ù„Ù‡ Ù„Ù„Ø·Ø¨ÙŠØ¨');
    }

    function loadDoctor() {
        const queue = document.getElementById('doctorQueue');
        const waiting = patients.filter(p => p.status === 'waiting_doctor');
        
        queue.innerHTML = waiting.map(p => `
            <button class="patient-btn" onclick="selectPatient(${p.id})">
                <div class="d-flex justify-content-between">
                    <div>
                        <strong>${p.name}</strong>
                        <small class="d-block">Ø§Ù„Ø¹Ù…Ø±: ${p.age}</small>
                    </div>
                    <div>
                        <small class="text-muted">${new Date(p.date).toLocaleTimeString('ar-EG')}</small>
                    </div>
                </div>
            </button>
        `).join('');
        
        document.getElementById('doctorBadge').textContent = waiting.length;
        document.getElementById('doctorBadge').classList.toggle('hidden-section', waiting.length === 0);
    }

    function selectPatient(patientId) {
        activePatient = patients.find(p => p.id === patientId);
        if (!activePatient) return;
        
        document.getElementById('currentPatientName').textContent = `Ø§Ù„Ù…Ø±ÙŠØ¶: ${activePatient.name}`;
        document.getElementById('doctorWorkArea').classList.remove('hidden-section');
        
        // ØªØ¹Ø¨Ø¦Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¥Ø°Ø§ ÙƒØ§Ù†Øª Ù…ÙˆØ¬ÙˆØ¯Ø©
        document.getElementById('complaint').value = activePatient.complaint || '';
        document.getElementById('diagnosis').value = activePatient.diagnosis || '';
        
        // ØªØ­Ù…ÙŠÙ„ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„ÙØ­ÙˆØµØ§Øª
        const labSelect = document.getElementById('labSelect');
        labSelect.innerHTML = labTests.map(test => 
            `<option value="${test.name}" data-price="${test.price}">${test.name} - ${test.price} Ø¬.Ø³</option>`
        ).join('');
        
        // Ø¹Ø±Ø¶ Ù†ØªØ§Ø¦Ø¬ Ø§Ù„ÙØ­ÙˆØµØ§Øª Ø¥Ø°Ø§ ÙƒØ§Ù†Øª Ù…ÙˆØ¬ÙˆØ¯Ø©
        displayLabResults();
    }

    function orderLab() {
        if (!activePatient) {
            alert('âš ï¸ ÙŠØ±Ø¬Ù‰ Ø§Ø®ØªÙŠØ§Ø± Ù…Ø±ÙŠØ¶ Ø£ÙˆÙ„Ø§Ù‹');
            return;
        }
        
        const selectedTests = Array.from(document.getElementById('labSelect').selectedOptions);
        if (selectedTests.length === 0) {
            alert('âš ï¸ ÙŠØ±Ø¬Ù‰ Ø§Ø®ØªÙŠØ§Ø± ÙØ­ÙˆØµØ§Øª Ù„Ù„Ù…Ø¹Ù…Ù„');
            return;
        }
        
        const tests = selectedTests.map(option => ({
            name: option.value,
            price: parseInt(option.dataset.price),
            result: ''
        }));
        
        activePatient.tests = tests;
        activePatient.status = 'waiting_lab';
        activePatient.labOrderTime = new Date().toISOString();
        
        saveData();
        loadDoctor();
        alert('âœ… ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø·Ù„Ø¨ Ø§Ù„ÙØ­ÙˆØµØ§Øª Ù„Ù„Ù…Ø¹Ù…Ù„');
    }

    function orderPharmacy() {
        if (!activePatient || prescriptionItems.length === 0) {
            alert('âš ï¸ ÙŠØ±Ø¬Ù‰ Ø¥Ù†Ø´Ø§Ø¡ Ø±ÙˆØ´ØªØ© Ø·Ø¨ÙŠØ© Ø£ÙˆÙ„Ø§Ù‹');
            return;
        }
        
        activePatient.status = 'waiting_pharmacy';
        activePatient.prescription = {
            date: new Date().toISOString(),
            doctor: currentUser?.name || 'Ø·Ø¨ÙŠØ¨',
            diagnosis: document.getElementById('diagnosis').value,
            medicines: prescriptionItems,
            totalAmount: prescriptionItems.reduce((sum, item) => sum + item.total, 0)
        };
        
        saveData();
        loadDoctor();
        alert('âœ… ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø±ÙˆØ´ØªØ© Ù„Ù„ØµÙŠØ¯Ù„ÙŠØ©');
    }

    function orderNurse() {
        if (!activePatient) {
            alert('âš ï¸ ÙŠØ±Ø¬Ù‰ Ø§Ø®ØªÙŠØ§Ø± Ù…Ø±ÙŠØ¶ Ø£ÙˆÙ„Ø§Ù‹');
            return;
        }
        
        const notes = document.getElementById('nurseNotes').value.trim();
        if (!notes) {
            alert('âš ï¸ ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ ØªØ¹Ù„ÙŠÙ…Ø§Øª Ù„Ù„ØªÙ…Ø±ÙŠØ¶');
            return;
        }
        
        activePatient.nursingNotes = notes;
        activePatient.status = 'waiting_nursing';
        
        saveData();
        loadDoctor();
        alert('âœ… ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„ØªØ¹Ù„ÙŠÙ…Ø§Øª Ù„Ù„ØªÙ…Ø±ÙŠØ¶');
    }

    function completeVisit() {
        if (!activePatient) {
            alert('âš ï¸ ÙŠØ±Ø¬Ù‰ Ø§Ø®ØªÙŠØ§Ø± Ù…Ø±ÙŠØ¶ Ø£ÙˆÙ„Ø§Ù‹');
            return;
        }
        
        if (confirm('Ù‡Ù„ ØªØ±ÙŠØ¯ Ø¥Ù†Ù‡Ø§Ø¡ Ø²ÙŠØ§Ø±Ø© Ø§Ù„Ù…Ø±ÙŠØ¶ Ø¨Ø§Ù„ÙƒØ§Ù…Ù„ØŸ')) {
            activePatient.status = 'completed';
            activePatient.completionTime = new Date().toISOString();
            
            // Ø­Ø³Ø§Ø¨ Ø§Ù„Ø¥ÙŠØ±Ø§Ø¯Ø§Øª
            const ticketPrice = activePatient.ticket || 2000;
            const labPrice = (activePatient.tests || []).reduce((sum, test) => sum + test.price, 0);
            const medPrice = (prescriptionItems || []).reduce((sum, item) => sum + item.total, 0);
            
            financials.clinic += ticketPrice;
            financials.lab += labPrice;
            financials.pharSales += medPrice;
            financials.total = financials.clinic + financials.lab + financials.pharSales;
            
            saveData();
            loadDoctor();
            alert('âœ… ØªÙ… Ø¥Ù†Ù‡Ø§Ø¡ Ø²ÙŠØ§Ø±Ø© Ø§Ù„Ù…Ø±ÙŠØ¶ Ø¨Ù†Ø¬Ø§Ø­');
        }
    }

    function loadPharmacy() {
        const list = document.getElementById('pharmacyList');
        const waiting = patients.filter(p => p.status === 'waiting_pharmacy');
        
        list.innerHTML = waiting.map(p => {
            const total = p.prescription?.totalAmount || 0;
            return `
            <div class="col-md-6">
                <div class="card p-3 border-start border-warning border-5">
                    <h6>${p.name} <span class="badge bg-success float-end">${total.toLocaleString()} Ø¬.Ø³</span></h6>
                    ${(p.prescription?.medicines || []).map((med, i) => `
                        <div class="mb-1">
                            <small>${med.name} Ã— ${med.qty} = ${med.total.toLocaleString()} Ø¬.Ø³</small>
                        </div>
                    `).join('')}
                    <button class="btn btn-warning btn-sm w-100 mt-2" onclick="dispenseMedicine(${p.id})">ğŸ’Š ØµØ±Ù Ø§Ù„Ø£Ø¯ÙˆÙŠØ©</button>
                </div>
            </div>`;
        }).join('');
        
        document.getElementById('pharBadge').textContent = waiting.length;
        document.getElementById('pharBadge').classList.toggle('hidden-section', waiting.length === 0);
    }

    function dispenseMedicine(patientId) {
        const patient = patients.find(p => p.id === patientId);
        if (!patient || !patient.prescription) return;
        
        // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ØªÙˆÙØ± Ø§Ù„Ù…Ø®Ø²ÙˆÙ†
        const missingMeds = [];
        patient.prescription.medicines.forEach(med => {
            const inventoryItem = inventory.find(item => item.name === med.name);
            if (!inventoryItem || inventoryItem.qty < med.qty) {
                missingMeds.push(med.name);
            }
        });
        
        if (missingMeds.length > 0) {
            alert(`âš ï¸ Ø§Ù„Ø£Ø¯ÙˆÙŠØ© Ø§Ù„ØªØ§Ù„ÙŠØ© ØºÙŠØ± Ù…ØªÙˆÙØ±Ø© Ø¨Ø§Ù„ÙƒÙ…ÙŠØ© Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©:\n${missingMeds.join('\n')}`);
            return;
        }
        
        // Ø®ØµÙ… Ù…Ù† Ø§Ù„Ù…Ø®Ø²ÙˆÙ†
        patient.prescription.medicines.forEach(med => {
            const inventoryItem = inventory.find(item => item.name === med.name);
            if (inventoryItem) {
                inventoryItem.qty -= med.qty;
            }
        });
        
        // ØªØ­Ø¯ÙŠØ« Ø­Ø§Ù„Ø© Ø§Ù„Ù…Ø±ÙŠØ¶
        patient.status = 'completed';
        patient.pharmacyTime = new Date().toISOString();
        
        // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª Ø§Ù„ÙŠÙˆÙ…ÙŠØ©
        dailySales.total += patient.prescription.totalAmount;
        dailySales.prescriptions.push({
            patientName: patient.name,
            date: new Date().toLocaleString('ar-EG'),
            medicines: patient.prescription.medicines,
            totalAmount: patient.prescription.totalAmount
        });
        
        saveData();
        loadPharmacy();
        loadDailySales();
        alert('âœ… ØªÙ… ØµØ±Ù Ø§Ù„Ø£Ø¯ÙˆÙŠØ© Ø¨Ù†Ø¬Ø§Ø­');
    }

    function loadNursing() {
        const list = document.getElementById('nurseList');
        const waiting = patients.filter(p => p.status === 'waiting_nursing');
        
        list.innerHTML = waiting.map(p => `
            <div class="col-md-6">
                <div class="card p-3 border-start border-purple border-5">
                    <h6>${p.name}</h6>
                    <p class="mb-2">${p.nursingNotes || 'Ù„Ø§ ØªÙˆØ¬Ø¯ ØªØ¹Ù„ÙŠÙ…Ø§Øª'}</p>
                    <button class="btn btn-purple btn-sm w-100" onclick="completeNursing(${p.id})">âœ… ØªÙ… Ø¥Ø¹Ø·Ø§Ø¡ Ø§Ù„Ø¥Ø¨Ø±Ø©/Ø§Ù„Ø¯Ø±ÙŠØ¨Ø§Øª</button>
                </div>
            </div>
        `).join('');
        
        document.getElementById('nurseBadge').textContent = waiting.length;
        document.getElementById('nurseBadge').classList.toggle('hidden-section', waiting.length === 0);
    }

    function completeNursing(patientId) {
        const patient = patients.find(p => p.id === patientId);
        if (!patient) return;
        
        patient.status = 'completed';
        patient.nursingTime = new Date().toISOString();
        
        saveData();
        loadNursing();
        alert('âœ… ØªÙ… Ø¥ÙƒÙ…Ø§Ù„ Ø§Ù„Ù…Ù‡Ù…Ø© Ø§Ù„ØªÙ…Ø±ÙŠØ¶ÙŠØ©');
    }

    function loadAdminDashboard() {
        document.getElementById('admIncClinic').textContent = financials.clinic.toLocaleString();
        document.getElementById('admIncLab').textContent = financials.lab.toLocaleString();
        document.getElementById('admIncPhar').textContent = financials.pharSales.toLocaleString();
        document.getElementById('admIncTotal').textContent = financials.total.toLocaleString();
        
        // ØªØ­Ù…ÙŠÙ„ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…ÙˆØ¸ÙÙŠÙ†
        loadStaffList();
    }

    function switchAdminTab(tab) {
        // Ø¥Ø®ÙØ§Ø¡ Ø¬Ù…ÙŠØ¹ Ø§Ù„ØªØ¨ÙˆÙŠØ¨Ø§Øª
        document.querySelectorAll('.admin-tab-content').forEach(el => el.classList.add('hidden-section'));
        document.querySelectorAll('.admin-tab-btn').forEach(el => el.classList.remove('active'));
        
        // Ø¥Ø¸Ù‡Ø§Ø± Ø§Ù„ØªØ¨ÙˆÙŠØ¨ Ø§Ù„Ù…Ø·Ù„ÙˆØ¨
        document.getElementById(`admin-${tab}`).classList.remove('hidden-section');
        document.querySelector(`[onclick="switchAdminTab('${tab}')"]`).classList.add('active');
        
        // ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ø­ØªÙˆÙ‰ Ø­Ø³Ø¨ Ø§Ù„ØªØ¨ÙˆÙŠØ¨
        switch(tab) {
            case 'dashboard':
                loadAdminDashboard();
                break;
            case 'staff':
                loadStaffList();
                break;
            case 'inventory':
                loadInventory();
                break;
            case 'security':
                loadSecurityLogs();
                break;
        }
    }

    function loadInventory() {
        // ØªØ­Ø¯ÙŠØ« Ø¬Ø¯Ø§ÙˆÙ„ Ø§Ù„Ù…Ø®Ø²ÙˆÙ†
        const labTable = document.getElementById('labTestsTable');
        labTable.innerHTML = labTests.map((test, index) => `
            <tr>
                <td>${index + 1}</td>
                <td>${test.name}</td>
                <td>${test.price.toLocaleString()}</td>
                <td>
                    <button class="btn btn-sm btn-outline-danger" onclick="deleteLabTest(${index})">ğŸ—‘ï¸</button>
                </td>
            </tr>
        `).join('');
        
        const inventoryTable = document.getElementById('inventoryTable');
        let totalValue = 0;
        inventoryTable.innerHTML = inventory.map((item, index) => {
            const value = item.price * item.qty;
            totalValue += value;
            return `
            <tr>
                <td>${index + 1}</td>
                <td>${item.name}</td>
                <td>${item.price.toLocaleString()}</td>
                <td>${item.qty}</td>
                <td>${value.toLocaleString()}</td>
                <td>
                    <button class="btn btn-sm btn-outline-warning" onclick="editMedicine(${index})">âœï¸</button>
                    <button class="btn btn-sm btn-outline-danger" onclick="deleteMedicine(${index})">ğŸ—‘ï¸</button>
                </td>
            </tr>
            `;
        }).join('');
        
        document.getElementById('totalStockValue').textContent = totalValue.toLocaleString();
        document.getElementById('totalTestsCount').textContent = labTests.length;
        document.getElementById('totalMedsCount').textContent = inventory.length;
        document.getElementById('totalInventoryValue').textContent = totalValue.toLocaleString() + ' Ø¬.Ø³';
    }

    function addNewLabTest() {
        const name = document.getElementById('newTestName').value.trim();
        const price = parseInt(document.getElementById('newTestPrice').value);
        
        if (!name || !price) {
            alert('âš ï¸ ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ø³Ù… Ø§Ù„ÙØ­Øµ ÙˆØ³Ø¹Ø±Ù‡');
            return;
        }
        
        labTests.push({ name, price });
        saveData();
        loadInventory();
        
        document.getElementById('newTestName').value = '';
        document.getElementById('newTestPrice').value = '';
        
        alert('âœ… ØªÙ… Ø¥Ø¶Ø§ÙØ© Ø§Ù„ÙØ­Øµ Ø¨Ù†Ø¬Ø§Ø­');
    }

    function addNewMedicine() {
        const name = document.getElementById('newMedName').value.trim();
        const price = parseInt(document.getElementById('newMedPrice').value);
        const qty = parseInt(document.getElementById('newMedQty').value);
        
        if (!name || !price || !qty) {
            alert('âš ï¸ ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø¬Ù…ÙŠØ¹ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¯ÙˆØ§Ø¡');
            return;
        }
        
        inventory.push({ name, price, qty });
        saveData();
        loadInventory();
        
        document.getElementById('newMedName').value = '';
        document.getElementById('newMedPrice').value = '';
        document.getElementById('newMedQty').value = '';
        
        alert('âœ… ØªÙ… Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø¯ÙˆØ§Ø¡ Ø¨Ù†Ø¬Ø§Ø­');
    }

    function deleteLabTest(index) {
        if (confirm('Ù‡Ù„ ØªØ±ÙŠØ¯ Ø­Ø°Ù Ù‡Ø°Ø§ Ø§Ù„ÙØ­ØµØŸ')) {
            labTests.splice(index, 1);
            saveData();
            loadInventory();
            alert('âœ… ØªÙ… Ø­Ø°Ù Ø§Ù„ÙØ­Øµ Ø¨Ù†Ø¬Ø§Ø­');
        }
    }

    function deleteMedicine(index) {
        if (confirm('Ù‡Ù„ ØªØ±ÙŠØ¯ Ø­Ø°Ù Ù‡Ø°Ø§ Ø§Ù„Ø¯ÙˆØ§Ø¡ØŸ')) {
            inventory.splice(index, 1);
            saveData();
            loadInventory();
            alert('âœ… ØªÙ… Ø­Ø°Ù Ø§Ù„Ø¯ÙˆØ§Ø¡ Ø¨Ù†Ø¬Ø§Ø­');
        }
    }

    function resetDailySystem() {
        if (confirm('âš ï¸ ØªØ­Ø°ÙŠØ±: Ù‡Ø°Ø§ Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡ Ø³ÙŠØ­Ø°Ù Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ÙŠÙˆÙ…ÙŠØ©.\nÙ‡Ù„ ØªØ±ÙŠØ¯ Ø§Ù„Ù…ØªØ§Ø¨Ø¹Ø©ØŸ')) {
            // Ø­ÙØ¸ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù‡Ø§Ù…Ø© Ø£ÙˆÙ„Ø§Ù‹
            const backup = {
                date: new Date().toISOString(),
                patients: patients.filter(p => p.status === 'completed'),
                inventory: inventory,
                labTests: labTests,
                staff: staffMembers
            };
            
            backups.push(backup);
            localStorage.setItem('shifa_backups', JSON.stringify(backups));
            
            // ØªØµÙÙŠØ± Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ÙŠÙˆÙ…ÙŠØ©
            patients = patients.filter(p => p.status !== 'completed');
            dailySales = { total: 0, prescriptions: [] };
            financials = { clinic: 0, lab: 0, pharSales: 0, pharProfit: 0, total: 0 };
            
            systemSettings.lastReset = new Date().toISOString();
            
            saveData();
            
            document.getElementById('lastResetTime').textContent = new Date().toLocaleString('ar-EG');
            alert('âœ… ØªÙ… ØªØµÙÙŠØ± Ø§Ù„Ù†Ø¸Ø§Ù… Ø§Ù„ÙŠÙˆÙ…ÙŠ Ø¨Ù†Ø¬Ø§Ø­');
        }
    }

    function loadSecurityLogs() {
        const container = document.getElementById('securityLogsContainer');
        const logs = securityLogger.getRecentLogs(50);
        
        container.innerHTML = logs.map(log => `
            <div class="security-log-item security-${log.severity}">
                <div class="d-flex justify-content-between">
                    <div>
                        <strong>${log.event}</strong>
                        <div class="small">${log.details}</div>
                    </div>
                    <div class="text-muted small text-nowrap">
                        ${new Date(log.timestamp).toLocaleTimeString('ar-EG')}
                    </div>
                </div>
                <div class="small">
                    <span class="badge bg-secondary">${log.user}</span>
                    <span class="badge bg-${log.severity === 'critical' ? 'danger' : log.severity === 'warning' ? 'warning' : 'info'}">
                        ${log.severity === 'critical' ? 'Ø­Ø±Ø¬' : log.severity === 'warning' ? 'ØªØ­Ø°ÙŠØ±' : 'Ù…Ø¹Ù„ÙˆÙ…Ø§Øª'}
                    </span>
                </div>
            </div>
        `).join('');
        
        document.getElementById('securityTotalEvents').textContent = securityLogger.logs.length;
        document.getElementById('securityCriticalEvents').textContent = 
            securityLogger.logs.filter(l => l.severity === 'critical').length;
        document.getElementById('securityLastEvent').textContent = 
            logs.length > 0 ? new Date(logs[0].timestamp).toLocaleString('ar-EG') : '--';
    }

    function showPasswordChangeModal() {
        const modal = new bootstrap.Modal(document.getElementById('passwordChangeModal'));
        modal.show();
    }

    async function updatePassword() {
        const newPass = document.getElementById('newPassword').value;
        const confirmPass = document.getElementById('confirmPassword').value;
        
        if (newPass !== confirmPass) {
            alert('âš ï¸ ÙƒÙ„Ù…ØªØ§ Ø§Ù„Ù…Ø±ÙˆØ± ØºÙŠØ± Ù…ØªØ·Ø§Ø¨Ù‚ØªÙŠÙ†');
            return;
        }
        
        const strength = validatePasswordStrength(newPass);
        if (!strength.meetsRequirements) {
            alert('âš ï¸ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± Ù„Ø§ ØªÙ„Ø¨ÙŠ Ù…ØªØ·Ù„Ø¨Ø§Øª Ø§Ù„Ø£Ù…Ø§Ù†');
            return;
        }
        
        // ØªØ­Ø¯ÙŠØ« ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±
        const hashedPassword = await hashPassword(newPass);
        HASHED_USERS[currentUser.username].password = hashedPassword;
        HASHED_USERS[currentUser.username].mustChangePassword = false;
        HASHED_USERS[currentUser.username].lastPasswordChange = new Date().toISOString();
        
        currentUser.mustChangePassword = false;
        
        const modal = bootstrap.Modal.getInstance(document.getElementById('passwordChangeModal'));
        modal.hide();
        
        alert('âœ… ØªÙ… ØªØºÙŠÙŠØ± ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± Ø¨Ù†Ø¬Ø§Ø­');
    }

    // ============================================
    // ØªÙ‡ÙŠØ¦Ø© Ø§Ù„Ù†Ø¸Ø§Ù… Ø¹Ù†Ø¯ Ø§Ù„ØªØ­Ù…ÙŠÙ„
    // ============================================

    document.addEventListener('DOMContentLoaded', function() {
        // ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
        loadAllData();
        initStaffMembers();
        
        // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø³Ø§Ø¹Ø©
        function updateClock() {
            const now = new Date();
            document.getElementById('clockDisplay').textContent = 
                now.toLocaleTimeString('ar-EG') + ' ' + now.toLocaleDateString('ar-EG');
        }
        setInterval(updateClock, 1000);
        updateClock();
        
        // Ø·Ù„Ø¨ Ø¥Ø°Ù† Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª
        if ('Notification' in window && Notification.permission === 'default') {
            Notification.requestPermission();
        }
        
        // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø´Ø§Ø±Ø§Øª
        function updateBadges() {
            const waitingDoctor = patients.filter(p => p.status === 'waiting_doctor').length;
            const waitingLab = patients.filter(p => p.status === 'waiting_lab').length;
            const waitingPharmacy = patients.filter(p => p.status === 'waiting_pharmacy').length;
            const waitingNursing = patients.filter(p => p.status === 'waiting_nursing').length;
            
            document.getElementById('doctorBadge').textContent = waitingDoctor;
            document.getElementById('labBadge').textContent = waitingLab;
            document.getElementById('pharBadge').textContent = waitingPharmacy;
            document.getElementById('nurseBadge').textContent = waitingNursing;
            
            document.getElementById('doctorBadge').classList.toggle('hidden-section', waitingDoctor === 0);
            document.getElementById('labBadge').classList.toggle('hidden-section', waitingLab === 0);
            document.getElementById('pharBadge').classList.toggle('hidden-section', waitingPharmacy === 0);
            document.getElementById('nurseBadge').classList.toggle('hidden-section', waitingNursing === 0);
        }
        
        updateBadges();
        setInterval(updateBadges, 10000); // ØªØ­Ø¯ÙŠØ« ÙƒÙ„ 10 Ø«ÙˆØ§Ù†ÙŠ
        
        // Ø¥Ø®ÙØ§Ø¡ Ø²Ø± Ø§Ù„Ø·ÙˆØ§Ø±Ø¦ Ø¥Ù„Ø§ Ø¥Ø°Ø§ ÙƒØ§Ù†Øª Ù‡Ù†Ø§Ùƒ Ù…Ø´ÙƒÙ„Ø© ÙÙŠ Ø§Ù„Ø¯Ø®ÙˆÙ„
        const emergencyBtn = document.getElementById('emergencyBtn');
        if (Object.keys(loginAttempts).some(user => loginAttempts[user].count >= 3)) {
            emergencyBtn.style.display = 'inline-block';
        }
    });

    function showRecoveryOptions() {
        alert('ğŸ“§ Ù„Ø§Ø³ØªØ¹Ø§Ø¯Ø© ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±:\n1. Ø§ØªØµÙ„ Ø¨Ø§Ù„Ø¯Ø¹Ù… Ø§Ù„ÙÙ†ÙŠ Ø¹Ù„Ù‰ Ø§Ù„Ø±Ù‚Ù…: 0127910778 \n2. Ø£Ùˆ Ø±Ø§Ø³Ù„ Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ: support@shifa.sd\n3. ÙŠÙ…ÙƒÙ† Ø§Ø³ØªØ®Ø¯Ø§Ù… ÙƒÙˆØ¯ Ø§Ù„Ø·ÙˆØ§Ø±Ø¦ Ø¥Ø°Ø§ ÙƒÙ†Øª Ù…Ø¯ÙŠØ± Ø§Ù„Ù†Ø¸Ø§Ù…');
    }

    function showEmergencyAccess() {
        const code = prompt('ğŸš¨ Ø£Ø¯Ø®Ù„ ÙƒÙˆØ¯ Ø§Ù„ÙˆØµÙˆÙ„ Ø§Ù„Ø·Ø§Ø±Ø¦:');
        if (code === SECURITY_SETTINGS.emergencyCode) {
            alert('âœ… ØªÙ… ØªÙØ¹ÙŠÙ„ Ø§Ù„ÙˆØµÙˆÙ„ Ø§Ù„Ø·Ø§Ø±Ø¦. ÙŠÙ…ÙƒÙ†Ùƒ Ø§Ù„Ø¢Ù† Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø­Ø³Ø§Ø¨ Ø§Ù„Ù…Ø¯ÙŠØ±.');
            document.getElementById('username').value = 'admin';
            document.getElementById('loginDept').value = 'admin';
            updateLoginPlaceholder();
        } else {
            alert('âŒ ÙƒÙˆØ¯ Ø§Ù„Ø·ÙˆØ§Ø±Ø¦ ØºÙŠØ± ØµØ­ÙŠØ­');
        }
    }

    // Ø§Ù„Ø¯ÙˆØ§Ù„ Ø§Ù„Ø¥Ø¶Ø§ÙÙŠØ©
    function openUserMenu() {
        alert(`ğŸ‘¤ Ø­Ø³Ø§Ø¨ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…:\nØ§Ù„Ø§Ø³Ù…: ${currentUser?.name}\nØ§Ù„Ø¯ÙˆØ±: ${currentUser?.role}\nØ¢Ø®Ø± Ø¯Ø®ÙˆÙ„: ${new Date().toLocaleString('ar-EG')}\n\nğŸ“Š Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª:\n- Ø§Ù„Ù…Ø±Ø¶Ù‰ Ø§Ù„ÙŠÙˆÙ…: ${patients.filter(p => new Date(p.date).toDateString() === new Date().toDateString()).length}\n- Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª Ø§Ù„ÙŠÙˆÙ…: ${dailySales.total.toLocaleString()} Ø¬.Ø³`);
    }

    function adminAddLab() {
        const name = document.getElementById('admLabName').value.trim();
        const price = parseInt(document.getElementById('admLabPrice').value);
        
        if (!name || !price) {
            alert('âš ï¸ ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ø³Ù… Ø§Ù„ÙØ­Øµ ÙˆØ³Ø¹Ø±Ù‡');
            return;
        }
        
        labTests.push({ name, price });
        saveData();
        alert('âœ… ØªÙ… Ø¥Ø¶Ø§ÙØ© Ø§Ù„ÙØ­Øµ Ø¨Ù†Ø¬Ø§Ø­');
        
        document.getElementById('admLabName').value = '';
        document.getElementById('admLabPrice').value = '';
    }

    function adminAddMed() {
        const name = document.getElementById('admMedName').value.trim();
        const price = parseInt(document.getElementById('admMedPrice').value);
        const qty = parseInt(document.getElementById('admMedQty').value);
        
        if (!name || !price || !qty) {
            alert('âš ï¸ ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø¬Ù…ÙŠØ¹ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¯ÙˆØ§Ø¡');
            return;
        }
        
        inventory.push({ name, price, qty });
        saveData();
        alert('âœ… ØªÙ… Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø¯ÙˆØ§Ø¡ Ø¨Ù†Ø¬Ø§Ø­');
        
        document.getElementById('admMedName').value = '';
        document.getElementById('admMedPrice').value = '';
        document.getElementById('admMedQty').value = '';
    }

    function renderReport(type) {
        let content = '';
        const now = new Date();
        
        switch(type) {
            case 'day':
                const todayPatients = patients.filter(p => 
                    new Date(p.date).toDateString() === now.toDateString()
                );
                content = `
                    <h6>ğŸ“Š ØªÙ‚Ø±ÙŠØ± ÙŠÙˆÙ…ÙŠ - ${now.toLocaleDateString('ar-EG')}</h6>
                    <p>Ø¹Ø¯Ø¯ Ø§Ù„Ù…Ø±Ø¶Ù‰: ${todayPatients.length}</p>
                    <p>Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª: ${dailySales.total.toLocaleString()} Ø¬.Ø³</p>
                    <p>Ø§Ù„Ø¥ÙŠØ±Ø§Ø¯Ø§Øª Ø§Ù„ÙƒÙ„ÙŠØ©: ${financials.total.toLocaleString()} Ø¬.Ø³</p>
                `;
                break;
                
            case 'week':
                const weekAgo = new Date(now.getTime() - 7 * 24 * 60 * 60 * 1000);
                const weekPatients = patients.filter(p => new Date(p.date) >= weekAgo);
                content = `
                    <h6>ğŸ“Š ØªÙ‚Ø±ÙŠØ± Ø£Ø³Ø¨ÙˆØ¹ÙŠ</h6>
                    <p>Ø¹Ø¯Ø¯ Ø§Ù„Ù…Ø±Ø¶Ù‰: ${weekPatients.length}</p>
                    <p>Ù…ØªÙˆØ³Ø· Ø§Ù„Ù…Ø±Ø¶Ù‰ ÙŠÙˆÙ…ÙŠØ§Ù‹: ${Math.round(weekPatients.length / 7)}</p>
                `;
                break;
                
            case 'month':
                content = `
                    <h6>ğŸ“Š ØªÙ‚Ø±ÙŠØ± Ø´Ù‡Ø±ÙŠ</h6>
                    <p>Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø¥ÙŠØ±Ø§Ø¯Ø§Øª: ${financials.total.toLocaleString()} Ø¬.Ø³</p>
                    <p>Ø§Ù„Ø¹ÙŠØ§Ø¯Ø©: ${financials.clinic.toLocaleString()} Ø¬.Ø³</p>
                    <p>Ø§Ù„Ù…Ø¹Ù…Ù„: ${financials.lab.toLocaleString()} Ø¬.Ø³</p>
                    <p>Ø§Ù„ØµÙŠØ¯Ù„ÙŠØ©: ${financials.pharSales.toLocaleString()} Ø¬.Ø³</p>
                `;
                break;
        }
        
        document.getElementById('reportArea').innerHTML = content;
    }

    function createSystemBackup() {
        const backup = {
            timestamp: new Date().toISOString(),
            patients: patients,
            inventory: inventory,
            labTests: labTests,
            dailySales: dailySales,
            financials: financials
        };
        
        const blob = new Blob([JSON.stringify(backup, null, 2)], { type: 'application/json' });
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = `shifa_backup_${new Date().toISOString().split('T')[0]}.json`;
        a.click();
        
        alert('âœ… ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ù†Ø³Ø®Ø© Ø§Ø­ØªÙŠØ§Ø·ÙŠØ©');
    }

    function exportSecurityLogs() {
        const logs = securityLogger.logs;
        const csv = logs.map(log => 
            `"${log.timestamp}","${log.event}","${log.details}","${log.severity}","${log.user}"`
        ).join('\n');
        
        const blob = new Blob(['timestamp,event,details,severity,user\n' + csv], { type: 'text/csv' });
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = `security_logs_${new Date().toISOString().split('T')[0]}.csv`;
        a.click();
        
        alert('âœ… ØªÙ… ØªØµØ¯ÙŠØ± Ø³Ø¬Ù„Ø§Øª Ø§Ù„Ø£Ù…Ø§Ù†');
    }

    function clearOldLogs() {
        if (confirm('Ù‡Ù„ ØªØ±ÙŠØ¯ Ø­Ø°Ù Ø§Ù„Ø³Ø¬Ù„Ø§Øª Ø§Ù„Ø£Ù‚Ø¯Ù… Ù…Ù† 30 ÙŠÙˆÙ…Ø§Ù‹ØŸ')) {
            const monthAgo = new Date(Date.now() - 30 * 24 * 60 * 60 * 1000);
            securityLogger.logs = securityLogger.logs.filter(log => 
                new Date(log.timestamp) > monthAgo
            );
            localStorage.setItem('shifa_security_logs', JSON.stringify(securityLogger.logs));
            loadSecurityLogs();
            alert('âœ… ØªÙ… Ø­Ø°Ù Ø§Ù„Ø³Ø¬Ù„Ø§Øª Ø§Ù„Ù‚Ø¯ÙŠÙ…Ø©');
        }
    }
</script>
</body>
</html>
