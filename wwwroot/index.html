<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="theme-color" content="#2c7a7b">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <link rel="apple-touch-icon" href="https://cdn-icons-png.flaticon.com/512/822/822118.png">
    
    <title>Ù…Ø¬Ù…Ø¹ Ø§Ù„Ø´ÙØ§Ø¡ - Ø§Ù„Ù†Ø³Ø®Ø© Ø§Ù„Ø°ÙƒÙŠØ© Ø§Ù„Ø´Ø§Ù…Ù„Ø© 2025</title>
    
    <!-- PWA Manifest -->
    <link rel="manifest" href="data:application/manifest+json,{%22name%22:%22%D9%85%D8%AC%D9%85%D8%B9%20%D8%A7%D9%84%D8%B4%D9%81%D8%A7%D8%A1%22,%22short_name%22:%22%D8%A7%D9%84%D8%B4%D9%81%D8%A1%22,%22start_url%22:%22.%22,%22display%22:%22standalone%22,%22background_color%22:%22%23f8fafc%22,%22theme_color%22:%22%232c7a7b%22,%22description%22:%22%D9%86%D8%B8%D8%A7%D9%85%20%D8%A5%D8%AF%D8%A7%D8%B1%D8%A9%20%D8%A7%D9%84%D9%85%D8%B3%D8%AA%D8%B4%D9%81%D9%8A%D8%A7%D8%AA%20%D9%88%D8%A7%D9%84%D8%B9%D9%8A%D8%A7%D8%AF%D8%A7%D8%AA%20%D8%A7%D9%84%D8%B0%D9%83%D9%8A%22,%22icons%22:[{%22src%22:%22https://cdn-icons-png.flaticon.com/512/822/822118.png%22,%22sizes%22:%22512x512%22,%22type%22:%22image/png%22,%22purpose%22:%22any%22},{%22src%22:%22https://cdn-icons-png.flaticon.com/512/822/822118.png%22,%22sizes%22:%22192x192%22,%22type%22:%22image/png%22,%22purpose%22:%22maskable%22}]}">

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.rtl.min.css" rel="stylesheet">
    <style>
        :root { 
            --primary-color: #2c7a7b; 
            --secondary-color: #f0fdf4; 
            --accent-blue: #0d6efd; 
            --accent-red: #dc3545; 
            --accent-green: #198754; 
            --accent-gold: #d4af37;
            --accent-warning: #ffc107;
            --accent-info: #17a2b8;
            --accent-purple: #6f42c1;
        }
        body { background-color: #f8fafc; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; -webkit-tap-highlight-color: transparent; }
        .navbar { background-color: var(--primary-color) !important; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
        .card { border-radius: 15px; border: none; box-shadow: 0 4px 12px rgba(0,0,0,0.08); margin-bottom: 15px; transition: transform 0.2s; }
        .card:hover { transform: translateY(-2px); }
        .hidden-section { display: none !important; }
        .nav-link { cursor: pointer; font-weight: bold; color: var(--primary-color); padding: 10px 20px !important; position: relative; }
        .nav-link.active { background-color: var(--accent-blue) !important; color: white !important; border-radius: 10px; }
        .badge-notify { position: absolute; top: -5px; right: -5px; background: var(--accent-red); color: white; border-radius: 50%; padding: 3px 7px; font-size: 0.7rem; }
        .stat-card { border-radius: 15px; padding: 20px; color: white; text-align: center; }
        .patient-btn { text-align: right; margin-bottom: 8px; border-right: 5px solid var(--primary-color); width: 100%; transition: 0.3s; padding: 12px 15px; background: white; border: 1px solid #dee2e6; border-radius: 10px; }
        .patient-btn.ready { border-right-color: #28a745; background-color: #f0fff4; }
        .patient-btn:hover { background-color: #f8f9fa; }
        .lab-result-item { background: #e9ecef; padding: 10px; border-radius: 8px; margin-bottom: 5px; border-left: 4px solid var(--accent-blue); }
        .section-pane { animation: fadeIn 0.3s ease-in; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        @media print { .no-print { display: none !important; } body * { visibility: hidden; } #printArea, #printArea * { visibility: visible; } #printArea { position: absolute; left: 0; top: 0; width: 100%; direction: rtl; padding: 20px; } }
        .search-box { position: relative; }
        .search-box input { padding-right: 40px; }
        .rx-item { background: #f8f9fa; padding: 8px 12px; margin: 5px 0; border-radius: 8px; border-left: 4px solid var(--accent-green); }
        .status-online { color: #28a745; font-weight: bold; }
        .status-offline { color: #dc3545; font-weight: bold; }
        .sync-status { position: fixed; bottom: 10px; left: 10px; z-index: 1000; }
        .sync-btn { position: fixed; bottom: 10px; right: 10px; z-index: 1000; }
        .medical-record { background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%); padding: 20px; border-radius: 10px; margin-bottom: 20px; }
        .nursing-schedule { border-left: 5px solid var(--accent-purple); }
        .expiry-warning { background: #fff3cd; border-left: 5px solid #ffc107; }
        .stock-critical { background: #f8d7da; border-left: 5px solid #dc3545; }
        .library-card { height: 100%; transition: all 0.3s; }
        .library-card:hover { transform: scale(1.02); box-shadow: 0 6px 20px rgba(0,0,0,0.15); }
        .form-check { padding-right: 1.5em; margin-bottom: 0.5rem; }
        .form-check-input { margin-right: -1.5em; }
        #labTestsChecklist { scrollbar-width: thin; scrollbar-color: var(--primary-color) #f1f1f1; }
        #labTestsChecklist::-webkit-scrollbar { width: 8px; }
        #labTestsChecklist::-webkit-scrollbar-track { background: #f1f1f1; border-radius: 4px; }
        #labTestsChecklist::-webkit-scrollbar-thumb { background: var(--primary-color); border-radius: 4px; }
        
        /* PWA Styles */
        .install-btn { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; border: none; border-radius: 50px; padding: 10px 20px; font-weight: bold; box-shadow: 0 4px 15px rgba(0,0,0,0.2); transition: all 0.3s; }
        .install-btn:hover { transform: translateY(-2px); box-shadow: 0 6px 20px rgba(0,0,0,0.3); }
        .pwa-status { position: fixed; top: 10px; left: 10px; z-index: 9999; }
        .pwa-notification { position: fixed; bottom: 20px; left: 50%; transform: translateX(-50%); background: white; border-radius: 15px; box-shadow: 0 10px 30px rgba(0,0,0,0.2); padding: 20px; z-index: 10000; max-width: 400px; direction: rtl; }
        .offline-banner { position: fixed; top: 0; left: 0; right: 0; background: #dc3545; color: white; text-align: center; padding: 10px; z-index: 9998; }
        .online-banner { position: fixed; top: 0; left: 0; right: 0; background: #28a745; color: white; text-align: center; padding: 10px; z-index: 9998; }
        #appVersion { font-size: 0.8em; color: #6c757d; }
        
        /* Advanced Permissions Styles */
        .permission-badge { font-size: 0.7em; padding: 2px 6px; margin-right: 3px; }
        .permission-row { border-bottom: 1px solid #eee; padding: 8px 0; }
        .permission-header { background: linear-gradient(135deg, #6a11cb 0%, #2575fc 100%); color: white; padding: 10px; border-radius: 8px; }
        .permission-toggle { transform: scale(0.9); }
        .user-status-online { color: #28a745; animation: pulse 2s infinite; }
        .user-status-offline { color: #dc3545; }
        @keyframes pulse { 0% { opacity: 1; } 50% { opacity: 0.7; } 100% { opacity: 1; } }
        .role-badge { font-size: 0.75em; padding: 3px 8px; }
        .permission-modal { max-height: 80vh; overflow-y: auto; }
        .password-strength { height: 5px; border-radius: 2px; margin-top: 5px; transition: all 0.3s; }
        
        /* New Styles for Workflow */
        .workflow-step { border-left: 4px solid; padding: 10px; margin: 5px 0; border-radius: 8px; }
        .step-reception { border-color: #0d6efd; background: #e7f1ff; }
        .step-doctor { border-color: #198754; background: #e8f5e8; }
        .step-lab { border-color: #dc3545; background: #fde8e8; }
        .step-pharmacy { border-color: #ffc107; background: #fff8e1; }
        .step-nursing { border-color: #6f42c1; background: #f0e8ff; }
        .step-completed { background: #d4edda !important; }
        .patient-flow { display: flex; justify-content: space-between; margin: 10px 0; }
        .flow-arrow { color: #6c757d; margin: 0 10px; }
        
        /* Admin Dashboard Styles */
        .admin-stat-card { border-radius: 12px; padding: 15px; color: white; text-align: center; min-height: 100px; display: flex; flex-direction: column; justify-content: center; }
        .admin-chart-container { height: 300px; position: relative; }
        .quick-action-btn { width: 100%; margin: 5px 0; }
        .system-health { font-size: 0.9em; }
        .health-good { color: #28a745; }
        .health-warning { color: #ffc107; }
        .health-critical { color: #dc3545; }
        .transaction-item { border-left: 4px solid; padding: 8px; margin: 5px 0; border-radius: 6px; }
        .transaction-income { border-color: #28a745; background: #d4edda; }
        .transaction-expense { border-color: #dc3545; background: #f8d7da; }
        .staff-avatar { width: 40px; height: 40px; border-radius: 50%; background: #6c757d; color: white; display: flex; align-items: center; justify-content: center; font-weight: bold; }
    </style>
</head>
<body>

    <audio id="notificationSound" src="https://assets.mixkit.co/active_storage/sfx/2869/2869-preview.mp3"></audio>

    <!-- Ù…Ù†Ø·Ù‚Ø© Ø§Ù„Ø·Ø¨Ø§Ø¹Ø© -->
    <div id="printArea" class="hidden-section">
        <div class="text-center border-bottom pb-3 mb-3">
            <h2 style="color: var(--primary-color);">ğŸ¥ Ù…Ø¬Ù…Ø¹ Ø§Ù„Ø´ÙØ§Ø¡ Ø§Ù„Ø·Ø¨ÙŠ</h2>
            <p>Ø§Ù„Ø³ÙˆØ¯Ø§Ù† - Ø¬Ù„Ù‚Ù†ÙŠ</p>
            <h5 id="printTitle">Ø±ÙˆØ´ØªØ© Ø·Ø¨ÙŠØ© / ÙØ§ØªÙˆØ±Ø©</h5>
            <small id="printDate"></small>
        </div>
        <div id="printContent" class="fs-5"></div>
        <div class="mt-5 pt-3 border-top text-center"><p>Ù†ØªÙ…Ù†Ù‰ Ù„ÙƒÙ… Ø¹Ø§Ø¬Ù„ Ø§Ù„Ø´ÙØ§Ø¡</p></div>
    </div>

    <!-- Ø´Ø§Ø´Ø© ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ -->
    <div id="loginOverlay" class="no-print" style="position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: #f0fdf4; z-index: 9999; display: flex; align-items: center; justify-content: center;">
        <div class="card p-4 shadow-lg" style="width: 380px; border-top: 8px solid var(--primary-color);">
            <div class="text-center mb-4">
                <img src="https://cdn-icons-png.flaticon.com/512/822/822118.png" width="60">
                <h3 class="mt-2 fw-bold" style="color: var(--primary-color);">Ù…Ø¬Ù…Ø¹ Ø§Ù„Ø´ÙØ§Ø¡ Ø§Ù„Ø·Ø¨ÙŠ</h3>
                <p class="text-muted small">Ø§Ù„Ù†Ø¸Ø§Ù… Ø§Ù„Ø°ÙƒÙŠ Ø§Ù„Ø´Ø§Ù…Ù„ - Ø¥Ø¯Ø§Ø±Ø© Ù…ØªÙƒØ§Ù…Ù„Ø©</p>
                <div class="mt-2">
                    <div class="form-check form-check-inline">
                        <input class="form-check-input" type="radio" name="loginMode" id="modeLocal" value="local" checked>
                        <label class="form-check-label" for="modeLocal">ğŸ’¾ Ø¹Ù…Ù„ Ù…Ø­Ù„ÙŠ</label>
                    </div>
                    <div class="form-check form-check-inline">
                        <input class="form-check-input" type="radio" name="loginMode" id="modeServer" value="server">
                        <label class="form-check-label" for="modeServer">â˜ï¸ Ù‚Ø§Ø¹Ø¯Ø© Ø¨ÙŠØ§Ù†Ø§Øª</label>
                    </div>
                </div>
            </div>
            <input type="text" id="username" class="form-control mb-3" placeholder="Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…" value="admin">
            <input type="password" id="password" class="form-control mb-3" placeholder="ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±" value="123">
            <button class="btn btn-primary w-100 fw-bold" onclick="handleLogin()">ğŸš€ Ø¯Ø®ÙˆÙ„ Ù„Ù„Ù†Ø¸Ø§Ù…</button>
            <div class="mt-3 text-center small text-muted" id="loginStatus">Ø¬Ø§Ù‡Ø² Ù„Ù„ØªØ´ØºÙŠÙ„</div>
            
            <!-- PWA Install Button -->
            <button id="installButton" class="install-btn hidden-section w-100 mt-3">
                ğŸ“² ØªØ«Ø¨ÙŠØª Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ Ø¹Ù„Ù‰ Ø§Ù„Ø¬Ù‡Ø§Ø²
            </button>
            
            <div id="appVersion" class="mt-2">Ø§Ù„Ø¥ØµØ¯Ø§Ø± 3.0.0 - Ù†Ø¸Ø§Ù… Ø§Ù„Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…ØªÙƒØ§Ù…Ù„</div>
        </div>
    </div>

    <!-- Ø§Ù„Ù…Ø­ØªÙˆÙ‰ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ -->
    <div id="mainContent" class="hidden-section">
        <!-- PWA Status -->
        <div class="pwa-status no-print">
            <div id="pwaStatus" class="badge bg-info">PWA: Ù†Ø´Ø·</div>
        </div>
        
        <!-- Ø´Ø±ÙŠØ· Ø§Ù„ØªÙ†Ù‚Ù„ -->
        <nav class="navbar navbar-dark mb-4 no-print">
            <div class="container d-flex justify-content-between text-white align-items-center">
                <span class="navbar-brand fw-bold">ğŸ¥ Ù…Ø¬Ù…Ø¹ Ø§Ù„Ø´ÙØ§Ø¡ - Ø§Ù„Ù†Ø¸Ø§Ù… Ø§Ù„Ø°ÙƒÙŠ</span>
                <div>
                    <span id="currentUserDisplay" class="badge bg-light text-dark mx-2"></span>
                    <span id="clockDisplay" class="badge bg-info text-dark"></span>
                    <span id="connectionStatus" class="badge bg-success mx-2">Ù…ØªØµÙ„ Ù…Ø­Ù„ÙŠØ§Ù‹</span>
                    <button class="btn btn-sm btn-outline-light ms-2" onclick="openUserMenu()">ğŸ‘¤</button>
                </div>
                <button class="btn btn-sm btn-outline-light" onclick="logout()">Ø®Ø±ÙˆØ¬</button>
            </div>
        </nav>

        <!-- ØªØ¨ÙˆÙŠØ¨Ø§Øª Ø§Ù„ØªÙ†Ù‚Ù„ -->
        <div class="container">
            <ul class="nav nav-pills mb-4 shadow-sm p-2 bg-white rounded justify-content-center no-print" id="mainTabs">
                <li class="nav-item" id="tab-reception-li"><button class="nav-link" id="btn-reception" onclick="switchSection('reception')">ğŸ“‹ Ø§Ù„Ø§Ø³ØªÙ‚Ø¨Ø§Ù„</button></li>
                <li class="nav-item" id="tab-doctor-li"><button class="nav-link" id="btn-doctor" onclick="switchSection('doctor')">ğŸ‘¨â€âš•ï¸ Ø§Ù„Ø¹ÙŠØ§Ø¯Ø© <span id="doctorBadge" class="badge-notify hidden-section">0</span></button></li>
                <li class="nav-item" id="tab-lab-li"><button class="nav-link" id="btn-lab" onclick="switchSection('lab')">ğŸ§ª Ø§Ù„Ù…Ø¹Ù…Ù„ <span id="labBadge" class="badge-notify hidden-section">0</span></button></li>
                <li class="nav-item" id="tab-pharmacy-li"><button class="nav-link" id="btn-pharmacy" onclick="switchSection('pharmacy')">ğŸ’Š Ø§Ù„ØµÙŠØ¯Ù„ÙŠØ© <span id="pharBadge" class="badge-notify hidden-section">0</span></button></li>
                <li class="nav-item" id="tab-nursing-li"><button class="nav-link" id="btn-nursing" onclick="switchSection('nursing')">ğŸ’‰ Ø§Ù„ØªÙ…Ø±ÙŠØ¶ <span id="nurseBadge" class="badge-notify hidden-section">0</span></button></li>
                <li class="nav-item" id="tab-admin-li"><button class="nav-link" id="btn-admin" onclick="switchSection('admin')">ğŸ‘‘ Ø§Ù„Ù…Ø¯ÙŠØ±</button></li>
            </ul>

            <!-- Ø£Ø²Ø±Ø§Ø± Ø§Ù„Ù…Ø²Ø§Ù…Ù†Ø© -->
            <div class="sync-status no-print">
                <div id="syncStatusText" class="badge bg-secondary">Ø¬Ø§Ù‡Ø²</div>
            </div>
            <div class="sync-btn no-print">
                <button class="btn btn-sm btn-outline-primary" onclick="manualSync()" title="Ù…Ø²Ø§Ù…Ù†Ø© ÙŠØ¯ÙˆÙŠØ©">
                    ğŸ”„ Ù…Ø²Ø§Ù…Ù†Ø©
                </button>
            </div>

            <!-- Ù…Ø­ØªÙˆÙ‰ Ø§Ù„Ø£Ù‚Ø³Ø§Ù… -->
            <div class="tab-content">
                <!-- Ù‚Ø³Ù… Ø§Ù„Ø§Ø³ØªÙ‚Ø¨Ø§Ù„ (Ù…Ø­ÙÙˆØ¸) -->
                <!-- Ù‚Ø³Ù… Ø§Ù„Ø¹ÙŠØ§Ø¯Ø© (Ù…Ø­ÙÙˆØ¸) -->
                <!-- Ù‚Ø³Ù… Ø§Ù„Ù…Ø¹Ù…Ù„ (Ù…Ø­ÙÙˆØ¸) -->
                <!-- Ù‚Ø³Ù… Ø§Ù„ØµÙŠØ¯Ù„ÙŠØ© (Ù…Ø­ÙÙˆØ¸) -->
                <!-- Ù‚Ø³Ù… Ø§Ù„ØªÙ…Ø±ÙŠØ¶ (Ù…Ø­ÙÙˆØ¸) -->

                <!-- Ù‚Ø³Ù… Ø§Ù„Ù…Ø¯ÙŠØ± Ø§Ù„Ø¬Ø¯ÙŠØ¯ Ø§Ù„ÙƒØ§Ù…Ù„ -->
                <div id="admin-sec" class="section-pane hidden-section">
                    <div class="row g-3 mb-4 text-white">
                        <div class="col-md-3">
                            <div class="stat-card bg-primary shadow">
                                <div class="d-flex justify-content-between align-items-center">
                                    <div>
                                        <h6 class="mb-1">ğŸ¦ Ø¹ÙŠØ§Ø¯Ø© Ø§Ù„ÙŠÙˆÙ…</h6>
                                        <h2 id="finClinic">0</h2>
                                        <small>Ø¬Ù†ÙŠÙ‡</small>
                                    </div>
                                    <div class="fs-1">ğŸ’°</div>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="stat-card bg-danger shadow">
                                <div class="d-flex justify-content-between align-items-center">
                                    <div>
                                        <h6 class="mb-1">ğŸ§ª Ù…Ø¹Ù…Ù„ Ø§Ù„ÙŠÙˆÙ…</h6>
                                        <h2 id="finLab">0</h2>
                                        <small>Ø¬Ù†ÙŠÙ‡</small>
                                    </div>
                                    <div class="fs-1">ğŸ”¬</div>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="stat-card bg-success shadow">
                                <div class="d-flex justify-content-between align-items-center">
                                    <div>
                                        <h6 class="mb-1">ğŸ’Š ØµÙŠØ¯Ù„ÙŠØ© Ø§Ù„ÙŠÙˆÙ…</h6>
                                        <h2 id="finPhar">0</h2>
                                        <small>Ø¬Ù†ÙŠÙ‡</small>
                                    </div>
                                    <div class="fs-1">ğŸ’Š</div>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="stat-card bg-dark shadow">
                                <div class="d-flex justify-content-between align-items-center">
                                    <div>
                                        <h6 class="mb-1">ğŸ’° Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„ÙŠÙˆÙ…</h6>
                                        <h2 id="totalProfit">0</h2>
                                        <small>Ø¬Ù†ÙŠÙ‡</small>
                                    </div>
                                    <div class="fs-1">ğŸ“Š</div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="row">
                        <!-- Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ… Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© -->
                        <div class="col-md-8">
                            <div class="card p-4 border-top border-3 border-info shadow">
                                <h5 class="fw-bold mb-3">ğŸ“Š Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ… Ø§Ù„Ø´Ø§Ù…Ù„Ø©</h5>
                                
                                <ul class="nav nav-tabs mb-3">
                                    <li class="nav-item"><button class="nav-link active" onclick="showAdminTab('dashboard')">Ø§Ù„Ù„ÙˆØ­Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</button></li>
                                    <li class="nav-item"><button class="nav-link" onclick="showAdminTab('reports')">Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ±</button></li>
                                    <li class="nav-item"><button class="nav-link" onclick="showAdminTab('patients')">Ø§Ù„Ù…Ø±Ø¶Ù‰</button></li>
                                    <li class="nav-item"><button class="nav-link" onclick="showAdminTab('staff')">ğŸ‘¥ Ø§Ù„Ù…ÙˆØ¸ÙÙŠÙ†</button></li>
                                    <li class="nav-item"><button class="nav-link" onclick="showAdminTab('financial')">ğŸ’° Ø§Ù„Ù…Ø§Ù„ÙŠØ©</button></li>
                                    <li class="nav-item"><button class="nav-link" onclick="showAdminTab('settings')">âš™ï¸ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª</button></li>
                                </ul>
                                
                                <!-- Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ… Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© -->
                                <div id="admin-dashboard">
                                    <div class="row g-3">
                                        <div class="col-md-6">
                                            <div class="card p-3 bg-light">
                                                <h6>ğŸ“ˆ Ù†Ø´Ø§Ø· Ø§Ù„ÙŠÙˆÙ…</h6>
                                                <div class="mt-3">
                                                    <div class="d-flex justify-content-between mb-2">
                                                        <span>Ø§Ù„Ù…Ø±Ø¶Ù‰ Ø§Ù„Ø¬Ø¯Ø¯</span>
                                                        <strong id="todayNewPatients">0</strong>
                                                    </div>
                                                    <div class="d-flex justify-content-between mb-2">
                                                        <span>Ø§Ù„ÙØ­ÙˆØµØ§Øª Ø§Ù„Ù…ÙƒØªÙ…Ù„Ø©</span>
                                                        <strong id="todayCompletedTests">0</strong>
                                                    </div>
                                                    <div class="d-flex justify-content-between mb-2">
                                                        <span>Ø§Ù„Ø±ÙˆØ´ØªØ§Øª Ø§Ù„Ù…ØµØ±Ù‘ÙØ©</span>
                                                        <strong id="todayDispensedRx">0</strong>
                                                    </div>
                                                    <div class="d-flex justify-content-between">
                                                        <span>Ù…Ù‡Ø§Ù… Ø§Ù„ØªÙ…Ø±ÙŠØ¶</span>
                                                        <strong id="todayNursingTasks">0</strong>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="col-md-6">
                                            <div class="card p-3 bg-light">
                                                <h6>ğŸ‘¥ Ø§Ù„Ù…ÙˆØ¸ÙÙŠÙ† Ø§Ù„Ù†Ø´Ø·ÙŠÙ†</h6>
                                                <div id="activeStaffList" class="mt-2" style="max-height: 150px; overflow-y: auto;"></div>
                                            </div>
                                        </div>
                                        <div class="col-12">
                                            <div class="card p-3 bg-light">
                                                <h6>ğŸ“‹ Ø§Ù„ØªØ­Ø°ÙŠØ±Ø§Øª ÙˆØ§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª</h6>
                                                <div id="adminAlerts" style="max-height: 200px; overflow-y: auto;"></div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                
                                <!-- Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ± -->
                                <div id="admin-reports" class="hidden-section">
                                    <div class="row g-3">
                                        <div class="col-md-6">
                                            <div class="card p-3 bg-light">
                                                <h6>ğŸ“ˆ Ø§Ù„Ø¥ÙŠØ±Ø§Ø¯Ø§Øª Ø§Ù„ÙŠÙˆÙ…ÙŠØ©</h6>
                                                <div class="text-center py-4">
                                                    <canvas id="dailyRevenueChart" height="150"></canvas>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="col-md-6">
                                            <div class="card p-3 bg-light">
                                                <h6>ğŸ‘¥ ØªÙˆØ²ÙŠØ¹ Ø§Ù„Ù…Ø±Ø¶Ù‰</h6>
                                                <div class="text-center py-4">
                                                    <canvas id="patientsChart" height="150"></canvas>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="col-md-12">
                                            <div class="card p-3 bg-light">
                                                <h6>ğŸ“Š ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ø£Ø¯Ø§Ø¡</h6>
                                                <div class="row">
                                                    <div class="col-md-3">
                                                        <p class="mb-1">Ù…ØªÙˆØ³Ø· ÙˆÙ‚Øª Ø§Ù„ÙƒØ´Ù: <strong id="avgConsultationTime">0</strong> Ø¯</p>
                                                    </div>
                                                    <div class="col-md-3">
                                                        <p class="mb-1">Ø¹Ø¯Ø¯ Ø§Ù„Ù…Ø±Ø¶Ù‰/Ø·Ø¨ÙŠØ¨: <strong id="patientsPerDoctor">0</strong></p>
                                                    </div>
                                                    <div class="col-md-3">
                                                        <p class="mb-1">Ù…Ø¹Ø¯Ù„ Ø§Ù„Ø¥Ø´ØºØ§Ù„: <strong id="occupancyRate">0%</strong></p>
                                                    </div>
                                                    <div class="col-md-3">
                                                        <p class="mb-1">Ø±Ø¶Ø§ Ø§Ù„Ù…Ø±Ø¶Ù‰: <strong id="patientSatisfaction">0%</strong></p>
                                                    </div>
                                                </div>
                                                <div class="mt-3">
                                                    <button class="btn btn-sm btn-outline-primary" onclick="generatePerformanceReport()">ğŸ“Š ØªÙˆÙ„ÙŠØ¯ ØªÙ‚Ø±ÙŠØ± Ø£Ø¯Ø§Ø¡</button>
                                                    <button class="btn btn-sm btn-outline-success" onclick="exportReportToExcel()">ğŸ“¥ ØªØµØ¯ÙŠØ± Ù„Ø¥ÙƒØ³Ù„</button>
                                                    <button class="btn btn-sm btn-outline-info" onclick="printDailyReport()">ğŸ–¨ï¸ Ø·Ø¨Ø§Ø¹Ø© Ø§Ù„ØªÙ‚Ø±ÙŠØ±</button>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                
                                <!-- Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø±Ø¶Ù‰ -->
                                <div id="admin-patients" class="hidden-section">
                                    <h6 class="fw-bold">ğŸ‘¥ Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø³Ø¬Ù„Ø§Øª Ø§Ù„Ø·Ø¨ÙŠØ©</h6>
                                    <div class="row mb-3">
                                        <div class="col-md-6">
                                            <input type="text" class="form-control" placeholder="Ø¨Ø­Ø« ÙÙŠ Ø³Ø¬Ù„Ø§Øª Ø§Ù„Ù…Ø±Ø¶Ù‰..." id="adminPatientSearch" onkeyup="searchAdminPatients(this.value)">
                                        </div>
                                        <div class="col-md-3">
                                            <button class="btn btn-info w-100" onclick="exportMedicalRecords()">ğŸ“¥ ØªØµØ¯ÙŠØ± Ø§Ù„Ø³Ø¬Ù„Ø§Øª</button>
                                        </div>
                                        <div class="col-md-3">
                                            <button class="btn btn-danger w-100" onclick="clearAllPatientData()">ğŸ—‘ï¸ Ù…Ø³Ø­ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª</button>
                                        </div>
                                    </div>
                                    <div id="adminPatientsTable" style="max-height: 300px; overflow-y: auto;"></div>
                                </div>
                                
                                <!-- Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…ÙˆØ¸ÙÙŠÙ† -->
                                <div id="admin-staff" class="hidden-section">
                                    <h6 class="fw-bold">ğŸ‘¥ Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…ÙˆØ¸ÙÙŠÙ† ÙˆØ§Ù„Ø£Ø¯Ø§Ø¡</h6>
                                    <div class="row g-2 mb-3">
                                        <div class="col-4">
                                            <input type="text" id="newStaffUser" class="form-control form-control-sm" placeholder="Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…">
                                        </div>
                                        <div class="col-4">
                                            <input type="text" id="newStaffPass" class="form-control form-control-sm" placeholder="ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±">
                                        </div>
                                        <div class="col-4">
                                            <select id="newStaffRole" class="form-select form-select-sm">
                                                <option value="admin">Ù…Ø¯ÙŠØ± Ù†Ø¸Ø§Ù…</option>
                                                <option value="super_admin">Ù…Ø¯ÙŠØ± Ø¹Ø§Ù…</option>
                                                <option value="head_doctor">Ø±Ø¦ÙŠØ³ Ø£Ø·Ø¨Ø§Ø¡</option>
                                                <option value="doctor">Ø·Ø¨ÙŠØ¨</option>
                                                <option value="lab_manager">Ù…Ø¯ÙŠØ± Ù…Ø¹Ù…Ù„</option>
                                                <option value="lab_tech">ÙÙ†ÙŠ Ù…Ø¹Ù…Ù„</option>
                                                <option value="pharmacy_manager">Ù…Ø¯ÙŠØ± ØµÙŠØ¯Ù„ÙŠØ©</option>
                                                <option value="pharmacist">ØµÙŠØ¯Ù„ÙŠ</option>
                                                <option value="head_nurse">Ø±Ø¦ÙŠØ³ ØªÙ…Ø±ÙŠØ¶</option>
                                                <option value="nurse">Ù…Ù…Ø±Ø¶</option>
                                                <option value="reception_supervisor">Ù…Ø´Ø±Ù Ø§Ø³ØªÙ‚Ø¨Ø§Ù„</option>
                                                <option value="reception">Ù…ÙˆØ¸Ù Ø§Ø³ØªÙ‚Ø¨Ø§Ù„</option>
                                                <option value="accountant">Ù…Ø­Ø§Ø³Ø¨</option>
                                                <option value="auditor">Ù…Ø±Ø§Ø¬Ø¹</option>
                                            </select>
                                        </div>
                                        <div class="col-12">
                                            <button class="btn btn-dark btn-sm w-100" onclick="addNewStaff()">â• Ø¥Ø¶Ø§ÙØ© Ù…ÙˆØ¸Ù Ø¬Ø¯ÙŠØ¯</button>
                                        </div>
                                    </div>
                                    <div class="row g-2 mb-3">
                                        <div class="col-6">
                                            <button class="btn btn-outline-info btn-sm w-100" onclick="resetUserPassword()">ğŸ”„ Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±</button>
                                        </div>
                                        <div class="col-6">
                                            <button class="btn btn-outline-warning btn-sm w-100" onclick="exportUserActivity()">ğŸ“Š ØªØµØ¯ÙŠØ± Ù†Ø´Ø§Ø· Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†</button>
                                        </div>
                                    </div>
                                    <table class="table table-bordered text-center table-sm table-hover">
                                        <thead class="table-light">
                                            <tr>
                                                <th>Ø§Ù„Ø§Ø³Ù…</th>
                                                <th>Ø§Ù„ØµÙ„Ø§Ø­ÙŠØ©</th>
                                                <th>Ø§Ù„Ù†Ø´Ø§Ø·</th>
                                                <th>Ø§Ù„Ø­Ø§Ù„Ø©</th>
                                                <th>Ø¥Ø¬Ø±Ø§Ø¡</th>
                                            </tr>
                                        </thead>
                                        <tbody id="staffTableBody"></tbody>
                                    </table>
                                </div>
                                
                                <!-- Ø§Ù„Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø§Ù„ÙŠØ© -->
                                <div id="admin-financial" class="hidden-section">
                                    <h6 class="fw-bold">ğŸ’° Ø§Ù„Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø§Ù„ÙŠØ© ÙˆØ§Ù„Ø¥ÙŠØ±Ø§Ø¯Ø§Øª</h6>
                                    <div class="row g-3 mb-3">
                                        <div class="col-md-6">
                                            <div class="card bg-light p-3">
                                                <h6>ğŸ’µ Ø§Ù„Ø¥ÙŠØ±Ø§Ø¯Ø§Øª Ø§Ù„ÙŠÙˆÙ…ÙŠØ©</h6>
                                                <div class="d-flex justify-content-between">
                                                    <span>Ø§Ù„Ø¹ÙŠØ§Ø¯Ø©:</span>
                                                    <strong id="dailyClinicRevenue">0</strong>
                                                </div>
                                                <div class="d-flex justify-content-between">
                                                    <span>Ø§Ù„Ù…Ø¹Ù…Ù„:</span>
                                                    <strong id="dailyLabRevenue">0</strong>
                                                </div>
                                                <div class="d-flex justify-content-between">
                                                    <span>Ø§Ù„ØµÙŠØ¯Ù„ÙŠØ©:</span>
                                                    <strong id="dailyPharmacyRevenue">0</strong>
                                                </div>
                                                <hr>
                                                <div class="d-flex justify-content-between text-success">
                                                    <span>Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ:</span>
                                                    <strong id="dailyTotalRevenue">0</strong>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="col-md-6">
                                            <div class="card bg-light p-3">
                                                <h6>ğŸ“… Ø§Ù„Ø¥ÙŠØ±Ø§Ø¯Ø§Øª Ø§Ù„Ø´Ù‡Ø±ÙŠØ©</h6>
                                                <div class="d-flex justify-content-between">
                                                    <span>Ø§Ù„Ø´Ù‡Ø± Ø§Ù„Ø­Ø§Ù„ÙŠ:</span>
                                                    <strong id="monthlyRevenue">0</strong>
                                                </div>
                                                <div class="d-flex justify-content-between">
                                                    <span>Ø§Ù„Ø´Ù‡Ø± Ø§Ù„Ù…Ø§Ø¶ÙŠ:</span>
                                                    <strong id="lastMonthRevenue">0</strong>
                                                </div>
                                                <div class="d-flex justify-content-between">
                                                    <span>Ù†Ø³Ø¨Ø© Ø§Ù„Ù†Ù…Ùˆ:</span>
                                                    <strong id="revenueGrowth">0%</strong>
                                                </div>
                                                <hr>
                                                <button class="btn btn-sm btn-outline-primary w-100" onclick="generateFinancialReport()">ğŸ“„ ØªÙ‚Ø±ÙŠØ± Ù…Ø§Ù„ÙŠ Ù…ÙØµÙ„</button>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="card bg-light p-3">
                                        <h6>ğŸ“Š Ø­Ø±ÙƒØ© Ø§Ù„Ù…Ø¹Ø§Ù…Ù„Ø§Øª Ø§Ù„Ù…Ø§Ù„ÙŠØ© Ø§Ù„ÙŠÙˆÙ…</h6>
                                        <div id="financialTransactions" style="max-height: 200px; overflow-y: auto;"></div>
                                    </div>
                                </div>
                                
                                <!-- Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ù†Ø¸Ø§Ù… -->
                                <div id="admin-settings" class="hidden-section">
                                    <h6 class="fw-bold">âš™ï¸ Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ù†Ø¸Ø§Ù… Ø§Ù„Ù…ØªÙ‚Ø¯Ù…Ø©</h6>
                                    <div class="row g-3">
                                        <div class="col-md-6">
                                            <div class="card bg-light p-3">
                                                <h6>ğŸ”” Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„ØªÙ†Ø¨ÙŠÙ‡Ø§Øª</h6>
                                                <div class="form-check form-switch mb-2">
                                                    <input class="form-check-input" type="checkbox" id="notificationsEnabled" checked>
                                                    <label class="form-check-label" for="notificationsEnabled">ØªÙ…ÙƒÙŠÙ† Ø§Ù„ØªÙ†Ø¨ÙŠÙ‡Ø§Øª</label>
                                                </div>
                                                <div class="form-check form-switch mb-2">
                                                    <input class="form-check-input" type="checkbox" id="soundEnabled" checked>
                                                    <label class="form-check-label" for="soundEnabled">ØªÙ…ÙƒÙŠÙ† Ø§Ù„ØµÙˆØª</label>
                                                </div>
                                                <div class="form-check form-switch mb-2">
                                                    <input class="form-check-input" type="checkbox" id="autoBackupEnabled">
                                                    <label class="form-check-label" for="autoBackupEnabled">Ù†Ø³Ø® Ø§Ø­ØªÙŠØ§Ø·ÙŠ ØªÙ„Ù‚Ø§Ø¦ÙŠ</label>
                                                </div>
                                                <div class="form-check form-switch mb-2">
                                                    <input class="form-check-input" type="checkbox" id="autoSyncEnabled">
                                                    <label class="form-check-label" for="autoSyncEnabled">Ù…Ø²Ø§Ù…Ù†Ø© ØªÙ„Ù‚Ø§Ø¦ÙŠØ©</label>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="col-md-6">
                                            <div class="card bg-light p-3">
                                                <h6>ğŸ”„ Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ù…Ø²Ø§Ù…Ù†Ø©</h6>
                                                <div class="mb-2">
                                                    <label class="form-label">ÙØªØ±Ø© Ø§Ù„Ù…Ø²Ø§Ù…Ù†Ø©</label>
                                                    <select class="form-select" id="syncInterval">
                                                        <option value="5">ÙƒÙ„ 5 Ø¯Ù‚Ø§Ø¦Ù‚</option>
                                                        <option value="15" selected>ÙƒÙ„ 15 Ø¯Ù‚ÙŠÙ‚Ø©</option>
                                                        <option value="30">ÙƒÙ„ 30 Ø¯Ù‚ÙŠÙ‚Ø©</option>
                                                        <option value="60">ÙƒÙ„ Ø³Ø§Ø¹Ø©</option>
                                                    </select>
                                                </div>
                                                <div class="mb-2">
                                                    <label class="form-label">Ø­Ø¯ Ø§Ù„Ù†Ø³Ø® Ø§Ù„Ø§Ø­ØªÙŠØ§Ø·ÙŠ</label>
                                                    <select class="form-select" id="backupLimit">
                                                        <option value="7">7 Ø£ÙŠØ§Ù…</option>
                                                        <option value="15" selected>15 ÙŠÙˆÙ…</option>
                                                        <option value="30">30 ÙŠÙˆÙ…</option>
                                                        <option value="90">90 ÙŠÙˆÙ…</option>
                                                    </select>
                                                </div>
                                                <button class="btn btn-sm btn-outline-primary w-100" onclick="saveSystemSettings()">ğŸ’¾ Ø­ÙØ¸ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª</button>
                                            </div>
                                        </div>
                                        <div class="col-12">
                                            <div class="card bg-light p-3">
                                                <h6>ğŸ“‹ Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ù†Ø¸Ø§Ù…</h6>
                                                <div class="row">
                                                    <div class="col-md-4">
                                                        <p><strong>Ø§Ù„Ø¥ØµØ¯Ø§Ø±:</strong> 3.0.0</p>
                                                        <p><strong>Ø¢Ø®Ø± ØªØ­Ø¯ÙŠØ«:</strong> <span id="lastUpdate">2025-01-01</span></p>
                                                    </div>
                                                    <div class="col-md-4">
                                                        <p><strong>Ù…Ø³Ø§Ø­Ø© Ø§Ù„ØªØ®Ø²ÙŠÙ†:</strong> <span id="storageUsage">0 KB</span></p>
                                                        <p><strong>Ø¹Ø¯Ø¯ Ø§Ù„Ù†Ø³Ø® Ø§Ù„Ø§Ø­ØªÙŠØ§Ø·ÙŠØ©:</strong> <span id="backupCount">0</span></p>
                                                    </div>
                                                    <div class="col-md-4">
                                                        <p><strong>Ø­Ø§Ù„Ø© Ø§Ù„Ù†Ø¸Ø§Ù…:</strong> <span id="systemHealth" class="health-good">Ø¬ÙŠØ¯Ø©</span></p>
                                                        <p><strong>Ø¢Ø®Ø± ÙØ­Øµ:</strong> <span id="lastSystemCheck">Ø§Ù„Ø¢Ù†</span></p>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Ø£Ø¯ÙˆØ§Øª Ø§Ù„ØªØ­ÙƒÙ… Ø§Ù„Ø³Ø±ÙŠØ¹ -->
                            <div class="card mt-3 p-3 bg-light border-danger">
                                <h6 class="fw-bold text-danger">âš ï¸ Ø£Ø¯ÙˆØ§Øª ØªØ­ÙƒÙ… Ø³Ø±ÙŠØ¹Ø©</h6>
                                <div class="row g-2">
                                    <div class="col-md-3">
                                        <button class="btn btn-outline-danger btn-sm w-100" onclick="resetSection('pats')">
                                            <small>ğŸ”„ ØªØµÙÙŠØ± Ø§Ù„Ø§Ø³ØªÙ‚Ø¨Ø§Ù„</small>
                                        </button>
                                    </div>
                                    <div class="col-md-3">
                                        <button class="btn btn-outline-danger btn-sm w-100" onclick="resetSection('lab')">
                                            <small>ğŸ”„ ØªØµÙÙŠØ± Ø§Ù„Ù…Ø¹Ù…Ù„</small>
                                        </button>
                                    </div>
                                    <div class="col-md-3">
                                        <button class="btn btn-outline-danger btn-sm w-100" onclick="resetSection('rx')">
                                            <small>ğŸ”„ ØªØµÙÙŠØ± Ø§Ù„ØµÙŠØ¯Ù„ÙŠØ©</small>
                                        </button>
                                    </div>
                                    <div class="col-md-3">
                                        <button class="btn btn-outline-danger btn-sm w-100" onclick="resetSection('nursing')">
                                            <small>ğŸ”„ ØªØµÙÙŠØ± Ø§Ù„ØªÙ…Ø±ÙŠØ¶</small>
                                        </button>
                                    </div>
                                    <div class="col-md-4">
                                        <button class="btn btn-danger btn-sm w-100" onclick="resetAllDay()">
                                            <small>ğŸ“Š Ø¥ØºÙ„Ø§Ù‚ Ø§Ù„ÙŠÙˆÙ…</small>
                                        </button>
                                    </div>
                                    <div class="col-md-4">
                                        <button class="btn btn-success btn-sm w-100" onclick="generateDailyReport()">
                                            <small>ğŸ“„ ØªÙ‚Ø±ÙŠØ± ÙŠÙˆÙ…ÙŠ</small>
                                        </button>
                                    </div>
                                    <div class="col-md-4">
                                        <button class="btn btn-info btn-sm w-100" onclick="backupAllData()">
                                            <small>ğŸ’¾ Ù†Ø³Ø® Ø§Ø­ØªÙŠØ§Ø·ÙŠ</small>
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Ø§Ù„Ø´Ø±ÙŠØ· Ø§Ù„Ø¬Ø§Ù†Ø¨ÙŠ -->
                        <div class="col-md-4">
                            <!-- Ø§Ù„Ù…ÙƒØªØ¨Ø© Ø§Ù„Ø·Ø¨ÙŠØ© -->
                            <div class="card p-4 border-top border-3 border-warning shadow library-card">
                                <h5 class="fw-bold text-warning mb-3">ğŸ“š Ø§Ù„Ù…ÙƒØªØ¨Ø© Ø§Ù„Ø·Ø¨ÙŠØ©</h5>
                                <div class="input-group mb-3">
                                    <input type="text" id="searchMedicalLibrary" class="form-control" placeholder="Ø¨Ø­Ø« Ø¹Ù† Ù…Ø±Ø¶ØŒ Ø¯ÙˆØ§Ø¡ØŒ Ø¥Ø¬Ø±Ø§Ø¡...">
                                    <button class="btn btn-warning" onclick="searchMedicalLibrary()">ğŸ”</button>
                                </div>
                                <div class="mb-3">
                                    <select class="form-select" onchange="filterLibrary(this.value)">
                                        <option value="all">Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø£Ù‚Ø³Ø§Ù…</option>
                                        <option value="diseases">Ø§Ù„Ø£Ù…Ø±Ø§Ø¶</option>
                                        <option value="drugs">Ø§Ù„Ø£Ø¯ÙˆÙŠØ©</option>
                                        <option value="procedures">Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª</option>
                                        <option value="tests">Ø§Ù„ÙØ­ÙˆØµØ§Øª</option>
                                    </select>
                                </div>
                                <div id="medicalLibraryContent" style="max-height: 300px; overflow-y: auto;"></div>
                                <button class="btn btn-outline-warning w-100 mt-3" onclick="addToLibrary()">â• Ø¥Ø¶Ø§ÙØ© Ù…Ø§Ø¯Ø© Ø¹Ù„Ù…ÙŠØ©</button>
                            </div>
                            
                            <!-- Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø³Ø±ÙŠØ¹Ø© -->
                            <div class="card p-3 mt-3 border-info">
                                <h6 class="fw-bold text-info">ğŸ“Š Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø³Ø±ÙŠØ¹Ø©</h6>
                                <div class="row text-center">
                                    <div class="col-6 mb-2">
                                        <div class="bg-light p-2 rounded">
                                            <h5 id="totalPatientsCount">0</h5>
                                            <small>Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…Ø±Ø¶Ù‰</small>
                                        </div>
                                    </div>
                                    <div class="col-6 mb-2">
                                        <div class="bg-light p-2 rounded">
                                            <h5 id="totalStaffCount">0</h5>
                                            <small>Ø§Ù„Ù…ÙˆØ¸ÙÙŠÙ†</small>
                                        </div>
                                    </div>
                                    <div class="col-6">
                                        <div class="bg-light p-2 rounded">
                                            <h5 id="totalInventoryItems">0</h5>
                                            <small>Ø£ØµÙ†Ø§Ù Ø§Ù„Ù…Ø®Ø²ÙˆÙ†</small>
                                        </div>
                                    </div>
                                    <div class="col-6">
                                        <div class="bg-light p-2 rounded">
                                            <h5 id="totalRevenueAll">0</h5>
                                            <small>Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø¥ÙŠØ±Ø§Ø¯Ø§Øª</small>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Ø¢Ø®Ø± Ø§Ù„Ø£Ù†Ø´Ø·Ø© -->
                            <div class="card p-3 mt-3 border-success">
                                <h6 class="fw-bold text-success">ğŸ“ Ø¢Ø®Ø± Ø§Ù„Ø£Ù†Ø´Ø·Ø©</h6>
                                <div id="recentActivities" style="max-height: 200px; overflow-y: auto;"></div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Modals -->
    <div id="changePasswordModal" class="modal fade" tabindex="-1">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header bg-primary text-white">
                    <h5 class="modal-title">ğŸ” ØªØºÙŠÙŠØ± ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±</h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <div class="mb-3">
                        <label class="form-label">ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± Ø§Ù„Ø­Ø§Ù„ÙŠØ©</label>
                        <input type="password" id="currentPassword" class="form-control">
                    </div>
                    <div class="mb-3">
                        <label class="form-label">ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©</label>
                        <input type="password" id="newPassword" class="form-control" onkeyup="checkPasswordStrength()">
                        <div class="password-strength" id="passwordStrength"></div>
                        <small class="text-muted">ÙŠØ¬Ø¨ Ø£Ù† ØªØ­ØªÙˆÙŠ Ø¹Ù„Ù‰ 8 Ø£Ø­Ø±Ù Ø¹Ù„Ù‰ Ø§Ù„Ø£Ù‚Ù„ØŒ Ø­Ø±ÙˆÙ ÙƒØ¨ÙŠØ±Ø© ÙˆØµØºÙŠØ±Ø©ØŒ ÙˆØ£Ø±Ù‚Ø§Ù…</small>
                    </div>
                    <div class="mb-3">
                        <label class="form-label">ØªØ£ÙƒÙŠØ¯ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©</label>
                        <input type="password" id="confirmPassword" class="form-control">
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Ø¥Ù„ØºØ§Ø¡</button>
                    <button type="button" class="btn btn-primary" onclick="confirmPasswordChange()">ØªØºÙŠÙŠØ±</button>
                </div>
            </div>
        </div>
    </div>

    <div id="userMenuModal" class="modal fade" tabindex="-1">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header bg-info text-white">
                    <h5 class="modal-title">ğŸ‘¤ Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø­Ø³Ø§Ø¨</h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <div class="text-center mb-3">
                        <div class="bg-light rounded-circle d-inline-flex align-items-center justify-content-center" style="width: 80px; height: 80px;">
                            <span class="fs-3">ğŸ‘¤</span>
                        </div>
                        <h5 class="mt-2" id="userNameDisplay"></h5>
                        <span class="badge bg-primary" id="userRoleDisplay"></span>
                    </div>
                    <div class="list-group">
                        <button class="list-group-item list-group-item-action" onclick="changePasswordModal()">
                            ğŸ” ØªØºÙŠÙŠØ± ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±
                        </button>
                        <button class="list-group-item list-group-item-action" onclick="viewMyActivity()">
                            ğŸ“‹ Ø³Ø¬Ù„ Ù†Ø´Ø§Ø·ÙŠ
                        </button>
                        <button class="list-group-item list-group-item-action" onclick="showMyPermissions()">
                            âš™ï¸ ØµÙ„Ø§Ø­ÙŠØ§ØªÙŠ
                        </button>
                        <button class="list-group-item list-group-item-action" onclick="toggleDarkMode()">
                            ğŸŒ™ Ø§Ù„ÙˆØ¶Ø¹ Ø§Ù„Ù„ÙŠÙ„ÙŠ
                        </button>
                    </div>
                </div>
                <div class="modal-footer">
                    <small class="text-muted" id="lastLoginDisplay"></small>
                </div>
            </div>
        </div>
    </div>

    <div id="permissionsModal" class="modal fade" tabindex="-1">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header bg-warning">
                    <h5 class="modal-title">âš™ï¸ ØªÙØ§ØµÙŠÙ„ Ø§Ù„ØµÙ„Ø§Ø­ÙŠØ§Øª</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body permission-modal">
                    <div id="permissionsDetails"></div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script>
        // ============================================
        // Ù†Ø¸Ø§Ù… Ø§Ù„ØµÙ„Ø§Ø­ÙŠØ§Øª Ø§Ù„Ù…ØªÙ‚Ø¯Ù…
        // ============================================

        // ØªØ¹Ø±ÙŠÙ Ø§Ù„Ø£Ø¯ÙˆØ§Ø± ÙˆØ§Ù„ØµÙ„Ø§Ø­ÙŠØ§Øª
        const ROLES = {
            SUPER_ADMIN: 'super_admin',
            ADMIN: 'admin',
            HEAD_DOCTOR: 'head_doctor',
            DOCTOR: 'doctor',
            LAB_MANAGER: 'lab_manager',
            LAB_TECH: 'lab_tech',
            PHARMACY_MANAGER: 'pharmacy_manager',
            PHARMACIST: 'pharmacist',
            HEAD_NURSE: 'head_nurse',
            NURSE: 'nurse',
            RECEPTION_SUPERVISOR: 'reception_supervisor',
            RECEPTION: 'reception',
            ACCOUNTANT: 'accountant',
            AUDITOR: 'auditor'
        };

        // ============================================
        // Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ù†Ø¸Ø§Ù… Ø§Ù„Ù…ØªÙ‚Ø¯Ù…Ø©
        // ============================================

        const SERVER_URL = "http://alshifaclinic.somee.com/api.aspx";
        let OPERATION_MODE = "local";
        let IS_ONLINE = navigator.onLine;
        let PENDING_SYNC = [];
        let SYNC_INTERVAL = null;
        let SESSION_TIMEOUT = null;

        // Ù‚ÙˆØ§Ø¹Ø¯ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø­Ù„ÙŠØ©
        let patients = JSON.parse(localStorage.getItem('shifa_pats')) || [];
        let labRequests = JSON.parse(localStorage.getItem('shifa_lab')) || [];
        let pharmOrders = JSON.parse(localStorage.getItem('shifa_rx')) || [];
        let nursingOrders = JSON.parse(localStorage.getItem('shifa_nursing')) || [];
        let nursingTasks = JSON.parse(localStorage.getItem('shifa_nursing_tasks')) || [];
        let inventory = JSON.parse(localStorage.getItem('shifa_inv')) || [];
        let financials = JSON.parse(localStorage.getItem('shifa_fin')) || { clinic: 0, lab: 0, pharSales: 0, pharProfit: 0, total: 0 };
        let staffMembers = JSON.parse(localStorage.getItem('shifa_staff')) || [];
        let labTests = JSON.parse(localStorage.getItem('shifa_tests')) || [];
        let medicalLibrary = JSON.parse(localStorage.getItem('shifa_library')) || [];
        let nurses = JSON.parse(localStorage.getItem('shifa_nurses')) || [];
        let systemLogs = JSON.parse(localStorage.getItem('shifa_logs')) || [];
        let backups = JSON.parse(localStorage.getItem('shifa_backups')) || [];

        // Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø§Ù„Ø­Ø§Ù„ÙŠ
        let currentUser = localStorage.getItem('shifa_user') ? JSON.parse(localStorage.getItem('shifa_user')) : null;
        let selectedPatientId = null;
        let currentRxItems = [];
        let currentNursingOrders = [];
        let currentLabTest = null;

        // ============================================
        // Ø¯ÙˆØ§Ù„ Ù†Ø¸Ø§Ù… Ø§Ù„Ù…Ø¯ÙŠØ± Ø§Ù„Ù…ØªÙ‚Ø¯Ù…Ø©
        // ============================================

        // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„Ù…Ø§Ù„ÙŠØ©
        function updateFinancialStats() {
            const today = new Date().toDateString();
            
            // Ø­Ø³Ø§Ø¨ Ø¥ÙŠØ±Ø§Ø¯Ø§Øª Ø§Ù„ÙŠÙˆÙ…
            const todayPatients = patients.filter(p => new Date(p.createdAt).toDateString() === today);
            const todayLab = labRequests.filter(l => new Date(l.requestedAt).toDateString() === today && l.status === 'completed');
            const todayRx = pharmOrders.filter(r => new Date(r.createdAt).toDateString() === today && r.status === 'dispensed');
            
            const dailyClinic = todayPatients.reduce((sum, p) => sum + (p.ticket || 0), 0);
            const dailyLab = todayLab.reduce((sum, l) => sum + (l.price || 0), 0);
            const dailyPharmacy = todayRx.reduce((sum, r) => sum + (r.totalAmount || 0), 0);
            
            // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¨Ø·Ø§Ù‚Ø§Øª Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©
            document.getElementById('finClinic').textContent = dailyClinic.toLocaleString();
            document.getElementById('finLab').textContent = dailyLab.toLocaleString();
            document.getElementById('finPhar').textContent = dailyPharmacy.toLocaleString();
            document.getElementById('totalProfit').textContent = (dailyClinic + dailyLab + dailyPharmacy).toLocaleString();
            
            // ØªØ­Ø¯ÙŠØ« Ù„ÙˆØ­Ø© Ø§Ù„Ø¥ÙŠØ±Ø§Ø¯Ø§Øª Ø§Ù„ÙŠÙˆÙ…ÙŠØ©
            document.getElementById('dailyClinicRevenue').textContent = dailyClinic.toLocaleString();
            document.getElementById('dailyLabRevenue').textContent = dailyLab.toLocaleString();
            document.getElementById('dailyPharmacyRevenue').textContent = dailyPharmacy.toLocaleString();
            document.getElementById('dailyTotalRevenue').textContent = (dailyClinic + dailyLab + dailyPharmacy).toLocaleString();
            
            // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„Ø³Ø±ÙŠØ¹Ø©
            document.getElementById('totalPatientsCount').textContent = patients.length;
            document.getElementById('totalStaffCount').textContent = staffMembers.length;
            document.getElementById('totalInventoryItems').textContent = inventory.length;
            document.getElementById('totalRevenueAll').textContent = (financials.total || 0).toLocaleString();
            
            // ØªØ­Ø¯ÙŠØ« Ù†Ø´Ø§Ø· Ø§Ù„ÙŠÙˆÙ…
            document.getElementById('todayNewPatients').textContent = todayPatients.length;
            document.getElementById('todayCompletedTests').textContent = todayLab.length;
            document.getElementById('todayDispensedRx').textContent = todayRx.length;
            document.getElementById('todayNursingTasks').textContent = nursingTasks.filter(t => 
                new Date(t.createdAt).toDateString() === today && t.status === 'completed'
            ).length;
        }

        // ØªØ­Ø¯ÙŠØ« Ø­Ø±ÙƒØ© Ø§Ù„Ù…Ø¹Ø§Ù…Ù„Ø§Øª Ø§Ù„Ù…Ø§Ù„ÙŠØ©
        function updateFinancialTransactions() {
            const container = document.getElementById('financialTransactions');
            const today = new Date().toDateString();
            
            const transactions = [];
            
            // Ø¥Ø¶Ø§ÙØ© Ù…Ø¹Ø§Ù…Ù„Ø§Øª Ø§Ù„Ø¹ÙŠØ§Ø¯Ø©
            patients.filter(p => new Date(p.createdAt).toDateString() === today).forEach(patient => {
                transactions.push({
                    type: 'Ø¹ÙŠØ§Ø¯Ø©',
                    amount: patient.ticket || 0,
                    patient: patient.name,
                    time: new Date(patient.createdAt).toLocaleTimeString('ar-EG'),
                    icon: 'ğŸ¥'
                });
            });
            
            // Ø¥Ø¶Ø§ÙØ© Ù…Ø¹Ø§Ù…Ù„Ø§Øª Ø§Ù„Ù…Ø¹Ù…Ù„
            labRequests.filter(l => new Date(l.requestedAt).toDateString() === today && l.status === 'completed').forEach(test => {
                transactions.push({
                    type: 'Ù…Ø¹Ù…Ù„',
                    amount: test.price || 0,
                    patient: test.patientName,
                    time: new Date(test.requestedAt).toLocaleTimeString('ar-EG'),
                    icon: 'ğŸ§ª'
                });
            });
            
            // Ø¥Ø¶Ø§ÙØ© Ù…Ø¹Ø§Ù…Ù„Ø§Øª Ø§Ù„ØµÙŠØ¯Ù„ÙŠØ©
            pharmOrders.filter(r => new Date(r.createdAt).toDateString() === today && r.status === 'dispensed').forEach(rx => {
                transactions.push({
                    type: 'ØµÙŠØ¯Ù„ÙŠØ©',
                    amount: rx.totalAmount || 0,
                    patient: rx.patientName,
                    time: new Date(rx.createdAt).toLocaleTimeString('ar-EG'),
                    icon: 'ğŸ’Š'
                });
            });
            
            // ØªØ±ØªÙŠØ¨ Ø­Ø³Ø¨ Ø§Ù„ÙˆÙ‚Øª (Ø§Ù„Ø£Ø­Ø¯Ø« Ø£ÙˆÙ„Ø§Ù‹)
            transactions.sort((a, b) => new Date('1970/01/01 ' + b.time) - new Date('1970/01/01 ' + a.time));
            
            let html = '';
            transactions.slice(0, 10).forEach(transaction => {
                html += `
                    <div class="transaction-item transaction-income">
                        <div class="d-flex justify-content-between align-items-center">
                            <div>
                                <span class="fs-5">${transaction.icon}</span>
                            </div>
                            <div class="flex-grow-1 mx-2">
                                <div class="d-flex justify-content-between">
                                    <small><strong>${transaction.type}</strong></small>
                                    <small class="text-success"><strong>${transaction.amount.toLocaleString()} Ø¬</strong></small>
                                </div>
                                <div class="d-flex justify-content-between">
                                    <small>${transaction.patient}</small>
                                    <small class="text-muted">${transaction.time}</small>
                                </div>
                            </div>
                        </div>
                    </div>
                `;
            });
            
            if (transactions.length === 0) {
                html = '<p class="text-muted text-center py-3">Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ø¹Ø§Ù…Ù„Ø§Øª Ø§Ù„ÙŠÙˆÙ…</p>';
            }
            
            container.innerHTML = html;
        }

        // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù…ÙˆØ¸ÙÙŠÙ† Ø§Ù„Ù†Ø´Ø·ÙŠÙ†
        function updateActiveStaff() {
            const container = document.getElementById('activeStaffList');
            const activeStaff = staffMembers.filter(s => s.status === 'active').slice(0, 5);
            
            let html = '';
            activeStaff.forEach(staff => {
                const roleName = staff.r === 'admin' ? 'Ù…Ø¯ÙŠØ±' : 
                               staff.r === 'doctor' ? 'Ø·Ø¨ÙŠØ¨' : 
                               staff.r === 'reception' ? 'Ø§Ø³ØªÙ‚Ø¨Ø§Ù„' : 
                               staff.r === 'lab_tech' ? 'Ù…Ø¹Ù…Ù„' : 
                               staff.r === 'pharmacist' ? 'ØµÙŠØ¯Ù„ÙŠ' : 
                               staff.r === 'nurse' ? 'ØªÙ…Ø±ÙŠØ¶' : staff.r;
                
                html += `
                    <div class="d-flex align-items-center mb-2">
                        <div class="staff-avatar">${staff.name.charAt(0)}</div>
                        <div class="ms-2 flex-grow-1">
                            <div class="d-flex justify-content-between">
                                <small><strong>${staff.name}</strong></small>
                                <small class="badge bg-info">${roleName}</small>
                            </div>
                            <small class="text-muted">${staff.u}</small>
                        </div>
                    </div>
                `;
            });
            
            if (activeStaff.length === 0) {
                html = '<p class="text-muted text-center py-2">Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ù…ÙˆØ¸ÙÙŠÙ† Ù†Ø´Ø·ÙŠÙ†</p>';
            }
            
            container.innerHTML = html;
        }

        // ØªØ­Ø¯ÙŠØ« Ø§Ù„ØªØ­Ø°ÙŠØ±Ø§Øª ÙˆØ§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª
        function updateAdminAlerts() {
            const container = document.getElementById('adminAlerts');
            const alerts = [];
            
            // ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ù…Ø®Ø²ÙˆÙ† Ø§Ù„Ù…Ù†Ø®ÙØ¶
            const lowStock = inventory.filter(item => item.qty < (item.minLevel || 10));
            if (lowStock.length > 0) {
                alerts.push({
                    type: 'warning',
                    message: `âš ï¸ ${lowStock.length} ØµÙ†Ù Ù…Ø®Ø²ÙˆÙ†Ù‡ Ù…Ù†Ø®ÙØ¶`,
                    icon: 'ğŸ“¦'
                });
            }
            
            // ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø£Ø¯ÙˆÙŠØ© Ø§Ù„Ù…Ù†ØªÙ‡ÙŠØ© Ø§Ù„ØµÙ„Ø§Ø­ÙŠØ©
            const expiredItems = inventory.filter(item => {
                if (!item.expiryDate) return false;
                const expiry = new Date(item.expiryDate);
                const today = new Date();
                const diffTime = expiry - today;
                const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));
                return diffDays <= 30 && diffDays > 0;
            });
            
            if (expiredItems.length > 0) {
                alerts.push({
                    type: 'danger',
                    message: `â° ${expiredItems.length} ØµÙ†Ù Ù‚Ø±Ø¨ Ø§Ù†ØªÙ‡Ø§Ø¡ Ø§Ù„ØµÙ„Ø§Ø­ÙŠØ©`,
                    icon: 'â³'
                });
            }
            
            // ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ù…Ø¹Ø§Ù…Ù„Ø§Øª ØºÙŠØ± Ø§Ù„Ù…ÙƒØªÙ…Ù„Ø©
            const pendingLab = labRequests.filter(l => l.status === 'pending').length;
            const pendingRx = pharmOrders.filter(r => r.status === 'pending').length;
            
            if (pendingLab > 0) {
                alerts.push({
                    type: 'info',
                    message: `ğŸ§ª ${pendingLab} ÙØ­Øµ Ù‚ÙŠØ¯ Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø±`,
                    icon: 'â±ï¸'
                });
            }
            
            if (pendingRx > 0) {
                alerts.push({
                    type: 'info',
                    message: `ğŸ’Š ${pendingRx} Ø±ÙˆØ´ØªØ© Ù‚ÙŠØ¯ Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø±`,
                    icon: 'â±ï¸'
                });
            }
            
            let html = '';
            alerts.forEach(alert => {
                const alertClass = alert.type === 'danger' ? 'alert-danger' : 
                                 alert.type === 'warning' ? 'alert-warning' : 'alert-info';
                
                html += `
                    <div class="alert ${alertClass} alert-dismissible fade show py-2" role="alert">
                        <div class="d-flex align-items-center">
                            <span class="fs-5 me-2">${alert.icon}</span>
                            <small>${alert.message}</small>
                        </div>
                        <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
                    </div>
                `;
            });
            
            if (alerts.length === 0) {
                html = '<p class="text-muted text-center py-3">Ù„Ø§ ØªÙˆØ¬Ø¯ ØªØ­Ø°ÙŠØ±Ø§Øª Ø­Ø§Ù„ÙŠØ§Ù‹</p>';
            }
            
            container.innerHTML = html;
        }

        // ØªØ­Ø¯ÙŠØ« Ø¢Ø®Ø± Ø§Ù„Ø£Ù†Ø´Ø·Ø©
        function updateRecentActivities() {
            const container = document.getElementById('recentActivities');
            const activities = [];
            
            // Ø¬Ù…Ø¹ Ø§Ù„Ø£Ù†Ø´Ø·Ø© Ù…Ù† Ø§Ù„Ù…Ø±Ø¶Ù‰
            const recentPatients = patients.slice(-3).reverse();
            recentPatients.forEach(patient => {
                activities.push({
                    type: 'patient',
                    message: `ØªÙ… ØªØ³Ø¬ÙŠÙ„ ${patient.name}`,
                    time: new Date(patient.createdAt).toLocaleTimeString('ar-EG'),
                    icon: 'ğŸ‘¤'
                });
            });
            
            // Ø¬Ù…Ø¹ Ø§Ù„Ø£Ù†Ø´Ø·Ø© Ù…Ù† Ø§Ù„Ù…Ø¹Ù…Ù„
            const recentLab = labRequests.slice(-2).reverse();
            recentLab.forEach(test => {
                activities.push({
                    type: 'lab',
                    message: `ÙØ­Øµ ${test.name} Ù„Ù€ ${test.patientName}`,
                    time: new Date(test.requestedAt).toLocaleTimeString('ar-EG'),
                    icon: 'ğŸ§ª'
                });
            });
            
            // ØªØ±ØªÙŠØ¨ Ø­Ø³Ø¨ Ø§Ù„ÙˆÙ‚Øª
            activities.sort((a, b) => new Date('1970/01/01 ' + b.time) - new Date('1970/01/01 ' + a.time));
            
            let html = '';
            activities.slice(0, 5).forEach(activity => {
                html += `
                    <div class="border-bottom pb-2 mb-2">
                        <div class="d-flex align-items-center">
                            <span class="fs-6 me-2">${activity.icon}</span>
                            <div class="flex-grow-1">
                                <small>${activity.message}</small>
                                <div class="text-muted"><small>${activity.time}</small></div>
                            </div>
                        </div>
                    </div>
                `;
            });
            
            if (activities.length === 0) {
                html = '<p class="text-muted text-center py-3">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø£Ù†Ø´Ø·Ø© Ø­Ø¯ÙŠØ«Ø©</p>';
            }
            
            container.innerHTML = html;
        }

        // Ø¹Ø±Ø¶ ØªØ¨ÙˆÙŠØ¨Ø§Øª Ø§Ù„Ù…Ø¯ÙŠØ±
        function showAdminTab(tab) {
            const tabs = ['dashboard', 'reports', 'patients', 'staff', 'financial', 'settings'];
            tabs.forEach(t => document.getElementById(`admin-${t}`).classList.add('hidden-section'));
            document.getElementById(`admin-${tab}`).classList.remove('hidden-section');
            
            switch(tab) {
                case 'dashboard':
                    updateFinancialStats();
                    updateActiveStaff();
                    updateAdminAlerts();
                    break;
                case 'reports':
                    generatePerformanceReport();
                    createCharts();
                    break;
                case 'patients':
                    loadAdminPatientsTable();
                    break;
                case 'staff':
                    refreshStaffTable();
                    break;
                case 'financial':
                    updateFinancialStats();
                    updateFinancialTransactions();
                    break;
                case 'settings':
                    loadSystemSettings();
                    break;
            }
        }

        // ØªÙˆÙ„ÙŠØ¯ ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ø£Ø¯Ø§Ø¡
        function generatePerformanceReport() {
            const today = new Date().toDateString();
            const todayPatients = patients.filter(p => new Date(p.createdAt).toDateString() === today);
            const activeDoctors = staffMembers.filter(s => s.r === 'doctor' || s.r === 'head_doctor').length;
            
            // Ø­Ø³Ø§Ø¨Ø§Øª Ø§ÙØªØ±Ø§Ø¶ÙŠØ© Ù„Ù„Ø¹Ø±Ø¶
            const avgConsultationTime = todayPatients.length > 0 ? Math.floor(Math.random() * 20) + 10 : 0;
            const patientsPerDoctor = activeDoctors > 0 ? Math.floor(todayPatients.length / Math.max(activeDoctors, 1)) : 0;
            const occupancyRate = Math.floor(Math.random() * 30) + 70;
            const patientSatisfaction = Math.floor(Math.random() * 20) + 80;
            
            document.getElementById('avgConsultationTime').textContent = avgConsultationTime;
            document.getElementById('patientsPerDoctor').textContent = patientsPerDoctor;
            document.getElementById('occupancyRate').textContent = `${occupancyRate}%`;
            document.getElementById('patientSatisfaction').textContent = `${patientSatisfaction}%`;
        }

        // Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø±Ø³ÙˆÙ… Ø§Ù„Ø¨ÙŠØ§Ù†ÙŠØ©
        function createCharts() {
            const today = new Date();
            const last7Days = [];
            for (let i = 6; i >= 0; i--) {
                const date = new Date(today);
                date.setDate(date.getDate() - i);
                last7Days.push(date.toLocaleDateString('ar-EG', { weekday: 'short' }));
            }
            
            // Ø±Ø³Ù… Ø¨ÙŠØ§Ù†ÙŠ Ù„Ù„Ø¥ÙŠØ±Ø§Ø¯Ø§Øª Ø§Ù„ÙŠÙˆÙ…ÙŠØ©
            const revenueCtx = document.getElementById('dailyRevenueChart');
            if (revenueCtx) {
                new Chart(revenueCtx, {
                    type: 'bar',
                    data: {
                        labels: last7Days,
                        datasets: [{
                            label: 'Ø§Ù„Ø¥ÙŠØ±Ø§Ø¯Ø§Øª',
                            data: Array.from({length: 7}, () => Math.floor(Math.random() * 1000000) + 500000),
                            backgroundColor: 'rgba(40, 167, 69, 0.5)',
                            borderColor: 'rgb(40, 167, 69)',
                            borderWidth: 1
                        }]
                    },
                    options: {
                        responsive: true,
                        plugins: {
                            legend: {
                                display: false
                            }
                        },
                        scales: {
                            y: {
                                beginAtZero: true,
                                ticks: {
                                    callback: function(value) {
                                        return value / 1000 + 'K';
                                    }
                                }
                            }
                        }
                    }
                });
            }
            
            // Ø±Ø³Ù… Ø¨ÙŠØ§Ù†ÙŠ Ù„ØªÙˆØ²ÙŠØ¹ Ø§Ù„Ù…Ø±Ø¶Ù‰
            const patientsCtx = document.getElementById('patientsChart');
            if (patientsCtx) {
                new Chart(patientsCtx, {
                    type: 'doughnut',
                    data: {
                        labels: ['Ø°ÙƒÙˆØ±', 'Ø¥Ù†Ø§Ø«'],
                        datasets: [{
                            data: [
                                patients.filter(p => p.gender === 'Ø°ÙƒØ±').length,
                                patients.filter(p => p.gender === 'Ø£Ù†Ø«Ù‰').length
                            ],
                            backgroundColor: [
                                'rgba(54, 162, 235, 0.5)',
                                'rgba(255, 99, 132, 0.5)'
                            ],
                            borderColor: [
                                'rgb(54, 162, 235)',
                                'rgb(255, 99, 132)'
                            ],
                            borderWidth: 1
                        }]
                    },
                    options: {
                        responsive: true,
                        plugins: {
                            legend: {
                                position: 'bottom'
                            }
                        }
                    }
                });
            }
        }

        // ØªØ­Ù…ÙŠÙ„ Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ù…Ø±Ø¶Ù‰ Ù„Ù„Ù…Ø¯ÙŠØ±
        function loadAdminPatientsTable() {
            const container = document.getElementById('adminPatientsTable');
            let html = '';
            
            patients.slice(-20).reverse().forEach(patient => {
                const date = new Date(patient.createdAt).toLocaleDateString('ar-EG');
                const status = patient.department === 'completed' ? 'Ù…ÙƒØªÙ…Ù„' : 
                             patient.department === 'pharmacy' ? 'ÙÙŠ Ø§Ù„ØµÙŠØ¯Ù„ÙŠØ©' :
                             patient.department === 'lab' ? 'ÙÙŠ Ø§Ù„Ù…Ø¹Ù…Ù„' :
                             patient.department === 'doctor' ? 'ÙÙŠ Ø§Ù„Ø¹ÙŠØ§Ø¯Ø©' : 'ÙÙŠ Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø±';
                
                const statusClass = patient.department === 'completed' ? 'bg-success' :
                                 patient.department === 'pharmacy' ? 'bg-warning' :
                                 patient.department === 'lab' ? 'bg-danger' :
                                 patient.department === 'doctor' ? 'bg-info' : 'bg-secondary';
                
                html += `
                    <div class="border-bottom pb-2 mb-2">
                        <div class="d-flex justify-content-between align-items-center">
                            <div>
                                <strong>${patient.name}</strong><br>
                                <small class="text-muted">${patient.age} Ø³Ù†Ø© | ${patient.gender || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯'} | ${date}</small>
                            </div>
                            <div class="text-end">
                                <span class="badge ${statusClass}">${status}</span><br>
                                <small class="text-muted">${patient.phone || 'Ù„Ø§ ÙŠÙˆØ¬Ø¯'}</small>
                            </div>
                        </div>
                    </div>
                `;
            });
            
            if (patients.length === 0) {
                html = '<div class="text-center text-muted p-4">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø³Ø¬Ù„Ø§Øª Ù…Ø±Ø¶Ù‰</div>';
            }
            
            container.innerHTML = html;
        }

        // Ø¨Ø­Ø« Ø§Ù„Ù…Ø±Ø¶Ù‰ ÙÙŠ Ù‚Ø³Ù… Ø§Ù„Ù…Ø¯ÙŠØ±
        function searchAdminPatients(query) {
            const container = document.getElementById('adminPatientsTable');
            const filtered = patients.filter(p => 
                p.name.toLowerCase().includes(query.toLowerCase()) ||
                p.phone.includes(query) ||
                p.id.toString().includes(query)
            );
            
            let html = '';
            filtered.slice(0, 20).forEach(patient => {
                const date = new Date(patient.createdAt).toLocaleDateString('ar-EG');
                html += `
                    <div class="border-bottom pb-2 mb-2">
                        <div class="d-flex justify-content-between">
                            <div>
                                <strong>${patient.name}</strong><br>
                                <small class="text-muted">${patient.age} Ø³Ù†Ø© | ${date}</small>
                            </div>
                            <div class="text-end">
                                <small>${patient.phone || 'Ù„Ø§ ÙŠÙˆØ¬Ø¯'}</small>
                            </div>
                        </div>
                    </div>
                `;
            });
            
            if (filtered.length === 0) {
                html = '<div class="text-center text-muted p-4">Ù„Ø§ ØªÙˆØ¬Ø¯ Ù†ØªØ§Ø¦Ø¬</div>';
            }
            
            container.innerHTML = html;
        }

        // Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…ÙˆØ¸ÙÙŠÙ†
        function refreshStaffTable() {
            const tbody = document.getElementById('staffTableBody');
            let html = '';
            
            staffMembers.forEach(staff => {
                const roleName = staff.r === 'admin' ? 'Ù…Ø¯ÙŠØ±' : 
                               staff.r === 'doctor' ? 'Ø·Ø¨ÙŠØ¨' : 
                               staff.r === 'reception' ? 'Ø§Ø³ØªÙ‚Ø¨Ø§Ù„' : 
                               staff.r === 'lab_tech' ? 'Ù…Ø¹Ù…Ù„' : 
                               staff.r === 'pharmacist' ? 'ØµÙŠØ¯Ù„ÙŠ' : 
                               staff.r === 'nurse' ? 'ØªÙ…Ø±ÙŠØ¶' : staff.r;
                
                const lastLogin = staff.lastLogin ? new Date(staff.lastLogin).toLocaleDateString('ar-EG') : 'Ù„Ù… ÙŠØ³Ø¬Ù„ Ø¯Ø®ÙˆÙ„';
                const statusBadge = staff.status === 'active' ? 
                    '<span class="badge bg-success">Ù†Ø´Ø·</span>' : 
                    '<span class="badge bg-danger">Ù…Ø¹Ø·Ù„</span>';
                
                html += `
                    <tr>
                        <td>${staff.name}</td>
                        <td><span class="badge bg-info">${roleName}</span></td>
                        <td><small>${lastLogin}</small></td>
                        <td>${statusBadge}</td>
                        <td>
                            <button class="btn btn-sm btn-outline-warning me-1" onclick="editStaff('${staff.u}')">âœï¸</button>
                            <button class="btn btn-sm btn-outline-danger" onclick="deleteStaff('${staff.u}')" ${staff.u === currentUser.u ? 'disabled' : ''}>ğŸ—‘ï¸</button>
                        </td>
                    </tr>
                `;
            });
            
            if (staffMembers.length === 0) {
                html = `
                    <tr>
                        <td colspan="5" class="text-center text-muted py-4">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø³Ø¬Ù„Ø§Øª Ù…ÙˆØ¸ÙÙŠÙ†</td>
                    </tr>
                `;
            }
            
            tbody.innerHTML = html;
        }

        function addNewStaff() {
            const username = document.getElementById('newStaffUser').value.trim();
            const password = document.getElementById('newStaffPass').value.trim();
            const role = document.getElementById('newStaffRole').value;
            
            if (!username || !password) {
                alert('âš ï¸ Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… ÙˆÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±!');
                return;
            }
            
            if (staffMembers.find(s => s.u === username)) {
                alert('âš ï¸ Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ù…ÙˆØ¬ÙˆØ¯ Ù…Ø³Ø¨Ù‚Ø§Ù‹!');
                return;
            }
            
            if (password.length < 4) {
                alert('âš ï¸ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± ÙŠØ¬Ø¨ Ø£Ù† ØªÙƒÙˆÙ† 4 Ø£Ø­Ø±Ù Ø¹Ù„Ù‰ Ø§Ù„Ø£Ù‚Ù„!');
                return;
            }
            
            const newStaff = {
                u: username,
                p: password,
                r: role,
                name: username,
                status: 'active',
                permissions: [],
                created: new Date().toISOString(),
                lastLogin: null
            };
            
            staffMembers.push(newStaff);
            localStorage.setItem('shifa_staff', JSON.stringify(staffMembers));
            
            document.getElementById('newStaffUser').value = '';
            document.getElementById('newStaffPass').value = '';
            
            refreshStaffTable();
            updateActiveStaff();
            showNotification('âœ… ØªÙ… Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…ÙˆØ¸Ù', `ØªÙ… Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…ÙˆØ¸Ù ${username} Ø¨Ù†Ø¬Ø§Ø­`);
        }

        function editStaff(username) {
            const staff = staffMembers.find(s => s.u === username);
            if (!staff) return;
            
            const newName = prompt('Ø£Ø¯Ø®Ù„ Ø§Ù„Ø§Ø³Ù… Ø§Ù„Ø¬Ø¯ÙŠØ¯:', staff.name);
            if (!newName) return;
            
            const newRole = prompt('Ø£Ø¯Ø®Ù„ Ø§Ù„Ø¯ÙˆØ± Ø§Ù„Ø¬Ø¯ÙŠØ¯:', staff.r);
            if (!newRole) return;
            
            const newStatus = confirm(`Ù‡Ù„ ØªØ±ÙŠØ¯ ${staff.status === 'active' ? 'ØªØ¹Ø·ÙŠÙ„' : 'ØªÙØ¹ÙŠÙ„'} Ø§Ù„Ø­Ø³Ø§Ø¨ØŸ`) ? 
                (staff.status === 'active' ? 'inactive' : 'active') : staff.status;
            
            staff.name = newName;
            staff.r = newRole;
            staff.status = newStatus;
            
            localStorage.setItem('shifa_staff', JSON.stringify(staffMembers));
            refreshStaffTable();
            updateActiveStaff();
            showNotification('âœ… ØªÙ… ØªØ­Ø¯ÙŠØ« Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…ÙˆØ¸Ù', `ØªÙ… ØªØ­Ø¯ÙŠØ« Ø¨ÙŠØ§Ù†Ø§Øª ${username} Ø¨Ù†Ø¬Ø§Ø­`);
        }

        function deleteStaff(username) {
            if (!confirm(`Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ø§Ù„Ù…ÙˆØ¸Ù ${username}ØŸ\nÙ‡Ø°Ø§ Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡ Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø§Ù„ØªØ±Ø§Ø¬Ø¹ Ø¹Ù†Ù‡.`)) return;
            
            if (username === currentUser.u) {
                alert('âš ï¸ Ù„Ø§ ÙŠÙ…ÙƒÙ†Ùƒ Ø­Ø°Ù Ø­Ø³Ø§Ø¨Ùƒ Ø§Ù„Ø®Ø§Øµ!');
                return;
            }
            
            staffMembers = staffMembers.filter(s => s.u !== username);
            localStorage.setItem('shifa_staff', JSON.stringify(staffMembers));
            refreshStaffTable();
            updateActiveStaff();
            showNotification('âœ… ØªÙ… Ø­Ø°Ù Ø§Ù„Ù…ÙˆØ¸Ù', `ØªÙ… Ø­Ø°Ù Ø§Ù„Ù…ÙˆØ¸Ù ${username} Ø¨Ù†Ø¬Ø§Ø­`);
        }

        function resetUserPassword() {
            const username = prompt('Ø£Ø¯Ø®Ù„ Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ù„Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±:');
            if (!username) return;
            
            const staff = staffMembers.find(s => s.u === username);
            if (!staff) {
                alert('âš ï¸ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯!');
                return;
            }
            
            const newPassword = prompt('Ø£Ø¯Ø®Ù„ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©:');
            if (!newPassword) return;
            
            const confirmPassword = prompt('Ø£Ø¹Ø¯ Ø¥Ø¯Ø®Ø§Ù„ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±:');
            if (newPassword !== confirmPassword) {
                alert('âš ï¸ ÙƒÙ„Ù…Ø§Øª Ø§Ù„Ù…Ø±ÙˆØ± ØºÙŠØ± Ù…ØªØ·Ø§Ø¨Ù‚Ø©!');
                return;
            }
            
            staff.p = newPassword;
            localStorage.setItem('shifa_staff', JSON.stringify(staffMembers));
            showNotification('âœ… ØªÙ… Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±', `ØªÙ… Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† ÙƒÙ„Ù…Ø© Ù…Ø±ÙˆØ± ${username} Ø¨Ù†Ø¬Ø§Ø­`);
        }

        function exportUserActivity() {
            const activityData = staffMembers.map(staff => ({
                username: staff.u,
                name: staff.name,
                role: staff.r,
                status: staff.status,
                created: staff.created,
                lastLogin: staff.lastLogin
            }));
            
            const blob = new Blob([JSON.stringify(activityData, null, 2)], {type: 'application/json'});
            const a = document.createElement('a');
            a.href = URL.createObjectURL(blob);
            a.download = `user_activity_${new Date().toISOString().split('T')[0]}.json`;
            a.click();
            
            showNotification('âœ… ØªÙ… Ø§Ù„ØªØµØ¯ÙŠØ±', 'ØªÙ… ØªØµØ¯ÙŠØ± Ù†Ø´Ø§Ø· Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ† Ø¨Ù†Ø¬Ø§Ø­');
        }

        // ØªØµØ¯ÙŠØ± Ø§Ù„Ø³Ø¬Ù„Ø§Øª Ø§Ù„Ø·Ø¨ÙŠØ©
        function exportMedicalRecords() {
            const records = patients.map(patient => ({
                id: patient.id,
                name: patient.name,
                age: patient.age,
                gender: patient.gender,
                phone: patient.phone,
                address: patient.address,
                medicalHistory: patient.medicalHistory,
                visitType: patient.visitType,
                ticket: patient.ticket,
                createdAt: patient.createdAt,
                updatedAt: patient.updatedAt,
                status: patient.department
            }));
            
            const blob = new Blob([JSON.stringify(records, null, 2)], {type: 'application/json'});
            const a = document.createElement('a');
            a.href = URL.createObjectURL(blob);
            a.download = `medical_records_${new Date().toISOString().split('T')[0]}.json`;
            a.click();
            
            showNotification('âœ… ØªÙ… Ø§Ù„ØªØµØ¯ÙŠØ±', 'ØªÙ… ØªØµØ¯ÙŠØ± Ø§Ù„Ø³Ø¬Ù„Ø§Øª Ø§Ù„Ø·Ø¨ÙŠØ© Ø¨Ù†Ø¬Ø§Ø­');
        }

        // ØªØµØ¯ÙŠØ± Ø§Ù„ØªÙ‚Ø±ÙŠØ± Ù„Ø¥ÙƒØ³Ù„
        function exportReportToExcel() {
            const today = new Date().toDateString();
            const todayPatients = patients.filter(p => new Date(p.createdAt).toDateString() === today);
            const todayLab = labRequests.filter(l => new Date(l.requestedAt).toDateString() === today);
            const todayRx = pharmOrders.filter(r => new Date(r.createdAt).toDateString() === today);
            
            const report = {
                date: new Date().toISOString(),
                summary: {
                    totalPatients: patients.length,
                    todayPatients: todayPatients.length,
                    todayRevenue: (financials.clinic + financials.lab + financials.pharSales),
                    activeStaff: staffMembers.filter(s => s.status === 'active').length
                },
                patients: todayPatients.map(p => ({
                    name: p.name,
                    age: p.age,
                    gender: p.gender,
                    ticket: p.ticket,
                    time: new Date(p.createdAt).toLocaleTimeString('ar-EG')
                })),
                financial: {
                    clinic: financials.clinic,
                    lab: financials.lab,
                    pharmacy: financials.pharSales,
                    total: financials.clinic + financials.lab + financials.pharSales
                }
            };
            
            const blob = new Blob([JSON.stringify(report, null, 2)], {type: 'application/json'});
            const a = document.createElement('a');
            a.href = URL.createObjectURL(blob);
            a.download = `daily_report_${new Date().toISOString().split('T')[0]}.json`;
            a.click();
            
            showNotification('âœ… ØªÙ… Ø§Ù„ØªØµØ¯ÙŠØ±', 'ØªÙ… ØªØµØ¯ÙŠØ± Ø§Ù„ØªÙ‚Ø±ÙŠØ± Ø¨Ù†Ø¬Ø§Ø­');
        }

        // Ø·Ø¨Ø§Ø¹Ø© Ø§Ù„ØªÙ‚Ø±ÙŠØ± Ø§Ù„ÙŠÙˆÙ…ÙŠ
        function printDailyReport() {
            const today = new Date().toDateString();
            const todayPatients = patients.filter(p => new Date(p.createdAt).toDateString() === today);
            const todayLab = labRequests.filter(l => new Date(l.requestedAt).toDateString() === today);
            const todayRx = pharmOrders.filter(r => new Date(r.createdAt).toDateString() === today);
            
            const report = `
                <div class="text-center">
                    <h3>ğŸ“Š ØªÙ‚Ø±ÙŠØ± Ø£Ø¯Ø§Ø¡ ÙŠÙˆÙ…ÙŠ</h3>
                    <p>${new Date().toLocaleDateString('ar-EG')}</p>
                </div>
                <hr>
                
                <h5>ğŸ“ˆ Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„Ø¹Ø§Ù…Ø©:</h5>
                <table class="table table-bordered">
                    <tr><td>Ø¹Ø¯Ø¯ Ø§Ù„Ù…Ø±Ø¶Ù‰ Ø§Ù„ÙŠÙˆÙ…</td><td><strong>${todayPatients.length}</strong></td></tr>
                    <tr><td>Ø¹Ø¯Ø¯ Ø§Ù„ÙØ­ÙˆØµØ§Øª</td><td><strong>${todayLab.length}</strong></td></tr>
                    <tr><td>Ø¹Ø¯Ø¯ Ø§Ù„Ø±ÙˆØ´ØªØ§Øª</td><td><strong>${todayRx.length}</strong></td></tr>
                    <tr><td>Ø¹Ø¯Ø¯ Ø§Ù„Ù…ÙˆØ¸ÙÙŠÙ† Ø§Ù„Ù†Ø´Ø·ÙŠÙ†</td><td><strong>${staffMembers.filter(s => s.status === 'active').length}</strong></td></tr>
                </table>
                
                <h5>ğŸ’° Ø§Ù„Ø¥ÙŠØ±Ø§Ø¯Ø§Øª:</h5>
                <table class="table table-bordered">
                    <tr><td>Ø±Ø³ÙˆÙ… Ø§Ù„Ø¹ÙŠØ§Ø¯Ø©</td><td><strong>${financials.clinic.toLocaleString()} Ø¬</strong></td></tr>
                    <tr><td>ÙØ­ÙˆØµØ§Øª Ø§Ù„Ù…Ø¹Ù…Ù„</td><td><strong>${financials.lab.toLocaleString()} Ø¬</strong></td></tr>
                    <tr><td>Ù…Ø¨ÙŠØ¹Ø§Øª Ø§Ù„ØµÙŠØ¯Ù„ÙŠØ©</td><td><strong>${financials.pharSales.toLocaleString()} Ø¬</strong></td></tr>
                    <tr class="table-success"><td>Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ</td><td><strong>${(financials.clinic + financials.lab + financials.pharSales).toLocaleString()} Ø¬</strong></td></tr>
                </table>
                
                <div class="text-center mt-4">
                    <p>ğŸ¥ Ù…Ø¬Ù…Ø¹ Ø§Ù„Ø´ÙØ§Ø¡ Ø§Ù„Ø·Ø¨ÙŠ - Ø§Ù„Ø³ÙˆØ¯Ø§Ù† - Ø¬Ù„Ù‚Ù†ÙŠ</p>
                    <small>ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„ØªÙ‚Ø±ÙŠØ± ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹ Ø¨ÙˆØ§Ø³Ø·Ø© Ø§Ù„Ù†Ø¸Ø§Ù… Ø§Ù„Ø°ÙƒÙŠ</small>
                </div>
            `;
            
            document.getElementById('printContent').innerHTML = report;
            document.getElementById('printTitle').textContent = 'ØªÙ‚Ø±ÙŠØ± Ø£Ø¯Ø§Ø¡ ÙŠÙˆÙ…ÙŠ';
            document.getElementById('printDate').textContent = new Date().toLocaleDateString('ar-EG');
            
            window.print();
        }

        // ØªÙˆÙ„ÙŠØ¯ ØªÙ‚Ø±ÙŠØ± Ù…Ø§Ù„ÙŠ Ù…ÙØµÙ„
        function generateFinancialReport() {
            const report = `
                <h4>ğŸ“„ ØªÙ‚Ø±ÙŠØ± Ù…Ø§Ù„ÙŠ Ù…ÙØµÙ„</h4>
                <p><strong>Ø§Ù„ØªØ§Ø±ÙŠØ®:</strong> ${new Date().toLocaleDateString('ar-EG')}</p>
                
                <h5>ğŸ“Š Ù…Ù„Ø®Øµ Ø§Ù„Ø¥ÙŠØ±Ø§Ø¯Ø§Øª:</h5>
                <p>â€¢ Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø¥ÙŠØ±Ø§Ø¯Ø§Øª Ø§Ù„Ø¹ÙŠØ§Ø¯Ø©: <strong>${financials.clinic.toLocaleString()} Ø¬</strong></p>
                <p>â€¢ Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø¥ÙŠØ±Ø§Ø¯Ø§Øª Ø§Ù„Ù…Ø¹Ù…Ù„: <strong>${financials.lab.toLocaleString()} Ø¬</strong></p>
                <p>â€¢ Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ù…Ø¨ÙŠØ¹Ø§Øª Ø§Ù„ØµÙŠØ¯Ù„ÙŠØ©: <strong>${financials.pharSales.toLocaleString()} Ø¬</strong></p>
                <p>â€¢ Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø£Ø±Ø¨Ø§Ø­: <strong>${financials.pharProfit.toLocaleString()} Ø¬</strong></p>
                <p>â€¢ Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„ÙƒÙ„ÙŠ: <strong>${(financials.clinic + financials.lab + financials.pharSales).toLocaleString()} Ø¬</strong></p>
                
                <h5>ğŸ‘¥ Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª:</h5>
                <p>â€¢ Ø¹Ø¯Ø¯ Ø§Ù„Ù…Ø±Ø¶Ù‰: <strong>${patients.length}</strong></p>
                <p>â€¢ Ø¹Ø¯Ø¯ Ø§Ù„Ù…ÙˆØ¸ÙÙŠÙ†: <strong>${staffMembers.length}</strong></p>
                <p>â€¢ Ø¹Ø¯Ø¯ Ø£ØµÙ†Ø§Ù Ø§Ù„Ù…Ø®Ø²ÙˆÙ†: <strong>${inventory.length}</strong></p>
                
                <div class="alert alert-info mt-3">
                    <small>ğŸ’¡ Ù‡Ø°Ø§ Ø§Ù„ØªÙ‚Ø±ÙŠØ± ØªÙ… Ø¥Ù†Ø´Ø§Ø¤Ù‡ ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹. ÙŠÙ…ÙƒÙ†Ùƒ ØªØµØ¯ÙŠØ± Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù„Ù„ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ù…ÙØµÙ„.</small>
                </div>
            `;
            
            document.getElementById('printContent').innerHTML = report;
            document.getElementById('printTitle').textContent = 'ØªÙ‚Ø±ÙŠØ± Ù…Ø§Ù„ÙŠ Ù…ÙØµÙ„';
            window.print();
        }

        // ØªÙˆÙ„ÙŠØ¯ ØªÙ‚Ø±ÙŠØ± ÙŠÙˆÙ…ÙŠ
        function generateDailyReport() {
            generateFinancialReport();
        }

        // Ù…Ø³Ø­ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
        function clearAllPatientData() {
            if (!confirm('âš ï¸ ØªØ­Ø°ÙŠØ±: Ù‡Ø°Ù‡ Ø§Ù„Ø¹Ù…Ù„ÙŠØ© Ø³ØªØ¤Ø¯ÙŠ Ø¥Ù„Ù‰ Ù…Ø³Ø­ Ø¬Ù…ÙŠØ¹ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø±Ø¶Ù‰!\nÙ‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ØŸ')) return;
            
            if (!confirm('âŒ ØªØ£ÙƒÙŠØ¯ Ù†Ù‡Ø§Ø¦ÙŠ: Ø¬Ù…ÙŠØ¹ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø±Ø¶Ù‰ Ø³ØªØ­Ø°Ù ÙˆÙ„Ø§ ÙŠÙ…ÙƒÙ† Ø§Ø³ØªØ¹Ø§Ø¯ØªÙ‡Ø§!')) return;
            
            patients = [];
            labRequests = [];
            pharmOrders = [];
            nursingOrders = [];
            
            localStorage.setItem('shifa_pats', JSON.stringify([]));
            localStorage.setItem('shifa_lab', JSON.stringify([]));
            localStorage.setItem('shifa_rx', JSON.stringify([]));
            localStorage.setItem('shifa_nursing', JSON.stringify([]));
            
            updateFinancialStats();
            updateBadges();
            loadAdminPatientsTable();
            
            showNotification('âœ… ØªÙ… Ø§Ù„Ù…Ø³Ø­', 'ØªÙ… Ù…Ø³Ø­ Ø¬Ù…ÙŠØ¹ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø±Ø¶Ù‰ Ø¨Ù†Ø¬Ø§Ø­');
        }

        // ØªØµÙÙŠØ± Ø§Ù„Ù‚Ø³Ù…
        function resetSection(section) {
            let message = '';
            let confirmMessage = '';
            
            switch(section) {
                case 'pats':
                    message = 'Ù‚Ø³Ù… Ø§Ù„Ø§Ø³ØªÙ‚Ø¨Ø§Ù„';
                    confirmMessage = 'Ù‡Ù„ ØªØ±ÙŠØ¯ ØªØµÙÙŠØ± Ø¬Ù…ÙŠØ¹ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø§Ø³ØªÙ‚Ø¨Ø§Ù„ ÙˆØ§Ù„Ù…Ø±Ø¶Ù‰ØŸ';
                    break;
                case 'lab':
                    message = 'Ù‚Ø³Ù… Ø§Ù„Ù…Ø¹Ù…Ù„';
                    confirmMessage = 'Ù‡Ù„ ØªØ±ÙŠØ¯ ØªØµÙÙŠØ± Ø¬Ù…ÙŠØ¹ Ø·Ù„Ø¨Ø§Øª ÙˆÙ†ØªØ§Ø¦Ø¬ Ø§Ù„Ù…Ø¹Ù…Ù„ØŸ';
                    break;
                case 'rx':
                    message = 'Ù‚Ø³Ù… Ø§Ù„ØµÙŠØ¯Ù„ÙŠØ©';
                    confirmMessage = 'Ù‡Ù„ ØªØ±ÙŠØ¯ ØªØµÙÙŠØ± Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø±ÙˆØ´ØªØ§Øª ÙˆØ§Ù„Ù…Ø®Ø²ÙˆÙ†ØŸ';
                    break;
                case 'nursing':
                    message = 'Ù‚Ø³Ù… Ø§Ù„ØªÙ…Ø±ÙŠØ¶';
                    confirmMessage = 'Ù‡Ù„ ØªØ±ÙŠØ¯ ØªØµÙÙŠØ± Ø¬Ù…ÙŠØ¹ Ù…Ù‡Ø§Ù… Ø§Ù„ØªÙ…Ø±ÙŠØ¶ØŸ';
                    break;
                default:
                    return;
            }
            
            if (!confirm(`âš ï¸ ${confirmMessage}`)) return;
            
            switch(section) {
                case 'pats':
                    patients = patients.filter(p => p.department === 'completed');
                    localStorage.setItem('shifa_pats', JSON.stringify(patients));
                    break;
                case 'lab':
                    labRequests = labRequests.filter(l => l.status === 'completed');
                    localStorage.setItem('shifa_lab', JSON.stringify(labRequests));
                    break;
                case 'rx':
                    pharmOrders = pharmOrders.filter(r => r.status === 'dispensed');
                    localStorage.setItem('shifa_rx', JSON.stringify(pharmOrders));
                    break;
                case 'nursing':
                    nursingOrders = [];
                    nursingTasks = [];
                    localStorage.setItem('shifa_nursing', JSON.stringify([]));
                    localStorage.setItem('shifa_nursing_tasks', JSON.stringify([]));
                    break;
            }
            
            updateBadges();
            updateFinancialStats();
            showNotification('ğŸ”„ ØªÙ… Ø§Ù„ØªØµÙÙŠØ±', `ØªÙ… ØªØµÙÙŠØ± ${message} Ø¨Ù†Ø¬Ø§Ø­`);
        }

        // Ø¥ØºÙ„Ø§Ù‚ Ø§Ù„ÙŠÙˆÙ…
        function resetAllDay() {
            if (!confirm('ğŸ“Š Ù‡Ù„ ØªØ±ÙŠØ¯ Ø¥ØºÙ„Ø§Ù‚ Ø§Ù„ÙŠÙˆÙ… ÙˆØ­ÙØ¸ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§ØªØŸ')) return;
            
            // Ø­ÙØ¸ Ù†Ø³Ø®Ø© Ø§Ø­ØªÙŠØ§Ø·ÙŠØ©
            const backup = {
                date: new Date().toISOString(),
                patients: patients.length,
                labRequests: labRequests.length,
                pharmOrders: pharmOrders.length,
                financials: {
                    clinic: financials.clinic,
                    lab: financials.lab,
                    pharSales: financials.pharSales,
                    pharProfit: financials.pharProfit
                },
                timestamp: new Date().getTime()
            };
            
            backups.push(backup);
            if (backups.length > 30) backups.shift();
            localStorage.setItem('shifa_backups', JSON.stringify(backups));
            
            // ØªØ­Ø¯ÙŠØ« Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø¥ÙŠØ±Ø§Ø¯Ø§Øª
            financials.total = (financials.total || 0) + financials.clinic + financials.lab + financials.pharSales;
            localStorage.setItem('shifa_fin', JSON.stringify(financials));
            
            // Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø¥ÙŠØ±Ø§Ø¯Ø§Øª Ø§Ù„ÙŠÙˆÙ…
            financials.clinic = 0;
            financials.lab = 0;
            financials.pharSales = 0;
            financials.pharProfit = 0;
            localStorage.setItem('shifa_fin', JSON.stringify(financials));
            
            // ØªØ­Ø¯ÙŠØ« Ø§Ù„ÙˆØ§Ø¬Ù‡Ø©
            updateFinancialStats();
            document.getElementById('backupCount').textContent = backups.length;
            
            showNotification('ğŸ“Š ØªÙ… Ø¥ØºÙ„Ø§Ù‚ Ø§Ù„ÙŠÙˆÙ…', 'ØªÙ… Ø­ÙØ¸ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ÙˆØ¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø¥ÙŠØ±Ø§Ø¯Ø§Øª Ø§Ù„ÙŠÙˆÙ…');
        }

        // Ù†Ø³Ø® Ø§Ø­ØªÙŠØ§Ø·ÙŠ Ù„Ù„Ø¨ÙŠØ§Ù†Ø§Øª
        function backupAllData() {
            const backupData = {
                date: new Date().toISOString(),
                patients: patients,
                labRequests: labRequests,
                pharmOrders: pharmOrders,
                nursingOrders: nursingOrders,
                inventory: inventory,
                financials: financials,
                staffMembers: staffMembers,
                labTests: labTests,
                medicalLibrary: medicalLibrary,
                nurses: nurses,
                systemLogs: systemLogs
            };
            
            const blob = new Blob([JSON.stringify(backupData, null, 2)], {type: 'application/json'});
            const a = document.createElement('a');
            a.href = URL.createObjectURL(blob);
            a.download = `shifa_backup_${new Date().toISOString().split('T')[0]}_${Date.now()}.json`;
            a.click();
            
            // Ø¥Ø¶Ø§ÙØ© Ø¥Ù„Ù‰ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù†Ø³Ø® Ø§Ù„Ø§Ø­ØªÙŠØ§Ø·ÙŠØ©
            backups.push({
                filename: a.download,
                date: new Date().toISOString(),
                size: blob.size
            });
            localStorage.setItem('shifa_backups', JSON.stringify(backups));
            document.getElementById('backupCount').textContent = backups.length;
            
            showNotification('ğŸ’¾ ØªÙ… Ø§Ù„Ù†Ø³Ø® Ø§Ù„Ø§Ø­ØªÙŠØ§Ø·ÙŠ', 'ØªÙ… Ø­ÙØ¸ Ù†Ø³Ø®Ø© Ø§Ø­ØªÙŠØ§Ø·ÙŠØ© Ù…Ù† Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª');
        }

        // ØªØ­Ù…ÙŠÙ„ Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ù†Ø¸Ø§Ù…
        function loadSystemSettings() {
            const settings = JSON.parse(localStorage.getItem('shifa_settings') || '{}');
            
            if (settings.notifications !== undefined) {
                document.getElementById('notificationsEnabled').checked = settings.notifications;
            }
            if (settings.sound !== undefined) {
                document.getElementById('soundEnabled').checked = settings.sound;
            }
            if (settings.autoBackup !== undefined) {
                document.getElementById('autoBackupEnabled').checked = settings.autoBackup;
            }
            if (settings.autoSync !== undefined) {
                document.getElementById('autoSyncEnabled').checked = settings.autoSync;
            }
            if (settings.syncInterval !== undefined) {
                document.getElementById('syncInterval').value = settings.syncInterval;
            }
            if (settings.backupLimit !== undefined) {
                document.getElementById('backupLimit').value = settings.backupLimit;
            }
            
            // Ø­Ø³Ø§Ø¨ Ù…Ø³Ø§Ø­Ø© Ø§Ù„ØªØ®Ø²ÙŠÙ†
            let totalStorage = 0;
            const keys = Object.keys(localStorage);
            keys.forEach(key => {
                const data = localStorage.getItem(key);
                if (data) totalStorage += data.length * 2; // ØªÙ‚Ø¯ÙŠØ± Ø¨Ø§Ù„Ø¨Ø§ÙŠØª
            });
            
            const storageKB = (totalStorage / 1024).toFixed(2);
            const storageMB = (totalStorage / (1024 * 1024)).toFixed(2);
            
            if (totalStorage > 1024 * 1024) {
                document.getElementById('storageUsage').textContent = `${storageMB} MB`;
            } else {
                document.getElementById('storageUsage').textContent = `${storageKB} KB`;
            }
            
            document.getElementById('backupCount').textContent = backups.length;
            document.getElementById('lastUpdate').textContent = new Date().toLocaleDateString('ar-EG');
            
            // ÙØ­Øµ ØµØ­Ø© Ø§Ù„Ù†Ø¸Ø§Ù…
            const systemHealth = document.getElementById('systemHealth');
            const lastSystemCheck = document.getElementById('lastSystemCheck');
            
            const errors = [];
            if (patients.length === 0) errors.push('Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ø±Ø¶Ù‰');
            if (staffMembers.length === 0) errors.push('Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª Ù…ÙˆØ¸ÙÙŠÙ†');
            if (inventory.length === 0) errors.push('Ø§Ù„Ù…Ø®Ø²ÙˆÙ† ÙØ§Ø±Øº');
            
            if (errors.length === 0) {
                systemHealth.textContent = 'Ø¬ÙŠØ¯Ø©';
                systemHealth.className = 'health-good';
            } else if (errors.length <= 2) {
                systemHealth.textContent = 'ØªØ­ØªØ§Ø¬ ØªØ­Ø³ÙŠÙ†';
                systemHealth.className = 'health-warning';
            } else {
                systemHealth.textContent = 'Ø­Ø±Ø¬Ø©';
                systemHealth.className = 'health-critical';
            }
            
            lastSystemCheck.textContent = new Date().toLocaleTimeString('ar-EG');
        }

        // Ø­ÙØ¸ Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ù†Ø¸Ø§Ù…
        function saveSystemSettings() {
            const settings = {
                notifications: document.getElementById('notificationsEnabled').checked,
                sound: document.getElementById('soundEnabled').checked,
                autoBackup: document.getElementById('autoBackupEnabled').checked,
                autoSync: document.getElementById('autoSyncEnabled').checked,
                syncInterval: document.getElementById('syncInterval').value,
                backupLimit: document.getElementById('backupLimit').value
            };
            
            localStorage.setItem('shifa_settings', JSON.stringify(settings));
            
            // ØªØ­Ø¯ÙŠØ« ÙØªØ±Ø© Ø§Ù„Ù…Ø²Ø§Ù…Ù†Ø© Ø¥Ø°Ø§ ÙƒØ§Ù†Øª Ù…ÙØ¹Ù„Ø©
            if (SYNC_INTERVAL && settings.autoSync) {
                clearInterval(SYNC_INTERVAL);
                SYNC_INTERVAL = setInterval(manualSync, parseInt(settings.syncInterval) * 60000);
            }
            
            showNotification('âš™ï¸ ØªÙ… Ø§Ù„Ø­ÙØ¸', 'ØªÙ… Ø­ÙØ¸ Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ù†Ø¸Ø§Ù… Ø¨Ù†Ø¬Ø§Ø­');
        }

        // Ø§Ù„Ù…ÙƒØªØ¨Ø© Ø§Ù„Ø·Ø¨ÙŠØ©
        function searchMedicalLibrary() {
            const query = document.getElementById('searchMedicalLibrary').value.toLowerCase();
            const container = document.getElementById('medicalLibraryContent');
            
            let html = '';
            if (!query) {
                medicalLibrary.slice(0, 5).forEach(item => {
                    const category = item.category === 'diseases' ? 'Ø£Ù…Ø±Ø§Ø¶' :
                                   item.category === 'drugs' ? 'Ø£Ø¯ÙˆÙŠØ©' :
                                   item.category === 'procedures' ? 'Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª' : 'ÙØ­ÙˆØµØ§Øª';
                    
                    html += `
                        <div class="border-bottom pb-2 mb-2">
                            <div class="d-flex justify-content-between align-items-start">
                                <div class="flex-grow-1">
                                    <strong>${item.title}</strong>
                                    <p class="small mb-1 text-muted">${item.content.substring(0, 80)}...</p>
                                </div>
                                <span class="badge bg-warning ms-2">${category}</span>
                            </div>
                        </div>
                    `;
                });
            } else {
                const results = medicalLibrary.filter(item => 
                    item.title.toLowerCase().includes(query) || 
                    item.content.toLowerCase().includes(query)
                );
                
                if (results.length === 0) {
                    html = '<p class="text-muted text-center py-4">Ù„Ø§ ØªÙˆØ¬Ø¯ Ù†ØªØ§Ø¦Ø¬</p>';
                } else {
                    results.forEach(item => {
                        const category = item.category === 'diseases' ? 'Ø£Ù…Ø±Ø§Ø¶' :
                                       item.category === 'drugs' ? 'Ø£Ø¯ÙˆÙŠØ©' :
                                       item.category === 'procedures' ? 'Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª' : 'ÙØ­ÙˆØµØ§Øª';
                        
                        html += `
                            <div class="border-bottom pb-2 mb-2">
                                <div class="d-flex justify-content-between align-items-start">
                                    <div class="flex-grow-1">
                                        <strong>${item.title}</strong>
                                        <p class="small mb-1 text-muted">${item.content.substring(0, 80)}...</p>
                                    </div>
                                    <span class="badge bg-warning ms-2">${category}</span>
                                </div>
                            </div>
                        `;
                    });
                }
            }
            
            container.innerHTML = html;
        }

        function filterLibrary(category) {
            const container = document.getElementById('medicalLibraryContent');
            
            let html = '';
            const filtered = category === 'all' ? medicalLibrary : medicalLibrary.filter(item => item.category === category);
            
            filtered.slice(0, 10).forEach(item => {
                const categoryName = item.category === 'diseases' ? 'Ø£Ù…Ø±Ø§Ø¶' :
                                   item.category === 'drugs' ? 'Ø£Ø¯ÙˆÙŠØ©' :
                                   item.category === 'procedures' ? 'Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª' : 'ÙØ­ÙˆØµØ§Øª';
                
                html += `
                    <div class="border-bottom pb-2 mb-2">
                        <div class="d-flex justify-content-between align-items-start">
                            <div class="flex-grow-1">
                                <strong>${item.title}</strong>
                                <p class="small mb-1 text-muted">${item.content.substring(0, 80)}...</p>
                            </div>
                            <span class="badge bg-warning ms-2">${categoryName}</span>
                        </div>
                    </div>
                `;
            });
            
            if (filtered.length === 0) {
                html = '<p class="text-muted text-center py-4">Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…ÙˆØ§Ø¯ ÙÙŠ Ù‡Ø°Ø§ Ø§Ù„Ù‚Ø³Ù…</p>';
            }
            
            container.innerHTML = html;
        }

        function addToLibrary() {
            const title = prompt('Ø£Ø¯Ø®Ù„ Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ù…Ø§Ø¯Ø© Ø§Ù„Ø¹Ù„Ù…ÙŠØ©:');
            if (!title) return;
            
            const category = prompt('Ø£Ø¯Ø®Ù„ Ø§Ù„Ù‚Ø³Ù… (diseases, drugs, procedures, tests):');
            if (!category) return;
            
            const content = prompt('Ø£Ø¯Ø®Ù„ Ù…Ø­ØªÙˆÙ‰ Ø§Ù„Ù…Ø§Ø¯Ø© Ø§Ù„Ø¹Ù„Ù…ÙŠØ©:');
            if (!content) return;
            
            const newItem = {
                id: Date.now(),
                title: title,
                category: category,
                content: content,
                addedBy: currentUser ? currentUser.u : 'admin',
                addedAt: new Date().toISOString()
            };
            
            medicalLibrary.push(newItem);
            localStorage.setItem('shifa_library', JSON.stringify(medicalLibrary));
            
            showNotification('ğŸ“š ØªÙ…Øª Ø§Ù„Ø¥Ø¶Ø§ÙØ©', 'ØªÙ… Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…Ø§Ø¯Ø© Ø§Ù„Ø¹Ù„Ù…ÙŠØ© Ø¨Ù†Ø¬Ø§Ø­');
            searchMedicalLibrary();
        }

        // ØªÙ‡ÙŠØ¦Ø© Ù‚Ø³Ù… Ø§Ù„Ù…Ø¯ÙŠØ±
        function initAdminSection() {
            updateFinancialStats();
            updateFinancialTransactions();
            updateActiveStaff();
            updateAdminAlerts();
            updateRecentActivities();
            loadSystemSettings();
            refreshStaffTable();
            loadAdminPatientsTable();
            searchMedicalLibrary();
            
            // ØªØ­Ø¯ÙŠØ« ÙƒÙ„ 30 Ø«Ø§Ù†ÙŠØ©
            setInterval(() => {
                updateFinancialStats();
                updateFinancialTransactions();
                updateRecentActivities();
            }, 30000);
        }

        // ============================================
        // Ø¯ÙˆØ§Ù„ Ø§Ù„Ù†Ø¸Ø§Ù… Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ© (Ù…Ø­ÙÙˆØ¸Ø©)
        // ============================================

        // Ø¯Ø§Ù„Ø© ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ù…Ø±ÙŠØ¶ (Ù…Ø­ÙÙˆØ¸Ø©)
        function registerPatient() {
            const name = document.getElementById('pName').value.trim();
            const age = document.getElementById('pAge').value;
            const phone = document.getElementById('pPhone').value.trim();
            
            if (!name || !age) {
                alert("âš ï¸ Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„Ø§Ø³Ù… ÙˆØ§Ù„Ø¹Ù…Ø±!");
                return;
            }
            
            const patientId = Date.now();
            const newPatient = {
                id: patientId,
                name: name,
                age: age,
                gender: document.getElementById('pGender').value,
                phone: phone,
                address: document.getElementById('pAddress').value,
                ticket: parseInt(document.getElementById('pTicket').value) || 5000,
                visitType: document.getElementById('pVisitType').value,
                medicalHistory: document.getElementById('pMedicalHistory').value,
                status: 'waiting',
                department: 'reception',
                createdAt: new Date().toISOString(),
                updatedAt: new Date().toISOString(),
                vitalSigns: {},
                complaint: '',
                diagnosis: '',
                labRequests: [],
                labResults: [],
                medications: [],
                nursingOrders: [],
                payments: []
            };
            
            patients.push(newPatient);
            localStorage.setItem('shifa_pats', JSON.stringify(patients));
            
            // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª
            financials.clinic += newPatient.ticket;
            localStorage.setItem('shifa_fin', JSON.stringify(financials));
            
            // Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø§Ù„Ø­Ù‚ÙˆÙ„
            document.getElementById('pName').value = '';
            document.getElementById('pAge').value = '';
            document.getElementById('pPhone').value = '';
            document.getElementById('pAddress').value = '';
            document.getElementById('pMedicalHistory').value = '';
            
            showNotification("âœ… ØªÙ… Ø§Ù„ØªØ³Ø¬ÙŠÙ„", `ØªÙ… ØªØ³Ø¬ÙŠÙ„ ${name} Ø¨Ù†Ø¬Ø§Ø­`);
            
            updateFinancialStats();
            updateBadges();
        }

        // Ø¯ÙˆØ§Ù„ Ø£Ø®Ø±Ù‰ Ù…Ø­ÙÙˆØ¸Ø© Ù…Ù† Ø§Ù„Ù†Ø¸Ø§Ù…...
        // ... [Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¯ÙˆØ§Ù„ Ø§Ù„Ø³Ø§Ø¨Ù‚Ø© ØªØ¨Ù‚Ù‰ ÙƒÙ…Ø§ Ù‡ÙŠ] ...

        // ============================================
        // ØªÙ‡ÙŠØ¦Ø© Ø§Ù„Ù†Ø¸Ø§Ù…
        // ============================================

        window.onload = function() {
            // ØªÙ‡ÙŠØ¦Ø© Ø§Ù„Ø³Ø§Ø¹Ø©
            updateClock();
            setInterval(updateClock, 1000);
            
            // Ø·Ù„Ø¨ Ø¥Ø°Ù† Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª
            if ('Notification' in window && Notification.permission === 'default') {
                Notification.requestPermission();
            }
            
            // Ø¥Ø°Ø§ ÙƒØ§Ù† Ù‡Ù†Ø§Ùƒ Ù…Ø³ØªØ®Ø¯Ù… Ù…Ø³Ø¬Ù„ Ù…Ø³Ø¨Ù‚Ø§Ù‹
            if (currentUser) {
                document.getElementById('loginOverlay').classList.add('hidden-section');
                document.getElementById('mainContent').classList.remove('hidden-section');
                document.getElementById('currentUserDisplay').textContent = `ğŸ‘¤ ${currentUser.u}`;
                
                // ØªÙ‡ÙŠØ¦Ø© Ù‚Ø³Ù… Ø§Ù„Ù…Ø¯ÙŠØ± Ø¥Ø°Ø§ ÙƒØ§Ù† Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ù…Ø¯ÙŠØ±Ø§Ù‹
                if (currentUser.r === 'admin' || currentUser.r === 'super_admin') {
                    initAdminSection();
                }
                
                switchSection('reception');
            }
        };

        function updateClock() {
            const now = new Date();
            document.getElementById('clockDisplay').textContent = now.toLocaleTimeString('ar-EG');
        }

        function switchSection(id) {
            // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„ØµÙ„Ø§Ø­ÙŠØ©
            if (id === 'admin' && !(currentUser.r === 'admin' || currentUser.r === 'super_admin')) {
                alert('â›” Ù„ÙŠØ³ Ù„Ø¯ÙŠÙƒ ØµÙ„Ø§Ø­ÙŠØ© Ù„Ù„ÙˆØµÙˆÙ„ Ù„Ù‚Ø³Ù… Ø§Ù„Ù…Ø¯ÙŠØ±!');
                return;
            }
            
            document.querySelectorAll('.section-pane').forEach(s => s.classList.add('hidden-section'));
            document.getElementById(`${id}-sec`).classList.remove('hidden-section');
            
            document.querySelectorAll('.nav-link').forEach(n => n.classList.remove('active'));
            document.getElementById(`btn-${id}`)?.classList.add('active');
            
            if (id === 'admin') {
                initAdminSection();
                showAdminTab('dashboard');
            }
            
            updateBadges();
        }

        function handleLogin() {
            const username = document.getElementById('username').value;
            const password = document.getElementById('password').value;
            
            // Ù…ØµØ§Ø¯Ù‚Ø© Ø¨Ø³ÙŠØ·Ø©
            if (username === 'admin' && password === '123') {
                currentUser = { u: 'admin', r: 'admin', name: 'Ø§Ù„Ù…Ø¯ÙŠØ±' };
                localStorage.setItem('shifa_user', JSON.stringify(currentUser));
                
                document.getElementById('loginOverlay').classList.add('hidden-section');
                document.getElementById('mainContent').classList.remove('hidden-section');
                document.getElementById('currentUserDisplay').textContent = `ğŸ‘¤ ${currentUser.u}`;
                
                initAdminSection();
                switchSection('admin');
                showNotification("Ù…Ø±Ø­Ø¨Ø§Ù‹ Ø¨Ùƒ", "ØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ ÙƒÙ…Ø¯ÙŠØ± Ù†Ø¸Ø§Ù…!");
            } else if (username === 'doctor' && password === 'doc123') {
                currentUser = { u: 'doctor', r: 'doctor', name: 'Ø§Ù„Ø·Ø¨ÙŠØ¨' };
                localStorage.setItem('shifa_user', JSON.stringify(currentUser));
                
                document.getElementById('loginOverlay').classList.add('hidden-section');
                document.getElementById('mainContent').classList.remove('hidden-section');
                document.getElementById('currentUserDisplay').textContent = `ğŸ‘¤ ${currentUser.u}`;
                
                switchSection('doctor');
                showNotification("Ù…Ø±Ø­Ø¨Ø§Ù‹ Ø¯ÙƒØªÙˆØ±", "Ø¬Ø§Ù‡Ø² Ù„Ø§Ø³ØªÙ‚Ø¨Ø§Ù„ Ø§Ù„Ù…Ø±Ø¶Ù‰!");
            } else if (username === 'reception' && password === 'rec123') {
                currentUser = { u: 'reception', r: 'reception', name: 'Ø§Ù„Ø§Ø³ØªÙ‚Ø¨Ø§Ù„' };
                localStorage.setItem('shifa_user', JSON.stringify(currentUser));
                
                document.getElementById('loginOverlay').classList.add('hidden-section');
                document.getElementById('mainContent').classList.remove('hidden-section');
                document.getElementById('currentUserDisplay').textContent = `ğŸ‘¤ ${currentUser.u}`;
                
                switchSection('reception');
                showNotification("Ù…Ø±Ø­Ø¨Ø§Ù‹", "Ø¬Ø§Ù‡Ø² Ù„ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ù…Ø±Ø¶Ù‰!");
            } else {
                alert("âŒ Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø£Ùˆ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± ØºÙŠØ± ØµØ­ÙŠØ­Ø©!");
            }
        }

        function logout() {
            localStorage.removeItem('shifa_user');
            location.reload();
        }

        function showNotification(title, message) {
            console.log(`ğŸ”” ${title}: ${message}`);
            
            // ØµÙˆØª Ø§Ù„ØªÙ†Ø¨ÙŠÙ‡
            try {
                document.getElementById('notificationSound').play();
            } catch (e) {}
            
            // Ø¥Ø´Ø¹Ø§Ø± ÙˆÙŠØ¨
            if ('Notification' in window && Notification.permission === 'granted') {
                new Notification(title, {
                    body: message,
                    icon: 'https://cdn-icons-png.flaticon.com/512/822/822118.png'
                });
            }
        }

        // Ø¯ÙˆØ§Ù„ Ù…Ø³Ø§Ø¹Ø¯Ø© Ø£Ø®Ø±Ù‰...
        function updateBadges() {
            // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¹Ø¯Ø§Ø¯Ø§Øª ÙÙŠ Ø§Ù„ØªØ¨ÙˆÙŠØ¨Ø§Øª
            const waitingPatients = patients.filter(p => p.department === 'reception' || p.department === 'doctor').length;
            const pendingTests = labRequests.filter(l => l.status === 'pending').length;
            const pendingRx = pharmOrders.filter(r => r.status === 'pending').length;
            
            if (waitingPatients > 0) {
                document.getElementById('doctorBadge').textContent = waitingPatients;
                document.getElementById('doctorBadge').classList.remove('hidden-section');
            } else {
                document.getElementById('doctorBadge').classList.add('hidden-section');
            }
            
            if (pendingTests > 0) {
                document.getElementById('labBadge').textContent = pendingTests;
                document.getElementById('labBadge').classList.remove('hidden-section');
            } else {
                document.getElementById('labBadge').classList.add('hidden-section');
            }
            
            if (pendingRx > 0) {
                document.getElementById('pharBadge').textContent = pendingRx;
                document.getElementById('pharBadge').classList.remove('hidden-section');
            } else {
                document.getElementById('pharBadge').classList.add('hidden-section');
            }
        }

        // Ø¨Ø§Ù‚ÙŠ Ø§Ù„Ø¯ÙˆØ§Ù„ Ø§Ù„Ù…Ø­ÙÙˆØ¸Ø©...
    </script>
    
    <!-- Service Worker Script -->
    <script>
        if ('serviceWorker' in navigator) {
            navigator.serviceWorker.register('service-worker.js').then(function(registration) {
                console.log('Service Worker registered with scope:', registration.scope);
            }).catch(function(error) {
                console.log('Service Worker registration failed:', error);
            });
        }
    </script>
</body>
</html>
