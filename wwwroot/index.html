<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="theme-color" content="#2c7a7b">
    <title>Ù…Ø¬Ù…Ø¹ Ø§Ù„Ø´ÙØ§Ø¡ - Ø§Ù„Ù†Ø¸Ø§Ù… Ø§Ù„Ù…ØªÙƒØ§Ù…Ù„ 2026</title>
    
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.rtl.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css"/>
    
    <style>
        :root { 
            --primary-color: #2c7a7b; 
            --secondary-color: #f0fdf4; 
            --accent-blue: #0d6efd; 
            --accent-red: #dc3545; 
            --accent-green: #198754; 
            --accent-gold: #d4af37;
            --accent-purple: #6f42c1; /* Ù„ÙˆÙ† Ø¬Ø¯ÙŠØ¯ Ù„Ù‚Ø³Ù… Ø§Ù„ØªÙ…Ø±ÙŠØ¶ */
        }
        body { background-color: #f4f7f6; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; }
        .navbar { background: linear-gradient(135deg, var(--primary-color), #1f5a5a) !important; box-shadow: 0 2px 15px rgba(0,0,0,0.2); }
        .card { border-radius: 18px; border: none; box-shadow: 0 4px 15px rgba(0,0,0,0.05); margin-bottom: 20px; }
        .hidden-section { display: none !important; }
        .nav-link { cursor: pointer; font-weight: bold; color: var(--primary-color); padding: 12px 15px !important; }
        .nav-link.active { background-color: var(--primary-color) !important; color: white !important; border-radius: 12px; }
        .patient-card { border-right: 6px solid var(--primary-color); cursor: pointer; transition: 0.3s; background: white; }
        .patient-card:hover { background-color: #e6fffa; }
        .stat-card { border-radius: 18px; padding: 25px; color: white; text-align: center; }
        .btn-action { border-radius: 10px; font-weight: 600; }
    </style>
</head>
<body>

    <audio id="notificationSound" src="https://assets.mixkit.co/active_storage/sfx/2869/2869-preview.mp3" preload="auto"></audio>

    <div id="loginOverlay" class="no-print" style="position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: linear-gradient(rgba(44, 122, 123, 0.9), rgba(44, 122, 123, 0.8)); z-index: 9999; display: flex; align-items: center; justify-content: center;">
        <div class="card p-4 shadow-lg animate__animated animate__zoomIn" style="width: 380px; border-top: 8px solid var(--accent-gold);">
            <div class="text-center mb-4">
                <h3 class="fw-bold" style="color: var(--primary-color);">Ù…Ø¬Ù…Ø¹ Ø§Ù„Ø´ÙØ§Ø¡ Ø§Ù„Ø·Ø¨ÙŠ</h3>
                <p class="text-muted small">ØªØ³Ø¬ÙŠÙ„ Ø¯Ø®ÙˆÙ„ Ø§Ù„Ø·Ø§Ù‚Ù… Ø§Ù„Ø·Ø¨ÙŠ</p>
            </div>
            <input type="text" id="username" class="form-control mb-3" placeholder="Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…">
            <input type="password" id="password" class="form-control mb-3" placeholder="ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±">
            <button class="btn btn-primary w-100 fw-bold btn-action" onclick="handleLogin()">ğŸš€ Ø¯Ø®ÙˆÙ„ Ù„Ù„Ù†Ø¸Ø§Ù…</button>
        </div>
    </div>

    <div id="mainContent" class="hidden-section animate__animated animate__fadeIn">
        <nav class="navbar navbar-dark mb-4 no-print py-3">
            <div class="container d-flex justify-content-between">
                <span class="navbar-brand fw-bold fs-4">ğŸ¥ Ù…Ø¬Ù…Ø¹ Ø§Ù„Ø´ÙØ§Ø¡ Ø§Ù„Ø°ÙƒÙŠ</span>
                <div class="d-flex align-items-center">
                    <span id="currentUserDisplay" class="badge bg-white text-dark p-2 mx-2"></span>
                    <button class="btn btn-sm btn-outline-light rounded-pill" onclick="logout()">Ø®Ø±ÙˆØ¬</button>
                </div>
            </div>
        </nav>

        <div class="container">
            <ul class="nav nav-pills mb-4 shadow-sm p-2 bg-white rounded-4 justify-content-center no-print" id="mainTabs">
                <li class="nav-item"><button class="nav-link" id="btn-reception" onclick="switchSection('reception')">ğŸ“‹ Ø§Ù„Ø§Ø³ØªÙ‚Ø¨Ø§Ù„</button></li>
                <li class="nav-item"><button class="nav-link" id="btn-doctor" onclick="switchSection('doctor')">ğŸ‘¨â€âš•ï¸ Ø§Ù„Ø·Ø¨ÙŠØ¨ <span id="doctorBadge" class="badge bg-danger ms-1 hidden-section">0</span></button></li>
                <li class="nav-item"><button class="nav-link" id="btn-nurse" onclick="switchSection('nurse')">ğŸ’‰ Ø§Ù„ØªÙ…Ø±ÙŠØ¶ <span id="nurseBadge" class="badge bg-danger ms-1 hidden-section">0</span></button></li>
                <li class="nav-item"><button class="nav-link" id="btn-lab" onclick="switchSection('lab')">ğŸ§ª Ø§Ù„Ù…Ø¹Ù…Ù„ <span id="labBadge" class="badge bg-danger ms-1 hidden-section">0</span></button></li>
                <li class="nav-item"><button class="nav-link" id="btn-pharmacy" onclick="switchSection('pharmacy')">ğŸ’Š Ø§Ù„ØµÙŠØ¯Ù„ÙŠØ© <span id="pharBadge" class="badge bg-danger ms-1 hidden-section">0</span></button></li>
                <li class="nav-item"><button class="nav-link" id="btn-admin" onclick="switchSection('admin')">ğŸ‘‘ Ø§Ù„Ù…Ø¯ÙŠØ±</button></li>
            </ul>

            <div id="reception-sec" class="section-pane hidden-section">
                <div class="row">
                    <div class="col-md-4">
                        <div class="card p-4 border-top border-primary border-4">
                            <h5 class="fw-bold mb-3">ØªØ³Ø¬ÙŠÙ„ Ù…Ø±ÙŠØ¶</h5>
                            <input type="text" id="pName" class="form-control mb-2" placeholder="Ø§Ø³Ù… Ø§Ù„Ù…Ø±ÙŠØ¶">
                            <input type="number" id="pAge" class="form-control mb-2" placeholder="Ø§Ù„Ø¹Ù…Ø±">
                            <button class="btn btn-primary w-100 btn-action" onclick="registerPatient()">âœ… Ø¥Ø±Ø³Ø§Ù„ Ù„Ù„ÙƒØ´Ù</button>
                        </div>
                    </div>
                    <div class="col-md-8">
                        <div class="card p-4">
                            <h5 class="fw-bold mb-3">Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø±</h5>
                            <div id="receptionList"></div>
                        </div>
                    </div>
                </div>
            </div>

            <div id="doctor-sec" class="section-pane hidden-section">
                <div class="row">
                    <div class="col-md-4">
                        <div class="card p-3">
                            <h6 class="fw-bold">Ø¨Ø§Ù†ØªØ¸Ø§Ø± Ø§Ù„Ø·Ø¨ÙŠØ¨</h6>
                            <div id="doctorQueue"></div>
                        </div>
                    </div>
                    <div class="col-md-8">
                        <div id="doctorWorkArea" class="card p-4 hidden-section border-top border-success border-5">
                            <h4 id="currentPatientName" class="text-success fw-bold"></h4>
                            <hr>
                            <textarea id="diagnosis" class="form-control mb-3" rows="3" placeholder="Ø§Ù„ØªØ´Ø®ÙŠØµ..."></textarea>
                            
                            <div class="mb-3">
                                <label class="fw-bold text-purple small">ğŸ’‰ Ø£ÙˆØ§Ù…Ø± Ø§Ù„ØªÙ…Ø±ÙŠØ¶ (Ø­Ù‚Ù†/Ø¯Ø±ÙŠØ¨Ø§Øª):</label>
                                <input type="text" id="nurseOrders" class="form-control border-purple" placeholder="Ù…Ø«Ø§Ù„: Ø¯Ø±Ø¨ Ù…Ù„Ø­ÙŠ + Ø­Ù‚Ù†Ø© Ø¯ÙŠÙƒØ³Ø§">
                            </div>

                            <div class="row g-2">
                                <div class="col-md-4"><button class="btn btn-outline-purple w-100" onclick="orderNurse()">ğŸ’‰ Ø¥Ø±Ø³Ø§Ù„ Ù„Ù„ØªÙ…Ø±ÙŠØ¶</button></div>
                                <div class="col-md-4"><button class="btn btn-outline-danger w-100" onclick="orderLab()">ğŸ§ª Ø·Ù„Ø¨ Ù…Ø¹Ù…Ù„</button></div>
                                <div class="col-md-4"><button class="btn btn-outline-warning w-100" onclick="orderPharmacy()">ğŸ’Š Ø·Ù„Ø¨ Ø¯ÙˆØ§Ø¡</button></div>
                            </div>
                            <button class="btn btn-success w-100 mt-3 btn-action" onclick="completeVisit()">ğŸ Ø¥Ù†Ù‡Ø§Ø¡ Ø§Ù„Ø²ÙŠØ§Ø±Ø©</button>
                        </div>
                    </div>
                </div>
            </div>

            <div id="nurse-sec" class="section-pane hidden-section">
                <div class="card p-4 border-top border-purple border-5" style="border-top-color: var(--accent-purple) !important;">
                    <h5 class="fw-bold mb-4">ğŸ’‰ Ù‚Ø³Ù… Ø§Ù„ØªÙ…Ø±ÙŠØ¶ - ØªÙ†ÙÙŠØ° Ø§Ù„Ø¬Ø±Ø¹Ø§Øª ÙˆØ§Ù„Ø¹Ù„Ø§Ø¬Ø§Øª</h5>
                    <div id="nurseList" class="row g-3"></div>
                </div>
            </div>

            <div id="lab-sec" class="section-pane hidden-section">
                <div class="card p-4 border-top border-danger border-5"><h5>ğŸ§ª Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ù…Ø¹Ù…Ù„</h5><div id="labList"></div></div>
            </div>
            <div id="pharmacy-sec" class="section-pane hidden-section">
                <div class="card p-4 border-top border-warning border-5"><h5>ğŸ’Š Ø§Ù„ØµÙŠØ¯Ù„ÙŠØ©</h5><div id="pharmacyList"></div></div>
            </div>
            <div id="admin-sec" class="section-pane hidden-section">
                <div class="row g-3 mb-4" id="adminStats"></div>
                <div class="card p-4"><h5>ğŸ“Š Ø³Ø¬Ù„ Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª</h5><table class="table"><tbody id="adminLogs"></tbody></table></div>
            </div>

        </div>
    </div>

    <script>
        let patients = JSON.parse(localStorage.getItem('shifa_pats')) || [];
        let currentUser = null;
        let activePatient = null;

        // Ø§Ù„Ø¯Ø®ÙˆÙ„ Ù…Ø¹ Ø¥Ø¶Ø§ÙØ© ØµÙ„Ø§Ø­ÙŠØ© Ø§Ù„Ù…Ù…Ø±Ø¶
        function handleLogin() {
            const user = document.getElementById('username').value.trim().toLowerCase();
            const pass = document.getElementById('password').value;
            
            if (pass === '123') {
                currentUser = { u: user, r: user }; 
                document.getElementById('loginOverlay').classList.add('hidden-section');
                document.getElementById('mainContent').classList.remove('hidden-section');
                document.getElementById('currentUserDisplay').innerHTML = `ğŸ‘¤ <b>${user}</b>`;
                
                // ØªÙˆØ¬ÙŠÙ‡ ØªÙ„Ù‚Ø§Ø¦ÙŠ Ø­Ø³Ø¨ Ø§Ù„ØªØ®ØµØµ
                if(user === 'nurse') switchSection('nurse');
                else if(user === 'doctor') switchSection('doctor');
                else if(user === 'admin') switchSection('admin');
                else switchSection('reception');
            } else { alert("Ø®Ø·Ø£!"); }
        }

        function logout() { location.reload(); }

        function switchSection(id) {
            document.querySelectorAll('.section-pane').forEach(s => s.classList.add('hidden-section'));
            document.getElementById(`${id}-sec`).classList.remove('hidden-section');
            document.querySelectorAll('.nav-link').forEach(n => n.classList.remove('active'));
            if(document.getElementById(`btn-${id}`)) document.getElementById(`btn-${id}`).classList.add('active');
            updateBadges();
            if (window[`load${id.charAt(0).toUpperCase() + id.slice(1)}`]) window[`load${id.charAt(0).toUpperCase() + id.slice(1)}`]();
        }

        // --- Ù…ÙŠØ²Ø§Øª Ø§Ù„Ø·Ø¨ÙŠØ¨ Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø© ---
        function selectPatient(id) {
            activePatient = patients.find(p => p.id === id);
            document.getElementById('doctorWorkArea').classList.remove('hidden-section');
            document.getElementById('currentPatientName').textContent = activePatient.name;
            document.getElementById('diagnosis').value = activePatient.diagnosis || '';
            document.getElementById('nurseOrders').value = '';
        }

        function orderNurse() {
            const orders = document.getElementById('nurseOrders').value;
            if(!orders) return alert("Ø§ÙƒØªØ¨ Ø§Ù„Ø¬Ø±Ø¹Ø© Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø© Ø£ÙˆÙ„Ø§Ù‹!");
            activePatient.nurseOrders = orders;
            activePatient.status = 'waiting_nurse';
            saveData();
            alert("ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ù…Ø±ÙŠØ¶ Ù„Ù„ØªÙ…Ø±ÙŠØ¶");
            switchSection('doctor');
        }

        // --- Ù…ÙŠØ²Ø§Øª Ø§Ù„ØªÙ…Ø±ÙŠØ¶ Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø© ---
        function loadNurse() {
            const list = document.getElementById('nurseList');
            const waiting = patients.filter(p => p.status === 'waiting_nurse');
            if(waiting.length === 0) {
                list.innerHTML = '<div class="text-center p-5 text-muted">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¬Ø±Ø¹Ø§Øª Ø¹Ù„Ø§Ø¬ÙŠØ© Ù…Ø·Ù„ÙˆØ¨Ø© Ø­Ø§Ù„ÙŠØ§Ù‹</div>';
                return;
            }
            list.innerHTML = waiting.map(p => `
                <div class="col-md-6 animate__animated animate__fadeInIn">
                    <div class="card p-3 border-start border-primary border-5 shadow-sm" style="border-right: 5px solid var(--accent-purple)">
                        <h6 class="fw-bold text-purple">${p.name}</h6>
                        <div class="bg-light p-2 rounded mb-2">
                            <small class="fw-bold">Ø§Ù„Ø¬Ø±Ø¹Ø© Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©:</small><br>
                            <span class="text-danger">${p.nurseOrders}</span>
                        </div>
                        <button class="btn btn-purple btn-sm w-100 text-white" style="background: var(--accent-purple)" onclick="finishNurse(${p.id})">âœ… ØªÙ… Ø¥Ø¹Ø·Ø§Ø¡ Ø§Ù„Ø¬Ø±Ø¹Ø©</button>
                    </div>
                </div>
            `).join('');
        }

        function finishNurse(id) {
            let p = patients.find(x => x.id === id);
            p.status = 'waiting_doctor'; // ÙŠØ¹ÙˆØ¯ Ù„Ù„Ø·Ø¨ÙŠØ¨ Ø¨Ø¹Ø¯ Ø§Ù„Ø¬Ø±Ø¹Ø© Ù„Ù„ØªØ£ÙƒØ¯
            saveData();
            loadNurse();
            playNotify();
        }

        // --- Ø§Ù„Ø¯ÙˆØ§Ù„ Ø§Ù„Ù…Ø³Ø§Ø¹Ø¯Ø© Ø§Ù„Ù…Ø³ØªÙ…Ø±Ø© ---
        function registerPatient() {
            const name = document.getElementById('pName').value;
            if(!name) return;
            patients.push({ id: Date.now(), name: name, status: 'waiting_doctor', time: new Date().toLocaleTimeString('ar-EG') });
            saveData();
            loadReception();
        }

        function loadReception() {
            document.getElementById('receptionList').innerHTML = patients.slice().reverse().map(p => `
                <div class="card p-2 mb-2 patient-card">${p.name} - <small>${p.status}</small></div>
            `).join('');
        }

        function loadDoctor() {
            const waiting = patients.filter(p => p.status === 'waiting_doctor');
            document.getElementById('doctorQueue').innerHTML = waiting.map(p => `
                <button class="btn btn-light w-100 mb-2 border shadow-sm" onclick="selectPatient(${p.id})">${p.name}</button>
            `).join('');
        }

        function orderLab() { activePatient.status = 'waiting_lab'; saveData(); switchSection('doctor'); }
        function orderPharmacy() { activePatient.status = 'waiting_pharmacy'; saveData(); switchSection('doctor'); }
        function completeVisit() { activePatient.status = 'completed'; saveData(); switchSection('doctor'); }

        function saveData() {
            localStorage.setItem('shifa_pats', JSON.stringify(patients));
            updateBadges();
        }

        function updateBadges() {
            const counts = {
                doctor: patients.filter(p => p.status === 'waiting_doctor').length,
                nurse: patients.filter(p => p.status === 'waiting_nurse').length,
                lab: patients.filter(p => p.status === 'waiting_lab').length,
                pharmacy: patients.filter(p => p.status === 'waiting_pharmacy').length
            };
            Object.keys(counts).forEach(k => {
                const el = document.getElementById(`${k}Badge`);
                if(el) {
                    el.textContent = counts[k];
                    counts[k] > 0 ? el.classList.remove('hidden-section') : el.classList.add('hidden-section');
                }
            });
        }

        function playNotify() { document.getElementById('notificationSound').play().catch(()=>{}); }

        window.onload = updateBadges;
    </script>
</body>
</html>
