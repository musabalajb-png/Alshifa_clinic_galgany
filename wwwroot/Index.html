<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ù†Ø¸Ø§Ù… Ù…Ø¬Ù…Ø¹ Ø§Ù„Ø´ÙØ§Ø¡ Ø§Ù„Ø·Ø¨ÙŠ</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/dist/css/bootstrap.rtl.min.css" rel="stylesheet">
    <style>
        :root { --primary-color: #2c7a7b; --secondary-color: #f0fdf4; }
        body { background-color: #f8fafc; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; }
        .navbar { background-color: var(--primary-color) !important; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
        .stat-card { background: white; border-radius: 15px; padding: 20px; border-right: 5px solid var(--primary-color); box-shadow: 0 4px 6px rgba(0,0,0,0.05); }
        .btn-primary { background-color: var(--primary-color); border: none; }
        .btn-primary:hover { background-color: #235e5f; }
    </style>
</head>
<body>
    <nav class="navbar navbar-dark mb-4">
        <div class="container">
            <span class="navbar-brand mb-0 h1">ğŸ¥ Ù…Ø¬Ù…Ø¹ Ø§Ù„Ø´ÙØ§Ø¡ Ø§Ù„Ø·Ø¨ÙŠ - Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…</span>
        </div>
    </nav>

    <div class="container">
        <div class="row mb-4" id="reportSummary">
            <div class="col-md-4 mb-3">
                <div class="stat-card">
                    <h6>Ù…Ø¨ÙŠØ¹Ø§Øª Ø§Ù„ÙŠÙˆÙ…</h6>
                    <h3 id="todaySales">0.00</h3>
                </div>
            </div>
            <div class="col-md-4 mb-3">
                <div class="stat-card">
                    <h6>Ø£Ø±Ø¨Ø§Ø­ Ø§Ù„ÙŠÙˆÙ…</h6>
                    <h3 id="todayProfit" class="text-success">0.00</h3>
                </div>
            </div>
            <div class="col-md-4 mb-3">
                <div class="stat-card">
                    <h6>Ù…Ø¨ÙŠØ¹Ø§Øª Ø§Ù„Ø´Ù‡Ø±</h6>
                    <h3 id="monthSales">0.00</h3>
                </div>
            </div>
        </div>

        <ul class="nav nav-pills mb-3" id="pills-tab" role="tablist">
            <li class="nav-item" role="presentation">
                <button class="nav-link active" id="pharmacy-tab" data-bs-toggle="pill" data-bs-target="#pharmacy" type="button">Ø§Ù„ØµÙŠØ¯Ù„ÙŠØ©</button>
            </li>
            <li class="nav-item" role="presentation">
                <button class="nav-link" id="clinic-tab" data-bs-toggle="pill" data-bs-target="#clinic" type="button">Ø§Ù„Ø§Ø³ØªÙ‚Ø¨Ø§Ù„</button>
            </li>
        </ul>

        <div class="tab-content" id="pills-tabContent">
            <div class="tab-pane fade show active" id="pharmacy" role="tabpanel">
                <div class="card p-3 shadow-sm">
                    <div class="d-flex justify-content-between mb-3">
                        <h5>Ù…Ø®Ø²ÙˆÙ† Ø§Ù„Ø£Ø¯ÙˆÙŠØ©</h5>
                        <input type="text" id="medSearch" class="form-control w-50" placeholder="Ø§Ø¨Ø­Ø« Ø¹Ù† Ø¯ÙˆØ§Ø¡...">
                    </div>
                    <div class="table-responsive">
                        <table class="table table-hover">
                            <thead class="table-light">
                                <tr>
                                    <th>Ø§Ù„Ø¯ÙˆØ§Ø¡</th>
                                    <th>Ø§Ù„Ø¬Ø±Ø¹Ø©</th>
                                    <th>Ø§Ù„Ù…ØªÙˆÙØ±</th>
                                    <th>Ø§Ù„Ø³Ø¹Ø±</th>
                                    <th>Ø¥Ø¬Ø±Ø§Ø¡</th>
                                </tr>
                            </thead>
                            <tbody id="medTableBody">
                                </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        const API_BASE = "https://alshifa-clinic-galgany.onrender.com/api";

        // Ø¬Ù„Ø¨ Ø§Ù„Ù…Ø®Ø²ÙˆÙ†
        async function loadInventory() {
            const res = await fetch(`${API_BASE}/Pharmacy/inventory`);
            const data = await res.json();
            const table = document.getElementById('medTableBody');
            table.innerHTML = data.map(med => `
                <tr>
                    <td>${med.name}</td>
                    <td>${med.dosage}</td>
                    <td class="${med.stockQuantity < 10 ? 'text-danger fw-bold' : ''}">${med.stockQuantity}</td>
                    <td>${med.sellingPrice}</td>
                    <td>
                        <button class="btn btn-sm btn-success" onclick="sellMed(${med.id}, 1)">ØµØ±Ù 1</button>
                    </td>
                </tr>
            `).join('');
        }

        // Ø¹Ù…Ù„ÙŠØ© Ø§Ù„Ø¨ÙŠØ¹
        async function sellMed(id, qty) {
            const res = await fetch(`${API_BASE}/Pharmacy/sell?id=${id}&quantity=${qty}`, { method: 'POST' });
            if(res.ok) {
                alert("ØªÙ…Øª Ø§Ù„Ø¹Ù…Ù„ÙŠØ© Ø¨Ù†Ø¬Ø§Ø­!");
                loadInventory();
                loadReports();
            }
        }

        // Ø¬Ù„Ø¨ Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ±
        async function loadReports() {
            const res = await fetch(`${API_BASE}/Pharmacy/reports`);
            const data = await res.json();
            document.getElementById('todaySales').innerText = data.todaySales.toLocaleString();
            document.getElementById('todayProfit').innerText = data.todayProfit.toLocaleString();
            document.getElementById('monthSales').innerText = data.thisMonthSales.toLocaleString();
        }

        // Ø§Ù„ØªØ´ØºÙŠÙ„ Ø¹Ù†Ø¯ Ø§Ù„ÙØªØ­
        window.onload = () => { loadInventory(); loadReports(); };
    </script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
